"use strict";(self.webpackChunkekydum_ui=self.webpackChunkekydum_ui||[]).push([[792],{532:()=>{const Ta=function(z,...ce){if(Ta.translate){const Le=Ta.translate(z,ce);z=Le[0],ce=Le[1]}let ae=_o(z[0],z.raw[0]);for(let Le=1;Le<z.length;Le++)ae+=ce[Le-1]+_o(z[Le],z.raw[Le]);return ae},lm=":";function _o(z,ce){return ce.charAt(0)===lm?z.substring(function fc(z,ce){for(let ae=1,Le=1;ae<z.length;ae++,Le++)if("\\"===ce[Le])Le++;else if(":"===z[ae])return ae;throw new Error(`Unterminated $localize metadata block in "${ce}".`)}(z,ce)+1):z}globalThis.$localize=Ta},571:()=>{function go(n,t){return Object.is(n,t)}let Nt=null,Os=!1,Ea=1;const on=Symbol("SIGNAL");function Te(n){const t=Nt;return Nt=n,t}const ks={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function mo(n){if(Os)throw new Error("");if(null===Nt)return;Nt.consumerOnSignalRead(n);const t=Nt.nextProducerIndex++;Gt(Nt),t<Nt.producerNode.length&&Nt.producerNode[t]!==n&&Ni(Nt)&&Ye(Nt.producerNode[t],Nt.producerIndexOfThis[t]),Nt.producerNode[t]!==n&&(Nt.producerNode[t]=n,Nt.producerIndexOfThis[t]=Ni(Nt)?Ot(n,Nt,t):0),Nt.producerLastReadVersion[t]=n.version}function yo(n){if((!Ni(n)||n.dirty)&&(n.dirty||n.lastCleanEpoch!==Ea)){if(!n.producerMustRecompute(n)&&!ae(n))return void _o(n);n.producerRecomputeValue(n),_o(n)}}function fc(n){if(void 0===n.liveConsumerNode)return;const t=Os;Os=!0;try{for(const e of n.liveConsumerNode)e.dirty||lm(e)}finally{Os=t}}function Ta(){return!1!==Nt?.consumerAllowSignalWrites}function lm(n){n.dirty=!0,fc(n),n.consumerMarkedDirty?.(n)}function _o(n){n.dirty=!1,n.lastCleanEpoch=Ea}function z(n){return n&&(n.nextProducerIndex=0),Te(n)}function ce(n,t){if(Te(t),n&&void 0!==n.producerNode&&void 0!==n.producerIndexOfThis&&void 0!==n.producerLastReadVersion){if(Ni(n))for(let e=n.nextProducerIndex;e<n.producerNode.length;e++)Ye(n.producerNode[e],n.producerIndexOfThis[e]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function ae(n){Gt(n);for(let t=0;t<n.producerNode.length;t++){const e=n.producerNode[t],i=n.producerLastReadVersion[t];if(i!==e.version||(yo(e),i!==e.version))return!0}return!1}function Le(n){if(Gt(n),Ni(n))for(let t=0;t<n.producerNode.length;t++)Ye(n.producerNode[t],n.producerIndexOfThis[t]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function Ot(n,t,e){if(Qt(n),0===n.liveConsumerNode.length&&er(n))for(let i=0;i<n.producerNode.length;i++)n.producerIndexOfThis[i]=Ot(n.producerNode[i],n,i);return n.liveConsumerIndexOfThis.push(e),n.liveConsumerNode.push(t)-1}function Ye(n,t){if(Qt(n),1===n.liveConsumerNode.length&&er(n))for(let i=0;i<n.producerNode.length;i++)Ye(n.producerNode[i],n.producerIndexOfThis[i]);const e=n.liveConsumerNode.length-1;if(n.liveConsumerNode[t]=n.liveConsumerNode[e],n.liveConsumerIndexOfThis[t]=n.liveConsumerIndexOfThis[e],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,t<n.liveConsumerNode.length){const i=n.liveConsumerIndexOfThis[t],r=n.liveConsumerNode[t];Gt(r),r.producerIndexOfThis[i]=t}}function Ni(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Gt(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function Qt(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function er(n){return void 0!==n.producerNode}const tr=Symbol("UNSET"),Jr=Symbol("COMPUTING"),Sr=Symbol("ERRORED"),nr={...ks,value:tr,dirty:!0,error:null,equal:go,kind:"computed",producerMustRecompute:n=>n.value===tr||n.value===Jr,producerRecomputeValue(n){if(n.value===Jr)throw new Error("Detected cycle in computations.");const t=n.value;n.value=Jr;const e=z(n);let i,r=!1;try{i=n.computation(),Te(null),r=t!==tr&&t!==Sr&&i!==Sr&&n.equal(t,i)}catch(s){i=Sr,n.error=s}finally{ce(n,e)}r?n.value=t:(n.value=i,n.version++)}};let Ls=function Hd(){throw new Error};function hc(n){Ls(n)}function Wd(n,t){Ta()||hc(n),n.equal(n.value,t)||(n.value=t,function M2(n){n.version++,function Vd(){Ea++}(),fc(n)}(n))}const cm={...ks,equal:go,value:void 0,kind:"signal"};let um;function Kd(){return um}function Ps(n){const t=um;return um=n,t}const dm=Symbol("NotFound");function We(n){return"function"==typeof n}function fm(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Error;const hm=fm(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function zd(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class kn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(We(i))try{i()}catch(s){t=s instanceof hm?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{KD(s)}catch(o){t=t??[],o instanceof hm?t=[...t,...o.errors]:t.push(o)}}if(t)throw new hm(t)}}add(t){var e;if(t&&t!==this)if(this.closed)KD(t);else{if(t instanceof kn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&zd(e,t)}remove(t){const{_finalizers:e}=this;e&&zd(e,t),t instanceof kn&&t._removeParent(this)}}kn.EMPTY=(()=>{const n=new kn;return n.closed=!0,n})();const GD=kn.EMPTY;function WD(n){return n instanceof kn||n&&"closed"in n&&We(n.remove)&&We(n.add)&&We(n.unsubscribe)}function KD(n){We(n)?n():n.unsubscribe()}const vo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},qd={setTimeout(n,t,...e){const{delegate:i}=qd;return i?.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=qd;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function zD(n){qd.setTimeout(()=>{const{onUnhandledError:t}=vo;if(!t)throw n;t(n)})}function pc(){}const F2=pm("C",void 0,void 0);function pm(n,t,e){return{kind:n,value:t,error:e}}let bo=null;function Yd(n){if(vo.useDeprecatedSynchronousErrorHandling){const t=!bo;if(t&&(bo={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=bo;if(bo=null,e)throw i}}else n()}class gm extends kn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,WD(t)&&t.add(this)):this.destination=G2}static create(t,e,i){return new ym(t,e,i)}next(t){this.isStopped?_m(function U2(n){return pm("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?_m(function B2(n){return pm("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?_m(F2,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const V2=Function.prototype.bind;function mm(n,t){return V2.call(n,t)}class j2{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Qd(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Qd(i)}else Qd(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Qd(e)}}}class ym extends gm{constructor(t,e,i){let r;if(super(),We(t)||!t)r={next:t??void 0,error:e??void 0,complete:i??void 0};else{let s;this&&vo.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&mm(t.next,s),error:t.error&&mm(t.error,s),complete:t.complete&&mm(t.complete,s)}):r=t}this.destination=new j2(r)}}function Qd(n){vo.useDeprecatedSynchronousErrorHandling?function $2(n){vo.useDeprecatedSynchronousErrorHandling&&bo&&(bo.errorThrown=!0,bo.error=n)}(n):zD(n)}function _m(n,t){const{onStoppedNotification:e}=vo;e&&qd.setTimeout(()=>e(n,t))}const G2={closed:!0,next:pc,error:function H2(n){throw n},complete:pc},vm="function"==typeof Symbol&&Symbol.observable||"@@observable";function es(n){return n}function qD(n){return 0===n.length?es:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let Dt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function z2(n){return n&&n instanceof gm||function K2(n){return n&&We(n.next)&&We(n.error)&&We(n.complete)}(n)&&WD(n)}(e)?e:new ym(e,i,r);return Yd(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=YD(i))((r,s)=>{const o=new ym({next:a=>{try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[vm](){return this}pipe(...e){return qD(e)(this)}toPromise(e){return new(e=YD(e))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=t=>new n(t),n})();function YD(n){var t;return null!==(t=n??vo.Promise)&&void 0!==t?t:Promise}const q2=fm(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ke=(()=>{class n extends Dt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new QD(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new q2}next(e){Yd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Yd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Yd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?GD:(this.currentObservers=null,s.push(e),new kn(()=>{this.currentObservers=null,zd(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new Dt;return e.source=this,e}}return n.create=(t,e)=>new QD(t,e),n})();class QD extends Ke{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:GD}}class Oi extends Ke{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function XD(n){return We(n?.lift)}function Wt(n){return t=>{if(XD(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function dt(n,t,e,i,r){return new Y2(n,t,e,i,r)}class Y2 extends gm{constructor(t,e,i,r,s,o){super(t),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=e?function(a){try{e(a)}catch(l){t.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Ne(n,t){return Wt((e,i)=>{let r=0;e.subscribe(dt(i,s=>{i.next(n.call(t,s,r++))}))})}const ZD="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss";class P extends Error{code;constructor(t,e){super(function ts(n,t){return`${function Q2(n){return`NG0${Math.abs(n)}`}(n)}${t?": "+t:""}`}(t,e)),this.code=t}}const Xd=Symbol("InputSignalNode#UNSET"),JD={...cm,transformFn:void 0,applyValueToInputSignal(n,t){Wd(n,t)}};function eT(n,t){const e=Object.create(JD);function i(){if(mo(e),e.value===Xd)throw new P(-950,null);return e.value}return e.value=n,e.transformFn=t?.transform,i[on]=e,i}function ns(n){return{toString:n}.toString()}const Ca="__parameters__";function wa(n,t,e){return ns(()=>{const i=function bm(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const o=new r(...s);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(Ca)?l[Ca]:Object.defineProperty(l,Ca,{value:[]})[Ca];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return r.prototype.ngMetadataName=n,r.annotationCls=r,r})}const Bt=globalThis;function et(n){for(let t in n)if(n[t]===et)return t;throw Error("Could not find renamed property on target object.")}function X2(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function an(n){if("string"==typeof n)return n;if(Array.isArray(n))return`[${n.map(an).join(", ")}]`;if(null==n)return""+n;const t=n.overriddenName||n.name;if(t)return`${t}`;const e=n.toString();if(null==e)return""+e;const i=e.indexOf("\n");return i>=0?e.slice(0,i):e}function Em(n,t){return n?t?`${n} ${t}`:n:t||""}const Z2=et({__forward_ref__:et});function Xe(n){return n.__forward_ref__=Xe,n.toString=function(){return an(this())},n}function be(n){return Zd(n)?n():n}function Zd(n){return"function"==typeof n&&n.hasOwnProperty(Z2)&&n.__forward_ref__===Xe}function H(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function st(n){return{providers:n.providers||[],imports:n.imports||[]}}function Jd(n){return nT(n,tf)||nT(n,iT)}function nT(n,t){return n.hasOwnProperty(t)?n[t]:null}function ef(n){return n&&(n.hasOwnProperty(Dm)||n.hasOwnProperty(rB))?n[Dm]:null}const tf=et({\u0275prov:et}),Dm=et({\u0275inj:et}),iT=et({ngInjectableDef:et}),rB=et({ngInjectorDef:et});class G{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,e){this._desc=t,this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=H({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Cm(n){return n&&!!n.\u0275providers}const Aa=et({\u0275cmp:et}),Im=et({\u0275dir:et}),wm=et({\u0275pipe:et}),sT=et({\u0275mod:et}),is=et({\u0275fac:et}),gc=et({__NG_ELEMENT_ID__:et}),oT=et({__NG_ENV_ID__:et});function Se(n){return"string"==typeof n?n:null==n?"":String(n)}function aT(n,t){throw new P(-200,n)}function Am(n,t){throw new P(-201,!1)}var Oe=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Oe||{});let xm;function lT(){return xm}function Xn(n){const t=xm;return xm=n,t}function cT(n,t,e){const i=Jd(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Oe.Optional?null:void 0!==t?t:void Am()}const Do={},Rm="__NG_DI_FLAG__";class uT{injector;constructor(t){this.injector=t}retrieve(t,e){return this.injector.get(t,e.optional?dm:Do,e)}}const sf="ngTempTokenPath",cB=/\n/gm,dT="__source";function dB(n,t=Oe.Default){if(void 0===Kd())throw new P(-203,!1);if(null===Kd())return cT(n,void 0,t);{const e=Kd();let i;return i=e instanceof uT?e.injector:e,i.get(n,t&Oe.Optional?null:void 0,t)}}function ue(n,t=Oe.Default){return(lT()||dB)(be(n),t)}function S(n,t=Oe.Default){return ue(n,af(t))}function af(n){return typeof n>"u"||"number"==typeof n?n:(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Mm(n){const t=[];for(let e=0;e<n.length;e++){const i=be(n[e]);if(Array.isArray(i)){if(0===i.length)throw new P(900,!1);let r,s=Oe.Default;for(let o=0;o<i.length;o++){const a=i[o],l=fB(a);"number"==typeof l?-1===l?r=a.token:s|=l:r=a}t.push(ue(r,s))}else t.push(ue(i))}return t}function mc(n,t){return n[Rm]=t,n.prototype[Rm]=t,n}function fB(n){return n[Rm]}const Nm=mc(wa("Optional"),8),Om=mc(wa("SkipSelf"),4);function To(n,t){return n.hasOwnProperty(is)?n[is]:null}function xa(n,t){n.forEach(e=>Array.isArray(e)?xa(e,t):t(e))}function hT(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function lf(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function pi(n,t,e){let i=yc(n,t);return i>=0?n[1|i]=e:(i=~i,function gT(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function km(n,t){const e=yc(n,t);if(e>=0)return n[1|e]}function yc(n,t){return function vB(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),o=n[s<<e];if(t===o)return s<<e;o>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const ir={},ze=[],ki=new G(""),mT=new G("",-1),Lm=new G("");class uf{get(t,e=Do){if(e===Do){const i=new Error(`NullInjectorError: No provider for ${an(t)}!`);throw i.name="NullInjectorError",i}return e}}function gi(n,t){const e=n[sT]||null;if(!e&&!0===t)throw new Error(`Type ${an(n)} does not have '\u0275mod' property.`);return e}function Be(n){return n[Aa]||null}function mi(n){return n[wm]||null}function Fs(n){return{\u0275providers:n}}function bB(...n){return{\u0275providers:Pm(0,n),\u0275fromNgModule:!0}}function Pm(n,...t){const e=[],i=new Set;let r;const s=o=>{e.push(o)};return xa(t,o=>{const a=o;df(a,s,[],i)&&(r||=[],r.push(a))}),void 0!==r&&yT(r,s),e}function yT(n,t){for(let e=0;e<n.length;e++){const{ngModule:i,providers:r}=n[e];Fm(r,s=>{t(s,i)})}}function df(n,t,e,i){if(!(n=be(n)))return!1;let r=null,s=ef(n);const o=!s&&Be(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const l=n.ngModule;if(s=ef(l),!s)return!1;r=l}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)df(c,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;i.add(r);try{xa(s.imports,u=>{df(u,t,e,i)&&(c||=[],c.push(u))})}finally{}void 0!==c&&yT(c,t)}if(!a){const c=To(r)||(()=>new r);t({provide:r,useFactory:c,deps:ze},r),t({provide:Lm,useValue:r,multi:!0},r),t({provide:ki,useValue:()=>ue(r),multi:!0},r)}const l=s.providers;if(null!=l&&!a){const c=n;Fm(l,u=>{t(u,c)})}}}return r!==n&&void 0!==n.providers}function Fm(n,t){for(let e of n)Cm(e)&&(e=e.\u0275providers),Array.isArray(e)?Fm(e,t):t(e)}const EB=et({provide:String,useValue:et});function Bm(n){return null!==n&&"object"==typeof n&&EB in n}function Co(n){return"function"==typeof n}const Um=new G(""),ff={},bT={};let $m;function hf(){return void 0===$m&&($m=new uf),$m}class An{}class Io extends An{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,jm(t,o=>this.processProvider(o)),this.records.set(mT,Ra(void 0,this)),r.has("environment")&&this.records.set(An,Ra(void 0,this));const s=this.records.get(Um);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Lm,ze,Oe.Self))}retrieve(t,e){return this.get(t,e.optional?dm:Do,e)}destroy(){_c(this),this._destroyed=!0;const t=Te(null);try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of e)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Te(t)}}onDestroy(t){return _c(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){_c(this);const e=Ps(this),i=Xn(void 0);try{return t()}finally{Ps(e),Xn(i)}}get(t,e=Do,i=Oe.Default){if(_c(this),t.hasOwnProperty(oT))return t[oT](this);i=af(i);const s=Ps(this),o=Xn(void 0);try{if(!(i&Oe.SkipSelf)){let l=this.records.get(t);if(void 0===l){const c=function wB(n){return"function"==typeof n||"object"==typeof n&&n instanceof G}(t)&&Jd(t);l=c&&this.injectableDefInScope(c)?Ra(Vm(t),ff):null,this.records.set(t,l)}if(null!=l)return this.hydrate(t,l,i)}return(i&Oe.Self?hf():this.parent).get(t,e=i&Oe.Optional&&e===Do?null:e)}catch(a){if("NullInjectorError"===a.name){if((a[sf]=a[sf]||[]).unshift(an(t)),s)throw a;return function hB(n,t,e,i){const r=n[sf];throw t[dT]&&r.unshift(t[dT]),n.message=function pB(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=an(t);if(Array.isArray(t))r=t.map(an).join(" -> ");else if("object"==typeof t){let s=[];for(let o in t)if(t.hasOwnProperty(o)){let a=t[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):an(a)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(cB,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[sf]=null,n}(a,t,"R3InjectorError",this.source)}throw a}finally{Xn(o),Ps(s)}}resolveInjectorInitializers(){const t=Te(null),e=Ps(this),i=Xn(void 0);try{const s=this.get(ki,ze,Oe.Self);for(const o of s)o()}finally{Ps(e),Xn(i),Te(t)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(an(i));return`R3Injector[${t.join(", ")}]`}processProvider(t){let e=Co(t=be(t))?t:be(t&&t.provide);const i=function SB(n){return Bm(n)?Ra(void 0,n.useValue):Ra(ET(n),ff)}(t);if(!Co(t)&&!0===t.multi){let r=this.records.get(e);r||(r=Ra(void 0,ff,!0),r.factory=()=>Mm(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e,i){const r=Te(null);try{return e.value===bT?aT(an(t)):e.value===ff&&(e.value=bT,e.value=e.factory(void 0,i)),"object"==typeof e.value&&e.value&&function IB(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Te(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;const e=be(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){const e=this._onDestroyHooks.indexOf(t);-1!==e&&this._onDestroyHooks.splice(e,1)}}function Vm(n){const t=Jd(n),e=null!==t?t.factory:To(n);if(null!==e)return e;if(n instanceof G)throw new P(204,!1);if(n instanceof Function)return function TB(n){if(n.length>0)throw new P(204,!1);const e=function iB(n){return n&&(n[tf]||n[iT])||null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new P(204,!1)}function ET(n,t,e){let i;if(Co(n)){const r=be(n);return To(r)||Vm(r)}if(Bm(n))i=()=>be(n.useValue);else if(function vT(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Mm(n.deps||[]));else if(function _T(n){return!(!n||!n.useExisting)}(n))i=(r,s)=>ue(be(n.useExisting),void 0!==s&&s&Oe.Optional?Oe.Optional:void 0);else{const r=be(n&&(n.useClass||n.provide));if(!function CB(n){return!!n.deps}(n))return To(r)||Vm(r);i=()=>new r(...Mm(n.deps))}return i}function _c(n){if(n.destroyed)throw new P(205,!1)}function Ra(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function jm(n,t){for(const e of n)Array.isArray(e)?jm(e,t):e&&Cm(e)?jm(e.\u0275providers,t):t(e)}function Li(n,t){let e;n instanceof Io?(_c(n),e=n):e=new uT(n);const r=Ps(e),s=Xn(void 0);try{return t()}finally{Ps(r),Xn(s)}}function Hm(){return void 0!==lT()||null!=Kd()}function wo(n){if(!Hm())throw new P(-203,!1)}function Ut(n){return Array.isArray(n)&&"object"==typeof n[1]}function cn(n){return Array.isArray(n)&&!0===n[1]}function Km(n){return!!(4&n.flags)}function sr(n){return n.componentOffset>-1}function _f(n){return!(1&~n.flags)}function _i(n){return!!n.template}function ss(n){return!!(512&n[2])}function os(n){return!(256&~n[2])}class UB{previousValue;currentValue;firstChange;constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function xT(n,t,e,i){null!==t?t.applyValueToInputSignal(t,i):n[e]=i}const Pn=(()=>{const n=()=>RT;return n.ngInherit=!0,n})();function RT(n){return n.type.prototype.ngOnChanges&&(n.setInput=VB),$B}function $B(){const n=NT(this),t=n?.current;if(t){const e=n.previous;if(e===ir)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function VB(n,t,e,i,r){const s=this.declaredInputs[i],o=NT(n)||function jB(n,t){return n[MT]=t}(n,{previous:ir,current:null}),a=o.current||(o.current={}),l=o.previous,c=l[s];a[s]=new UB(c&&c.currentValue,e,l===ir),xT(n,t,r,e)}const MT="__ngSimpleChanges__";function NT(n){return n[MT]||null}function He(n){for(;Array.isArray(n);)n=n[0];return n}function Fa(n,t){return He(t[n])}function Un(n,t){return He(t[n.index])}function Mo(n,t){return n.data[t]}function No(n,t){return n[t]}function $n(n,t){const e=t[n];return Ut(e)?e:e[0]}function Qm(n){return!(128&~n[2])}function Pi(n,t){return null==t?null:n[t]}function LT(n){n[17]=0}function Xm(n){1024&n[2]||(n[2]|=1024,Qm(n)&&Ba(n))}function Ec(n){return!!(9216&n[2]||n[24]?.dirty)}function Zm(n){n[10].changeDetectionScheduler?.notify(8),64&n[2]&&(n[2]|=1024),Ec(n)&&Ba(n)}function Ba(n){n[10].changeDetectionScheduler?.notify(0);let t=as(n);for(;null!==t&&!(8192&t[2])&&(t[2]|=8192,Qm(t));)t=as(t)}function bf(n,t){if(os(n))throw new P(911,!1);null===n[21]&&(n[21]=[]),n[21].push(t)}function as(n){const t=n[3];return cn(t)?t[3]:t}function ey(n){return n[7]??=[]}function ty(n){return n.cleanup??=[]}const Ee={lFrame:WT(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let iy=!1;function ry(){return Ee.bindingsEnabled}function Oo(){return null!==Ee.skipHydrationRootTNode}function O(){return Ee.lFrame.lView}function ye(){return Ee.lFrame.tView}function Ae(n){return Ee.lFrame.contextLView=n,n[8]}function xe(n){return Ee.lFrame.contextLView=null,n}function Pe(){let n=FT();for(;null!==n&&64===n.type;)n=n.parent;return n}function FT(){return Ee.lFrame.currentTNode}function or(n,t){const e=Ee.lFrame;e.currentTNode=n,e.isParent=t}function sy(){return Ee.lFrame.isParent}function oy(){Ee.lFrame.isParent=!1}function $T(){return iy}function Df(n){const t=iy;return iy=n,t}function Vn(){const n=Ee.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Fi(){return Ee.lFrame.bindingIndex++}function cs(n){const t=Ee.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function iU(n,t){const e=Ee.lFrame;e.bindingIndex=e.bindingRootIndex=n,ay(t)}function ay(n){Ee.lFrame.currentDirectiveIndex=n}function cy(){return Ee.lFrame.currentQueryIndex}function Tf(n){Ee.lFrame.currentQueryIndex=n}function sU(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[5]:null}function HT(n,t,e){if(e&Oe.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&Oe.Host||(r=sU(s),null===r||(s=s[14],10&r.type))););if(null===r)return!1;t=r,n=s}const i=Ee.lFrame=GT();return i.currentTNode=t,i.lView=n,!0}function uy(n){const t=GT(),e=n[1];Ee.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function GT(){const n=Ee.lFrame,t=null===n?null:n.child;return null===t?WT(n):t}function WT(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function KT(){const n=Ee.lFrame;return Ee.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const zT=KT;function dy(){const n=KT();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function xn(){return Ee.lFrame.selectedIndex}function ko(n){Ee.lFrame.selectedIndex=n}function ot(){const n=Ee.lFrame;return Mo(n.tView,n.selectedIndex)}let YT=!0;function Tc(){return YT}function wr(n){YT=n}function fy(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-e,o),a&&((n.contentHooks??=[]).push(e,a),(n.contentCheckHooks??=[]).push(e,a)),l&&(n.viewHooks??=[]).push(-e,l),c&&((n.viewHooks??=[]).push(e,c),(n.viewCheckHooks??=[]).push(e,c)),null!=u&&(n.destroyHooks??=[]).push(e,u)}}function Sf(n,t,e){QT(n,t,3,e)}function Cf(n,t,e,i){(3&n[2])===e&&QT(n,t,e,i)}function hy(n,t){let e=n[2];(3&e)===t&&(e&=16383,e+=1,n[2]=e)}function QT(n,t,e,i){const s=i??-1,o=t.length-1;let a=0;for(let l=void 0!==i?65535&n[17]:0;l<o;l++)if("number"==typeof t[l+1]){if(a=t[l],null!=i&&a>=i)break}else t[l]<0&&(n[17]+=65536),(a<s||-1==s)&&(fU(n,e,t,l),n[17]=(4294901760&n[17])+l+2),l++}function XT(n,t){const e=Te(null);try{t.call(n)}finally{Te(e)}}function fU(n,t,e,i){const r=e[i]<0,s=e[i+1],a=n[r?-e[i]:e[i]];r?n[2]>>14<n[17]>>16&&(3&n[2])===t&&(n[2]+=16384,XT(a,s)):XT(a,s)}class Sc{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,e,i){this.factory=t,this.canSeeViewProviders=e,this.injectImpl=i}}function ZT(n){return 3===n||4===n||6===n}function JT(n){return 64===n.charCodeAt(0)}function $a(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||eS(n,e,r,0,-1===e||2===e?t[++i]:null)}}return n}function eS(n,t,e,i,r){let s=0,o=n.length;if(-1===t)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===t){o=-1;break}if(a>t){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===e)return void(null!==r&&(n[s+1]=r));s++,null!==r&&s++}-1!==o&&(n.splice(o,0,t),s=o+1),n.splice(s++,0,e),null!==r&&n.splice(s++,0,r)}function my(n){return-1!==n}function Cc(n){return 32767&n}function Ic(n,t){let e=function yU(n){return n>>16}(n),i=t;for(;e>0;)i=i[14],e--;return i}let yy=!0;function If(n){const t=yy;return yy=n,t}let _U=0;const Ar={};function wf(n,t){const e=iS(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,_y(i.data,n),_y(t,null),_y(i.blueprint,null));const r=Af(n,t),s=n.injectorIndex;if(my(r)){const o=Cc(r),a=Ic(r,t),l=a[1].data;for(let c=0;c<8;c++)t[s+c]=a[o+c]|l[o+c]}return t[s+8]=r,s}function _y(n,t){n.push(0,0,0,0,0,0,0,0,t)}function iS(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Af(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=uS(r),null===i)return-1;if(e++,r=r[14],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function vy(n,t,e){!function vU(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(gc)&&(i=e[gc]),null==i&&(i=e[gc]=_U++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function rS(n,t,e){if(e&Oe.Optional||void 0!==n)return n;Am()}function sS(n,t,e,i){if(e&Oe.Optional&&void 0===i&&(i=null),!(e&(Oe.Self|Oe.Host))){const r=n[9],s=Xn(void 0);try{return r?r.get(t,i,e&Oe.Optional):cT(t,i,e&Oe.Optional)}finally{Xn(s)}}return rS(i,0,e)}function oS(n,t,e,i=Oe.Default,r){if(null!==n){if(2048&t[2]&&!(i&Oe.Self)){const o=function SU(n,t,e,i,r){let s=n,o=t;for(;null!==s&&null!==o&&2048&o[2]&&!ss(o);){const a=aS(s,o,e,i|Oe.Self,Ar);if(a!==Ar)return a;let l=s.parent;if(!l){const c=o[20];if(c){const u=c.get(e,Ar,i);if(u!==Ar)return u}l=uS(o),o=o[14]}s=l}return r}(n,t,e,i,Ar);if(o!==Ar)return o}const s=aS(n,t,e,i,Ar);if(s!==Ar)return s}return sS(t,e,i,r)}function aS(n,t,e,i,r){const s=function DU(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(gc)?n[gc]:void 0;return"number"==typeof t?t>=0?255&t:TU:t}(e);if("function"==typeof s){if(!HT(t,n,i))return i&Oe.Host?rS(r,0,i):sS(t,e,i,r);try{let o;if(o=s(i),null!=o||i&Oe.Optional)return o;Am()}finally{zT()}}else if("number"==typeof s){let o=null,a=iS(n,t),l=-1,c=i&Oe.Host?t[15][5]:null;for((-1===a||i&Oe.SkipSelf)&&(l=-1===a?Af(n,t):t[a+8],-1!==l&&cS(i,!1)?(o=t[1],a=Cc(l),t=Ic(l,t)):a=-1);-1!==a;){const u=t[1];if(lS(s,a,u.data)){const d=EU(a,t,e,o,i,c);if(d!==Ar)return d}l=t[a+8],-1!==l&&cS(i,t[1].data[a+8]===c)&&lS(s,a,t)?(o=u,a=Cc(l),t=Ic(l,t)):a=-1}}return r}function EU(n,t,e,i,r,s){const o=t[1],a=o.data[n+8],u=xf(a,o,e,null==i?sr(a)&&yy:i!=o&&!!(3&a.type),r&Oe.Host&&s===a);return null!==u?wc(t,o,u,a,r):Ar}function xf(n,t,e,i,r){const s=n.providerIndexes,o=t.data,a=1048575&s,l=n.directiveStart,u=s>>20,f=r?a+u:n.directiveEnd;for(let h=i?a:a+u;h<f;h++){const p=o[h];if(h<l&&e===p||h>=l&&p.type===e)return h}if(r){const h=o[l];if(h&&_i(h)&&h.type===e)return l}return null}function wc(n,t,e,i,r){let s=n[e];const o=t.data;if(s instanceof Sc){const a=s;a.resolving&&aT(function Qe(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Se(n)}(o[e]));const l=If(a.canSeeViewProviders);a.resolving=!0;const u=a.injectImpl?Xn(a.injectImpl):null;HT(n,i,Oe.Default);try{s=n[e]=a.factory(void 0,r,o,n,i),t.firstCreatePass&&e>=i.directiveStart&&function dU(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const o=RT(t);(e.preOrderHooks??=[]).push(n,o),(e.preOrderCheckHooks??=[]).push(n,o)}r&&(e.preOrderHooks??=[]).push(0-n,r),s&&((e.preOrderHooks??=[]).push(n,s),(e.preOrderCheckHooks??=[]).push(n,s))}(e,o[e],t)}finally{null!==u&&Xn(u),If(l),a.resolving=!1,zT()}}return s}function lS(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function cS(n,t){return!(n&Oe.Self||n&Oe.Host&&t)}class $t{_tNode;_lView;constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return oS(this._tNode,this._lView,t,af(i),e)}}function TU(){return new $t(Pe(),O())}function Tt(n){return ns(()=>{const t=n.prototype.constructor,e=t[is]||by(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[is]||by(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function by(n){return Zd(n)?()=>{const t=by(be(n));return t&&t()}:To(n)}function uS(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[5]:null}function gS(n,t=null,e=null,i){const r=mS(n,t,e,i);return r.resolveInjectorInitializers(),r}function mS(n,t=null,e=null,i,r=new Set){const s=[e||ze,bB(n)];return i=i||("object"==typeof n?void 0:an(n)),new Io(s,t||hf(),i||null,r)}class at{static THROW_IF_NOT_FOUND=Do;static NULL=new uf;static create(t,e){if(Array.isArray(t))return gS({name:""},e,t,"");{const i=t.name??"";return gS({name:i},t.parent,t.providers,i)}}static \u0275prov=H({token:at,providedIn:"any",factory:()=>ue(mT)});static __NG_ELEMENT_ID__=-1}new G("").__NG_ELEMENT_ID__=n=>{const t=Pe();if(null===t)throw new P(204,!1);if(2&t.type)return t.value;if(n&Oe.Optional)return null;throw new P(204,!1)};const yS=!1;let jn=(()=>class n{static __NG_ELEMENT_ID__=OU;static __NG_ENV_ID__=e=>e})();class _S extends jn{_lView;constructor(t){super(),this._lView=t}onDestroy(t){const e=this._lView;return os(e)?(t(),()=>{}):(bf(e,t),()=>function Jm(n,t){if(null===n[21])return;const e=n[21].indexOf(t);-1!==e&&n[21].splice(e,1)}(e,t))}}function OU(){return new _S(O())}class us{}const Ac=new G("",{providedIn:"root",factory:()=>!1}),vS=new G(""),Dy=new G("");let Vs=(()=>{class n{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new Oi(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=H({token:n,providedIn:"root",factory:()=>new n})}return n})();const _e=class kU extends Ke{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,Hm()&&(this.destroyRef=S(jn,{optional:!0})??void 0,this.pendingTasks=S(Vs,{optional:!0})??void 0)}emit(t){const e=Te(null);try{super.next(t)}finally{Te(e)}}subscribe(t,e,i){let r=t,s=e||(()=>null),o=i;if(t&&"object"==typeof t){const l=t;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=this.wrapInTimeout(s),r&&(r=this.wrapInTimeout(r)),o&&(o=this.wrapInTimeout(o)));const a=super.subscribe({next:r,error:s,complete:o});return t instanceof kn&&t.add(a),a}wrapInTimeout(t){return e=>{const i=this.pendingTasks?.add();setTimeout(()=>{try{t(e)}finally{void 0!==i&&this.pendingTasks?.remove(i)}})}}};function xc(...n){}function ES(n){let t,e;function i(){n=xc;try{void 0!==e&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(e),void 0!==t&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{n(),i()}),"function"==typeof requestAnimationFrame&&(e=requestAnimationFrame(()=>{n(),i()})),()=>i()}function DS(n){return queueMicrotask(()=>n()),()=>{n=xc}}const Ty="isAngularZone",Mf=Ty+"_ID";let LU=0;class ke{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new _e(!1);onMicrotaskEmpty=new _e(!1);onStable=new _e(!1);onError=new _e(!1);constructor(t){const{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:s=yS}=t;if(typeof Zone>"u")throw new P(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&i,o.shouldCoalesceRunChangeDetection=r,o.callbackScheduled=!1,o.scheduleInRootZone=s,function BU(n){const t=()=>{!function FU(n){function t(){ES(()=>{n.callbackScheduled=!1,Cy(n),n.isCheckStableRunning=!0,Sy(n),n.isCheckStableRunning=!1})}n.isCheckStableRunning||n.callbackScheduled||(n.callbackScheduled=!0,n.scheduleInRootZone?Zone.root.run(()=>{t()}):n._outer.run(()=>{t()}),Cy(n))}(n)},e=LU++;n._inner=n._inner.fork({name:"angular",properties:{[Ty]:!0,[Mf]:e,[Mf+e]:!0},onInvokeTask:(i,r,s,o,a,l)=>{if(function UU(n){return CS(n,"__ignore_ng_zone__")}(l))return i.invokeTask(s,o,a,l);try{return TS(n),i.invokeTask(s,o,a,l)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&t(),SS(n)}},onInvoke:(i,r,s,o,a,l,c)=>{try{return TS(n),i.invoke(s,o,a,l,c)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!function $U(n){return CS(n,"__scheduler_tick__")}(l)&&t(),SS(n)}},onHasTask:(i,r,s,o)=>{i.hasTask(s,o),r===s&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,Cy(n),Sy(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(i,r,s,o)=>(i.handleError(s,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(Ty)}static assertInAngularZone(){if(!ke.isInAngularZone())throw new P(909,!1)}static assertNotInAngularZone(){if(ke.isInAngularZone())throw new P(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,t,PU,xc,xc);try{return s.runTask(o,e,i)}finally{s.cancelTask(o)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const PU={};function Sy(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Cy(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&!0===n.callbackScheduled)}function TS(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function SS(n){n._nesting--,Sy(n)}class Iy{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new _e;onMicrotaskEmpty=new _e;onStable=new _e;onError=new _e;run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}function CS(n,t){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0]?.data?.[t]}class ar{_console=console;handleError(t){this._console.error("ERROR",t)}}const jU=new G("",{providedIn:"root",factory:()=>{const n=S(ke),t=S(ar);return e=>n.runOutsideAngular(()=>t.handleError(e))}});function wS(n,t){return eT(n,t)}const GU=(wS.required=function HU(n){return eT(Xd,n)},wS);function WU(){return Va(Pe(),O())}function Va(n,t){return new nt(Un(n,t))}let nt=(()=>class n{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=WU})();function AS(n){return n instanceof nt?n.nativeElement:n}function xr(n,t){const e=function R2(n,t){const e=Object.create(cm);e.value=n,void 0!==t&&(e.equal=t);const i=()=>(mo(e),e.value);return i[on]=e,i}(n,t?.equal),i=e[on];return e.set=r=>Wd(i,r),e.update=r=>function jD(n,t){Ta()||hc(n),Wd(n,t(n.value))}(i,r),e.asReadonly=Nf.bind(e),e}function Nf(){const n=this[on];if(void 0===n.readonlyFn){const t=()=>this();t[on]=n,n.readonlyFn=t}return n.readonlyFn}function RS(n){return function xS(n){return"function"==typeof n&&void 0!==n[on]}(n)&&"function"==typeof n.set}function KU(){return this._results[Symbol.iterator]()}class zU{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Ke}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){this.dirty=!1;const i=function Zn(n){return n.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function _B(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(this._results,i,e))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=KU}function Mc(n){return!(128&~n.flags)}var Of=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(Of||{});const kf=new Map;let YU=0;function Ay(n){kf.delete(n[19])}const Ry="__ngContext__";function ei(n,t){Ut(t)?(n[Ry]=t[19],function XU(n){kf.set(n[19],n)}(t)):n[Ry]=t}function US(n){return VS(n[12])}function $S(n){return VS(n[4])}function VS(n){for(;null!==n&&!cn(n);)n=n[4];return n}let Ny;const ds=new G("",{providedIn:"root",factory:()=>m$}),m$="ng",Oy=new G(""),ky=new G("",{providedIn:"platform",factory:()=>"unknown"}),qS=new G("",{providedIn:"root",factory:()=>function Rr(){if(void 0!==Ny)return Ny;if(typeof document<"u")return document;throw new P(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),ZS=new G("",{providedIn:"root",factory:()=>!1});var Wy=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(Wy||{});const Ha=new G(""),n1=new Set;function ti(n){n1.has(n)||(n1.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}let $f=(()=>class n{view;node;constructor(e,i){this.view=e,this.node=i}static __NG_ELEMENT_ID__=E$})();function E$(){return new $f(O(),Pe())}var Ga=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(Ga||{});let Ky=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=H({token:n,providedIn:"root",factory:()=>new n})}return n})();const i1=[Ga.EarlyRead,Ga.Write,Ga.MixedReadWrite,Ga.Read];let r1=(()=>{class n{ngZone=S(ke);scheduler=S(us);errorHandler=S(ar,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){S(Ha,{optional:!0})}execute(){this.executing=!0;for(const i of i1)for(const r of this.sequences)if(!r.erroredOrDestroyed&&r.hooks[i])try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>(0,r.hooks[i])(r.pipelinedValue),r.snapshot))}catch(s){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(s)}this.executing=!1;for(const i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(const i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(e){const{view:i}=e;void 0!==i?((i[25]??=[]).push(e),Ba(i),i[2]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,i){return i?i.run(Wy.AFTER_NEXT_RENDER,e):e()}static \u0275prov=H({token:n,providedIn:"root",factory:()=>new n})}return n})();class s1{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,e,i,r,s,o=null){this.impl=t,this.hooks=e,this.view=i,this.once=r,this.snapshot=o,this.unregisterOnDestroy=s?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();const t=this.view?.[25];t&&(this.view[25]=t.filter(e=>e!==this))}}function Fo(n,t){!t?.injector&&wo();const e=t?.injector??S(at);return ti("NgAfterNextRender"),o1(n,e,t,!0)}function o1(n,t,e,i){const r=t.get(Ky);r.impl??=t.get(r1);const s=t.get(Ha,null,{optional:!0}),o=e?.phase??Ga.MixedReadWrite,a=!0!==e?.manualCleanup?t.get(jn):null,l=t.get($f,null,{optional:!0}),c=new s1(r.impl,function D$(n,t){if(n instanceof Function){const e=[void 0,void 0,void 0,void 0];return e[t]=n,e}return[n.earlyRead,n.write,n.mixedReadWrite,n.read]}(n,o),l?.view,i,a,s?.snapshot(null));return r.impl.register(c),c}function N1(n,t){const e=n.contentQueries;if(null!==e){const i=Te(null);try{for(let r=0;r<e.length;r+=2){const o=e[r+1];if(-1!==o){const a=n.data[o];Tf(e[r]),a.contentQueries(2,t[o],o)}}}finally{Te(i)}}}function a0(n,t,e){Tf(0);const i=Te(null);try{t(n,e)}finally{Te(i)}}function l0(n,t,e){if(Km(t)){const i=Te(null);try{const s=t.directiveEnd;for(let o=t.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,e[o],o)}}finally{Te(i)}}}var Bi=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Bi||{});let Xf;function P1(n){return function c0(){if(void 0===Xf&&(Xf=null,Bt.trustedTypes))try{Xf=Bt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Xf}()?.createScriptURL(n)||n}class F1{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ZD})`}}function Hs(n){return n instanceof F1?n.changingThisBreaksApplicationSecurity:n}function Gc(n,t){const e=function fV(n){return n instanceof F1&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see ${ZD})`)}return e===t}const mV=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Ja=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(Ja||{});function Jf(n){const t=Kc();return t?t.sanitize(Ja.URL,n)||"":Gc(n,"URL")?Hs(n):function u0(n){return(n=String(n)).match(mV)?n:"unsafe:"+n}(Se(n))}function K1(n){const t=Kc();if(t)return P1(t.sanitize(Ja.RESOURCE_URL,n)||"");if(Gc(n,"ResourceURL"))return P1(Hs(n));throw new P(904,!1)}function Kc(){const n=O();return n&&n[10].sanitizer}function Mr(n){return n instanceof Function?n():n}function WV(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const nC="ng-template";function KV(n,t,e,i){let r=0;if(i){for(;r<t.length&&"string"==typeof t[r];r+=2)if("class"===t[r]&&-1!==WV(t[r+1].toLowerCase(),e,0))return!0}else if(m0(n))return!1;if(r=t.indexOf(1,r),r>-1){let s;for(;++r<t.length&&"string"==typeof(s=t[r]);)if(s.toLowerCase()===e)return!0}return!1}function m0(n){return 4===n.type&&n.value!==nC}function zV(n,t,e){return t===(4!==n.type||e?n.value:nC)}function qV(n,t,e){let i=4;const r=n.attrs,s=null!==r?function XV(n){for(let t=0;t<n.length;t++)if(ZT(n[t]))return t;return n.length}(r):0;let o=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!o)if(4&i){if(i=2|1&i,""!==l&&!zV(n,l,e)||""===l&&1===t.length){if(lr(i))return!1;o=!0}}else if(8&i){if(null===r||!KV(n,r,l,e)){if(lr(i))return!1;o=!0}}else{const c=t[++a],u=YV(l,r,m0(n),e);if(-1===u){if(lr(i))return!1;o=!0;continue}if(""!==c){let d;if(d=u>s?"":r[u+1].toLowerCase(),2&i&&c!==d){if(lr(i))return!1;o=!0}}}}else{if(!o&&!lr(i)&&!lr(l))return!1;if(o&&lr(l))continue;o=!1,i=l|1&i}}return lr(i)||o}function lr(n){return!(1&n)}function YV(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const o=t[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=t[++r];for(;"string"==typeof a;)a=t[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function ZV(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function iC(n,t,e=!1){for(let i=0;i<t.length;i++)if(qV(n,t[i],e))return!0;return!1}function JV(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function rC(n,t){return n?":not("+t.trim()+")":t}function e3(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let o=n[e];if("string"==typeof o)if(2&i){const a=n[++e];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!lr(o)&&(t+=rC(s,r),r=""),i=o,s=s||!lr(i);e++}return""!==r&&(t+=rC(s,r)),t}const Ce={};function nh(n,t,e){return n.createElement(t,e)}function Uo(n,t,e,i,r){n.insertBefore(t,e,i,r)}function oC(n,t,e){n.appendChild(t,e)}function aC(n,t,e,i,r){null!==i?Uo(n,t,e,i,r):oC(n,t,e)}function cC(n,t,e){const{mergedAttrs:i,classes:r,styles:s}=e;null!==i&&function mU(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],o=e[i++],a=e[i++];n.setAttribute(t,o,a,s)}else{const s=r,o=e[++i];JT(s)?n.setProperty(t,s,o):n.setAttribute(t,s,o),i++}}}(n,t,i),null!==r&&function r3(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}(n,t,r),null!==s&&function i3(n,t,e){n.setAttribute(t,"style",e)}(n,t,s)}function v0(n,t,e,i,r,s,o,a,l,c,u){const d=26+i,f=d+r,h=function s3(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:Ce);return e}(d,f),p="function"==typeof c?c():c;return h[1]={type:n,blueprint:h,template:e,queries:null,viewQuery:a,declTNode:t,data:h.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1,ssrId:u}}function ih(n,t,e,i,r,s,o,a,l,c,u){const d=t.blueprint.slice();return d[0]=r,d[2]=1228|i,(null!==c||n&&2048&n[2])&&(d[2]|=2048),LT(d),d[3]=d[14]=n,d[8]=e,d[10]=o||n&&n[10],d[11]=a||n&&n[11],d[9]=l||n&&n[9]||null,d[5]=s,d[19]=function QU(){return YU++}(),d[6]=u,d[20]=c,d[15]=2==t.type?n[15]:d,d}function b0(n){let t=16;return n.signals?t=4096:n.onPush&&(t=64),t}function qc(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function E0(n,t){return n[12]?n[13][4]=t:n[12]=t,n[13]=t,t}function N(n=1){dC(ye(),O(),xn()+n,!1)}function dC(n,t,e,i){if(!i)if(3&~t[2]){const s=n.preOrderHooks;null!==s&&Cf(t,s,0,e)}else{const s=n.preOrderCheckHooks;null!==s&&Sf(t,s,e)}ko(e)}var rh=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(rh||{});function D0(n,t,e,i){const r=Te(null);try{const[s,o,a]=n.inputs[e];let l=null;!!(o&rh.SignalBased)&&(l=t[s][on]),null!==l&&void 0!==l.transformFn?i=l.transformFn(i):null!==a&&(i=a.call(t,i)),null!==n.setInput?n.setInput(t,l,i,e,s):xT(t,l,s,i)}finally{Te(r)}}function fC(n,t,e,i,r){const s=xn(),o=2&i;try{ko(-1),o&&t.length>26&&dC(n,t,26,!1),e(i,r)}finally{ko(s)}}function sh(n,t,e){(function h3(n,t,e){const i=e.directiveStart,r=e.directiveEnd;sr(e)&&function o3(n,t,e){const i=Un(t,n),r=function uC(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=v0(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}(e),s=n[10].rendererFactory,o=E0(n,ih(n,r,null,b0(e),i,t,null,s.createRenderer(i,e),null,null,null));n[t.index]=o}(t,e,n.data[i+e.componentOffset]),n.firstCreatePass||wf(e,t);const s=e.initialInputs;for(let o=i;o<r;o++){const a=n.data[o],l=wc(t,n,o,e);ei(l,t),null!==s&&m3(0,o-i,l,a,0,s),_i(a)&&($n(e.index,t)[8]=wc(t,n,o,e))}})(n,t,e),!(64&~e.flags)&&function p3(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,o=function rU(){return Ee.lFrame.currentDirectiveIndex}();try{ko(s);for(let a=i;a<r;a++){const l=n.data[a],c=t[a];ay(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&g3(l,c)}}finally{ko(-1),ay(o)}}(n,t,e)}function T0(n,t,e=Un){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?e(t,n):n[o];n[r++]=a}}}let hC=()=>null;function ni(n,t,e,i,r,s,o,a){if(a||!w0(t,n,e,i,r)){if(3&t.type){const l=Un(t,e);i=function d3(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,t.value||"",i):r,s.setProperty(l,i,r)}}else sr(t)&&function f3(n,t){const e=$n(t,n);16&e[2]||(e[2]|=64)}(e,t.index)}function g3(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function S0(n,t){const e=n.directiveRegistry;let i=null;if(e)for(let r=0;r<e.length;r++){const s=e[r];iC(t,s.selectors,!1)&&(i??=[],_i(s)?i.unshift(s):i.push(s))}return i}function Nr(n,t,e,i,r,s){const o=Un(n,t);!function C0(n,t,e,i,r,s,o){if(null==s)n.removeAttribute(t,r,e);else{const a=null==o?Se(s):o(s,i||"",r);n.setAttribute(t,r,a,e)}}(t[11],o,s,n.value,e,i,r)}function m3(n,t,e,i,r,s){const o=s[t];if(null!==o)for(let a=0;a<o.length;a+=2)D0(i,e,o[a],o[a+1])}function w0(n,t,e,i,r){const s=n.inputs?.[i],o=n.hostDirectiveInputs?.[i];let a=!1;if(o)for(let l=0;l<o.length;l+=2){const c=o[l];D0(t.data[c],e[c],o[l+1],r),a=!0}if(s)for(const l of s)D0(t.data[l],e[l],i,r),a=!0;return a}function y3(n,t){const e=$n(t,n),i=e[1];!function _3(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}(i,e);const r=e[0];null!==r&&null===e[6]&&(e[6]=null),oh(i,e,e[8])}function oh(n,t,e){uy(t);try{const i=n.viewQuery;null!==i&&a0(1,i,e);const r=n.template;null!==r&&fC(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[18]?.finishViewCreation(n),n.staticContentQueries&&N1(n,t),n.staticViewQueries&&a0(2,n.viewQuery,e);const s=n.components;null!==s&&function v3(n,t){for(let e=0;e<t.length;e++)y3(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,dy()}}function tl(n,t,e,i){const r=Te(null);try{const s=t.tView,l=ih(n,s,e,4096&n[2]?4096:16,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null);l[16]=n[t.index];const u=n[18];return null!==u&&(l[18]=u.createEmbeddedView(s)),oh(s,l,e),l}finally{Te(r)}}function $o(n,t){return!t||null===t.firstChild||Mc(n)}function x0(n,t){return undefined(n,t)}var Gs=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Gs||{});function Ws(n){return!(32&~n.flags)}function nl(n,t,e,i,r){if(null!=i){let s,o=!1;cn(i)?s=i:Ut(i)&&(o=!0,i=i[0]);const a=He(i);0===n&&null!==e?null==r?oC(t,e,a):Uo(t,e,a,r||null,!0):1===n&&null!==e?Uo(t,e,a,r||null,!0):2===n?function zc(n,t,e){n.removeChild(null,t,e)}(t,a,o):3===n&&t.destroyNode(a),null!=s&&function I3(n,t,e,i,r){const s=e[7];s!==He(e)&&nl(t,n,i,s,r);for(let a=10;a<e.length;a++){const l=e[a];lh(l[1],l,n,t,i,s)}}(t,n,s,e,r)}}function yC(n,t){t[10].changeDetectionScheduler?.notify(9),lh(n,t,t[11],2,null,null)}function R0(n,t){const e=n[9],i=e.indexOf(t);e.splice(i,1)}function Yc(n,t){if(os(t))return;const e=t[11];e.destroyNode&&lh(n,t,e,3,null,null),function D3(n){let t=n[12];if(!t)return M0(n[1],n);for(;t;){let e=null;if(Ut(t))e=t[12];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Ut(t)&&M0(t[1],t),t=t[3];null===t&&(t=n),Ut(t)&&M0(t[1],t),e=t&&t[4]}t=e}}(t)}function M0(n,t){if(os(t))return;const e=Te(null);try{t[2]&=-129,t[2]|=256,t[24]&&Le(t[24]),function S3(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Sc)){const s=e[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],l=s[o+1];try{l.call(a)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function T3(n,t){const e=n.cleanup,i=t[7];if(null!==e)for(let o=0;o<e.length-1;o+=2)if("string"==typeof e[o]){const a=e[o+3];a>=0?i[a]():i[-a].unsubscribe(),o+=2}else e[o].call(i[e[o+1]]);null!==i&&(t[7]=null);const r=t[21];if(null!==r){t[21]=null;for(let o=0;o<r.length;o++)(0,r[o])()}const s=t[23];if(null!==s){t[23]=null;for(const o of s)o.destroy()}}(n,t),1===t[1].type&&t[11].destroy();const i=t[16];if(null!==i&&cn(t[3])){i!==t[3]&&R0(i,t);const r=t[18];null!==r&&r.detachView(n)}Ay(t)}finally{Te(e)}}function N0(n,t,e){return function _C(n,t,e){let i=t;for(;null!==i&&168&i.type;)i=(t=i).parent;if(null===i)return e[0];if(sr(i)){const{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===Bi.None||r===Bi.Emulated)return null}return Un(i,e)}(n,t.parent,e)}function vC(n,t,e){return EC(n,t,e)}let EC=function bC(n,t,e){return 40&n.type?Un(n,e):null};function ah(n,t,e,i){const r=N0(n,i,t),s=t[11],a=vC(i.parent||t[5],i,t);if(null!=r)if(Array.isArray(e))for(let l=0;l<e.length;l++)aC(s,r,e[l],a,!1);else aC(s,r,e,a,!1)}function Vo(n,t){if(null!==t){const e=t.type;if(3&e)return Un(t,n);if(4&e)return k0(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Vo(n,i);{const r=n[t.index];return cn(r)?k0(-1,r):He(r)}}if(128&e)return Vo(n,t.next);if(32&e)return x0(t,n)()||He(n[t.index]);{const i=TC(n,t);return null!==i?Array.isArray(i)?i[0]:Vo(as(n[15]),i):Vo(n,t.next)}}return null}function TC(n,t){return null!==t?n[15][5].projection[t.projection]:null}function k0(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return Vo(i,r)}return t[7]}function L0(n,t,e,i,r,s,o){for(;null!=e;){if(128===e.type){e=e.next;continue}const a=i[e.index],l=e.type;if(o&&0===t&&(a&&ei(He(a),i),e.flags|=2),!Ws(e))if(8&l)L0(n,t,e.child,i,r,s,!1),nl(t,n,r,a,s);else if(32&l){const c=x0(e,i);let u;for(;u=c();)nl(t,n,r,u,s);nl(t,n,r,a,s)}else 16&l?SC(n,t,i,e,r,s):nl(t,n,r,a,s);e=o?e.projectionNext:e.next}}function lh(n,t,e,i,r,s){L0(e,i,n.firstChild,t,r,s,!1)}function SC(n,t,e,i,r,s){const o=e[15],l=o[5].projection[i.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)nl(t,n,r,l[c],s);else{let c=l;const u=o[3];Mc(i)&&(c.flags|=128),L0(n,t,c,u,r,s,!0)}}function il(n,t,e,i,r=!1){for(;null!==e;){if(128===e.type){e=r?e.projectionNext:e.next;continue}const s=t[e.index];null!==s&&i.push(He(s)),cn(s)&&P0(s,i);const o=e.type;if(8&o)il(n,t,e.child,i);else if(32&o){const a=x0(e,t);let l;for(;l=a();)i.push(l)}else if(16&o){const a=TC(t,e);if(Array.isArray(a))i.push(...a);else{const l=as(t[15]);il(l[1],l,a,i,!0)}}e=r?e.projectionNext:e.next}return i}function P0(n,t){for(let e=10;e<n.length;e++){const i=n[e],r=i[1].firstChild;null!==r&&il(i[1],i,r,t)}n[7]!==n[0]&&t.push(n[7])}function CC(n){if(null!==n[25]){for(const t of n[25])t.impl.addSequence(t);n[25].length=0}}let IC=[];const M3={...ks,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{Ba(n.lView)},consumerOnSignalRead(){this.lView[24]=this}},O3={...ks,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let t=as(n.lView);for(;t&&!wC(t[1]);)t=as(t);t&&Xm(t)},consumerOnSignalRead(){this.lView[24]=this}};function wC(n){return 2!==n.type}function AC(n){if(null===n[23])return;let t=!0;for(;t;){let e=!1;for(const i of n[23])i.dirty&&(e=!0,null===i.zone||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));t=e&&!!(8192&n[2])}}function ch(n,t=!0,e=0){const r=n[10].rendererFactory;r.begin?.();try{!function L3(n,t){const e=$T();try{Df(!0),F0(n,t);let i=0;for(;Ec(n);){if(100===i)throw new P(103,!1);i++,F0(n,1)}}finally{Df(e)}}(n,e)}catch(o){throw t&&function I0(n,t){const e=n[9],i=e?e.get(ar,null):null;i&&i.handleError(t)}(n,o),o}finally{r.end?.()}}function RC(n,t,e,i){if(os(t))return;const r=t[2];uy(t);let a=!0,l=null,c=null;wC(n)?(c=function A3(n){return n[24]??function x3(n){const t=IC.pop()??Object.create(M3);return t.lView=n,t}(n)}(t),l=z(c)):null===function Da(){return Nt}()?(a=!1,c=function N3(n){const t=n[24]??Object.create(O3);return t.lView=n,t}(t),l=z(c)):t[24]&&(Le(t[24]),t[24]=null);try{LT(t),function VT(n){return Ee.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&fC(n,t,e,2,i);const u=!(3&~r);if(u){const h=n.preOrderCheckHooks;null!==h&&Sf(t,h,null)}else{const h=n.preOrderHooks;null!==h&&Cf(t,h,0,null),hy(t,0)}if(function P3(n){for(let t=US(n);null!==t;t=$S(t)){if(!(2&t[2]))continue;const e=t[9];for(let i=0;i<e.length;i++)Xm(e[i])}}(t),AC(t),MC(t,0),null!==n.contentQueries&&N1(n,t),u){const h=n.contentCheckHooks;null!==h&&Sf(t,h)}else{const h=n.contentHooks;null!==h&&Cf(t,h,1),hy(t,1)}!function B3(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)ko(~r);else{const s=r,o=e[++i],a=e[++i];iU(o,s);const l=t[s];a(2,l)}}}finally{ko(-1)}}(n,t);const d=n.components;null!==d&&OC(t,d,0);const f=n.viewQuery;if(null!==f&&a0(2,f,i),u){const h=n.viewCheckHooks;null!==h&&Sf(t,h)}else{const h=n.viewHooks;null!==h&&Cf(t,h,2),hy(t,2)}if(!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[22]){for(const h of t[22])h();t[22]=null}CC(t),t[2]&=-73}catch(u){throw Ba(t),u}finally{null!==c&&(ce(c,l),a&&function R3(n){n.lView[24]!==n&&(n.lView=null,IC.push(n))}(c)),dy()}}function MC(n,t){for(let e=US(n);null!==e;e=$S(e))for(let i=10;i<e.length;i++)NC(e[i],t)}function F3(n,t,e){const i=$n(t,n);NC(i,e)}function NC(n,t){Qm(n)&&F0(n,t)}function F0(n,t){const i=n[1],r=n[2],s=n[24];let o=!!(0===t&&16&r);if(o||=!!(64&r&&0===t),o||=!!(1024&r),o||=!(!s?.dirty||!ae(s)),o||=!1,s&&(s.dirty=!1),n[2]&=-9217,o)RC(i,n,i.template,n[8]);else if(8192&r){AC(n),MC(n,1);const a=i.components;null!==a&&OC(n,a,1),CC(n)}}function OC(n,t,e){for(let i=0;i<t.length;i++)F3(n,t[i],e)}function Qc(n,t){const e=$T()?64:1088;for(n[10].changeDetectionScheduler?.notify(t);n;){n[2]|=e;const i=as(n);if(ss(n)&&!i)return n;n=i}return null}function kC(n,t,e,i){return[n,!0,0,t,null,i,null,e,null,null]}function rl(n,t,e,i=!0){const r=t[1];if(function U3(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],hT(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const o=t[16];null!==o&&e!==o&&PC(o,t);const a=t[18];null!==a&&a.insertView(n),Zm(t),t[2]|=128}(r,t,n,e),i){const o=k0(e,n),a=t[11],l=a.parentNode(n[7]);null!==l&&function E3(n,t,e,i,r,s){i[0]=r,i[5]=t,lh(n,i,e,1,r,s)}(r,n[5],a,t,l,o)}const s=t[6];null!==s&&null!==s.firstChild&&(s.firstChild=null)}function Xc(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[16];null!==r&&r!==n&&R0(r,i),t>0&&(n[e-1][4]=i[4]);const s=lf(n,10+t);!function mC(n,t){yC(n,t),t[0]=null,t[5]=null}(i[1],i);const o=s[18];null!==o&&o.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function PC(n,t){const e=n[9],i=t[3];(Ut(i)||t[15]!==i[3][15])&&(n[2]|=2),null===e?n[9]=[t]:e.push(t)}let Zc=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){const t=this._lView,e=t[1];return il(e,t,e.firstChild,[])}constructor(t,e,i=!0){this._lView=t,this._cdRefInjectingView=e,this.notifyErrorHandler=i}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return os(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(cn(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(Xc(t,i),lf(e,i))}this._attachedToViewContainer=!1}Yc(this._lView[1],this._lView)}onDestroy(t){bf(this._lView,t)}markForCheck(){Qc(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){Zm(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,ch(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new P(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const t=ss(this._lView),e=this._lView[16];null!==e&&!t&&R0(e,this._lView),yC(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new P(902,!1);this._appRef=t;const e=ss(this._lView),i=this._lView[16];null!==i&&!e&&PC(i,this._lView),Zm(this._lView)}},Xt=(()=>class n{static __NG_ELEMENT_ID__=j3})();const $3=Xt,V3=class extends $3{_declarationLView;_declarationTContainer;elementRef;constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,e){return this.createEmbeddedViewImpl(t,e)}createEmbeddedViewImpl(t,e,i){const r=tl(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:e,dehydratedView:i});return new Zc(r)}};function j3(){return uh(Pe(),O())}function uh(n,t){return 4&n.type?new V3(t,n,Va(n,t)):null}function sl(n,t,e,i,r){let s=n.data[t];if(null===s)s=function j0(n,t,e,i,r){const s=FT(),o=sy(),l=n.data[t]=function Z3(n,t,e,i,r,s){let o=t?t.injectorIndex:-1,a=0;return Oo()&&(a|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,e,t,i,r);return function X3(n,t,e,i){null===n.firstChild&&(n.firstChild=t),null!==e&&(i?null==e.child&&null!==t.parent&&(e.child=t):null===e.next&&(e.next=t,t.prev=e))}(n,l,s,o),l}(n,t,e,i,r),function nU(){return Ee.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const o=function Dc(){const n=Ee.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return or(s,!0),s}let Bj=class{},sI=class{};class Uj{resolveComponentFactory(t){throw Error(`No component factory found for ${an(t)}.`)}}let yh=class{static NULL=new Uj};class Q0{}let gs=(()=>class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>function $j(){const n=O(),e=$n(Pe().index,n);return(Ut(e)?e:n)[11]}()})(),Vj=(()=>{class n{static \u0275prov=H({token:n,providedIn:"root",factory:()=>null})}return n})();const Z0={};class ll{injector;parentInjector;constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){i=af(i);const r=this.injector.get(t,Z0,i);return r!==Z0||e===Z0?r:this.parentInjector.get(t,e,i)}}function J0(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const a=t[o];"number"==typeof a?s=a:1==s?r=Em(r,a):2==s&&(i=Em(i,a+": "+t[++o]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function F(n,t=Oe.Default){const e=O();return null===e?ue(n,t):oS(Pe(),e,be(n),t)}function e_(n,t,e,i,r){const s=null===i?null:{"":-1},o=r(n,e);if(null!==o){let a,l=null,c=null;const u=function Kj(n){let t=null,e=!1;for(let o=0;o<n.length;o++){const a=n[o];if(0===o&&_i(a)&&(t=a),null!==a.findHostDirectiveDefs){e=!0;break}}if(!e)return null;let i=null,r=null,s=null;for(const o of n)null!==o.findHostDirectiveDefs&&(i??=[],r??=new Map,s??=new Map,zj(o,i,s,r)),o===t&&(i??=[],i.push(o));return null!==i?(i.push(...null===t?n:n.slice(1)),[i,r,s]):null}(o);null===u?a=o:[a,l,c]=u,function Yj(n,t,e,i,r,s,o){const a=i.length;let l=!1;for(let f=0;f<a;f++){const h=i[f];!l&&_i(h)&&(l=!0,qj(n,e,f)),vy(wf(e,t),n,h.type)}!function tH(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}(e,n.data.length,a);for(let f=0;f<a;f++){const h=i[f];h.providersResolver&&h.providersResolver(h)}let c=!1,u=!1,d=qc(n,t,a,null);a>0&&(e.directiveToIndex=new Map);for(let f=0;f<a;f++){const h=i[f];if(e.mergedAttrs=$a(e.mergedAttrs,h.hostAttrs),Xj(n,e,t,d,h),eH(d,h,r),null!==o&&o.has(h)){const[g,m]=o.get(h);e.directiveToIndex.set(h.type,[d,g+e.directiveStart,m+e.directiveStart])}else(null===s||!s.has(h))&&e.directiveToIndex.set(h.type,d);null!==h.contentQueries&&(e.flags|=4),(null!==h.hostBindings||null!==h.hostAttrs||0!==h.hostVars)&&(e.flags|=64);const p=h.type.prototype;!c&&(p.ngOnChanges||p.ngOnInit||p.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),c=!0),!u&&(p.ngOnChanges||p.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),u=!0),d++}!function Qj(n,t,e){for(let i=t.directiveStart;i<t.directiveEnd;i++){const r=n.data[i];if(null!==e&&e.has(r)){const s=e.get(r);cI(0,t,s,i),cI(1,t,s,i),dI(t,i,!0)}else lI(0,t,r,i),lI(1,t,r,i),dI(t,i,!1)}}(n,e,s)}(n,t,e,a,s,l,c)}null!==s&&null!==i&&function Wj(n,t,e){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new P(-301,!1);i.push(t[r],s)}}(e,i,s)}function zj(n,t,e,i){const r=t.length;n.findHostDirectiveDefs(n,t,i),e.set(n,[r,t.length-1])}function qj(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function lI(n,t,e,i){const r=0===n?e.inputs:e.outputs;for(const s in r)if(r.hasOwnProperty(s)){let o;o=0===n?t.inputs??={}:t.outputs??={},o[s]??=[],o[s].push(i),uI(t,s)}}function cI(n,t,e,i){const r=0===n?e.inputs:e.outputs;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];let a;a=0===n?t.hostDirectiveInputs??={}:t.hostDirectiveOutputs??={},a[o]??=[],a[o].push(i,s),uI(t,o)}}function uI(n,t){"class"===t?n.flags|=8:"style"===t&&(n.flags|=16)}function dI(n,t,e){const{attrs:i,inputs:r,hostDirectiveInputs:s}=n;if(null===i||!e&&null===r||e&&null===s||m0(n))return n.initialInputs??=[],void n.initialInputs.push(null);let o=null,a=0;for(;a<i.length;){const l=i[a];if(0!==l)if(5!==l){if("number"==typeof l)break;if(!e&&r.hasOwnProperty(l)){const c=r[l];for(const u of c)if(u===t){o??=[],o.push(l,i[a+1]);break}}else if(e&&s.hasOwnProperty(l)){const c=s[l];for(let u=0;u<c.length;u+=2)if(c[u]===t){o??=[],o.push(c[u+1],i[a+1]);break}}a+=2}else a+=2;else a+=4}n.initialInputs??=[],n.initialInputs.push(o)}function Xj(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=To(r.type)),o=new Sc(s,_i(r),F);n.blueprint[i]=o,e[i]=o,function Zj(n,t,e,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~t.index;(function Jj(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(o)!=a&&o.push(a),o.push(e,i,s)}}(n,t,i,qc(n,e,r.hostVars,Ce),r)}function eH(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;_i(t)&&(e[""]=n)}}function fI(n,t,e,i,r,s,o,a){const l=t.consts,u=sl(t,n,2,i,Pi(l,o));return s&&e_(t,e,u,Pi(l,a),r),u.mergedAttrs=$a(u.mergedAttrs,u.attrs),null!==u.attrs&&J0(u,u.attrs,!1),null!==u.mergedAttrs&&J0(u,u.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,u),u}function hI(n,t){fy(n,t),Km(t)&&n.queries.elementEnd(t)}class pI extends yh{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Be(t);return new lu(e,this.ngModule)}}class lu extends sI{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function nH(n){return Object.keys(n).map(t=>{const[e,i,r]=n[t],s={propName:e,templateName:t,isSignal:!!(i&rh.SignalBased)};return r&&(s.transform=r),s})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function iH(n){return Object.keys(n).map(t=>({propName:n[t],templateName:t}))}(this.componentDef.outputs),this.cachedOutputs}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function t3(n){return n.map(e3).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!e}create(t,e,i,r){const s=Te(null);try{const o=this.componentDef,a=i?["ng-version","19.2.15"]:function n3(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!lr(r))break;r=s}i++}return e.length&&t.push(1,...e),t}(this.componentDef.selectors[0]),l=v0(0,null,null,1,0,null,null,null,null,[a],null),c=function rH(n,t,e){let i=t instanceof An?t:t?.injector;return i&&null!==n.getStandaloneInjector&&(i=n.getStandaloneInjector(i)||i),i?new ll(e,i):e}(o,r||this.ngModule,t),u=function sH(n){const t=n.get(Q0,null);if(null===t)throw new P(407,!1);return{rendererFactory:t,sanitizer:n.get(Vj,null),changeDetectionScheduler:n.get(us,null)}}(c),d=u.rendererFactory.createRenderer(null,o),f=i?function a3(n,t,e,i){const s=i.get(ZS,!1)||e===Bi.ShadowDom,o=n.selectRootElement(t,s);return function l3(n){hC(n)}(o),o}(d,i,o.encapsulation,c):function oH(n,t){const e=(n.selectors[0][0]||"div").toLowerCase();return nh(t,e,"svg"===e?"svg":"math"===e?"math":null)}(o,d),h=ih(null,l,null,512|b0(o),null,null,u,d,c,null,null);h[26]=f,uy(h);let p=null;try{const g=fI(26,l,h,"#host",()=>[this.componentDef],!0,0);f&&(cC(d,f,g),ei(f,h)),sh(l,h,g),l0(l,g,h),hI(l,g),void 0!==e&&function lH(n,t,e){const i=n.projection=[];for(let r=0;r<t.length;r++){const s=e[r];i.push(null!=s&&s.length?Array.from(s):null)}}(g,this.ngContentSelectors,e),p=$n(g.index,h),h[8]=p[8],oh(l,h,null)}catch(g){throw null!==p&&Ay(p),Ay(h),g}finally{dy()}return new aH(this.componentType,h)}finally{Te(s)}}}class aH extends Bj{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,e){super(),this._rootLView=e,this._tNode=Mo(e[1],26),this.location=Va(this._tNode,e),this.instance=$n(this._tNode.index,e)[8],this.hostView=this.changeDetectorRef=new Zc(e,void 0,!1),this.componentType=t}setInput(t,e){const i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;const r=this._rootLView;w0(i,r[1],r,t,e),this.previousInputValues.set(t,e),Qc($n(i.index,r),1)}get injector(){return new $t(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}let vi=(()=>class n{static __NG_ELEMENT_ID__=cH})();function cH(){return yI(Pe(),O())}const uH=vi,gI=class extends uH{_lContainer;_hostTNode;_hostLView;constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Va(this._hostTNode,this._hostLView)}get injector(){return new $t(this._hostTNode,this._hostLView)}get parentInjector(){const t=Af(this._hostTNode,this._hostLView);if(my(t)){const e=Ic(t,this._hostLView),i=Cc(t);return new $t(e[1].data[i+8],e)}return new $t(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=mI(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const a=t.createEmbeddedViewImpl(e||{},s,null);return this.insertImpl(a,r,$o(this._hostTNode,null)),a}createComponent(t,e,i,r,s){const o=t&&!function vc(n){return"function"==typeof n}(t);let a;if(o)a=e;else{const p=e||{};a=p.index,i=p.injector,r=p.projectableNodes,s=p.environmentInjector||p.ngModuleRef}const l=o?t:new lu(Be(t)),c=i||this.parentInjector;if(!s&&null==l.ngModule){const g=(o?c:this.parentInjector).get(An,null);g&&(s=g)}Be(l.componentType??{});const h=l.create(c,r,null,s);return this.insertImpl(h.hostView,a,$o(this._hostTNode,null)),h}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,i){const r=t._lView;if(function KB(n){return cn(n[3])}(r)){const a=this.indexOf(t);if(-1!==a)this.detach(a);else{const l=r[3],c=new gI(l,l[5],l[3]);c.detach(c.indexOf(t))}}const s=this._adjustIndex(e),o=this._lContainer;return rl(o,r,s,i),t.attachToViewContainerRef(),hT(t_(o),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=mI(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=Xc(this._lContainer,e);i&&(lf(t_(this._lContainer),e),Yc(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=Xc(this._lContainer,e);return i&&null!=lf(t_(this._lContainer),e)?new Zc(i):null}_adjustIndex(t,e=0){return t??this.length+e}};function mI(n){return n[8]}function t_(n){return n[8]||(n[8]=[])}function yI(n,t){let e;const i=t[n.index];return cn(i)?e=i:(e=kC(i,t,null,n),t[n.index]=e,E0(t,e)),_I(e,t,n,i),new gI(e,n,t)}let _I=function bI(n,t,e,i){if(n[7])return;let r;r=8&e.type?He(i):function dH(n,t){const e=n[11],i=e.createComment(""),r=Un(t,n),s=e.parentNode(r);return Uo(e,s,i,e.nextSibling(r),!1),i}(t,e),n[7]=r};class i_{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new i_(this.queryList)}setDirty(){this.queryList.setDirty()}}class r_{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const o=e.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new r_(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==c_(t,e).matches&&this.queries[e].setDirty()}}class EI{flags;read;predicate;constructor(t,e,i=null){this.flags=e,this.read=i,this.predicate="string"==typeof t?function vH(n){return n.split(",").map(t=>t.trim())}(t):t}}class s_{queries;constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new s_(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class o_{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,e=-1){this.metadata=t,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new o_(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1&~this.metadata.flags){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,gH(e,s)),this.matchTNodeWithReadOption(t,e,xf(e,t,s,!1,!1))}else i===Xt?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,xf(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===nt||r===vi||r===Xt&&4&e.type)this.addMatch(e.index,-2);else{const s=xf(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function gH(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function yH(n,t,e,i){return-1===e?function mH(n,t){return 11&n.type?Va(n,t):4&n.type?uh(n,t):null}(t,n):-2===e?function _H(n,t,e){return e===nt?Va(t,n):e===Xt?uh(t,n):e===vi?yI(t,n):void 0}(n,t,i):wc(n,n[1],e,t)}function DI(n,t,e,i){const r=t[18].queries[i];if(null===r.matches){const s=n.data,o=e.matches,a=[];for(let l=0;null!==o&&l<o.length;l+=2){const c=o[l];a.push(c<0?null:yH(t,s[c],o[l+1],e.metadata.read))}r.matches=a}return r.matches}function a_(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const o=DI(n,t,r,e);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)i.push(o[a/2]);else{const c=s[a+1],u=t[-l];for(let d=10;d<u.length;d++){const f=u[d];f[16]===f[3]&&a_(f[1],f,c,i)}if(null!==u[9]){const d=u[9];for(let f=0;f<d.length;f++){const h=d[f];a_(h[1],h,c,i)}}}}}return i}function TI(n,t,e){const i=new zU(!(4&~e));return function zB(n,t,e,i){const r=ey(t);r.push(e),n.firstCreatePass&&ty(n).push(i,r.length-1)}(n,t,i,i.destroy),(t[18]??=new r_).queries.push(new i_(i))-1}function II(n,t,e){null===n.queries&&(n.queries=new s_),n.queries.track(new o_(t,e))}function c_(n,t){return n.queries.getByIndex(t)}function wI(n,t){const e=n[1],i=c_(e,t);return i.crossesNgTemplate?a_(e,n,t,[]):DI(e,n,i,t)}let Go=class{},BI=class{};class f_ extends Go{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new pI(this);constructor(t,e,i,r=!0){super(),this.ngModuleType=t,this._parent=e;const s=gi(t);this._bootstrapComponents=Mr(s.bootstrap),this._r3Injector=mS(t,e,[{provide:Go,useValue:this},{provide:yh,useValue:this.componentFactoryResolver},...i],an(t),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class h_ extends BI{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new f_(this.moduleType,t,[])}}class UI extends Go{injector;componentFactoryResolver=new pI(this);instance=null;constructor(t){super();const e=new Io([...t.providers,{provide:Go,useValue:this},{provide:yh,useValue:this.componentFactoryResolver}],t.parent||hf(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function vh(n,t,e=null){return new UI({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}let NH=(()=>{class n{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const i=Pm(0,e.type),r=i.length>0?vh([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,r)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=H({token:n,providedIn:"environment",factory:()=>new n(ue(An))})}return n})();function un(n){return ns(()=>{const t=$I(n),e={...t,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Of.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:t.standalone?r=>r.get(NH).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Bi.Emulated,styles:n.styles||ze,_:null,schemas:n.schemas||null,tView:null,id:""};t.standalone&&ti("NgStandalone"),VI(e);const i=n.dependencies;return e.directiveDefs=bh(i,!1),e.pipeDefs=bh(i,!0),e.id=function BH(n){let t=0;const i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,"function"==typeof n.consts?"":n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(const s of i.join("|"))t=Math.imul(31,t)+s.charCodeAt(0)|0;return t+=2147483648,"c"+t}(e),e})}function OH(n){return Be(n)||function wn(n){return n[Im]||null}(n)}function kH(n){return null!==n}function ft(n){return ns(()=>({type:n.type,bootstrap:n.bootstrap||ze,declarations:n.declarations||ze,imports:n.imports||ze,exports:n.exports||ze,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function LH(n,t){if(null==n)return ir;const e={};for(const i in n)if(n.hasOwnProperty(i)){const r=n[i];let s,o,a,l;Array.isArray(r)?(a=r[0],s=r[1],o=r[2]??s,l=r[3]||null):(s=r,o=r,a=rh.None,l=null),e[s]=[i,a,l],t[s]=o}return e}function PH(n){if(null==n)return ir;const t={};for(const e in n)n.hasOwnProperty(e)&&(t[n[e]]=e);return t}function X(n){return ns(()=>{const t=$I(n);return VI(t),t})}function ii(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:n.standalone??!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function $I(n){const t={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputConfig:n.inputs||ir,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:!0===n.signals,selectors:n.selectors||ze,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:LH(n.inputs,t),outputs:PH(n.outputs),debugInfo:null}}function VI(n){n.features?.forEach(t=>t(n))}function bh(n,t){if(!n)return null;const e=t?mi:OH;return()=>("function"==typeof n?n():n).map(i=>e(i)).filter(kH)}function qe(n){let t=function jI(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(_i(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new P(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const o=n;o.inputs=p_(n.inputs),o.declaredInputs=p_(n.declaredInputs),o.outputs=p_(n.outputs);const a=r.hostBindings;a&&HH(n,a);const l=r.viewQuery,c=r.contentQueries;if(l&&VH(n,l),c&&jH(n,c),UH(n,r),X2(n.outputs,r.outputs),_i(r)&&r.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(n),a===qe&&(e=!1)}}t=Object.getPrototypeOf(t)}!function $H(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=$a(r.hostAttrs,e=$a(e,r.hostAttrs))}}(i)}function UH(n,t){for(const e in t.inputs){if(!t.inputs.hasOwnProperty(e)||n.inputs.hasOwnProperty(e))continue;const i=t.inputs[e];void 0!==i&&(n.inputs[e]=i,n.declaredInputs[e]=t.declaredInputs[e])}}function p_(n){return n===ir?{}:n===ze?[]:n}function VH(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function jH(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function HH(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}function Eh(n){return!!function y_(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function Or(n,t,e){return n[t]=e}function Vt(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Wo(n,t,e,i){const r=Vt(n,t,e);return Vt(n,t+1,i)||r}function du(n,t,e,i,r,s,o,a,l,c){const u=e+26,d=t.firstCreatePass?function XH(n,t,e,i,r,s,o,a,l){const c=t.consts,u=sl(t,n,4,o||null,a||null);ry()&&e_(t,e,u,Pi(c,l),S0),u.mergedAttrs=$a(u.mergedAttrs,u.attrs),fy(t,u);const d=u.tView=v0(2,u,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return null!==t.queries&&(t.queries.template(t,u),d.queries=t.queries.embeddedTView(u)),u}(u,t,n,i,r,s,o,a,l):t.data[u];or(d,!1);const f=zI(t,n,d,e);Tc()&&ah(t,n,f,d),ei(f,n);const h=kC(f,n,f,d);return n[u]=h,E0(n,h),_f(d)&&sh(t,n,d),null!=l&&T0(n,d,c),d}function de(n,t,e,i,r,s,o,a){const l=O(),c=ye();return du(l,c,n,t,e,i,r,Pi(c.consts,s),o,a),de}let zI=function qI(n,t,e,i){return wr(!0),t[11].createComment("")};let b_=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();const aw=new G(""),Ih=new G("");let I_,S_=(()=>{class n{_ngZone;registry;_isZoneStable=!0;_callbacks=[];_taskTrackingZone=null;_destroyRef;constructor(e,i,r){this._ngZone=e,this.registry=i,Hm()&&(this._destroyRef=S(jn,{optional:!0})??void 0),I_||(function YG(n){I_=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this._taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){const e=this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),i=this._ngZone.runOutsideAngular(()=>this._ngZone.onStable.subscribe({next:()=>{ke.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}}));this._destroyRef?.onDestroy(()=>{e.unsubscribe(),i.unsubscribe()})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb()}});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1))}}getPendingTasks(){return this._taskTrackingZone?this._taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),e()},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this._taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}static \u0275fac=function(i){return new(i||n)(ue(ke),ue(C_),ue(Ih))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})(),C_=(()=>{class n{_applications=new Map;registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){return I_?.findTestabilityInTree(this,e,i)??null}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})(),lw=(()=>{class n{static \u0275prov=H({token:n,providedIn:"root",factory:()=>new QG})}return n})();class QG{queuedEffectCount=0;queues=new Map;schedule(t){this.enqueue(t)}remove(t){const i=this.queues.get(t.zone);i.has(t)&&(i.delete(t),this.queuedEffectCount--)}enqueue(t){const e=t.zone;this.queues.has(e)||this.queues.set(e,new Set);const i=this.queues.get(e);i.has(t)||(this.queuedEffectCount++,i.add(t))}flush(){for(;this.queuedEffectCount>0;)for(const[t,e]of this.queues)null===t?this.flushQueue(e):t.run(()=>this.flushQueue(e))}flushQueue(t){for(const e of t)t.delete(e),this.queuedEffectCount--,e.run()}}function hu(n){return!!n&&"function"==typeof n.then}function cw(n){return!!n&&"function"==typeof n.subscribe}const uw=new G("");function dw(n){return Fs([{provide:uw,multi:!0,useValue:n}])}let fw=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i});appInits=S(uw,{optional:!0})??[];injector=S(at);constructor(){}runInitializers(){if(this.initialized)return;const e=[];for(const r of this.appInits){const s=Li(this.injector,r);if(hu(s))e.push(s);else if(cw(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});e.push(o)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const pu=new G("");function pw(n,t){return Array.isArray(t)?t.reduce(pw,n):{...n,...t}}let ri=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=S(jU);afterRenderManager=S(Ky);zonelessEnabled=S(Ac);rootEffectScheduler=S(lw);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Ke;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=S(Vs).hasPendingTasks.pipe(Ne(e=>!e));constructor(){S(Ha,{optional:!0})}whenStable(){let e;return new Promise(i=>{e=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{e.unsubscribe()})}_injector=S(An);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,i){return this.bootstrapImpl(e,i)}bootstrapImpl(e,i,r=at.NULL){const s=e instanceof sI;if(!this._injector.get(fw).done)throw new P(405,"");let a;a=s?e:this._injector.get(yh).resolveComponentFactory(e),this.componentTypes.push(a.componentType);const l=function XG(n){return n.isBoundToModule}(a)?void 0:this._injector.get(Go),u=a.create(r,[],i||a.selector,l),d=u.location.nativeElement,f=u.injector.get(aw,null);return f?.registerApplication(d),u.onDestroy(()=>{this.detachView(u.hostView),wh(this.components,u),f?.unregisterApplication(d)}),this._loadComponent(u),u}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){null!==this.tracingSnapshot?this.tracingSnapshot.run(Wy.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new P(101,!1);const e=Te(null);try{this._runningTick=!0,this.synchronize()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Te(e),this.afterTick.next()}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Q0,null,{optional:!0}));let e=0;for(;0!==this.dirtyFlags&&e++<10;)this.synchronizeOnce()}synchronizeOnce(){if(16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),7&this.dirtyFlags){const e=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:i,notifyErrorHandler:r}of this.allViews)JG(i,r,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:e})=>Ec(e))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;wh(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(pu,[]).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>wh(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new P(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function wh(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function JG(n,t,e,i){(e||Ec(n))&&ch(n,t,e&&!i?0:1)}function ht(n,t,e,i){const r=O();return Vt(r,Fi(),t)&&(ye(),Nr(ot(),r,n,t,e,i)),ht}function pl(n,t,e,i,r,s){const a=Wo(n,function ls(){return Ee.lFrame.bindingIndex}(),e,r);return cs(2),a?t+Se(e)+i+Se(r)+s:Ce}function Ah(n,t){return n<<17|t<<2}function zo(n){return n>>17&32767}function M_(n){return 2|n}function El(n){return(131068&n)>>2}function N_(n,t){return-131069&n|t<<2}function O_(n){return 1|n}function Nw(n,t,e,i){const r=n[e+1],s=null===t;let o=i?zo(r):El(r),a=!1;for(;0!==o&&(!1===a||s);){const c=n[o+1];U8(n[o],t)&&(a=!0,n[o+1]=i?O_(c):M_(c)),o=i?zo(c):El(c)}a&&(n[e+1]=i?M_(r):O_(r))}function U8(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&yc(n,t)>=0}const dn={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Ow(n){return n.substring(dn.key,dn.keyEnd)}function kw(n,t){const e=dn.textEnd;return e===t?-1:(t=dn.keyEnd=function H8(n,t,e){for(;t<e&&n.charCodeAt(t)>32;)t++;return t}(n,dn.key=t,e),Dl(n,t,e))}function Dl(n,t,e){for(;t<e&&n.charCodeAt(t)<=32;)t++;return t}function j(n,t,e){const i=O();return Vt(i,Fi(),t)&&ni(ye(),ot(),i,n,t,i[11],e,!1),j}function k_(n,t,e,i,r){w0(t,n,e,r?"class":"style",i)}function Ge(n,t){return function cr(n,t,e,i){const r=O(),s=ye(),o=cs(2);s.firstUpdatePass&&Vw(s,n,o,i),t!==Ce&&Vt(r,o,t)&&Hw(s,s.data[xn()],r,r[11],n,r[o+1]=function e4(n,t){return null==n||""===n||("string"==typeof t?n+=t:"object"==typeof n&&(n=an(Hs(n)))),n}(t,e),i,o)}(n,t,null,!0),Ge}function mu(n){!function ur(n,t,e,i){const r=ye(),s=cs(2);r.firstUpdatePass&&Vw(r,null,s,i);const o=O();if(e!==Ce&&Vt(o,s,e)){const a=r.data[xn()];if(Ww(a,i)&&!$w(r,s)){let l=i?a.classesWithoutHost:a.stylesWithoutHost;null!==l&&(e=Em(l,e||"")),k_(r,a,o,e,i)}else!function J8(n,t,e,i,r,s,o,a){r===Ce&&(r=ze);let l=0,c=0,u=0<r.length?r[0]:null,d=0<s.length?s[0]:null;for(;null!==u||null!==d;){const f=l<r.length?r[l+1]:void 0,h=c<s.length?s[c+1]:void 0;let g,p=null;u===d?(l+=2,c+=2,f!==h&&(p=d,g=h)):null===d||null!==u&&u<d?(l+=2,p=u):(c+=2,p=d,g=h),null!==p&&Hw(n,t,e,i,p,g,o,a),u=l<r.length?r[l]:null,d=c<s.length?s[c]:null}}(r,a,o,o[11],o[s+1],o[s+1]=function X8(n,t,e){if(null==e||""===e)return ze;const i=[],r=Hs(e);if(Array.isArray(r))for(let s=0;s<r.length;s++)n(i,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&n(i,s,r[s]);else"string"==typeof r&&t(i,r);return i}(n,t,e),i,s)}}(Z8,Lr,n,!0)}function Lr(n,t){for(let e=function V8(n){return function Pw(n){dn.key=0,dn.keyEnd=0,dn.value=0,dn.valueEnd=0,dn.textEnd=n.length}(n),kw(n,Dl(n,0,dn.textEnd))}(t);e>=0;e=kw(t,e))pi(n,Ow(t),!0)}function $w(n,t){return t>=n.expandoStartIndex}function Vw(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[xn()],o=$w(n,e);Ww(s,i)&&null===t&&!o&&(t=!1),t=function z8(n,t,e,i){const r=function ly(n){const t=Ee.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=yu(e=L_(null,n,t,e,i),t.attrs,i),s=null);else{const o=t.directiveStylingLast;if(-1===o||n[o]!==r)if(e=L_(r,n,t,e,i),null===s){let l=function q8(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==El(i))return n[zo(i)]}(n,t,i);void 0!==l&&Array.isArray(l)&&(l=L_(null,n,t,l[1],i),l=yu(l,t.attrs,i),function Y8(n,t,e,i){n[zo(e?t.classBindings:t.styleBindings)]=i}(n,t,i,l))}else s=function Q8(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=yu(i,n[s].hostAttrs,e);return yu(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function F8(n,t,e,i,r,s){let o=s?t.classBindings:t.styleBindings,a=zo(o),l=El(o);n[i]=e;let u,c=!1;if(Array.isArray(e)?(u=e[1],(null===u||yc(e,u)>0)&&(c=!0)):u=e,r)if(0!==l){const f=zo(n[a+1]);n[i+1]=Ah(f,a),0!==f&&(n[f+1]=N_(n[f+1],i)),n[a+1]=function L8(n,t){return 131071&n|t<<17}(n[a+1],i)}else n[i+1]=Ah(a,0),0!==a&&(n[a+1]=N_(n[a+1],i)),a=i;else n[i+1]=Ah(l,0),0===a?a=i:n[l+1]=N_(n[l+1],i),l=i;c&&(n[i+1]=M_(n[i+1])),Nw(n,u,i,!0),Nw(n,u,i,!1),function B8(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&yc(s,t)>=0&&(e[i+1]=O_(e[i+1]))}(t,u,n,i,s),o=Ah(a,l),s?t.classBindings=o:t.styleBindings=o}(r,s,t,e,o,i)}}function L_(n,t,e,i,r){let s=null;const o=e.directiveEnd;let a=e.directiveStylingLast;for(-1===a?a=e.directiveStart:a++;a<o&&(s=t[a],i=yu(i,s.hostAttrs,r),s!==n);)a++;return null!==n&&(e.directiveStylingLast=a),i}function yu(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?r=o:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),pi(n,o,!!e||t[++s]))}return void 0===n?null:n}function Z8(n,t,e){const i=String(t);""!==i&&!i.includes(" ")&&pi(n,i,e)}function Hw(n,t,e,i,r,s,o,a){if(!(3&t.type))return;const l=n.data,c=l[a+1],u=function P8(n){return!(1&~n)}(c)?Gw(l,t,e,r,El(c),o):void 0;xh(u)||(xh(s)||function k8(n){return!(2&~n)}(c)&&(s=Gw(l,null,e,r,a,o)),function w3(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:Gs.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Gs.Important),n.setStyle(e,i,r,s))}}(i,o,Fa(xn(),e),r,s))}function Gw(n,t,e,i,r,s){const o=null===t;let a;for(;r>0;){const l=n[r],c=Array.isArray(l),u=c?l[1]:l,d=null===u;let f=e[r+1];f===Ce&&(f=d?ze:void 0);let h=d?km(f,i):u===i?f:void 0;if(c&&!xh(h)&&(h=km(l,i)),xh(h)&&(a=h,o))return a;const p=n[r+1];r=o?zo(p):El(p)}if(null!==t){let l=s?t.residualClasses:t.residualStyles;null!=l&&(a=km(l,i))}return a}function xh(n){return void 0!==n}function Ww(n,t){return!!(n.flags&(t?8:16))}function A(n,t,e,i){const r=O(),s=ye(),o=26+n,a=r[11],l=s.firstCreatePass?fI(o,s,r,t,S0,ry(),e,i):s.data[o],c=Yw(s,r,l,a,t,n);r[o]=c;const u=_f(l);return or(l,!0),cC(a,c,l),!Ws(l)&&Tc()&&ah(s,r,c,l),(0===function qB(){return Ee.lFrame.elementDepthCount}()||u)&&ei(c,r),function YB(){Ee.lFrame.elementDepthCount++}(),u&&(sh(s,r,l),l0(s,l,r)),null!==i&&T0(r,l),A}function x(){let n=Pe();sy()?oy():(n=n.parent,or(n,!1));const t=n;(function XB(n){return Ee.skipHydrationRootTNode===n})(t)&&function tU(){Ee.skipHydrationRootTNode=null}(),function QB(){Ee.lFrame.elementDepthCount--}();const e=ye();return e.firstCreatePass&&hI(e,t),null!=t.classesWithoutHost&&function pU(n){return!!(8&n.flags)}(t)&&k_(e,t,O(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function gU(n){return!!(16&n.flags)}(t)&&k_(e,t,O(),t.stylesWithoutHost,!1),x}function oe(n,t,e,i){return A(n,t,e,i),x(),oe}let Yw=(n,t,e,i,r,s)=>(wr(!0),nh(i,r,function qT(){return Ee.lFrame.currentNamespace}()));function pt(){return O()}function $i(n,t,e){const i=O();return Vt(i,Fi(),t)&&ni(ye(),ot(),i,n,t,i[11],e,!0),$i}const qo=void 0;var S4=["en",[["a","p"],["AM","PM"],qo],[["AM","PM"],qo,qo],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],qo,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],qo,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",qo,"{1} 'at' {0}",qo],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function T4(n){const t=Math.floor(Math.abs(n)),e=n.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===e?1:5}];let Tl={};function Gn(n){const t=function C4(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=Jw(t);if(e)return e;const i=t.split("-")[0];if(e=Jw(i),e)return e;if("en"===i)return S4;throw new P(701,!1)}function Jw(n){return n in Tl||(Tl[n]=Bt.ng&&Bt.ng.common&&Bt.ng.common.locales&&Bt.ng.common.locales[n]),Tl[n]}var St=function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n}(St||{});const Mh="en-US";let eA=Mh;function _A(n,t,e){return function i(r){if(r===Function)return e;Qc(sr(n)?$n(n.index,t):t,5);const o=t[8];let a=vA(t,o,e,r),l=i.__ngNextListenerFn__;for(;l;)a=vA(t,o,l,r)&&a,l=l.__ngNextListenerFn__;return a}}function vA(n,t,e,i){const r=Te(null);try{return!1!==e(i)}catch(s){return function f5(n,t){const e=n[9],i=e?e.get(ar,null):null;i&&i.handleError(t)}(n,s),!1}finally{Te(r)}}function bA(n,t,e,i,r,s){const a=t[1],u=t[e][a.data[e].outputs[i]],d=a.firstCreatePass?ty(a):null,f=ey(t),h=u.subscribe(s),p=f.length;f.push(s,h),d&&d.push(r,n.index,p,-(p+1))}function re(n,t,e,i){const r=O(),s=ye(),o=Pe();return W_(s,r,r[11],o,n,t,i),re}function W_(n,t,e,i,r,s,o){const a=_f(i),c=n.firstCreatePass?ty(n):null,u=ey(t);let d=!0;if(3&i.type||o){const f=Un(i,t),h=o?o(f):f,p=u.length,g=o?y=>o(He(y[i.index])):i.index;let m=null;if(!o&&a&&(m=function h5(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===e&&r[s+1]===i){const a=t[7],l=r[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(n,t,r,i.index)),null!==m)(m.__ngLastListenerFn__||m).__ngNextListenerFn__=s,m.__ngLastListenerFn__=s,d=!1;else{s=_A(i,t,s);const y=e.listen(h,r,s);u.push(s,y),c&&c.push(r,g,p,p+1)}}else s=_A(i,t,s);if(d){const f=i.outputs?.[r],h=i.hostDirectiveOutputs?.[r];if(h&&h.length)for(let p=0;p<h.length;p+=2)bA(i,t,h[p],h[p+1],r,s);if(f&&f.length)for(const p of f)bA(i,t,p,r,r,s)}}function U(n=1){return function oU(n){return(Ee.lFrame.contextLView=function PT(n,t){for(;n>0;)t=t[14],n--;return t}(n,Ee.lFrame.contextLView))[8]}(n)}function p5(n,t){let e=null;const i=function QV(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(!(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?iC(n,s,!0):JV(i,s))return r}else e=r}return e}function fn(n,t,e,i){!function CI(n,t,e,i){const r=ye();if(r.firstCreatePass){const s=Pe();II(r,new EI(t,e,i),s.index),function bH(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),!(2&~e)&&(r.staticContentQueries=!0)}return TI(r,O(),e)}(n,t,e,i)}function ms(n,t,e){!function SI(n,t,e){const i=ye();return i.firstCreatePass&&(II(i,new EI(n,t,e),-1),!(2&~t)&&(i.staticViewQueries=!0)),TI(i,O(),t)}(n,t,e)}function gt(n){const t=O(),e=ye(),i=cy();Tf(i+1);const r=c_(e,i);if(n.dirty&&function WB(n){return!(4&~n[2])}(t)===!(2&~r.metadata.flags)){if(null===r.matches)n.reset([]);else{const s=wI(t,i);n.reset(s,AS),n.notifyOnChanges()}return!0}return!1}function mt(){return function l_(n,t){return n[18].queries[t].queryList}(O(),cy())}function B(n,t=""){const e=O(),i=ye(),r=n+26,s=i.firstCreatePass?sl(i,r,1,t,null):i.data[r],o=$A(i,e,s,t,n);e[r]=o,Tc()&&ah(i,e,o,s),or(s,!1)}let $A=(n,t,e,i,r)=>(wr(!0),function y0(n,t){return n.createText(t)}(t[11],i));function hn(n){return zt("",n,""),hn}function zt(n,t,e){const i=O(),r=function hl(n,t,e,i){return Vt(n,Fi(),e)?t+Se(e)+i:Ce}(i,n,t,e);return r!==Ce&&_s(i,xn(),r),zt}function Su(n,t,e,i,r){const s=O(),o=pl(s,n,t,e,i,r);return o!==Ce&&_s(s,xn(),o),Su}function _s(n,t,e){const i=Fa(t,n);!function sC(n,t,e){n.setValue(t,e)}(n[11],i,e)}function bi(n,t,e){RS(t)&&(t=t());const i=O();return Vt(i,Fi(),t)&&ni(ye(),ot(),i,n,t,i[11],e,!1),bi}function Vi(n,t){const e=RS(n);return e&&n.set(t),e}function Ei(n,t){const e=O(),i=ye(),r=Pe();return W_(i,e,e[11],r,n,t),Ei}function Y_(n,t,e,i,r){if(n=be(n),Array.isArray(n))for(let s=0;s<n.length;s++)Y_(n[s],t,e,i,r);else{const s=ye(),o=O(),a=Pe();let l=Co(n)?n:be(n.provide);const c=ET(n),u=1048575&a.providerIndexes,d=a.directiveStart,f=a.providerIndexes>>20;if(Co(n)||!n.multi){const h=new Sc(c,r,F),p=X_(l,t,r?u:u+f,d);-1===p?(vy(wf(a,o),s,l),Q_(s,n,t.length),t.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),e.push(h),o.push(h)):(e[p]=h,o[p]=h)}else{const h=X_(l,t,u+f,d),p=X_(l,t,u,u+f),m=p>=0&&e[p];if(r&&!m||!r&&!(h>=0&&e[h])){vy(wf(a,o),s,l);const y=function P5(n,t,e,i,r){const s=new Sc(n,e,F);return s.multi=[],s.index=t,s.componentProviders=0,QA(s,r,i&&!e),s}(r?L5:k5,e.length,r,i,c);!r&&m&&(e[p].providerFactory=y),Q_(s,n,t.length,0),t.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),e.push(y),o.push(y)}else Q_(s,n,h>-1?h:p,QA(e[r?p:h],c,!r&&i));!r&&i&&m&&e[p].componentProviders++}}}function Q_(n,t,e,i){const r=Co(t),s=function DB(n){return!!n.useClass}(t);if(r||s){const l=(s?be(t.useClass):t).prototype.ngOnDestroy;if(l){const c=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const u=c.indexOf(e);-1===u?c.push(e,[i,l]):c[u+1].push(i,l)}else c.push(e,l)}}}function QA(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function X_(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function k5(n,t,e,i,r){return Z_(this.multi,[])}function L5(n,t,e,i,r){const s=this.multi;let o;if(this.providerFactory){const a=this.providerFactory.componentProviders,l=wc(i,i[1],this.providerFactory.index,r);o=l.slice(0,a),Z_(s,o);for(let c=a;c<l.length;c++)o.push(l[c])}else o=[],Z_(s,o);return o}function Z_(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function yt(n,t=[]){return e=>{e.providersResolver=(i,r)=>function O5(n,t,e){const i=ye();if(i.firstCreatePass){const r=_i(n);Y_(e,i.data,i.blueprint,r,!0),Y_(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}function Cu(n,t){const e=n[t];return e===Ce?void 0:e}function ZA(n,t,e,i,r,s){const o=t+e;return Vt(n,o,r)?Or(n,o+1,s?i.call(s,r):i(r)):Cu(n,o+1)}function Fh(n,t){const e=ye();let i;const r=n+26;e.firstCreatePass?(i=function z5(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks??=[]).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=To(i.type)),a=Xn(F);try{const l=If(!1),c=s();return If(l),function Ym(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,O(),r,c),c}finally{Xn(a)}}function ev(n,t,e,i){const r=n+26,s=O(),o=No(s,r);return Iu(s,r)?function JA(n,t,e,i,r,s,o){const a=t+e;return Wo(n,a,r,s)?Or(n,a+2,o?i.call(o,r,s):i(r,s)):Cu(n,a+2)}(s,Vn(),t,o.transform,e,i,o):o.transform(e,i)}function Iu(n,t){return n[1].data[t].pure}class S6{ngModuleFactory;componentFactories;constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let C6=(()=>{class n{compileModuleSync(e){return new h_(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=Mr(gi(e).declarations).reduce((o,a)=>{const l=Be(a);return l&&o.push(new lu(l)),o},[]);return new S6(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),A6=(()=>{class n{zone=S(ke);changeDetectionScheduler=S(us);applicationRef=S(ri);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function sv({ngZoneFactory:n,ignoreChangesOutsideZone:t,scheduleInRootZone:e}){return n??=()=>new ke({...ov(),scheduleInRootZone:e}),[{provide:ke,useFactory:n},{provide:ki,multi:!0,useFactory:()=>{const i=S(A6,{optional:!0});return()=>i.initialize()}},{provide:ki,multi:!0,useFactory:()=>{const i=S(R6);return()=>{i.initialize()}}},!0===t?{provide:vS,useValue:!0}:[],{provide:Dy,useValue:e??yS}]}function ov(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}let R6=(()=>{class n{subscription=new kn;initialized=!1;zone=S(ke);pendingTasks=S(Vs);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ke.assertNotInAngularZone(),queueMicrotask(()=>{null!==e&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ke.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Au=(()=>{class n{appRef=S(ri);taskService=S(Vs);ngZone=S(ke);zonelessEnabled=S(Ac);tracing=S(Ha,{optional:!0});disableScheduling=S(vS,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new kn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Mf):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(S(Dy,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Iy||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&5===e)return;let i=!1;switch(e){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,i=!0;break;case 12:this.appRef.dirtyFlags|=16,i=!0;break;case 11:i=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;const r=this.useMicrotaskScheduler?DS:ES;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>r(()=>this.tick())):this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Mf+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){throw this.taskService.remove(e),i}finally{this.cleanup()}this.useMicrotaskScheduler=!0,DS(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const vs=new G("",{providedIn:"root",factory:()=>S(vs,Oe.Optional|Oe.SkipSelf)||function M6(){return typeof $localize<"u"&&$localize.locale||Mh}()}),Vh=new G(""),F6=new G("");function xu(n){return!n.moduleRef}let Ix=(()=>{class n{_injector;_modules=[];_destroyListeners=[];_destroyed=!1;constructor(e){this._injector=e}bootstrapModuleFactory(e,i){const r=i?.scheduleInRootZone,o=i?.ignoreChangesOutsideZone,a=[sv({ngZoneFactory:()=>function VU(n="zone.js",t){return"noop"===n?new Iy:"zone.js"===n?new ke(t):n}(i?.ngZone,{...ov({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}),scheduleInRootZone:r}),ignoreChangesOutsideZone:o}),{provide:us,useExisting:Au}],l=function MH(n,t,e){return new f_(n,t,e,!1)}(e.moduleType,this.injector,a);return function Cx(n){const t=xu(n)?n.r3Injector:n.moduleRef.injector,e=t.get(ke);return e.run(()=>{xu(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();const i=t.get(ar,null);let r;if(e.runOutsideAngular(()=>{r=e.onError.subscribe({next:s=>{i.handleError(s)}})}),xu(n)){const s=()=>t.destroy(),o=n.platformInjector.get(Vh);o.add(s),t.onDestroy(()=>{r.unsubscribe(),o.delete(s)})}else{const s=()=>n.moduleRef.destroy(),o=n.platformInjector.get(Vh);o.add(s),n.moduleRef.onDestroy(()=>{wh(n.allPlatformModules,n.moduleRef),r.unsubscribe(),o.delete(s)})}return function U6(n,t,e){try{const i=e();return hu(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(i,e,()=>{const s=t.get(fw);return s.runInitializers(),s.donePromise.then(()=>{if(function x4(n){"string"==typeof n&&(eA=n.toLowerCase().replace(/_/g,"-"))}(t.get(vs,Mh)||Mh),!t.get(F6,!0))return xu(n)?t.get(ri):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(xu(n)){const l=t.get(ri);return void 0!==n.rootComponent&&l.bootstrap(n.rootComponent),l}return function B6(n,t){const e=n.injector.get(ri);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(i=>e.bootstrap(i));else{if(!n.instance.ngDoBootstrap)throw new P(-403,!1);n.instance.ngDoBootstrap(e)}t.push(n)}(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}({moduleRef:l,allPlatformModules:this._modules,platformInjector:this.injector})}bootstrapModule(e,i=[]){const r=pw({},i);return function w6(n,t,e){const i=new h_(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new P(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(Vh,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static \u0275fac=function(i){return new(i||n)(ue(at))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})(),Il=null;function wx(n,t,e=[]){const i=`Platform: ${t}`,r=new G(i);return(s=[])=>{let o=jh();if(!o){const a=[...e,...s,{provide:r,useValue:!0}];o=n?.(a)??function $6(n){if(jh())throw new P(400,!1);(function hw(){!function x2(n){Ls=n}(()=>{throw new P(600,!1)})})(),Il=n;const t=n.get(Ix);return function xx(n){const t=n.get(Oy,null);Li(n,()=>{t?.forEach(e=>e())})}(n),t}(function Ax(n=[],t){return at.create({name:t,providers:[{provide:Um,useValue:"platform"},{provide:Vh,useValue:new Set([()=>Il=null])},...n]})}(a,i))}return function V6(){const t=jh();if(!t)throw new P(401,!1);return t}()}}function jh(){return Il?.get(Ix)??null}let ji=(()=>class n{static __NG_ELEMENT_ID__=H6})();function H6(n){return function G6(n,t,e){if(sr(n)&&!e){const i=$n(n.index,t);return new Zc(i,i)}return 175&n.type?new Zc(t[15],t):null}(Pe(),O(),!(16&~n))}class kx{constructor(){}supports(t){return Eh(t)}create(t){return new Y6(t)}}const q6=(n,t)=>t;class Y6{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||q6}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const o=!i||e&&e.currentIndex<Px(i,r,s)?e:i,a=Px(o,r,s),l=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(e=e._next,null==o.previousIndex)r++;else{s||(s=[]);const c=a-r,u=l-r;if(c!=u){for(let f=0;f<c;f++){const h=f<s.length?s[f]:s[f]=0,p=h+f;u<=p&&p<c&&(s[f]=h+1)}s[o.previousIndex]=u-c}}a!==l&&t(o,a,l)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Eh(t))throw new P(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,o,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)s=t[a],o=this._trackByFn(a,s),null!==e&&Object.is(e.trackById,o)?(i&&(e=this._verifyReinsertion(e,s,o,a)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,o,a),i=!0),e=e._next}else r=0,function YH(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Symbol.iterator]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,a=>{o=this._trackByFn(r,a),null!==e&&Object.is(e.trackById,o)?(i&&(e=this._verifyReinsertion(e,a,o,r)),Object.is(e.item,a)||this._addIdentityChange(e,a)):(e=this._mismatch(e,a,o,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new Q6(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Lx),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Lx),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Q6{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,e){this.item=t,this.trackById=e}}class X6{_head=null;_tail=null;add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class Lx{map=new Map;put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new X6,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Px(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}function Bx(){return new dv([new kx])}let dv=(()=>{class n{factories;static \u0275prov=H({token:n,providedIn:"root",factory:Bx});constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||Bx()),deps:[[n,new Om,new Nm]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new P(901,!1)}}return n})();const nW=wx(null,"core",[]);let iW=(()=>{class n{constructor(e){}static \u0275fac=function(i){return new(i||n)(ue(ri))};static \u0275mod=ft({type:n});static \u0275inj=st({})}return n})();function wl(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}function Zt(n){return function L2(n){const t=Te(null);try{return n()}finally{Te(t)}}(n)}function bs(n,t){return function jd(n,t){const e=Object.create(nr);e.computation=n,void 0!==t&&(e.equal=t);const i=()=>{if(yo(e),mo(e),e.value===Sr)throw e.error;return e.value};return i[on]=e,i}(n,t?.equal)}function gv(n,t){const e=Be(n),i=t.elementInjector||hf();return new lu(e).create(i,t.projectableNodes,t.hostElement,t.environmentInjector)}const Jt=new G("");let sR=null;function Xs(){return sR}class zW{}let mv=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>S(YW),providedIn:"platform"})}return n})();const qW=new G("");let YW=(()=>{class n extends mv{_location;_history;_doc=S(Jt);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Xs().getBaseHref(this._doc)}onPopState(e){const i=Xs().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=Xs().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,r){this._history.pushState(e,i,r)}replaceState(e,i,r){this._history.replaceState(e,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function yv(n,t){return n?t?n.endsWith("/")?t.startsWith("/")?n+t.slice(1):n+t:t.startsWith("/")?n+t:`${n}/${t}`:n:t}function oR(n){const t=n.search(/#|\?|$/);return"/"===n[t-1]?n.slice(0,t-1)+n.slice(t):n}function Es(n){return n&&"?"!==n[0]?`?${n}`:n}let Qo=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>S(lR),providedIn:"root"})}return n})();const aR=new G("");let lR=(()=>{class n extends Qo{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??S(Jt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return yv(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+Es(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const o=this.prepareExternalUrl(r+Es(s));this._platformLocation.pushState(e,i,o)}replaceState(e,i,r,s){const o=this.prepareExternalUrl(r+Es(s));this._platformLocation.replaceState(e,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(ue(mv),ue(aR,8))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Mu=(()=>{class n{_subject=new Ke;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._basePath=function ZW(n){if(new RegExp("^(https?:)?//").test(n)){const[,e]=n.split(/\/\/[^\/]+/);return e}return n}(oR(cR(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+Es(i))}normalize(e){return n.stripTrailingSlash(function XW(n,t){if(!n||!t.startsWith(n))return t;const e=t.substring(n.length);return""===e||["/",";","?","#"].includes(e[0])?e:t}(this._basePath,cR(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Es(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Es(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=Es;static joinWithSlash=yv;static stripTrailingSlash=oR;static \u0275fac=function(i){return new(i||n)(ue(Qo))};static \u0275prov=H({token:n,factory:()=>function QW(){return new Mu(ue(Qo))}(),providedIn:"root"})}return n})();function cR(n){return n.replace(/\/index.html$/,"")}function uR(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}function fR(n){return"server"===n}class hR{}let eK=(()=>{class n extends Qo{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){const i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=yv(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){const o=this.prepareExternalUrl(r+Es(s))||this._platformLocation.pathname;this._platformLocation.pushState(e,i,o)}replaceState(e,i,r,s){const o=this.prepareExternalUrl(r+Es(s))||this._platformLocation.pathname;this._platformLocation.replaceState(e,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(ue(mv),ue(aR,8))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();var Kn=function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n}(Kn||{}),_t=function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n}(_t||{}),Di=function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n}(Di||{});function Xh(n,t){return Gi(Gn(n)[St.DateFormat],t)}function Zh(n,t){return Gi(Gn(n)[St.TimeFormat],t)}function Jh(n,t){return Gi(Gn(n)[St.DateTimeFormat],t)}function Hi(n,t){const e=Gn(n),i=e[St.NumberSymbols][t];if(typeof i>"u"){if(12===t)return e[St.NumberSymbols][0];if(13===t)return e[St.NumberSymbols][1]}return i}function gR(n){if(!n[St.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[St.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Gi(n,t){for(let e=t;e>-1;e--)if(typeof n[e]<"u")return n[e];throw new Error("Locale data API: locale data undefined")}function vv(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const pK=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ep={},gK=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function mR(n,t,e,i){let r=function SK(n){if(vR(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,o=1]=n.split("-").map(a=>+a);return tp(r,s-1,o)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(pK))return function CK(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const o=Number(n[4]||0)-e,a=Number(n[5]||0)-i,l=Number(n[6]||0),c=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,o,a,l,c),t}(i)}const t=new Date(n);if(!vR(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=Ds(e,t)||t;let a,o=[];for(;t;){if(a=gK.exec(t),!a){o.push(t);break}{o=o.concat(a.slice(1));const u=o.pop();if(!u)break;t=u}}let l=r.getTimezoneOffset();i&&(l=_R(i,l),r=function TK(n,t){const r=n.getTimezoneOffset();return function DK(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,-1*(_R(t,r)-r))}(r,i));let c="";return o.forEach(u=>{const d=function EK(n){if(Ev[n])return Ev[n];let t;switch(n){case"G":case"GG":case"GGG":t=Ct(3,_t.Abbreviated);break;case"GGGG":t=Ct(3,_t.Wide);break;case"GGGGG":t=Ct(3,_t.Narrow);break;case"y":t=tn(0,1,0,!1,!0);break;case"yy":t=tn(0,2,0,!0,!0);break;case"yyy":t=tn(0,3,0,!1,!0);break;case"yyyy":t=tn(0,4,0,!1,!0);break;case"Y":t=sp(1);break;case"YY":t=sp(2,!0);break;case"YYY":t=sp(3);break;case"YYYY":t=sp(4);break;case"M":case"L":t=tn(1,1,1);break;case"MM":case"LL":t=tn(1,2,1);break;case"MMM":t=Ct(2,_t.Abbreviated);break;case"MMMM":t=Ct(2,_t.Wide);break;case"MMMMM":t=Ct(2,_t.Narrow);break;case"LLL":t=Ct(2,_t.Abbreviated,Kn.Standalone);break;case"LLLL":t=Ct(2,_t.Wide,Kn.Standalone);break;case"LLLLL":t=Ct(2,_t.Narrow,Kn.Standalone);break;case"w":t=bv(1);break;case"ww":t=bv(2);break;case"W":t=bv(1,!0);break;case"d":t=tn(2,1);break;case"dd":t=tn(2,2);break;case"c":case"cc":t=tn(7,1);break;case"ccc":t=Ct(1,_t.Abbreviated,Kn.Standalone);break;case"cccc":t=Ct(1,_t.Wide,Kn.Standalone);break;case"ccccc":t=Ct(1,_t.Narrow,Kn.Standalone);break;case"cccccc":t=Ct(1,_t.Short,Kn.Standalone);break;case"E":case"EE":case"EEE":t=Ct(1,_t.Abbreviated);break;case"EEEE":t=Ct(1,_t.Wide);break;case"EEEEE":t=Ct(1,_t.Narrow);break;case"EEEEEE":t=Ct(1,_t.Short);break;case"a":case"aa":case"aaa":t=Ct(0,_t.Abbreviated);break;case"aaaa":t=Ct(0,_t.Wide);break;case"aaaaa":t=Ct(0,_t.Narrow);break;case"b":case"bb":case"bbb":t=Ct(0,_t.Abbreviated,Kn.Standalone,!0);break;case"bbbb":t=Ct(0,_t.Wide,Kn.Standalone,!0);break;case"bbbbb":t=Ct(0,_t.Narrow,Kn.Standalone,!0);break;case"B":case"BB":case"BBB":t=Ct(0,_t.Abbreviated,Kn.Format,!0);break;case"BBBB":t=Ct(0,_t.Wide,Kn.Format,!0);break;case"BBBBB":t=Ct(0,_t.Narrow,Kn.Format,!0);break;case"h":t=tn(3,1,-12);break;case"hh":t=tn(3,2,-12);break;case"H":t=tn(3,1);break;case"HH":t=tn(3,2);break;case"m":t=tn(4,1);break;case"mm":t=tn(4,2);break;case"s":t=tn(5,1);break;case"ss":t=tn(5,2);break;case"S":t=tn(6,1);break;case"SS":t=tn(6,2);break;case"SSS":t=tn(6,3);break;case"Z":case"ZZ":case"ZZZ":t=ip(0);break;case"ZZZZZ":t=ip(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=ip(1);break;case"OOOO":case"ZZZZ":case"zzzz":t=ip(2);break;default:return null}return Ev[n]=t,t}(u);c+=d?d(r,e,l):"''"===u?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function tp(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function Ds(n,t){const e=function nK(n){return Gn(n)[St.LocaleId]}(n);if(ep[e]??={},ep[e][t])return ep[e][t];let i="";switch(t){case"shortDate":i=Xh(n,Di.Short);break;case"mediumDate":i=Xh(n,Di.Medium);break;case"longDate":i=Xh(n,Di.Long);break;case"fullDate":i=Xh(n,Di.Full);break;case"shortTime":i=Zh(n,Di.Short);break;case"mediumTime":i=Zh(n,Di.Medium);break;case"longTime":i=Zh(n,Di.Long);break;case"fullTime":i=Zh(n,Di.Full);break;case"short":const r=Ds(n,"shortTime"),s=Ds(n,"shortDate");i=np(Jh(n,Di.Short),[r,s]);break;case"medium":const o=Ds(n,"mediumTime"),a=Ds(n,"mediumDate");i=np(Jh(n,Di.Medium),[o,a]);break;case"long":const l=Ds(n,"longTime"),c=Ds(n,"longDate");i=np(Jh(n,Di.Long),[l,c]);break;case"full":const u=Ds(n,"fullTime"),d=Ds(n,"fullDate");i=np(Jh(n,Di.Full),[u,d])}return i&&(ep[e][t]=i),i}function np(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function dr(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let o=String(n);for(;o.length<t;)o="0"+o;return i&&(o=o.slice(o.length-t)),s+o}function tn(n,t,e=0,i=!1,r=!1){return function(s,o){let a=function yK(n,t){switch(n){case 0:return t.getFullYear();case 1:return t.getMonth();case 2:return t.getDate();case 3:return t.getHours();case 4:return t.getMinutes();case 5:return t.getSeconds();case 6:return t.getMilliseconds();case 7:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||a>-e)&&(a+=e),3===n)0===a&&-12===e&&(a=12);else if(6===n)return function mK(n,t){return dr(n,3).substring(0,t)}(a,t);const l=Hi(o,5);return dr(a,t,l,i,r)}}function Ct(n,t,e=Kn.Format,i=!1){return function(r,s){return function _K(n,t,e,i,r,s){switch(e){case 2:return function sK(n,t,e){const i=Gn(n),s=Gi([i[St.MonthsFormat],i[St.MonthsStandalone]],t);return Gi(s,e)}(t,r,i)[n.getMonth()];case 1:return function rK(n,t,e){const i=Gn(n),s=Gi([i[St.DaysFormat],i[St.DaysStandalone]],t);return Gi(s,e)}(t,r,i)[n.getDay()];case 0:const o=n.getHours(),a=n.getMinutes();if(s){const c=function cK(n){const t=Gn(n);return gR(t),(t[St.ExtraData][2]||[]).map(i=>"string"==typeof i?vv(i):[vv(i[0]),vv(i[1])])}(t),u=function uK(n,t,e){const i=Gn(n);gR(i);const s=Gi([i[St.ExtraData][0],i[St.ExtraData][1]],t)||[];return Gi(s,e)||[]}(t,r,i),d=c.findIndex(f=>{if(Array.isArray(f)){const[h,p]=f,g=o>=h.hours&&a>=h.minutes,m=o<p.hours||o===p.hours&&a<p.minutes;if(h.hours<p.hours){if(g&&m)return!0}else if(g||m)return!0}else if(f.hours===o&&f.minutes===a)return!0;return!1});if(-1!==d)return u[d]}return function iK(n,t,e){const i=Gn(n),s=Gi([i[St.DayPeriodsFormat],i[St.DayPeriodsStandalone]],t);return Gi(s,e)}(t,r,i)[o<12?0:1];case 3:return function oK(n,t){return Gi(Gn(n)[St.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function ip(n){return function(t,e,i){const r=-1*i,s=Hi(e,5),o=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case 0:return(r>=0?"+":"")+dr(o,2,s)+dr(Math.abs(r%60),2,s);case 1:return"GMT"+(r>=0?"+":"")+dr(o,1,s);case 2:return"GMT"+(r>=0?"+":"")+dr(o,2,s)+":"+dr(Math.abs(r%60),2,s);case 3:return 0===i?"Z":(r>=0?"+":"")+dr(o,2,s)+":"+dr(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}const vK=0,rp=4;function yR(n){const t=n.getDay(),e=0===t?-3:rp-t;return tp(n.getFullYear(),n.getMonth(),n.getDate()+e)}function bv(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,o=e.getDate();r=1+Math.floor((o+s)/7)}else{const s=yR(e),o=function bK(n){const t=tp(n,vK,1).getDay();return tp(n,0,1+(t<=rp?rp:rp+7)-t)}(s.getFullYear()),a=s.getTime()-o.getTime();r=1+Math.round(a/6048e5)}return dr(r,n,Hi(i,5))}}function sp(n,t=!1){return function(e,i){return dr(yR(e).getFullYear(),n,Hi(i,5),t)}}const Ev={};function _R(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function vR(n){return n instanceof Date&&!isNaN(n.valueOf())}class UK{$implicit;ngForOf;index;count;constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let xl=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,o)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new UK(r.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)i.remove(null===s?void 0:s);else if(null!==s){const a=i.get(s);i.move(a,o),CR(a,r)}});for(let r=0,s=i.length;r<s;r++){const a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{CR(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||n)(F(vi),F(Xt),F(dv))};static \u0275dir=X({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function CR(n,t){n.context.$implicit=t.item}let Xo=(()=>{class n{_viewContainer;_context=new $K;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,i){this._viewContainer=e,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){IR(e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){IR(e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||n)(F(vi),F(Xt))};static \u0275dir=X({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})();class $K{$implicit=null;ngIf=null}function IR(n,t){if(n&&!n.createEmbeddedView)throw new P(2020,!1)}function fr(n,t){return new P(2100,!1)}const XK=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let AR=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw fr();return e.replace(XK,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}static \u0275fac=function(i){return new(i||n)};static \u0275pipe=ii({name:"titlecase",type:n,pure:!0})}return n})();const ez=new G(""),tz=new G("");let Rv=(()=>{class n{locale;defaultTimezone;defaultOptions;constructor(e,i,r){this.locale=e,this.defaultTimezone=i,this.defaultOptions=r}transform(e,i,r,s){if(null==e||""===e||e!=e)return null;try{return mR(e,i??this.defaultOptions?.dateFormat??"mediumDate",s||this.locale,r??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(o){throw fr()}}static \u0275fac=function(i){return new(i||n)(F(vs,16),F(ez,24),F(tz,24))};static \u0275pipe=ii({name:"date",type:n,pure:!0})}return n})(),RR=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ft({type:n});static \u0275inj=st({})}return n})();const Ov=new G("");let MR=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,i){this._zone=i,e.forEach(r=>{r.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,i,r,s){return this._findPluginFor(i).addEventListener(e,i,r,s)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(s=>s.supports(e)),!i)throw new P(5101,!1);return this._eventNameToPlugin.set(e,i),i}static \u0275fac=function(i){return new(i||n)(ue(Ov),ue(ke))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();class NR{_doc;constructor(t){this._doc=t}manager}const ap="ng-app-id";function OR(n){for(const t of n)t.remove()}function kR(n,t){const e=t.createElement("style");return e.textContent=n,e}function kv(n,t){const e=t.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",n),e}let LR=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,i,r,s={}){this.doc=e,this.appId=i,this.nonce=r,this.isServer=fR(s),function dz(n,t,e,i){const r=n.head?.querySelectorAll(`style[${ap}="${t}"],link[${ap}="${t}"]`);if(r)for(const s of r)s.removeAttribute(ap),s instanceof HTMLLinkElement?i.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&e.set(s.textContent,{usage:0,elements:[s]})}(e,i,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,i){for(const r of e)this.addUsage(r,this.inline,kR);i?.forEach(r=>this.addUsage(r,this.external,kv))}removeStyles(e,i){for(const r of e)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(e,i,r){const s=i.get(e);s?s.usage++:i.set(e,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,r(e,this.doc)))})}removeUsage(e,i){const r=i.get(e);r&&(r.usage--,r.usage<=0&&(OR(r.elements),i.delete(e)))}ngOnDestroy(){for(const[,{elements:e}]of[...this.inline,...this.external])OR(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(const[i,{elements:r}]of this.inline)r.push(this.addElement(e,kR(i,this.doc)));for(const[i,{elements:r}]of this.external)r.push(this.addElement(e,kv(i,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,i){return this.nonce&&i.setAttribute("nonce",this.nonce),this.isServer&&i.setAttribute(ap,this.appId),e.appendChild(i)}static \u0275fac=function(i){return new(i||n)(ue(Jt),ue(ds),ue(qS,8),ue(ky))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();const Lv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Pv=/%COMP%/g,yz=new G("",{providedIn:"root",factory:()=>!0});function FR(n,t){return t.map(e=>e.replace(Pv,n))}let BR=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,i,r,s,o,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=fR(a),this.defaultRenderer=new Fv(e,o,l,this.platformIsServer,this.tracingService)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Bi.ShadowDom&&(i={...i,encapsulation:Bi.Emulated});const r=this.getOrCreateRenderer(e,i);return r instanceof $R?r.applyToHost(e):r instanceof Bv&&r.applyStyles(),r}getOrCreateRenderer(e,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,f=this.tracingService;switch(i.encapsulation){case Bi.Emulated:s=new $R(l,c,i,this.appId,u,o,a,d,f);break;case Bi.ShadowDom:return new Ez(l,c,e,i,o,a,this.nonce,d,f);default:s=new Bv(l,c,i,u,o,a,d,f)}r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(i){return new(i||n)(ue(MR),ue(LR),ue(ds),ue(yz),ue(Jt),ue(ky),ue(ke),ue(qS),ue(Ha,8))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();class Fv{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,e,i,r,s){this.eventManager=t,this.doc=e,this.ngZone=i,this.platformIsServer=r,this.tracingService=s}destroy(){}destroyNode=null;createElement(t,e){return e?this.doc.createElementNS(Lv[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(UR(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(UR(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){e.remove()}selectRootElement(t,e){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new P(-5104,!1);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=Lv[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=Lv[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Gs.DashCase|Gs.Important)?t.style.setProperty(e,i,r&Gs.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Gs.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){null!=t&&(t[e]=i)}setValue(t,e){t.nodeValue=e}listen(t,e,i,r){if("string"==typeof t&&!(t=Xs().getGlobalEventTarget(this.doc,t)))throw new P(5102,!1);let s=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(t,e,s)),this.eventManager.addEventListener(t,e,s,r)}decoratePreventDefault(t){return e=>{if("__ngUnwrap__"===e)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(e)):t(e))&&e.preventDefault()}}}function UR(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Ez extends Fv{sharedStylesHost;hostEl;shadowRoot;constructor(t,e,i,r,s,o,a,l,c){super(t,s,o,l,c),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=r.styles;u=FR(r.id,u);for(const f of u){const h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=f,this.shadowRoot.appendChild(h)}const d=r.getExternalStyles?.();if(d)for(const f of d){const h=kv(f,s);a&&h.setAttribute("nonce",a),this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(null,e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Bv extends Fv{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,e,i,r,s,o,a,l,c){super(t,s,o,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=r;let u=i.styles;this.styles=c?FR(c,u):u,this.styleUrls=i.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}class $R extends Bv{contentAttr;hostAttr;constructor(t,e,i,r,s,o,a,l,c){const u=r+"-"+i.id;super(t,e,i,s,o,a,l,c,u),this.contentAttr=function _z(n){return"_ngcontent-%COMP%".replace(Pv,n)}(u),this.hostAttr=function vz(n){return"_nghost-%COMP%".replace(Pv,n)}(u)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class Uv extends zW{supportsDOMEvents=!0;static makeCurrent(){!function KW(n){sR??=n}(new Uv)}onAndCancel(t,e,i,r){return t.addEventListener(e,i,r),()=>{t.removeEventListener(e,i,r)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.remove()}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function Dz(){return ku=ku||document.head.querySelector("base"),ku?ku.getAttribute("href"):null}();return null==e?null:function Tz(n){return new URL(n,document.baseURI).pathname}(e)}resetBaseElement(){ku=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return uR(document.cookie,t)}}let ku=null,Cz=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})(),Iz=(()=>{class n extends NR{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r,s){return e.addEventListener(i,r,s),()=>this.removeEventListener(e,i,r,s)}removeEventListener(e,i,r,s){return e.removeEventListener(i,r,s)}static \u0275fac=function(i){return new(i||n)(ue(Jt))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();const VR=["alt","control","meta","shift"],wz={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Az={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let xz=(()=>{class n extends NR{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r,s){const o=n.parseEventName(i),a=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Xs().onAndCancel(e,o.domEventName,a,s))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),VR.forEach(c=>{const u=i.indexOf(c);u>-1&&(i.splice(u,1),o+=c+".")}),o+=s,0!=i.length||0===s.length)return null;const l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(e,i){let r=wz[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),VR.forEach(o=>{o!==r&&(0,Az[o])(e)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{n.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}static \u0275fac=function(i){return new(i||n)(ue(Jt))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();const HR=[{provide:ky,useValue:"browser"},{provide:Oy,useValue:function Rz(){Uv.makeCurrent()},multi:!0},{provide:Jt,useFactory:function Nz(){return function g$(n){Ny=n}(document),document}}],Oz=wx(nW,"browser",HR),GR=[{provide:Ih,useClass:class Sz{addToWindow(t){Bt.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new P(5103,!1);return s},Bt.getAllAngularTestabilities=()=>t.getAllTestabilities(),Bt.getAllAngularRootElements=()=>t.getAllRootElements(),Bt.frameworkStabilizers||(Bt.frameworkStabilizers=[]),Bt.frameworkStabilizers.push(i=>{const r=Bt.getAllAngularTestabilities();let s=r.length;const o=function(){s--,0==s&&i()};r.forEach(a=>{a.whenStable(o)})})}findTestabilityInTree(t,e,i){return null==e?null:t.getTestability(e)??(i?Xs().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null)}}},{provide:aw,useClass:S_,deps:[ke,C_,Ih]},{provide:S_,useClass:S_,deps:[ke,C_,Ih]}],WR=[{provide:Um,useValue:"root"},{provide:ar,useFactory:function Mz(){return new ar}},{provide:Ov,useClass:Iz,multi:!0,deps:[Jt]},{provide:Ov,useClass:xz,multi:!0,deps:[Jt]},BR,LR,MR,{provide:Q0,useExisting:BR},{provide:hR,useClass:Cz},[]];let kz=(()=>{class n{constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275mod=ft({type:n});static \u0275inj=st({providers:[...WR,...GR],imports:[RR,iW]})}return n})(),Lu=(()=>{class n{constructor(){this.toasts=[],this.toastId=0,this.toasts$=new Ke}show(e,i="info"){var r={id:this.toastId++,message:e,type:i};this.toasts.push(r),this.toasts$.next([...this.toasts]),setTimeout(()=>{this.remove(r.id)},5e3)}success(e){this.show(e,"success")}error(e){this.show(e,"error")}warning(e){this.show(e,"warning")}info(e){this.show(e,"info")}remove(e){this.toasts=this.toasts.filter(i=>i.id!==e),this.toasts$.next([...this.toasts])}clear(){this.toasts=[],this.toasts$.next([])}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Zs(n){return this instanceof Zs?(this.v=n,this):new Zs(n)}function YR(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function Hv(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(o){return new Promise(function(a,l){!function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Wv=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function QR(n){return We(n?.then)}function XR(n){return We(n[vm])}function ZR(n){return Symbol.asyncIterator&&We(n?.[Symbol.asyncIterator])}function JR(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const eM=function lq(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function tM(n){return We(n?.[eM])}function nM(n){return function qR(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function o(h){return function(p){return Promise.resolve(p).then(h,d)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(h,p){i[h]&&(r[h]=function(g){return new Promise(function(m,y){s.push([h,g,m,y])>1||l(h,g)})},p&&(r[h]=p(r[h])))}function l(h,p){try{!function c(h){h.value instanceof Zs?Promise.resolve(h.value.v).then(u,d):f(s[0][2],h)}(i[h](p))}catch(g){f(s[0][3],g)}}function u(h){l("next",h)}function d(h){l("throw",h)}function f(h,p){h(p),s.shift(),s.length&&l(s[0][0],s[0][1])}}(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield Zs(e.read());if(r)return yield Zs(void 0);yield yield Zs(i)}}finally{e.releaseLock()}})}function iM(n){return We(n?.getReader)}function Tn(n){if(n instanceof Dt)return n;if(null!=n){if(XR(n))return function cq(n){return new Dt(t=>{const e=n[vm]();if(We(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Wv(n))return function uq(n){return new Dt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(QR(n))return function dq(n){return new Dt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,zD)})}(n);if(ZR(n))return rM(n);if(tM(n))return function fq(n){return new Dt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(iM(n))return function hq(n){return rM(nM(n))}(n)}throw JR(n)}function rM(n){return new Dt(t=>{(function pq(n,t){var e,i,r,s;return function KR(n,t,e,i){return new(e||(e=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function r(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=YR(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function Ts(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function sM(n,t=0){return Wt((e,i)=>{e.subscribe(dt(i,r=>Ts(i,n,()=>i.next(r),t),()=>Ts(i,n,()=>i.complete(),t),r=>Ts(i,n,()=>i.error(r),t)))})}function oM(n,t=0){return Wt((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function aM(n,t){if(!n)throw new Error("Iterable cannot be null");return new Dt(e=>{Ts(e,t,()=>{const i=n[Symbol.asyncIterator]();Ts(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function nn(n,t){return t?function bq(n,t){if(null!=n){if(XR(n))return function gq(n,t){return Tn(n).pipe(oM(t),sM(t))}(n,t);if(Wv(n))return function yq(n,t){return new Dt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(QR(n))return function mq(n,t){return Tn(n).pipe(oM(t),sM(t))}(n,t);if(ZR(n))return aM(n,t);if(tM(n))return function _q(n,t){return new Dt(e=>{let i;return Ts(e,t,()=>{i=n[eM](),Ts(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void e.error(o)}s?e.complete():e.next(r)},0,!0)}),()=>We(i?.return)&&i.return()})}(n,t);if(iM(n))return function vq(n,t){return aM(nM(n),t)}(n,t)}throw JR(n)}(n,t):Tn(n)}function lM(n){return n&&We(n.schedule)}function Kv(n){return n[n.length-1]}function lp(n){return We(Kv(n))?n.pop():void 0}function Pu(n){return lM(Kv(n))?n.pop():void 0}function fe(...n){return nn(n,Pu(n))}const{isArray:Dq}=Array,{getPrototypeOf:Tq,prototype:Sq,keys:Cq}=Object;function cM(n){if(1===n.length){const t=n[0];if(Dq(t))return{args:t,keys:null};if(function Iq(n){return n&&"object"==typeof n&&Tq(n)===Sq}(t)){const e=Cq(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:wq}=Array;function zv(n){return Ne(t=>function Aq(n,t){return wq(t)?n(...t):n(t)}(n,t))}function uM(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function qv(...n){const t=Pu(n),e=lp(n),{args:i,keys:r}=cM(n);if(0===i.length)return nn([],t);const s=new Dt(function xq(n,t,e=es){return i=>{dM(t,()=>{const{length:r}=n,s=new Array(r);let o=r,a=r;for(let l=0;l<r;l++)dM(t,()=>{const c=nn(n[l],t);let u=!1;c.subscribe(dt(i,d=>{s[l]=d,u||(u=!0,a--),a||i.next(e(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}(i,t,r?o=>uM(r,o):es));return e?s.pipe(zv(e)):s}function dM(n,t,e){n?Ts(e,n,t):t()}const cp=fm(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Sn(n,t,e=1/0){return We(t)?Sn((i,r)=>Ne((s,o)=>t(i,s,r,o))(Tn(n(i,r))),e):("number"==typeof t&&(e=t),Wt((i,r)=>function Rq(n,t,e,i,r,s,o,a){const l=[];let c=0,u=0,d=!1;const f=()=>{d&&!l.length&&!c&&t.complete()},h=g=>c<i?p(g):l.push(g),p=g=>{s&&t.next(g),c++;let m=!1;Tn(e(g,u++)).subscribe(dt(t,y=>{r?.(y),s?h(y):t.next(y)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;l.length&&c<i;){const y=l.shift();o?Ts(t,o,()=>p(y)):p(y)}f()}catch(y){t.error(y)}}))};return n.subscribe(dt(t,h,()=>{d=!0,f()})),()=>{a?.()}}(i,r,n,e)))}function Rl(n=1/0){return Sn(es,n)}function Fu(...n){return function Mq(){return Rl(1)}()(nn(n,Pu(n)))}function fM(n){return new Dt(t=>{Tn(n()).subscribe(t)})}function Bu(n,t){const e=We(n)?n:()=>n,i=r=>r.error(e());return new Dt(t?r=>t.schedule(i,0,r):i)}const oi=new Dt(n=>n.complete());function Yv(){return Wt((n,t)=>{let e=null;n._refCount++;const i=dt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class hM extends Dt{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,XD(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new kn;const e=this.getSubject();t.add(this.source.subscribe(dt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=kn.EMPTY)}return t}refCount(){return Yv()(this)}}function Wi(n,t){return Wt((e,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();e.subscribe(dt(i,l=>{r?.unsubscribe();let c=0;const u=s++;Tn(n(l,u)).subscribe(r=dt(i,d=>i.next(t?t(l,d,u,c++):d),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function Ki(n){return n<=0?()=>oi:Wt((t,e)=>{let i=0;t.subscribe(dt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function pn(n,t){return Wt((e,i)=>{let r=0;e.subscribe(dt(i,s=>n.call(t,s,r++)&&i.next(s)))})}function up(n){return Wt((t,e)=>{let i=!1;t.subscribe(dt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function gM(n=Oq){return Wt((t,e)=>{let i=!1;t.subscribe(dt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function Oq(){return new cp}function Zo(n,t){const e=arguments.length>=2;return i=>i.pipe(n?pn((r,s)=>n(r,s,i)):es,Ki(1),e?up(t):gM(()=>new cp))}function Ml(n,t){return We(t)?Sn(n,t,1):Sn(n,1)}function qt(n,t,e){const i=We(n)||t||e?{next:n,error:t,complete:e}:n;return i?Wt((r,s)=>{var o;null===(o=i.subscribe)||void 0===o||o.call(i);let a=!0;r.subscribe(dt(s,l=>{var c;null===(c=i.next)||void 0===c||c.call(i,l),s.next(l)},()=>{var l;a=!1,null===(l=i.complete)||void 0===l||l.call(i),s.complete()},l=>{var c;a=!1,null===(c=i.error)||void 0===c||c.call(i,l),s.error(l)},()=>{var l,c;a&&(null===(l=i.unsubscribe)||void 0===l||l.call(i)),null===(c=i.finalize)||void 0===c||c.call(i)}))}):es}function It(n){return Wt((t,e)=>{let s,i=null,r=!1;i=t.subscribe(dt(e,void 0,void 0,o=>{s=Tn(n(o,It(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function Qv(n){return n<=0?()=>oi:Wt((t,e)=>{let i=[];t.subscribe(dt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function dp(n){return Wt((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}function gn(n){return Wt((t,e)=>{Tn(n).subscribe(dt(e,()=>e.complete(),pc)),!e.closed&&t.subscribe(e)})}let Fq=(()=>{class n{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(i){return new(i||n)(ue(Jt))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Re="primary",$u=Symbol("RouteTitle");class Vq{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Nl(n){return new Vq(n)}function jq(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const o=i[s],a=n[s];if(":"===o[0])r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Ur(n,t){const e=n?Xv(n):void 0,i=t?Xv(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!_M(n[r],t[r]))return!1;return!0}function Xv(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function _M(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function vM(n){return n.length>0?n[n.length-1]:null}function eo(n){return function Lz(n){return!!n&&(n instanceof Dt||We(n.lift)&&We(n.subscribe))}(n)?n:hu(n)?nn(Promise.resolve(n)):fe(n)}const Gq={exact:function DM(n,t,e){if(!ea(n.segments,t.segments)||!fp(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!DM(n.children[i],t.children[i],e))return!1;return!0},subset:TM},bM={exact:function Wq(n,t){return Ur(n,t)},subset:function Kq(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>_M(n[e],t[e]))},ignored:()=>!0};function EM(n,t,e){return Gq[e.paths](n.root,t.root,e.matrixParams)&&bM[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function TM(n,t,e){return SM(n,t,t.segments,e)}function SM(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!ea(r,e)||t.hasChildren()||!fp(r,e,i))}if(n.segments.length===e.length){if(!ea(n.segments,e)||!fp(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!TM(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(ea(n.segments,r)&&fp(n.segments,r,i)&&n.children[Re])&&SM(n.children[Re],t,s,i)}}function fp(n,t,e){return t.every((i,r)=>bM[e](n[r].parameters,i.parameters))}class Jo{root;queryParams;fragment;_queryParamMap;constructor(t=new ct([],{}),e={},i=null){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap??=Nl(this.queryParams),this._queryParamMap}toString(){return Yq.serialize(this)}}class ct{segments;children;parent=null;constructor(t,e){this.segments=t,this.children=e,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return pp(this)}}class Vu{path;parameters;_parameterMap;constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=Nl(this.parameters),this._parameterMap}toString(){return wM(this)}}function ea(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let ju=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>new hp,providedIn:"root"})}return n})();class hp{parse(t){const e=new oY(t);return new Jo(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${Hu(t.root,!0)}`,i=function Zq(n){const t=Object.entries(n).map(([e,i])=>Array.isArray(i)?i.map(r=>`${gp(e)}=${gp(r)}`).join("&"):`${gp(e)}=${gp(i)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function Qq(n){return encodeURI(n)}(t.fragment)}`:""}`}}const Yq=new hp;function pp(n){return n.segments.map(t=>wM(t)).join("/")}function Hu(n,t){if(!n.hasChildren())return pp(n);if(t){const e=n.children[Re]?Hu(n.children[Re],!1):"",i=[];return Object.entries(n.children).forEach(([r,s])=>{r!==Re&&i.push(`${r}:${Hu(s,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function qq(n,t){let e=[];return Object.entries(n.children).forEach(([i,r])=>{i===Re&&(e=e.concat(t(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==Re&&(e=e.concat(t(r,i)))}),e}(n,(i,r)=>r===Re?[Hu(n.children[Re],!1)]:[`${r}:${Hu(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Re]?`${pp(n)}/${e[0]}`:`${pp(n)}/(${e.join("//")})`}}function CM(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gp(n){return CM(n).replace(/%3B/gi,";")}function Zv(n){return CM(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function mp(n){return decodeURIComponent(n)}function IM(n){return mp(n.replace(/\+/g,"%20"))}function wM(n){return`${Zv(n.path)}${function Xq(n){return Object.entries(n).map(([t,e])=>`;${Zv(t)}=${Zv(e)}`).join("")}(n.parameters)}`}const Jq=/^[^\/()?;#]+/;function Jv(n){const t=n.match(Jq);return t?t[0]:""}const eY=/^[^\/()?;=#]+/,nY=/^[^=?&#]+/,rY=/^[^&#]+/;class oY{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ct([],{}):new ct([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Re]=new ct(t,e)),i}parseSegment(){const t=Jv(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new P(4009,!1);return this.capture(t),new Vu(mp(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=function tY(n){const t=n.match(eY);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=Jv(this.remaining);r&&(i=r,this.capture(i))}t[mp(e)]=mp(i)}parseQueryParam(t){const e=function iY(n){const t=n.match(nY);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const o=function sY(n){const t=n.match(rY);return t?t[0]:""}(this.remaining);o&&(i=o,this.capture(i))}const r=IM(e),s=IM(i);if(t.hasOwnProperty(r)){let o=t[r];Array.isArray(o)||(o=[o],t[r]=o),o.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Jv(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new P(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Re);const o=this.parseChildren();e[s]=1===Object.keys(o).length?o[Re]:new ct([],o),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new P(4011,!1)}}function AM(n){return n.segments.length>0?new ct([],{[Re]:n}):n}function xM(n){const t={};for(const[i,r]of Object.entries(n.children)){const s=xM(r);if(i===Re&&0===s.segments.length&&s.hasChildren())for(const[o,a]of Object.entries(s.children))t[o]=a;else(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function aY(n){if(1===n.numberOfChildren&&n.children[Re]){const t=n.children[Re];return new ct(n.segments.concat(t.segments),t.children)}return n}(new ct(n.segments,t))}function ta(n){return n instanceof Jo}function RM(n){let t;const r=AM(function e(s){const o={};for(const l of s.children){const c=e(l);o[l.outlet]=c}const a=new ct(s.url,o);return s===n&&(t=a),a}(n.root));return t??r}function MM(n,t,e,i){let r=n;for(;r.parent;)r=r.parent;if(0===t.length)return eb(r,r,r,e,i);const s=function cY(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new OM(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Object.entries(s.outlets).forEach(([l,c])=>{a[l]="string"==typeof c?c.split("/"):c}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?e=!0:".."===a?t++:""!=a&&r.push(a))}),r):[...r,s]},[]);return new OM(e,t,i)}(t);if(s.toRoot())return eb(r,r,new ct([],{}),e,i);const o=function uY(n,t,e){if(n.isAbsolute)return new _p(t,!0,0);if(!e)return new _p(t,!1,NaN);if(null===e.parent)return new _p(e,!0,0);const i=yp(n.commands[0])?0:1;return function dY(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new P(4005,!1);r=i.segments.length}return new _p(i,!1,r-s)}(e,e.segments.length-1+i,n.numberOfDoubleDots)}(s,r,n),a=o.processChildren?Wu(o.segmentGroup,o.index,s.commands):kM(o.segmentGroup,o.index,s.commands);return eb(r,o.segmentGroup,a,e,i)}function yp(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Gu(n){return"object"==typeof n&&null!=n&&n.outlets}function eb(n,t,e,i,r){let o,s={};i&&Object.entries(i).forEach(([l,c])=>{s[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`}),o=n===t?e:NM(n,t,e);const a=AM(xM(o));return new Jo(a,s,r)}function NM(n,t,e){const i={};return Object.entries(n.children).forEach(([r,s])=>{i[r]=s===t?e:NM(s,t,e)}),new ct(n.segments,i)}class OM{isAbsolute;numberOfDoubleDots;commands;constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&yp(i[0]))throw new P(4003,!1);const r=i.find(Gu);if(r&&r!==vM(i))throw new P(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class _p{segmentGroup;processChildren;index;constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function kM(n,t,e){if(n??=new ct([],{}),0===n.segments.length&&n.hasChildren())return Wu(n,t,e);const i=function hY(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const o=n.segments[r],a=e[i];if(Gu(a))break;const l=`${a}`,c=i<e.length-1?e[i+1]:null;if(r>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!PM(l,c,o))return s;i+=2}else{if(!PM(l,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new ct(n.segments.slice(0,i.pathIndex),{});return s.children[Re]=new ct(n.segments.slice(i.pathIndex),n.children),Wu(s,0,r)}return i.match&&0===r.length?new ct(n.segments,{}):i.match&&!n.hasChildren()?tb(n,t,e):i.match?Wu(n,0,r):tb(n,t,e)}function Wu(n,t,e){if(0===e.length)return new ct(n.segments,{});{const i=function fY(n){return Gu(n[0])?n[0].outlets:{[Re]:n}}(e),r={};if(Object.keys(i).some(s=>s!==Re)&&n.children[Re]&&1===n.numberOfChildren&&0===n.children[Re].segments.length){const s=Wu(n.children[Re],t,e);return new ct(n.segments,s.children)}return Object.entries(i).forEach(([s,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(r[s]=kM(n.children[s],t,o))}),Object.entries(n.children).forEach(([s,o])=>{void 0===i[s]&&(r[s]=o)}),new ct(n.segments,r)}}function tb(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(Gu(s)){const l=pY(s.outlets);return new ct(i,l)}if(0===r&&yp(e[0])){i.push(new Vu(n.segments[t].path,LM(e[0]))),r++;continue}const o=Gu(s)?s.outlets[Re]:`${s}`,a=r<e.length-1?e[r+1]:null;o&&a&&yp(a)?(i.push(new Vu(o,LM(a))),r+=2):(i.push(new Vu(o,{})),r++)}return new ct(i,{})}function pY(n){const t={};return Object.entries(n).forEach(([e,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[e]=tb(new ct([],{}),0,i))}),t}function LM(n){const t={};return Object.entries(n).forEach(([e,i])=>t[e]=`${i}`),t}function PM(n,t,e){return n==e.path&&Ur(t,e.parameters)}const vp="imperative";var Ve=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Ve||{});class $r{id;url;constructor(t,e){this.id=t,this.url=e}}class bp extends $r{type=Ve.NavigationStart;navigationTrigger;restoredState;constructor(t,e,i="imperative",r=null){super(t,e),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ss extends $r{urlAfterRedirects;type=Ve.NavigationEnd;constructor(t,e,i){super(t,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Ti=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Ti||{}),Ep=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Ep||{});class na extends $r{reason;code;type=Ve.NavigationCancel;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Ol extends $r{reason;code;type=Ve.NavigationSkipped;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}}class nb extends $r{error;target;type=Ve.NavigationError;constructor(t,e,i,r){super(t,e),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class FM extends $r{urlAfterRedirects;state;type=Ve.RoutesRecognized;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gY extends $r{urlAfterRedirects;state;type=Ve.GuardsCheckStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mY extends $r{urlAfterRedirects;state;shouldActivate;type=Ve.GuardsCheckEnd;constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class yY extends $r{urlAfterRedirects;state;type=Ve.ResolveStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _Y extends $r{urlAfterRedirects;state;type=Ve.ResolveEnd;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vY{route;type=Ve.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class bY{route;type=Ve.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class EY{snapshot;type=Ve.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class DY{snapshot;type=Ve.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class TY{snapshot;type=Ve.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SY{snapshot;type=Ve.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class BM{routerEvent;position;anchor;type=Ve.Scroll;constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class ib{}class Dp{url;navigationBehaviorOptions;constructor(t,e){this.url=t,this.navigationBehaviorOptions=e}}function hr(n){return n.outlet||Re}function Ku(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let t=n.parent;t;t=t.parent){const e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class RY{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Ku(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new zu(this.rootInjector)}}let zu=(()=>{class n{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new RY(this.rootInjector),this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(i){return new(i||n)(ue(An))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class UM{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=rb(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=rb(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=sb(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return sb(t,this._root).map(e=>e.value)}}function rb(n,t){if(n===t.value)return t;for(const e of t.children){const i=rb(n,e);if(i)return i}return null}function sb(n,t){if(n===t.value)return[t];for(const e of t.children){const i=sb(n,e);if(i.length)return i.unshift(t),i}return[]}class pr{value;children;constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function kl(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class $M extends UM{snapshot;constructor(t,e){super(t),this.snapshot=e,ob(this,t)}toString(){return this.snapshot.toString()}}function VM(n){const t=function MY(n){const s=new Sp([],{},{},"",{},Re,n,null,{});return new jM("",new pr(s,[]))}(n),e=new Oi([new Vu("",{})]),i=new Oi({}),r=new Oi({}),s=new Oi({}),o=new Oi(""),a=new ia(e,i,s,o,r,Re,n,t.root);return a.snapshot=t.root,new $M(new pr(a,[]),t)}class ia{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,e,i,r,s,o,a,l){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Ne(c=>c[$u]))??fe(void 0),this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Ne(t=>Nl(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Ne(t=>Nl(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Tp(n,t,e="emptyOnly"){let i;const{routeConfig:r}=n;return i=null===t||"always"!==e&&""!==r?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...n.params},data:{...n.data},resolve:{...n.data,...n._resolvedData??{}}}:{params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.data,...r?.data,...n._resolvedData}},r&&GM(r)&&(i.resolve[$u]=r.title),i}class Sp{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[$u]}constructor(t,e,i,r,s,o,a,l,c){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Nl(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Nl(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class jM extends UM{url;constructor(t,e){super(e),this.url=t,ob(this,e)}toString(){return HM(this._root)}}function ob(n,t){t.value._routerState=n,t.children.forEach(e=>ob(n,e))}function HM(n){const t=n.children.length>0?` { ${n.children.map(HM).join(", ")} } `:"";return`${n.value}${t}`}function ab(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,Ur(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),Ur(t.params,e.params)||n.paramsSubject.next(e.params),function Hq(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!Ur(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.urlSubject.next(e.url),Ur(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function lb(n,t){const e=Ur(n.params,t.params)&&function zq(n,t){return ea(n,t)&&n.every((e,i)=>Ur(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||lb(n.parent,t.parent))}function GM(n){return"string"==typeof n.title||null===n.title}const NY=new G("");let cb=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Re;activateEvents=new _e;deactivateEvents=new _e;attachEvents=new _e;detachEvents=new _e;routerOutletData=GU(void 0);parentContexts=S(zu);location=S(vi);changeDetector=S(ji);inputBinder=S(Cp,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){const{firstChange:i,previousValue:r}=e.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new P(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new P(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new P(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new P(4013,!1);this._activatedRoute=e;const r=this.location,o=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new OY(e,a,r.injector,this.routerOutletData);this.activated=r.createComponent(o,{index:r.length,injector:l,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=X({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Pn]})}return n})();class OY{route;childContexts;parent;outletData;constructor(t,e,i,r){this.route=t,this.childContexts=e,this.parent=i,this.outletData=r}get(t,e){return t===ia?this.route:t===zu?this.childContexts:t===NY?this.outletData:this.parent.get(t,e)}}const Cp=new G("");let WM=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){const{activatedRoute:i}=e,r=qv([i.queryParams,i.params,i.data]).pipe(Wi(([s,o,a],l)=>(a={...s,...o,...a},0===l?fe(a):Promise.resolve(a)))).subscribe(s=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(e);const o=function WW(n){const t=Be(n);if(!t)return null;const e=new lu(t);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(i.component);if(o)for(const{templateName:a}of o.inputs)e.activatedComponentRef.setInput(a,s[a]);else this.unsubscribeFromRouteData(e)});this.outletDataSubscriptions.set(e,r)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})(),KM=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=un({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){1&i&&oe(0,"router-outlet")},dependencies:[cb],encapsulation:2})}return n})();function ub(n){const t=n.children&&n.children.map(ub),e=t?{...n,children:t}:{...n};return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Re&&(e.component=KM),e}function qu(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function LY(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return qu(n,i,r);return qu(n,i)})}(n,t,e);return new pr(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=t.value,o.children=t.children.map(a=>qu(n,a)),o}}const i=function PY(n){return new ia(new Oi(n.url),new Oi(n.params),new Oi(n.queryParams),new Oi(n.fragment),new Oi(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>qu(n,s));return new pr(i,r)}}class db{redirectTo;navigationBehaviorOptions;constructor(t,e){this.redirectTo=t,this.navigationBehaviorOptions=e}}const zM="ngNavigationCancelingError";function Ip(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=ta(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=qM(!1,Ti.Redirect);return r.url=e,r.navigationBehaviorOptions=i,r}function qM(n,t){const e=new Error(`NavigationCancelingError: ${n||""}`);return e[zM]=!0,e.cancellationCode=t,e}function YM(n){return!!n&&n[zM]}class UY{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,e,i,r,s){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),ab(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=kl(e);t.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(t,e,o.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=kl(t);for(const o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);if(i&&i.outlet){const o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:o,route:t,contexts:a})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=kl(t);for(const o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,e,i){const r=kl(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new SY(s.value.snapshot))}),t.children.length&&this.forwardEvent(new DY(t.value.snapshot))}activateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(ab(r),r===s)if(r.component){const o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,o.children)}else this.activateChildRoutes(t,e,i);else if(r.component){const o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),ab(a.route.value),this.activateChildRoutes(t,null,o.children)}else o.attachRef=null,o.route=r,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(t,null,o.children)}else this.activateChildRoutes(t,null,i)}}class QM{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class wp{component;route;constructor(t,e){this.component=t,this.route=e}}function $Y(n,t,e){const i=n._root;return Yu(i,t?t._root:null,e,[i.value])}function Ll(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function nB(n){return null!==Jd(n)}(n)?t.get(n):n:i}function Yu(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=kl(t);return n.children.forEach(o=>{(function jY(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=t?t.value:null,a=e?e.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function HY(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!ea(n.url,t.url);case"pathParamsOrQueryParamsChange":return!ea(n.url,t.url)||!Ur(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!lb(n,t)||!Ur(n.queryParams,t.queryParams);default:return!lb(n,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new QM(i)):(s.data=o.data,s._resolvedData=o._resolvedData),Yu(n,t,s.component?a?a.children:null:e,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new wp(a.outlet.component,o))}else o&&Qu(t,a,r),r.canActivateChecks.push(new QM(i)),Yu(n,null,s.component?a?a.children:null:e,i,r)})(o,s[o.value.outlet],e,i.concat([o.value]),r),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Qu(a,e.getContext(o),r)),r}function Qu(n,t,e){const i=kl(n),r=n.value;Object.entries(i).forEach(([s,o])=>{Qu(o,r.component?t?t.children.getContext(s):null:t,e)}),e.canDeactivateChecks.push(new wp(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function Xu(n){return"function"==typeof n}function XM(n){return n instanceof cp||"EmptyError"===n?.name}const Ap=Symbol("INITIAL_VALUE");function Pl(){return Wi(n=>qv(n.map(t=>t.pipe(Ki(1),function pM(...n){const t=Pu(n);return Wt((e,i)=>{(t?Fu(n,e,t):Fu(n,e)).subscribe(i)})}(Ap)))).pipe(Ne(t=>{for(const e of t)if(!0!==e){if(e===Ap)return Ap;if(!1===e||QY(e))return e}return!0}),pn(t=>t!==Ap),Ki(1)))}function QY(n){return ta(n)||n instanceof db}function ZM(n){return function W2(...n){return qD(n)}(qt(t=>{if("boolean"!=typeof t)throw Ip(0,t)}),Ne(t=>!0===t))}class fb{segmentGroup;constructor(t){this.segmentGroup=t||null}}class hb extends Error{urlTree;constructor(t){super(),this.urlTree=t}}function Fl(n){return Bu(new fb(n))}class c9{urlSerializer;urlTree;constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return fe(i);if(r.numberOfChildren>1||!r.children[Re])return Bu(new P(4e3,!1));r=r.children[Re]}}applyRedirectCommands(t,e,i,r,s){if("string"!=typeof e){const a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:f,params:h,data:p,title:g}=r,m=Li(s,()=>a({params:h,data:p,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:f,title:g}));if(m instanceof Jo)throw new hb(m);e=m}const o=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i);if("/"===e[0])throw new hb(o);return o}applyRedirectCreateUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new Jo(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return Object.entries(t).forEach(([r,s])=>{if("string"==typeof s&&":"===s[0]){const a=s.substring(1);i[r]=e[a]}else i[r]=s}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let o={};return Object.entries(e.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(t,l,i,r)}),new ct(s,o)}createSegments(t,e,i,r){return e.map(s=>":"===s.path[0]?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new P(4001,!1);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}const pb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function u9(n,t,e,i,r){const s=JM(n,t,e);return s.matched?(i=function CY(n,t){return n.providers&&!n._injector&&(n._injector=vh(n.providers,t,`Route: ${n.path}`)),n._injector??t}(t,i),function o9(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?fe(r.map(o=>{const a=Ll(o,n);return eo(function YY(n){return n&&Xu(n.canMatch)}(a)?a.canMatch(t,e):Li(n,()=>a(t,e)))})).pipe(Pl(),ZM()):fe(!0)}(i,t,e).pipe(Ne(o=>!0===o?s:{...pb}))):fe(s)}function JM(n,t,e){if("**"===t.path)return function d9(n){return{matched:!0,parameters:n.length>0?vM(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}(e);if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?{...pb}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const r=(t.matcher||jq)(e,n,t);if(!r)return{...pb};const s={};Object.entries(r.posParams??{}).forEach(([a,l])=>{s[a]=l.path});const o=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:e.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function eN(n,t,e,i){return e.length>0&&function p9(n,t,e){return e.some(i=>xp(n,t,i)&&hr(i)!==Re)}(n,e,i)?{segmentGroup:new ct(t,h9(i,new ct(e,n.children))),slicedSegments:[]}:0===e.length&&function g9(n,t,e){return e.some(i=>xp(n,t,i))}(n,e,i)?{segmentGroup:new ct(n.segments,f9(n,e,i,n.children)),slicedSegments:e}:{segmentGroup:new ct(n.segments,n.children),slicedSegments:e}}function f9(n,t,e,i){const r={};for(const s of e)if(xp(n,t,s)&&!i[hr(s)]){const o=new ct([],{});r[hr(s)]=o}return{...i,...r}}function h9(n,t){const e={};e[Re]=t;for(const i of n)if(""===i.path&&hr(i)!==Re){const r=new ct([],{});e[hr(i)]=r}return e}function xp(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}class y9{}class b9{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,e,i,r,s,o,a){this.injector=t,this.configLoader=e,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new c9(this.urlSerializer,this.urlTree)}noMatchError(t){return new P(4002,`'${t.segmentGroup}'`)}recognize(){const t=eN(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(Ne(({children:e,rootSnapshot:i})=>{const r=new pr(i,e),s=new jM("",r),o=function lY(n,t,e=null,i=null){return MM(RM(n),t,e,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(t){const e=new Sp([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),Re,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,Re,e).pipe(Ne(i=>({children:i,rootSnapshot:e})),It(i=>{if(i instanceof hb)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof fb?this.noMatchError(i):i}))}processSegmentGroup(t,e,i,r,s){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i,s):this.processSegment(t,e,i,i.segments,r,!0,s).pipe(Ne(o=>o instanceof pr?[o]:[]))}processChildren(t,e,i,r){const s=[];for(const o of Object.keys(i.children))"primary"===o?s.unshift(o):s.push(o);return nn(s).pipe(Ml(o=>{const a=i.children[o],l=function xY(n,t){const e=n.filter(i=>hr(i)===t);return e.push(...n.filter(i=>hr(i)!==t)),e}(e,o);return this.processSegmentGroup(t,l,a,o,r)}),function Lq(n,t){return Wt(function kq(n,t,e,i,r){return(s,o)=>{let a=e,l=t,c=0;s.subscribe(dt(o,u=>{const d=c++;l=a?n(l,u,d):(a=!0,u),i&&o.next(l)},r&&(()=>{a&&o.next(l),o.complete()})))}}(n,t,arguments.length>=2,!0))}((o,a)=>(o.push(...a),o)),up(null),function Pq(n,t){const e=arguments.length>=2;return i=>i.pipe(n?pn((r,s)=>n(r,s,i)):es,Qv(1),e?up(t):gM(()=>new cp))}(),Sn(o=>{if(null===o)return Fl(i);const a=tN(o);return function E9(n){n.sort((t,e)=>t.value.outlet===Re?-1:e.value.outlet===Re?1:t.value.outlet.localeCompare(e.value.outlet))}(a),fe(a)}))}processSegment(t,e,i,r,s,o,a){return nn(e).pipe(Ml(l=>this.processSegmentAgainstRoute(l._injector??t,e,l,i,r,s,o,a).pipe(It(c=>{if(c instanceof fb)return fe(null);throw c}))),Zo(l=>!!l),It(l=>{if(XM(l))return function m9(n,t,e){return 0===t.length&&!n.children[e]}(i,r,s)?fe(new y9):Fl(i);throw l}))}processSegmentAgainstRoute(t,e,i,r,s,o,a,l){return hr(i)===o||o!==Re&&xp(r,s,i)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,r,i,s,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,r,e,i,s,o,l):Fl(r):Fl(r)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,o,a){const{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:f}=JM(e,r,s);if(!l)return Fl(e);"string"==typeof r.redirectTo&&"/"===r.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const h=new Sp(s,c,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,nN(r),hr(r),r.component??r._loadedComponent??null,r,iN(r)),p=Tp(h,a,this.paramsInheritanceStrategy);h.params=Object.freeze(p.params),h.data=Object.freeze(p.data);const g=this.applyRedirects.applyRedirectCommands(u,r.redirectTo,d,h,t);return this.applyRedirects.lineralizeSegments(r,g).pipe(Sn(m=>this.processSegment(t,i,e,m.concat(f),o,!1,a)))}matchSegmentAgainstRoute(t,e,i,r,s,o){const a=u9(e,i,r,t);return"**"===i.path&&(e.children={}),a.pipe(Wi(l=>l.matched?this.getChildConfig(t=i._injector??t,i,r).pipe(Wi(({routes:c})=>{const u=i._loadedInjector??t,{parameters:d,consumedSegments:f,remainingSegments:h}=l,p=new Sp(f,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,nN(i),hr(i),i.component??i._loadedComponent??null,i,iN(i)),g=Tp(p,o,this.paramsInheritanceStrategy);p.params=Object.freeze(g.params),p.data=Object.freeze(g.data);const{segmentGroup:m,slicedSegments:y}=eN(e,f,h,c);if(0===y.length&&m.hasChildren())return this.processChildren(u,c,m,p).pipe(Ne(b=>new pr(p,b)));if(0===c.length&&0===y.length)return fe(new pr(p,[]));const v=hr(i)===s;return this.processSegment(u,c,m,y,v?Re:s,!0,p).pipe(Ne(b=>new pr(p,b instanceof pr?[b]:[])))})):Fl(e)))}getChildConfig(t,e,i){return e.children?fe({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?fe({routes:e._loadedRoutes,injector:e._loadedInjector}):function s9(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?fe(!0):fe(r.map(o=>{const a=Ll(o,n);return eo(function WY(n){return n&&Xu(n.canLoad)}(a)?a.canLoad(t,e):Li(n,()=>a(t,e)))})).pipe(Pl(),ZM())}(t,e,i).pipe(Sn(r=>r?this.configLoader.loadChildren(t,e).pipe(qt(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function l9(){return Bu(qM(!1,Ti.GuardRejected))}())):fe({routes:[],injector:t})}}function D9(n){const t=n.value.routeConfig;return t&&""===t.path}function tN(n){const t=[],e=new Set;for(const i of n){if(!D9(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=tN(i.children);t.push(new pr(i.value,r))}return t.filter(i=>!e.has(i))}function nN(n){return n.data||{}}function iN(n){return n.resolve||{}}function rN(n){const t=n.children.map(e=>rN(e)).flat();return[n,...t]}function gb(n){return Wi(t=>{const e=n(t);return e?nn(e).pipe(Ne(()=>t)):fe(t)})}let sN=(()=>{class n{buildTitle(e){let i,r=e.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===Re);return i}getResolvedTitleForRoute(e){return e.data[$u]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>S(A9),providedIn:"root"})}return n})(),A9=(()=>{class n extends sN{title;constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(ue(Fq))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Zu=new G("",{providedIn:"root",factory:()=>({})}),Rp=new G("");let mb=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=S(C6);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return fe(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=eo(e.loadComponent()).pipe(Ne(oN),qt(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),dp(()=>{this.componentLoaders.delete(e)})),r=new hM(i,()=>new Ke).pipe(Yv());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return fe({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=function x9(n,t,e,i){return eo(n.loadChildren()).pipe(Ne(oN),Sn(r=>r instanceof BI||Array.isArray(r)?fe(r):nn(t.compileModuleAsync(r))),Ne(r=>{i&&i(n);let s,o,a=!1;return Array.isArray(r)?(o=r,!0):(s=r.create(e).injector,o=s.get(Rp,[],{optional:!0,self:!0}).flat()),{routes:o.map(ub),injector:s}}))}(i,this.compiler,e,this.onLoadEndListener).pipe(dp(()=>{this.childrenLoaders.delete(i)})),o=new hM(s,()=>new Ke).pipe(Yv());return this.childrenLoaders.set(i,o),o}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function oN(n){return function R9(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let yb=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>S(M9),providedIn:"root"})}return n})(),M9=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const aN=new G(""),lN=new G("");function N9(n,t,e){const i=n.get(lN),r=n.get(Jt);return n.get(ke).runOutsideAngular(()=>{if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(c=>setTimeout(c));let s;const o=new Promise(c=>{s=c}),a=r.startViewTransition(()=>(s(),function O9(n){return new Promise(t=>{Fo({read:()=>setTimeout(t)},{injector:n})})}(n))),{onViewTransitionCreated:l}=i;return l&&Li(n,()=>l({transition:a,from:t,to:e})),o})}const cN=new G("");let _b=(()=>{class n{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Ke;transitionAbortSubject=new Ke;configLoader=S(mb);environmentInjector=S(An);destroyRef=S(jn);urlSerializer=S(ju);rootContexts=S(zu);location=S(Mu);inputBindingEnabled=null!==S(Cp,{optional:!0});titleStrategy=S(sN);options=S(Zu,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=S(yb);createViewTransition=S(aN,{optional:!0});navigationErrorHandler=S(cN,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>fe(void 0);rootComponentType=null;destroyed=!1;constructor(){this.configLoader.onLoadEndListener=r=>this.events.next(new bY(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new vY(r)),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){const i=++this.navigationId;this.transitions?.next({...e,extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:i})}setupNavigations(e){return this.transitions=new Oi(null),this.transitions.pipe(pn(i=>null!==i),Wi(i=>{let r=!1,s=!1;return fe(i).pipe(Wi(o=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Ti.SupersededByNewNavigation),oi;this.currentTransition=i,this.currentNavigation={id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:"string"==typeof o.extras.browserUrl?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const a=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!a&&"reload"!==(o.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const c="";return this.events.next(new Ol(o.id,this.urlSerializer.serialize(o.rawUrl),c,Ep.IgnoredSameUrlNavigation)),o.resolve(!1),oi}if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return fe(o).pipe(Wi(c=>(this.events.next(new bp(c.id,this.urlSerializer.serialize(c.extractedUrl),c.source,c.restoredState)),c.id!==this.navigationId?oi:Promise.resolve(c))),function T9(n,t,e,i,r,s){return Sn(o=>function _9(n,t,e,i,r,s,o="emptyOnly"){return new b9(n,t,e,i,r,o,s).recognize()}(n,t,e,i,o.extractedUrl,r,s).pipe(Ne(({state:a,tree:l})=>({...o,targetSnapshot:a,urlAfterRedirects:l}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),qt(c=>{i.targetSnapshot=c.targetSnapshot,i.urlAfterRedirects=c.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:c.urlAfterRedirects};const u=new FM(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}));if(a&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){const{id:c,extractedUrl:u,source:d,restoredState:f,extras:h}=o,p=new bp(c,this.urlSerializer.serialize(u),d,f);this.events.next(p);const g=VM(this.rootComponentType).snapshot;return this.currentTransition=i={...o,targetSnapshot:g,urlAfterRedirects:u,extras:{...h,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=u,fe(i)}{const c="";return this.events.next(new Ol(o.id,this.urlSerializer.serialize(o.extractedUrl),c,Ep.IgnoredByUrlHandlingStrategy)),o.resolve(!1),oi}}),qt(o=>{const a=new gY(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),Ne(o=>(this.currentTransition=i={...o,guards:$Y(o.targetSnapshot,o.currentSnapshot,this.rootContexts)},i)),function XY(n,t){return Sn(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=e;return 0===o.length&&0===s.length?fe({...e,guardsResult:!0}):function ZY(n,t,e,i){return nn(n).pipe(Sn(r=>function r9(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?fe(s.map(a=>{const l=Ku(t)??r,c=Ll(a,l);return eo(function qY(n){return n&&Xu(n.canDeactivate)}(c)?c.canDeactivate(n,t,e,i):Li(l,()=>c(n,t,e,i))).pipe(Zo())})).pipe(Pl()):fe(!0)}(r.component,r.route,e,t,i)),Zo(r=>!0!==r,!0))}(o,i,r,n).pipe(Sn(a=>a&&function GY(n){return"boolean"==typeof n}(a)?function JY(n,t,e,i){return nn(t).pipe(Ml(r=>Fu(function t9(n,t){return null!==n&&t&&t(new EY(n)),fe(!0)}(r.route.parent,i),function e9(n,t){return null!==n&&t&&t(new TY(n)),fe(!0)}(r.route,i),function i9(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(o=>function VY(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(o)).filter(o=>null!==o).map(o=>fM(()=>fe(o.guards.map(l=>{const c=Ku(o.node)??e,u=Ll(l,c);return eo(function zY(n){return n&&Xu(n.canActivateChild)}(u)?u.canActivateChild(i,n):Li(c,()=>u(i,n))).pipe(Zo())})).pipe(Pl())));return fe(s).pipe(Pl())}(n,r.path,e),function n9(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return fe(!0);const r=i.map(s=>fM(()=>{const o=Ku(t)??e,a=Ll(s,o);return eo(function KY(n){return n&&Xu(n.canActivate)}(a)?a.canActivate(t,n):Li(o,()=>a(t,n))).pipe(Zo())}));return fe(r).pipe(Pl())}(n,r.route,e))),Zo(r=>!0!==r,!0))}(i,s,n,t):fe(a)),Ne(a=>({...e,guardsResult:a})))})}(this.environmentInjector,o=>this.events.next(o)),qt(o=>{if(i.guardsResult=o.guardsResult,o.guardsResult&&"boolean"!=typeof o.guardsResult)throw Ip(0,o.guardsResult);const a=new mY(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),pn(o=>!!o.guardsResult||(this.cancelNavigationTransition(o,"",Ti.GuardRejected),!1)),gb(o=>{if(0!==o.guards.canActivateChecks.length)return fe(o).pipe(qt(a=>{const l=new yY(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}),Wi(a=>{let l=!1;return fe(a).pipe(function S9(n,t){return Sn(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return fe(e);const s=new Set(r.map(l=>l.route)),o=new Set;for(const l of s)if(!o.has(l))for(const c of rN(l))o.add(c);let a=0;return nn(o).pipe(Ml(l=>s.has(l)?function C9(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==r?.title&&!GM(r)&&(s[$u]=r.title),function I9(n,t,e,i){const r=Xv(n);if(0===r.length)return fe({});const s={};return nn(r).pipe(Sn(o=>function w9(n,t,e,i){const r=Ku(t)??i,s=Ll(n,r);return eo(s.resolve?s.resolve(t,e):Li(r,()=>s(t,e)))}(n[o],t,e,i).pipe(Zo(),qt(a=>{if(a instanceof db)throw Ip(new hp,a);s[o]=a}))),Qv(1),Ne(()=>s),It(o=>XM(o)?oi:Bu(o)))}(s,n,t,i).pipe(Ne(o=>(n._resolvedData=o,n.data=Tp(n,n.parent,e).resolve,null)))}(l,i,n,t):(l.data=Tp(l,l.parent,n).resolve,fe(void 0))),qt(()=>a++),Qv(1),Sn(l=>a===o.size?fe(e):oi))})}(this.paramsInheritanceStrategy,this.environmentInjector),qt({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(a,"",Ti.NoDataFromResolver)}}))}),qt(a=>{const l=new _Y(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}))}),gb(o=>{const a=l=>{const c=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(l.routeConfig).pipe(qt(u=>{l.component=u}),Ne(()=>{})));for(const u of l.children)c.push(...a(u));return c};return qv(a(o.targetSnapshot.root)).pipe(up(null),Ki(1))}),gb(()=>this.afterPreactivation()),Wi(()=>{const{currentSnapshot:o,targetSnapshot:a}=i,l=this.createViewTransition?.(this.environmentInjector,o.root,a.root);return l?nn(l).pipe(Ne(()=>i)):fe(i)}),Ne(o=>{const a=function kY(n,t,e){const i=qu(n,t._root,e?e._root:void 0);return new $M(i,t)}(e.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=i={...o,targetRouterState:a},this.currentNavigation.targetRouterState=a,i}),qt(()=>{this.events.next(new ib)}),((n,t,e,i)=>Ne(r=>(new UY(t,r.targetRouterState,r.currentRouterState,e,i).activate(n),r)))(this.rootContexts,e.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),Ki(1),qt({next:o=>{r=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ss(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),gn(this.transitionAbortSubject.pipe(qt(o=>{throw o}))),dp(()=>{!r&&!s&&this.cancelNavigationTransition(i,"",Ti.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),It(o=>{if(this.destroyed)return i.resolve(!1),oi;if(s=!0,YM(o))this.events.next(new na(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode)),function FY(n){return YM(n)&&ta(n.url)}(o)?this.events.next(new Dp(o.url,o.navigationBehaviorOptions)):i.resolve(!1);else{const a=new nb(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);try{const l=Li(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(!(l instanceof db))throw this.events.next(a),o;{const{message:c,cancellationCode:u}=Ip(0,l);this.events.next(new na(i.id,this.urlSerializer.serialize(i.extractedUrl),c,u)),this.events.next(new Dp(l.redirectTo,l.navigationBehaviorOptions))}}catch(l){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(l)}}return oi}))}))}cancelNavigationTransition(e,i,r){const s=new na(e.id,this.urlSerializer.serialize(e.extractedUrl),i,r);this.events.next(s),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==i?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function k9(n){return n!==vp}let L9=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>S(F9),providedIn:"root"})}return n})();class P9{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}let F9=(()=>{class n extends P9{static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),uN=(()=>{class n{urlSerializer=S(ju);options=S(Zu,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=S(Mu);urlHandlingStrategy=S(yb);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Jo;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:i,targetBrowserUrl:r}){const s=void 0!==e?this.urlHandlingStrategy.merge(e,i):i,o=r??s;return o instanceof Jo?this.urlSerializer.serialize(o):o}commitTransition({targetRouterState:e,finalUrl:i,initialUrl:r}){i&&e?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=e):this.rawUrlTree=r}routerState=VM(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:()=>S(B9),providedIn:"root"})}return n})(),B9=(()=>{class n extends uN{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(i=>{"popstate"===i.type&&setTimeout(()=>{e(i.url,i.state,"popstate")})})}handleRouterEvent(e,i){e instanceof bp?this.updateStateMemento():e instanceof Ol?this.commitTransition(i):e instanceof FM?"eager"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof ib?(this.commitTransition(i),"deferred"===this.urlUpdateStrategy&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof na&&(e.code===Ti.GuardRejected||e.code===Ti.NoDataFromResolver)?this.restoreHistory(i):e instanceof nb?this.restoreHistory(i,!0):e instanceof Ss&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:i,id:r}){const{replaceUrl:s,state:o}=i;if(this.location.isCurrentPathEqualTo(e)||s){const a=this.browserPageId,l={...o,...this.generateNgRouterState(r,a)};this.location.replaceState(e,"",l)}else{const a={...o,...this.generateNgRouterState(r,this.browserPageId+1)};this.location.go(e,"",a)}}restoreHistory(e,i=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-this.browserPageId;0!==s?this.location.historyGo(s):this.getCurrentUrlTree()===e.finalUrl&&0===s&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function dN(n,t){n.events.pipe(pn(e=>e instanceof Ss||e instanceof na||e instanceof nb||e instanceof Ol),Ne(e=>e instanceof Ss||e instanceof Ol?0:e instanceof na&&(e.code===Ti.Redirect||e.code===Ti.SupersededByNewNavigation)?2:1),pn(e=>2!==e),Ki(1)).subscribe(()=>{t()})}const U9={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},$9={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let gr=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=S(b_);stateManager=S(uN);options=S(Zu,{optional:!0})||{};pendingTasks=S(Vs);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=S(_b);urlSerializer=S(ju);location=S(Mu);urlHandlingStrategy=S(yb);_events=new Ke;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=S(L9);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=S(Rp,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!S(Cp,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new kn;subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(i=>{try{const r=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(null!==r&&null!==s)if(this.stateManager.handleRouterEvent(i,s),i instanceof na&&i.code!==Ti.Redirect&&i.code!==Ti.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Ss)this.navigated=!0;else if(i instanceof Dp){const o=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),l={browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||"eager"===this.urlUpdateStrategy||k9(r.source),...o};this.scheduleNavigation(a,vp,null,l,{resolve:r.resolve,reject:r.reject,promise:r.promise})}(function j9(n){return!(n instanceof ib||n instanceof Dp)})(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),vp,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,i,r)=>{this.navigateToSyncWithBrowser(e,r,i)})}navigateToSyncWithBrowser(e,i,r){const s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){const l={...r};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(s.state=l)}const a=this.parseUrl(e);this.scheduleNavigation(a,i,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(ub),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=i,c=l?this.currentUrlTree.fragment:o;let d,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u={...this.currentUrlTree.queryParams,...s};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}null!==u&&(u=this.removeEmptyProps(u));try{d=RM(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||"/"!==e[0][0])&&(e=[]),d=this.currentUrlTree.root}return MM(d,e,u,c??null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=ta(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,vp,null,i)}navigate(e,i={skipLocationChange:!1}){return function V9(n){for(let t=0;t<n.length;t++)if(null==n[t])throw new P(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,i){let r;if(r=!0===i?{...U9}:!1===i?{...$9}:i,ta(e))return EM(this.currentUrlTree,e,r);const s=this.parseUrl(e);return EM(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.entries(e).reduce((i,[r,s])=>(null!=s&&(i[r]=s),i),{})}scheduleNavigation(e,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,c;o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((d,f)=>{a=d,l=f});const u=this.pendingTasks.add();return dN(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:s,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),H9=(()=>{class n{static \u0275prov=H({token:n,providedIn:"root",factory:()=>new G9(S(Jt),window)})}return n})();class G9{document;window;offset=()=>[0,0];constructor(t,e){this.document=t,this.window=e}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){const e=function W9(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&"function"==typeof n.body.attachShadow){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const o=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(o)return o}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}}let Bl=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Ke;constructor(e,i,r,s,o,a){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=o,this.locationStrategy=a;const l=o.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===l||"area"===l,this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof Ss&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){null==e?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=ta(e)||Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,i,r,s,o){const a=this.urlTree;return!!(null===a||this.isAnchorElement&&(0!==e||i||r||s||o||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(a,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const e=this.urlTree;this.href=null!==e&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;const i=null===this.href?null:function z1(n,t,e){return function MV(n,t){return"src"===t&&("embed"===n||"frame"===n||"iframe"===n||"media"===n||"script"===n)||"href"===t&&("base"===n||"link"===n)?K1:Jf}(t,e)(n)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(e,i){const r=this.renderer,s=this.el.nativeElement;null!==i?r.setAttribute(s,e,i):r.removeAttribute(s,e)}get urlTree(){return null===this.routerLinkInput?null:ta(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||n)(F(gr),F(ia),function $s(n){return function bU(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(ZT(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(Pe(),n)}("tabindex"),F(gs),F(nt),F(Qo))};static \u0275dir=X({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){1&i&&re("click",function(o){return r.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),2&i&&ht("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",wl],skipLocationChange:[2,"skipLocationChange","skipLocationChange",wl],replaceUrl:[2,"replaceUrl","replaceUrl",wl],routerLink:"routerLink"},features:[Pn]})}return n})(),DN=(()=>{class n{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new _e;constructor(e,i,r,s,o){this.router=e,this.element=i,this.renderer=r,this.cdr=s,this.link=o,this.routerEventsSubscription=e.events.subscribe(a=>{a instanceof Ss&&this.update()})}ngAfterContentInit(){fe(this.links.changes,fe(null)).pipe(Rl()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const e=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=nn(e).pipe(Rl()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(e){const i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const e=this.hasActiveLinks();this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.isActiveChange.emit(e))})}isLinkActive(e){const i=function v7(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>{const s=r.urlTree;return!!s&&e.isActive(s,i)}}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}static \u0275fac=function(i){return new(i||n)(F(gr),F(nt),F(gs),F(ji),F(Bl,8))};static \u0275dir=X({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,s){if(1&i&&fn(s,Bl,5),2&i){let o;gt(o=mt())&&(r.links=o)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Pn]})}return n})();class TN{}let b7=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(e,i,r,s){this.router=e,this.injector=i,this.preloadingStrategy=r,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(pn(e=>e instanceof Ss),Ml(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=vh(s.providers,e,`Route: ${s.path}`));const o=s._injector??e,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return nn(r).pipe(Rl())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):fe(null);const s=r.pipe(Sn(o=>null===o?fe(void 0):(i._loadedRoutes=o.routes,i._loadedInjector=o.injector,this.processRoutes(o.injector??e,o.routes))));return i.loadComponent&&!i._loadedComponent?nn([s,this.loader.loadComponent(i)]).pipe(Rl()):s})}static \u0275fac=function(i){return new(i||n)(ue(gr),ue(An),ue(TN),ue(mb))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Db=new G("");let SN=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(e,i,r,s,o={}){this.urlSerializer=e,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=o,o.scrollPositionRestoration||="disabled",o.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof bp?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Ss?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Ol&&e.code===Ep.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof BM&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new BM(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(i){!function aI(){throw new Error("invalid")}()};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();function Vr(n,t){return{\u0275kind:n,\u0275providers:t}}function IN(){const n=S(at);return t=>{const e=n.get(ri);if(t!==e.components[0])return;const i=n.get(gr),r=n.get(wN);1===n.get(Tb)&&i.initialNavigation(),n.get(AN,null,Oe.Optional)?.setUpPreloading(),n.get(Db,null,Oe.Optional)?.init(),i.resetRootComponentType(e.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const wN=new G("",{factory:()=>new Ke}),Tb=new G("",{providedIn:"root",factory:()=>1}),AN=new G("");function S7(n){return Vr(0,[{provide:AN,useExisting:b7},{provide:TN,useExisting:n}])}function I7(n){return ti("NgRouterViewTransitions"),Vr(9,[{provide:aN,useValue:N9},{provide:lN,useValue:{skipNextTransition:!!n?.skipInitialTransition,...n}}])}const w7=[Mu,{provide:ju,useClass:hp},gr,zu,{provide:ia,useFactory:function CN(n){return n.routerState.root},deps:[gr]},mb,[]];let A7=(()=>{class n{constructor(){}static forRoot(e,i){return{ngModule:n,providers:[w7,[],{provide:Rp,multi:!0,useValue:e},[],i?.errorHandler?{provide:cN,useValue:i.errorHandler}:[],{provide:Zu,useValue:i||{}},i?.useHash?{provide:Qo,useClass:eK}:{provide:Qo,useClass:lR},{provide:Db,useFactory:()=>{const n=S(H9),t=S(ke),e=S(Zu),i=S(_b),r=S(ju);return e.scrollOffset&&n.setOffset(e.scrollOffset),new SN(r,i,n,t,e)}},i?.preloadingStrategy?S7(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?N7(i):[],i?.bindToComponentInputs?Vr(8,[WM,{provide:Cp,useExisting:WM}]).\u0275providers:[],i?.enableViewTransitions?I7().\u0275providers:[],[{provide:xN,useFactory:IN},{provide:pu,multi:!0,useExisting:xN}]]}}static forChild(e){return{ngModule:n,providers:[{provide:Rp,multi:!0,useValue:e}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=ft({type:n});static \u0275inj=st({})}return n})();function N7(n){return["disabled"===n.initialNavigation?Vr(3,[dw(()=>{S(gr).setUpLocationChangeListener()}),{provide:Tb,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Vr(2,[{provide:Tb,useValue:0},dw(()=>{const t=S(at);return t.get(qW,Promise.resolve()).then(()=>new Promise(i=>{const r=t.get(gr),s=t.get(wN);dN(r,()=>{i(!0)}),t.get(_b).afterPreactivation=()=>(i(!0),s.closed?fe(void 0):s),r.initialNavigation()}))})]).\u0275providers:[]]}const xN=new G("");function k7(n,t){if(1&n){const e=pt();A(0,"div",17)(1,"div",18)(2,"strong",19),oe(3,"i",2),B(4),Fh(5,"titlecase"),x(),A(6,"button",20),re("click",function(){const r=Ae(e).$implicit;return xe(U().removeToast(r.id))}),x()(),A(7,"div",21),B(8),x()()}if(2&n){const e=t.$implicit;Ge("bg-success","success"===e.type)("bg-danger","error"===e.type)("bg-warning","warning"===e.type)("bg-info","info"===e.type),N(3),Ge("fa-check-circle","success"===e.type)("fa-exclamation-circle","error"===e.type)("fa-exclamation-triangle","warning"===e.type)("fa-info-circle","info"===e.type),N(),zt(" ",function ix(n,t,e){const i=n+26,r=O(),s=No(r,i);return Iu(r,i)?ZA(r,Vn(),t,s.transform,e,s):s.transform(e)}(5,18,e.type)," "),N(4),zt(" ",e.message," ")}}let L7=(()=>{class n{constructor(e){this.toastService=e,this.sidebarCollapsed=!1,this.toasts=[]}ngOnInit(){this.toastService.toasts$.subscribe(e=>{this.toasts=e}),window.innerWidth<768&&(this.sidebarCollapsed=!0)}toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed}closeSidebarOnMobile(){window.innerWidth<768&&(this.sidebarCollapsed=!0)}removeToast(e){this.toastService.remove(e)}static{this.\u0275fac=function(i){return new(i||n)(F(Lu))}}static{this.\u0275cmp=un({type:n,selectors:[["app-root"]],standalone:!1,decls:25,vars:11,consts:[[1,"app-container"],[1,"navbar-toggle",3,"click"],[1,"fas"],[1,"sidebar"],[1,"sidebar-header"],["src","/appicon/favicon-32x32.png","alt","","width","28","height","28",1,"logo","me-1"],[1,"app-name"],[1,"sidebar-menu"],["routerLink","/subscriptions","routerLinkActive","active",3,"click"],[1,"fas","fa-star"],["routerLink","/settings","routerLinkActive","active",3,"click"],[1,"fas","fa-cog"],["routerLink","/manage","routerLinkActive","active",3,"click"],[1,"fas","fa-users-cog"],[1,"main-content"],[1,"toast-container"],["class","toast show mb-2","role","alert",3,"bg-success","bg-danger","bg-warning","bg-info",4,"ngFor","ngForOf"],["role","alert",1,"toast","show","mb-2"],[1,"toast-header"],[1,"me-auto","text-white"],["type","button",1,"btn-close","btn-close-white",3,"click"],[1,"toast-body","text-white"]],template:function(i,r){1&i&&(A(0,"div",0)(1,"button",1),re("click",function(){return r.toggleSidebar()}),oe(2,"i",2),x(),A(3,"nav",3)(4,"div",4),oe(5,"img",5),A(6,"div",6),B(7,"Ekydum"),x()(),A(8,"ul",7)(9,"li")(10,"a",8),re("click",function(){return r.closeSidebarOnMobile()}),oe(11,"i",9),B(12," Subscriptions "),x()(),A(13,"li")(14,"a",10),re("click",function(){return r.closeSidebarOnMobile()}),oe(15,"i",11),B(16," Settings "),x()(),A(17,"li")(18,"a",12),re("click",function(){return r.closeSidebarOnMobile()}),oe(19,"i",13),B(20," Manage "),x()()()(),A(21,"main",14),oe(22,"router-outlet"),x(),A(23,"div",15),de(24,k7,9,20,"div",16),x()()),2&i&&(N(),Ge("sidebar-collapsed",r.sidebarCollapsed),N(),Ge("fa-bars",r.sidebarCollapsed)("fa-times",!r.sidebarCollapsed),N(),Ge("collapsed",r.sidebarCollapsed),N(18),Ge("expanded",r.sidebarCollapsed),N(3),j("ngForOf",r.toasts))},dependencies:[xl,cb,Bl,DN,AR],styles:[".toast-header[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff}.sidebar-header[_ngcontent-%COMP%]{padding:1rem;background:#000;color:#fff;font-weight:700;font-size:1.2rem;border-bottom:1px solid #343a40;display:flex;flex-direction:row;cursor:default;-webkit-user-select:none;user-select:none}.sidebar-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:28px;height:28px;object-fit:contain;vertical-align:middle;border-radius:2px}"]})}}return n})();class kp{}class Lp{}class zi{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=e.slice(i+1).trim();this.addHeaderEntry(r,s)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((e,i)=>{this.addHeaderEntry(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof zi?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new zi;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof zi?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let o=this.headers.get(e);if(!o)return;o=o.filter(a=>-1===s.indexOf(a)),0===o.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,o)}else this.headers.delete(e),this.normalizedNames.delete(e)}}addHeaderEntry(t,e){const i=t.toLowerCase();this.maybeSetNormalizedName(t,i),this.headers.has(i)?this.headers.get(i).push(e):this.headers.set(i,[e])}setHeaderEntries(t,e){const i=(Array.isArray(e)?e:[e]).map(s=>s.toString()),r=t.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class P7{encodeKey(t){return RN(t)}encodeValue(t){return RN(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const B7=/%(\d[a-f0-9])/gi,U7={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function RN(n){return encodeURIComponent(n).replace(B7,(t,e)=>U7[e]??t)}function Pp(n){return`${n}`}class mr{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new P7,t.fromString){if(t.fromObject)throw new P(2805,!1);this.map=function F7(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[o,a]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],l=e.get(o)||[];l.push(a),e.set(o,l)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(Pp):[Pp(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new mr({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Pp(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(Pp(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class $7{map=new Map;set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function MN(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function NN(n){return typeof Blob<"u"&&n instanceof Blob}function ON(n){return typeof FormData<"u"&&n instanceof FormData}const nd="Content-Type",Sb="X-Request-URL",kN="text/plain",LN="application/json",PN=`${LN}, ${kN}, */*`;class id{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(t,e,i,r){let s;if(this.url=e,this.method=t.toUpperCase(),function V7(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new zi,this.context??=new $7,this.params){const o=this.params.toString();if(0===o.length)this.urlWithParams=e;else{const a=e.indexOf("?");this.urlWithParams=e+(-1===a?"?":a<e.length-1?"&":"")+o}}else this.params=new mr,this.urlWithParams=e}serializeBody(){return null===this.body?null:"string"==typeof this.body||MN(this.body)||NN(this.body)||ON(this.body)||function j7(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)?this.body:this.body instanceof mr?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||ON(this.body)?null:NN(this.body)?this.body.type||null:MN(this.body)?null:"string"==typeof this.body?kN:this.body instanceof mr?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?LN:null}clone(t={}){const e=t.method||this.method,i=t.url||this.url,r=t.responseType||this.responseType,s=t.transferCache??this.transferCache,o=void 0!==t.body?t.body:this.body,a=t.withCredentials??this.withCredentials,l=t.reportProgress??this.reportProgress;let c=t.headers||this.headers,u=t.params||this.params;const d=t.context??this.context;return void 0!==t.setHeaders&&(c=Object.keys(t.setHeaders).reduce((f,h)=>f.set(h,t.setHeaders[h]),c)),t.setParams&&(u=Object.keys(t.setParams).reduce((f,h)=>f.set(h,t.setParams[h]),u)),new id(e,i,o,{params:u,headers:c,context:d,reportProgress:l,responseType:r,withCredentials:a,transferCache:s})}}var to=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(to||{});class Cb{headers;status;statusText;url;ok;type;constructor(t,e=200,i="OK"){this.headers=t.headers||new zi,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Bp extends Cb{constructor(t={}){super(t)}type=to.ResponseHeader;clone(t={}){return new Bp({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class rd extends Cb{body;constructor(t={}){super(t),this.body=void 0!==t.body?t.body:null}type=to.Response;clone(t={}){return new rd({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Ul extends Cb{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Ib(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}let BN=(()=>{class n{handler;constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof id)s=e;else{let l,c;l=r.headers instanceof zi?r.headers:new zi(r.headers),r.params&&(c=r.params instanceof mr?r.params:new mr({fromObject:r.params})),s=new id(e,i,void 0!==r.body?r.body:null,{headers:l,context:r.context,params:c,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}const o=fe(s).pipe(Ml(l=>this.handler.handle(l)));if(e instanceof id||"events"===r.observe)return o;const a=o.pipe(pn(l=>l instanceof rd));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(Ne(l=>{if(null!==l.body&&!(l.body instanceof ArrayBuffer))throw new P(2806,!1);return l.body}));case"blob":return a.pipe(Ne(l=>{if(null!==l.body&&!(l.body instanceof Blob))throw new P(2807,!1);return l.body}));case"text":return a.pipe(Ne(l=>{if(null!==l.body&&"string"!=typeof l.body)throw new P(2808,!1);return l.body}));default:return a.pipe(Ne(l=>l.body))}case"response":return a;default:throw new P(2809,!1)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new mr).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,Ib(r,i))}post(e,i,r={}){return this.request("POST",e,Ib(r,i))}put(e,i,r={}){return this.request("PUT",e,Ib(r,i))}static \u0275fac=function(i){return new(i||n)(ue(kp))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();const $N=new G("");function VN(n,t){return t(n)}const sd=new G(""),X7=new G(""),jN=new G("",{providedIn:"root",factory:()=>!0});let HN=(()=>{class n extends kp{backend;injector;chain=null;pendingTasks=S(Vs);contributeToStability=S(jN);constructor(e,i){super(),this.backend=e,this.injector=i}handle(e){if(null===this.chain){const i=Array.from(new Set([...this.injector.get(sd),...this.injector.get(X7,[])]));this.chain=i.reduceRight((r,s)=>function Y7(n,t,e){return(i,r)=>Li(e,()=>t(i,s=>n(s,r)))}(r,s,this.injector),VN)}if(this.contributeToStability){const i=this.pendingTasks.add();return this.chain(e,r=>this.backend.handle(r)).pipe(dp(()=>this.pendingTasks.remove(i)))}return this.chain(e,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||n)(ue(Lp),ue(An))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();const nQ=/^\)\]\}',?\n/,iQ=RegExp(`^${Sb}:`,"m");let WN=(()=>{class n{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new P(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?nn(i.\u0275loadImpl()):fe(null)).pipe(Wi(()=>new Dt(s=>{const o=i.build();if(o.open(e.method,e.urlWithParams),e.withCredentials&&(o.withCredentials=!0),e.headers.forEach((g,m)=>o.setRequestHeader(g,m.join(","))),e.headers.has("Accept")||o.setRequestHeader("Accept",PN),!e.headers.has(nd)){const g=e.detectContentTypeHeader();null!==g&&o.setRequestHeader(nd,g)}if(e.responseType){const g=e.responseType.toLowerCase();o.responseType="json"!==g?g:"text"}const a=e.serializeBody();let l=null;const c=()=>{if(null!==l)return l;const g=o.statusText||"OK",m=new zi(o.getAllResponseHeaders()),y=function rQ(n){return"responseURL"in n&&n.responseURL?n.responseURL:iQ.test(n.getAllResponseHeaders())?n.getResponseHeader(Sb):null}(o)||e.url;return l=new Bp({headers:m,status:o.status,statusText:g,url:y}),l},u=()=>{let{headers:g,status:m,statusText:y,url:v}=c(),b=null;204!==m&&(b=typeof o.response>"u"?o.responseText:o.response),0===m&&(m=b?200:0);let E=m>=200&&m<300;if("json"===e.responseType&&"string"==typeof b){const D=b;b=b.replace(nQ,"");try{b=""!==b?JSON.parse(b):null}catch(w){b=D,E&&(E=!1,b={error:w,text:b})}}E?(s.next(new rd({body:b,headers:g,status:m,statusText:y,url:v||void 0})),s.complete()):s.error(new Ul({error:b,headers:g,status:m,statusText:y,url:v||void 0}))},d=g=>{const{url:m}=c(),y=new Ul({error:g,status:o.status||0,statusText:o.statusText||"Unknown Error",url:m||void 0});s.error(y)};let f=!1;const h=g=>{f||(s.next(c()),f=!0);let m={type:to.DownloadProgress,loaded:g.loaded};g.lengthComputable&&(m.total=g.total),"text"===e.responseType&&o.responseText&&(m.partialText=o.responseText),s.next(m)},p=g=>{let m={type:to.UploadProgress,loaded:g.loaded};g.lengthComputable&&(m.total=g.total),s.next(m)};return o.addEventListener("load",u),o.addEventListener("error",d),o.addEventListener("timeout",d),o.addEventListener("abort",d),e.reportProgress&&(o.addEventListener("progress",h),null!==a&&o.upload&&o.upload.addEventListener("progress",p)),o.send(a),s.next({type:to.Sent}),()=>{o.removeEventListener("error",d),o.removeEventListener("abort",d),o.removeEventListener("load",u),o.removeEventListener("timeout",d),e.reportProgress&&(o.removeEventListener("progress",h),null!==a&&o.upload&&o.upload.removeEventListener("progress",p)),o.readyState!==o.DONE&&o.abort()}})))}static \u0275fac=function(i){return new(i||n)(ue(hR))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();const xb=new G(""),KN=new G("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),zN=new G("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class qN{}let aQ=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,i){this.doc=e,this.cookieName=i}getToken(){const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=uR(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(i){return new(i||n)(ue(Jt),ue(KN))};static \u0275prov=H({token:n,factory:n.\u0275fac})}return n})();function lQ(n,t){const e=n.url.toLowerCase();if(!S(xb)||"GET"===n.method||"HEAD"===n.method||e.startsWith("http://")||e.startsWith("https://"))return t(n);const i=S(qN).getToken(),r=S(zN);return null!=i&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),t(n)}function cQ(...n){const t=[BN,WN,HN,{provide:kp,useExisting:HN},{provide:Lp,useFactory:()=>S($N,{optional:!0})??S(WN)},{provide:sd,useValue:lQ,multi:!0},{provide:xb,useValue:!0},{provide:qN,useClass:aQ}];for(const e of n)t.push(...e.\u0275providers);return Fs(t)}let od=(()=>{class n{constructor(){this.SERVER_URL_KEY="ekydum_server_url",this.ACCOUNT_TOKEN_KEY="ekydum_account_token",this.ADMIN_TOKEN_KEY="ekydum_admin_token"}getServerUrl(){return localStorage.getItem(this.SERVER_URL_KEY)}setServerUrl(e){localStorage.setItem(this.SERVER_URL_KEY,e)}getAccountToken(){return localStorage.getItem(this.ACCOUNT_TOKEN_KEY)}setAccountToken(e){localStorage.setItem(this.ACCOUNT_TOKEN_KEY,e)}clearAccountToken(){localStorage.removeItem(this.ACCOUNT_TOKEN_KEY)}getAdminToken(){return localStorage.getItem(this.ADMIN_TOKEN_KEY)}setAdminToken(e){localStorage.setItem(this.ADMIN_TOKEN_KEY,e)}clearAdminToken(){localStorage.removeItem(this.ADMIN_TOKEN_KEY)}isAuthenticated(){return!(!this.getServerUrl()||!this.getAccountToken())}isAdmin(){return!!this.getAdminToken()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ad=(()=>{class n{constructor(e,i,r){this.http=e,this.auth=i,this.toast=r}getHeaders(e=!1){var i=new zi({"Content-Type":"application/json"});if(e){var r=this.auth.getAdminToken();r&&(i=i.set("x-admin-token",r))}else{var s=this.auth.getAccountToken();s&&(i=i.set("x-account-token",s))}return i}getUrl(e){return`${this.auth.getServerUrl()||"http://localhost:3000"}${e}`}handleError(e){return this.toast.error(e.error?.error||e.message||"An error occurred"),Bu(()=>e)}getMe(){return this.http.get(this.getUrl("/me"),{headers:this.getHeaders()}).pipe(It(e=>this.handleError(e)))}searchChannels(e){return this.http.post(this.getUrl("/channels/search"),{q:e},{headers:this.getHeaders()}).pipe(It(i=>this.handleError(i)))}getChannel(e){return this.http.get(this.getUrl(`/channels/${e}`),{headers:this.getHeaders()}).pipe(It(i=>this.handleError(i)))}getChannelVideos(e,i=1,r){var s=(new mr).set("page",i.toString());return r&&(s=s.set("page_size",r.toString())),this.http.get(this.getUrl(`/channels/${e}/videos`),{headers:this.getHeaders(),params:s}).pipe(It(o=>this.handleError(o)))}getVideo(e){return this.http.get(this.getUrl(`/videos/${e}`),{headers:this.getHeaders()}).pipe(It(i=>this.handleError(i)))}getVideoStream(e,i){var r=i?(new mr).set("quality",i):new mr;return this.http.get(this.getUrl(`/videos/${e}/stream`),{headers:this.getHeaders(),params:r}).pipe(It(s=>this.handleError(s)))}getSubscriptions(){return this.http.get(this.getUrl("/subscriptions"),{headers:this.getHeaders()}).pipe(It(e=>this.handleError(e)))}subscribe(e){return this.http.post(this.getUrl("/subscriptions"),{yt_channel_id:e},{headers:this.getHeaders()}).pipe(It(i=>this.handleError(i)))}unsubscribe(e){return this.http.delete(this.getUrl(`/subscriptions/${e}`),{headers:this.getHeaders()}).pipe(It(i=>this.handleError(i)))}getSettings(){return this.http.get(this.getUrl("/settings"),{headers:this.getHeaders()}).pipe(It(e=>this.handleError(e)))}updateSetting(e,i){return this.http.put(this.getUrl(`/settings/${e}`),{value:i},{headers:this.getHeaders()}).pipe(It(r=>this.handleError(r)))}getAccounts(){return this.http.get(this.getUrl("/admin/accounts"),{headers:this.getHeaders(!0)}).pipe(It(e=>this.handleError(e)))}getAccount(e){return this.http.get(this.getUrl(`/admin/accounts/${e}`),{headers:this.getHeaders(!0)}).pipe(It(i=>this.handleError(i)))}createAccount(e){return this.http.post(this.getUrl("/admin/accounts"),{name:e},{headers:this.getHeaders(!0)}).pipe(It(i=>this.handleError(i)))}updateAccount(e,i){return this.http.put(this.getUrl(`/admin/accounts/${e}`),{name:i},{headers:this.getHeaders(!0)}).pipe(It(r=>this.handleError(r)))}deleteAccount(e){return this.http.delete(this.getUrl(`/admin/accounts/${e}`),{headers:this.getHeaders(!0)}).pipe(It(i=>this.handleError(i)))}static{this.\u0275fac=function(i){return new(i||n)(ue(BN),ue(od),ue(Lu))}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function QN(...n){const t=lp(n),{args:e,keys:i}=cM(n),r=new Dt(s=>{const{length:o}=e;if(!o)return void s.complete();const a=new Array(o);let l=o,c=o;for(let u=0;u<o;u++){let d=!1;Tn(e[u]).subscribe(dt(s,f=>{d||(d=!0,c--),a[u]=f},()=>l--,void 0,()=>{(!l||!d)&&(c||s.next(i?uM(i,a):a),s.complete())}))}});return t?r.pipe(zv(t)):r}let XN=(()=>{class n{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,i){this._renderer=e,this._elementRef=i}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(i){return new(i||n)(F(gs),F(nt))};static \u0275dir=X({type:n})}return n})(),sa=(()=>{class n extends XN{static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275dir=X({type:n,features:[qe]})}return n})();const qi=new G(""),dQ={provide:qi,useExisting:Xe(()=>$l),multi:!0},hQ=new G("");let $l=(()=>{class n extends XN{_compositionMode;_composing=!1;constructor(e,i,r){super(e,i),this._compositionMode=r,null==this._compositionMode&&(this._compositionMode=!function fQ(){const n=Xs()?Xs().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(i){return new(i||n)(F(gs),F(nt),F(hQ,8))};static \u0275dir=X({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){1&i&&re("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},standalone:!1,features:[yt([dQ]),qe]})}return n})();function Mb(n){return null==n?null:Array.isArray(n)||"string"==typeof n?n.length:n instanceof Set?n.size:null}const Rn=new G(""),io=new G("");function Up(n){return null}function aO(n){return null!=n}function lO(n){return hu(n)?nn(n):n}function cO(n){let t={};return n.forEach(e=>{t=null!=e?{...t,...e}:t}),0===Object.keys(t).length?null:t}function uO(n,t){return t.map(e=>e(n))}function dO(n){return n.map(t=>function gQ(n){return!n.validate}(t)?t:e=>t.validate(e))}function Nb(n){return null!=n?function fO(n){if(!n)return null;const t=n.filter(aO);return 0==t.length?null:function(e){return cO(uO(e,t))}}(dO(n)):null}function Ob(n){return null!=n?function hO(n){if(!n)return null;const t=n.filter(aO);return 0==t.length?null:function(e){return QN(uO(e,t).map(lO)).pipe(Ne(cO))}}(dO(n)):null}function pO(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function kb(n){return n?Array.isArray(n)?n:[n]:[]}function $p(n,t){return Array.isArray(n)?n.includes(t):n===t}function yO(n,t){const e=kb(t);return kb(n).forEach(r=>{$p(e,r)||e.push(r)}),e}function _O(n,t){return kb(t).filter(e=>!$p(n,e))}class vO{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Nb(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=Ob(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class zn extends vO{name;get formDirective(){return null}get path(){return null}}class ro extends vO{_parent=null;name=null;valueAccessor=null}class bO{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let Vp=(()=>{class n extends bO{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(F(ro,2))};static \u0275dir=X({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){2&i&&Ge("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[qe]})}return n})();const ld="VALID",Hp="INVALID",Vl="PENDING",cd="DISABLED";class jl{}class DO extends jl{value;source;constructor(t,e){super(),this.value=t,this.source=e}}class Fb extends jl{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}}class Bb extends jl{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}}class Gp extends jl{status;source;constructor(t,e){super(),this.status=t,this.source=e}}function Wp(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class Vb{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Zt(this.statusReactive)}set status(t){Zt(()=>this.statusReactive.set(t))}_status=bs(()=>this.statusReactive());statusReactive=xr(void 0);get valid(){return this.status===ld}get invalid(){return this.status===Hp}get pending(){return this.status==Vl}get disabled(){return this.status===cd}get enabled(){return this.status!==cd}errors;get pristine(){return Zt(this.pristineReactive)}set pristine(t){Zt(()=>this.pristineReactive.set(t))}_pristine=bs(()=>this.pristineReactive());pristineReactive=xr(!0);get dirty(){return!this.pristine}get touched(){return Zt(this.touchedReactive)}set touched(t){Zt(()=>this.touchedReactive.set(t))}_touched=bs(()=>this.touchedReactive());touchedReactive=xr(!1);get untouched(){return!this.touched}_events=new Ke;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(yO(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(yO(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(_O(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(_O(t,this._rawAsyncValidators))}hasValidator(t){return $p(this._rawValidators,t)}hasAsyncValidator(t){return $p(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){const e=!1===this.touched;this.touched=!0;const i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched({...t,sourceControl:i}),e&&!1!==t.emitEvent&&this._events.next(new Bb(!0,i))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){const e=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const i=t.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:i})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i),e&&!1!==t.emitEvent&&this._events.next(new Bb(!1,i))}markAsDirty(t={}){const e=!0===this.pristine;this.pristine=!1;const i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty({...t,sourceControl:i}),e&&!1!==t.emitEvent&&this._events.next(new Fb(!1,i))}markAsPristine(t={}){const e=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const i=t.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),e&&!1!==t.emitEvent&&this._events.next(new Fb(!0,i))}markAsPending(t={}){this.status=Vl;const e=t.sourceControl??this;!1!==t.emitEvent&&(this._events.next(new Gp(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending({...t,sourceControl:e})}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=cd,this.errors=null,this._forEachChild(r=>{r.disable({...t,onlySelf:!0})}),this._updateValue();const i=t.sourceControl??this;!1!==t.emitEvent&&(this._events.next(new DO(this.value,i)),this._events.next(new Gp(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:e},this),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=ld,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:e},this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ld||this.status===Vl)&&this._runAsyncValidator(i,t.emitEvent)}const e=t.sourceControl??this;!1!==t.emitEvent&&(this._events.next(new DO(this.value,e)),this._events.next(new Gp(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity({...t,sourceControl:e})}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?cd:ld}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=Vl,this._hasOwnPendingAsyncValidator={emitEvent:!1!==e};const i=lO(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent,this,e.shouldHaveEmitted)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,i){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||i)&&this._events.next(new Gp(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,i)}_initObservables(){this.valueChanges=new _e,this.statusChanges=new _e}_calculateStatus(){return this._allControlsDisabled()?cd:this.errors?Hp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Vl)?Vl:this._anyControlsHaveStatus(Hp)?Hp:ld}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){const i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),r&&this._events.next(new Fb(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new Bb(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Wp(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function TQ(n){return Array.isArray(n)?Nb(n):n||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function SQ(n){return Array.isArray(n)?Ob(n):n||null}(this._rawAsyncValidators)}}const Hl=new G("",{providedIn:"root",factory:()=>Kp}),Kp="always";function ud(n,t,e=Kp){(function Hb(n,t){const e=function gO(n){return n._rawValidators}(n);null!==t.validator?n.setValidators(pO(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=function mO(n){return n._rawAsyncValidators}(n);null!==t.asyncValidator?n.setAsyncValidators(pO(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();Yp(t._rawValidators,r),Yp(t._rawAsyncValidators,r)})(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||"always"===e)&&t.valueAccessor.setDisabledState?.(n.disabled),function wQ(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&wO(n,t)})}(n,t),function xQ(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function AQ(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&wO(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function IQ(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function Yp(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function wO(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function RO(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function MO(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}Promise.resolve();const NO=class extends Vb{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,i){super(function Ub(n){return(Wp(n)?n.validators:n)||null}(e),function $b(n,t){return(Wp(t)?t.asyncValidators:n)||null}(i,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Wp(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=MO(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){RO(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){RO(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){MO(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},UQ={provide:ro,useExisting:Xe(()=>fd)},OO=Promise.resolve();let fd=(()=>{class n extends ro{_changeDetectorRef;callSetDisabledState;control=new NO;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new _e;constructor(e,i,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=function Kb(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===$l?e=s:function NQ(n){return Object.getPrototypeOf(n.constructor)===sa}(s)?i=s:r=s}),r||i||e||null}(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),function Wb(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){ud(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){OO.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&wl(i);OO.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?function zp(n,t){return[...t.path,n]}(e,this._parent):[e]}static \u0275fac=function(i){return new(i||n)(F(zn,9),F(Rn,10),F(io,10),F(qi,10),F(ji,8),F(Hl,8))};static \u0275dir=X({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[yt([UQ]),qe,Pn]})}return n})();const QQ={provide:qi,useExisting:Xe(()=>ng),multi:!0};function VO(n,t){return null==n?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let ng=(()=>{class n extends sa{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;const r=VO(this._getOptionId(e),e);this.setProperty("value",r)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){const i=function XQ(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275dir=X({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,r){1&i&&re("change",function(o){return r.onChange(o.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[yt([QQ]),qe]})}return n})(),jO=(()=>{class n{_element;_renderer;_select;id;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(VO(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(i){return new(i||n)(F(nt),F(gs),F(ng,9))};static \u0275dir=X({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();const ZQ={provide:qi,useExisting:Xe(()=>zb),multi:!0};function HO(n,t){return null==n?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let zb=(()=>{class n extends sa{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){let i;if(this.value=e,Array.isArray(e)){const r=e.map(s=>this._getOptionId(s));i=(s,o)=>{s._setSelected(r.indexOf(o.toString())>-1)}}else i=(r,s)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{const r=[],s=i.selectedOptions;if(void 0!==s){const o=s;for(let a=0;a<o.length;a++){const c=this._getOptionValue(o[a].value);r.push(c)}}else{const o=i.options;for(let a=0;a<o.length;a++){const l=o[a];if(l.selected){const c=this._getOptionValue(l.value);r.push(c)}}}this.value=r,e(r)}}_registerOption(e){const i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){const i=function JQ(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275dir=X({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,r){1&i&&re("change",function(o){return r.onChange(o.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[yt([ZQ]),qe]})}return n})(),GO=(()=>{class n{_element;_renderer;_select;id;_value;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(HO(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(HO(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(i){return new(i||n)(F(nt),F(gs),F(zb,9))};static \u0275dir=X({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function WO(n){return"number"==typeof n?n:parseInt(n,10)}let oa=(()=>{class n{_validator=Up;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Up,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}static \u0275fac=function(i){return new(i||n)};static \u0275dir=X({type:n,features:[Pn]})}return n})();const sX={provide:Rn,useExisting:Xe(()=>Yb),multi:!0};let Yb=(()=>{class n extends oa{minlength;inputName="minlength";normalizeInput=e=>WO(e);createValidator=e=>function rO(n){return t=>{const e=t.value?.length??Mb(t.value);return null===e||0===e?null:e<n?{minlength:{requiredLength:n,actualLength:e}}:null}}(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275dir=X({type:n,selectors:[["","minlength","","formControlName",""],["","minlength","","formControl",""],["","minlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){2&i&&ht("minlength",r._enabled?r.minlength:null)},inputs:{minlength:"minlength"},standalone:!1,features:[yt([sX]),qe]})}return n})();const oX={provide:Rn,useExisting:Xe(()=>Qb),multi:!0};let Qb=(()=>{class n extends oa{maxlength;inputName="maxlength";normalizeInput=e=>WO(e);createValidator=e=>function sO(n){return t=>{const e=t.value?.length??Mb(t.value);return null!==e&&e>n?{maxlength:{requiredLength:n,actualLength:e}}:null}}(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})();static \u0275dir=X({type:n,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){2&i&&ht("maxlength",r._enabled?r.maxlength:null)},inputs:{maxlength:"maxlength"},standalone:!1,features:[yt([oX]),qe]})}return n})(),lX=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ft({type:n});static \u0275inj=st({})}return n})(),uX=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:Hl,useValue:e.callSetDisabledState??Kp}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=ft({type:n});static \u0275inj=st({imports:[lX]})}return n})();function dX(n,t){1&n&&(A(0,"div",13),oe(1,"i",14),B(2," Please configure your server settings first. Go to "),A(3,"a",15),B(4,"Settings"),x(),B(5,". "),x())}function fX(n,t){1&n&&(A(0,"div",16)(1,"div",17)(2,"span",18),B(3,"Loading..."),x()()())}function hX(n,t){1&n&&(A(0,"div",19),oe(1,"i",20),B(2," No subscriptions yet. Search for channels to subscribe! "),x())}function pX(n,t){if(1&n){const e=pt();A(0,"div",23)(1,"div",24),re("click",function(){const r=Ae(e).$implicit;return xe(U(2).openChannel(r.yt_channel_id))}),A(2,"div",25)(3,"h5",26),oe(4,"i",27),B(5),x(),A(6,"p",28),oe(7,"i",29),B(8),Fh(9,"date"),x(),A(10,"button",30),re("click",function(r){const s=Ae(e).$implicit;return xe(U(2).unsubscribe(s.id,r))}),oe(11,"i",31),B(12," Unsubscribe "),x()()()()}if(2&n){const e=t.$implicit;N(5),zt(" ",e.yt_channel_name||"Channel"," "),N(3),zt(" Subscribed: ",ev(9,2,e.created_at,"short")," ")}}function gX(n,t){if(1&n&&(A(0,"div",21),de(1,pX,13,5,"div",22),x()),2&n){const e=U();N(),j("ngForOf",e.subscriptions)}}function mX(n,t){1&n&&(A(0,"div",40),oe(1,"div",17),x())}function yX(n,t){if(1&n&&(A(0,"div",19),B(1),x()),2&n){const e=U(2);N(),zt(' No channels found for "',e.searchQuery,'" ')}}function _X(n,t){if(1&n){const e=pt();A(0,"div",43)(1,"div",44)(2,"div")(3,"h6",45),B(4),x(),A(5,"small",46),B(6),x()(),A(7,"button",47),re("click",function(){const r=Ae(e).$implicit;return xe(U(3).subscribeToChannel(r.yt_id))}),oe(8,"i",48),B(9),x()()()}if(2&n){const e=t.$implicit,i=U(3);N(4),hn(e.name),N(2),hn(e.yt_id),N(),j("disabled",i.isSubscribed(e.yt_id)),N(),Ge("fa-check",i.isSubscribed(e.yt_id))("fa-plus",!i.isSubscribed(e.yt_id)),N(),zt(" ",i.isSubscribed(e.yt_id)?"Subscribed":"Subscribe"," ")}}function vX(n,t){if(1&n&&(A(0,"div",41),de(1,_X,10,8,"div",42),x()),2&n){const e=U(2);N(),j("ngForOf",e.searchResults)}}function bX(n,t){if(1&n){const e=pt();A(0,"div",32),re("click",function(){return Ae(e),xe(U().closeSearch())}),A(1,"div",33),re("click",function(r){return Ae(e),xe(r.stopPropagation())}),A(2,"div",34)(3,"h4"),oe(4,"i",35),B(5," Search Results "),x(),A(6,"button",36),re("click",function(){return Ae(e),xe(U().closeSearch())}),oe(7,"i",37),x()(),de(8,mX,2,0,"div",38)(9,yX,2,1,"div",10)(10,vX,2,1,"div",39),x()()}if(2&n){const e=U();N(8),j("ngIf",e.searching),N(),j("ngIf",!e.searching&&0===e.searchResults.length),N(),j("ngIf",!e.searching)}}let EX=(()=>{class n{constructor(e,i,r,s){this.api=e,this.auth=i,this.toast=r,this.router=s,this.subscriptions=[],this.searchResults=[],this.searchQuery="",this.loading=!1,this.searching=!1,this.showSearchResults=!1,this.isAuthenticated=!1}ngOnInit(){this.isAuthenticated=this.auth.isAuthenticated(),this.isAuthenticated&&this.loadSubscriptions()}loadSubscriptions(){this.loading=!0,this.api.getSubscriptions().subscribe({next:e=>{this.subscriptions=e?.subscriptions||[],this.loading=!1},error:()=>{this.loading=!1}})}searchChannels(){this.searchQuery.trim()&&(this.searching=!0,this.showSearchResults=!0,this.searchResults=[],this.api.searchChannels(this.searchQuery).subscribe({next:e=>{this.searchResults=e?.channels||[],this.searching=!1},error:()=>{this.searching=!1}}))}subscribeToChannel(e){this.api.subscribe(e).subscribe({next:()=>{this.toast.success("Subscribed successfully"),this.loadSubscriptions()}})}unsubscribe(e,i){i.stopPropagation(),this.api.unsubscribe(e).subscribe({next:()=>{this.toast.success("Unsubscribed successfully"),this.loadSubscriptions()}})}isSubscribed(e){return this.subscriptions.some(i=>i.yt_channel_id===e)}openChannel(e){this.router.navigate(["/channel",e])}closeSearch(){this.showSearchResults=!1,this.searchResults=[],this.searchQuery=""}static{this.\u0275fac=function(i){return new(i||n)(F(ad),F(od),F(Lu),F(gr))}}static{this.\u0275cmp=un({type:n,selectors:[["app-subscriptions"]],standalone:!1,decls:15,vars:7,consts:[[1,"container-fluid"],[1,"mb-4",2,"margin-left","48px"],[1,"fas","fa-star","me-2"],[1,"mb-4"],[1,"input-group"],["type","text","placeholder","Search channels...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-search","me-1"],["class","alert alert-warning",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","row",4,"ngIf"],["class","search-overlay",3,"click",4,"ngIf"],[1,"alert","alert-warning"],[1,"fas","fa-exclamation-triangle","me-2"],["routerLink","/settings"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"alert","alert-info"],[1,"fas","fa-info-circle","me-2"],[1,"row"],["class","col-md-6 col-lg-4 col-xl-3 mb-4",4,"ngFor","ngForOf"],[1,"col-md-6","col-lg-4","col-xl-3","mb-4"],[1,"card","channel-card","h-100",3,"click"],[1,"card-body"],[1,"card-title"],[1,"fas","fa-tv","me-2"],[1,"card-text","text-muted","small"],[1,"fas","fa-calendar","me-1"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-times","me-1"],[1,"search-overlay",3,"click"],[1,"search-results",3,"click"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"fas","fa-search","me-2"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-times"],["class","text-center py-3",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"text-center","py-3"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"fas"]],template:function(i,r){1&i&&(A(0,"div",0)(1,"h2",1),oe(2,"i",2),B(3," Subscriptions "),x(),A(4,"div",3)(5,"div",4)(6,"input",5),Ei("ngModelChange",function(o){return Vi(r.searchQuery,o)||(r.searchQuery=o),o}),re("keyup.enter",function(){return r.searchChannels()}),x(),A(7,"button",6),re("click",function(){return r.searchChannels()}),oe(8,"i",7),B(9," Search "),x()()(),de(10,dX,6,0,"div",8)(11,fX,4,0,"div",9)(12,hX,3,0,"div",10)(13,gX,2,1,"div",11)(14,bX,11,3,"div",12),x()),2&i&&(N(6),bi("ngModel",r.searchQuery),N(),j("disabled",!r.searchQuery||r.searching),N(3),j("ngIf",!r.isAuthenticated),N(),j("ngIf",r.loading),N(),j("ngIf",!r.loading&&0===r.subscriptions.length),N(),j("ngIf",!r.loading&&r.subscriptions.length>0),N(),j("ngIf",r.showSearchResults))},dependencies:[xl,Xo,Bl,$l,Vp,fd,Rv],encapsulation:2})}}return n})();function DX(n,t){1&n&&(A(0,"div",3),oe(1,"div",4),x())}function TX(n,t){1&n&&(A(0,"div",15),oe(1,"div",4),x())}function SX(n,t){1&n&&(A(0,"div",16),B(1," No videos found for this channel. "),x())}function CX(n,t){if(1&n&&oe(0,"img",26),2&n){const e=U().$implicit;j("src",e.thumbnail,Jf)("alt",e.title)}}function IX(n,t){if(1&n&&(A(0,"p",27),oe(1,"i",28),B(2),oe(3,"i",29),B(4),x()),2&n){const e=U().$implicit,i=U(3);N(2),zt(" ",i.formatDuration(e.duration)," "),N(2),zt(" ",e.view_count," ")}}function wX(n,t){if(1&n){const e=pt();A(0,"div",19)(1,"div",20),re("click",function(){const r=Ae(e).$implicit;return xe(U(3).watchVideo(r.yt_id))}),A(2,"div",21),de(3,CX,1,2,"img",22),x(),A(4,"div",23)(5,"h6",24),B(6),x(),de(7,IX,5,2,"p",25),x()()()}if(2&n){const e=t.$implicit;N(3),j("ngIf",e.thumbnail),N(3),hn(e.title),N(),j("ngIf",e.duration)}}function AX(n,t){if(1&n&&(A(0,"div",17),de(1,wX,8,3,"div",18),x()),2&n){const e=U(2);N(),j("ngForOf",e.videos)}}function xX(n,t){1&n&&(A(0,"span"),oe(1,"i",32),B(2," Load More "),x())}function RX(n,t){1&n&&(A(0,"span"),oe(1,"span",33),B(2," Loading... "),x())}function MX(n,t){if(1&n){const e=pt();A(0,"div",30)(1,"button",31),re("click",function(){return Ae(e),xe(U(2).loadMore())}),de(2,xX,3,0,"span",2)(3,RX,3,0,"span",2),x()()}if(2&n){const e=U(2);N(),j("disabled",e.loadingMore),N(),j("ngIf",!e.loadingMore),N(),j("ngIf",e.loadingMore)}}function NX(n,t){if(1&n){const e=pt();A(0,"div")(1,"div",5)(2,"div")(3,"h2",6),oe(4,"i",7),B(5),x()(),oe(6,"div",8),A(7,"button",9),re("click",function(){return Ae(e),xe(U().goBack())}),oe(8,"i",10),x()(),de(9,TX,2,0,"div",11)(10,SX,2,0,"div",12)(11,AX,2,1,"div",13)(12,MX,4,3,"div",14),x()}if(2&n){const e=U();N(5),zt(" ",e.channel.name," "),N(4),j("ngIf",e.loadingVideos),N(),j("ngIf",!e.loadingVideos&&0===e.videos.length),N(),j("ngIf",!e.loadingVideos&&e.videos.length>0),N(),j("ngIf",e.videos.length>0&&!e.loadingVideos)}}let OX=(()=>{class n{constructor(e,i,r){this.route=e,this.router=i,this.api=r,this.channelId="",this.channel=null,this.videos=[],this.loading=!1,this.loadingVideos=!1,this.loadingMore=!1,this.currentPage=1}ngOnInit(){this.channelId=this.route.snapshot.paramMap.get("id")||"",this.channelId&&(this.loadChannel(),this.loadVideos())}loadChannel(){this.loading=!0,this.api.getChannel(this.channelId).subscribe({next:e=>{this.channel=e,this.loading=!1},error:()=>{this.loading=!1}})}loadVideos(){this.loadingVideos=!0,this.api.getChannelVideos(this.channelId,this.currentPage).subscribe({next:e=>{this.videos=e?.items||[],this.loadingVideos=!1},error:()=>{this.loadingVideos=!1}})}loadMore(){this.loadingMore=!0,this.currentPage++,this.api.getChannelVideos(this.channelId,this.currentPage).subscribe({next:e=>{this.videos=[...this.videos,...e.items],this.loadingMore=!1},error:()=>{this.loadingMore=!1,this.currentPage--}})}watchVideo(e){this.router.navigate(["/watch",e])}goBack(){this.router.navigate(["/subscriptions"])}formatDuration(e){var i=Math.floor(e/3600),r=Math.floor(e%3600/60),s=e%60;return i>0?`${i}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`}static{this.\u0275fac=function(i){return new(i||n)(F(ia),F(gr),F(ad))}}static{this.\u0275cmp=un({type:n,selectors:[["app-channel"]],standalone:!1,decls:3,vars:2,consts:[[1,"container-fluid"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"d-flex","align-items-center","mb-4"],[1,"mb-0",2,"margin-left","48px"],[1,"fas","fa-tv","me-2"],[1,"d-flex","flex-row","flex-grow-1"],[1,"btn","btn-outline-secondary","me-3",3,"click"],[1,"fas","fa-arrow-left"],["class","text-center py-3",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","row",4,"ngIf"],["class","text-center mt-4",4,"ngIf"],[1,"text-center","py-3"],[1,"alert","alert-info"],[1,"row"],["class","col-md-6 col-lg-4 col-xl-3 mb-4",4,"ngFor","ngForOf"],[1,"col-md-6","col-lg-4","col-xl-3","mb-4"],[1,"card","video-card","h-100",3,"click"],[1,"video-thumbnail"],[3,"src","alt",4,"ngIf"],[1,"card-body"],[1,"card-title"],["class","card-text text-muted small",4,"ngIf"],[3,"src","alt"],[1,"card-text","text-muted","small"],[1,"fas","fa-clock","me-1"],[1,"fas","fa-eye","me-1"],[1,"text-center","mt-4"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-chevron-down","me-2"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,r){1&i&&(A(0,"div",0),de(1,DX,2,0,"div",1)(2,NX,13,5,"div",2),x()),2&i&&(N(),j("ngIf",r.loading),N(),j("ngIf",!r.loading&&r.channel))},dependencies:[xl,Xo],encapsulation:2})}}return n})();const J=Number.isFinite||function(n){return"number"==typeof n&&isFinite(n)},kX=Number.isSafeInteger||function(n){return"number"==typeof n&&Math.abs(n)<=LX},LX=Number.MAX_SAFE_INTEGER||9007199254740991;let le=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),M=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),_=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var se_MAIN="main";class Gl{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class PX{constructor(t,e,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Gl(t),this.fast_=new Gl(e),this.defaultTTFB_=r,this.ttfb_=new Gl(t)}update(t,e){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==t&&(this.slow_=new Gl(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.fast_=new Gl(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.ttfb_=new Gl(t,s.getEstimate(),s.getTotalWeight()))}sample(t,e){const r=(t=Math.max(t,this.minDelayMs_))/1e3,s=8*e/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function FX(n,t,e){return(t=function UX(n){var t=function BX(n,t){if("object"!=typeof n||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var i=e.call(n,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(n)}(n,"string");return"symbol"==typeof t?t:t+""}(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function ut(){return ut=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)({}).hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ut.apply(null,arguments)}function ZO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),e.push.apply(e,i)}return e}function it(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?ZO(Object(e),!0).forEach(function(i){FX(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ZO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Yi{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${t}]:`;this.trace=so,this.debug=e.debug.bind(null,i),this.log=e.log.bind(null,i),this.warn=e.warn.bind(null,i),this.info=e.info.bind(null,i),this.error=e.error.bind(null,i)}}const so=function(){},$X={trace:so,debug:so,log:so,warn:so,info:so,error:so};function Xb(){return ut({},$X)}function JO(n,t,e){return t[n]?t[n].bind(t):function VX(n,t){const e=self.console[n];return e?e.bind(self.console,`${t?"["+t+"] ":""}[${n}] >`):so}(n,e)}const Zb=Xb(),rt=Zb;function oo(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ek(n,t){const e=Object.keys(n),i=Object.keys(t),r=e.length,s=i.length;return!r||!s||r===s&&!e.some(o=>-1===i.indexOf(o))}function Si(n,t=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(n);if(t){const u=c.indexOf("\0");return-1!==u?c.substring(0,u):c}return c.replace(/\0/g,"")}const e=n.length;let i,r,s,o="",a=0;for(;a<e;){if(i=n[a++],0===i&&t)return o;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:r=n[a++],o+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=n[a++],s=n[a++],o+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&s)}}return o}function qn(n){let t="";for(let e=0;e<n.length;e++){let i=n[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}function tk(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function GX(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nk,Jb={exports:{}},eE=function WX(){return nk||(nk=1,i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Jb.exports=a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),!(c=c.trim())){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var p=r.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var g={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var m=h.path,y=m.substring(0,m.lastIndexOf("/")+1)+f.path;g.path=a.normalizePath(y)}else g.path=h.path,f.params||(g.params=h.params,f.query||(g.query=h.query));return null===g.path&&(g.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(g)},parseURL:function(l){var c=i.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}}),Jb.exports;var i,r,s,o,a}();class tE{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var bt_AUDIO="audio",bt_VIDEO="video",bt_AUDIOVIDEO="audiovideo";class ik{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof t&&(t={url:t}),this.base=t,function zX(n,t){const e=rk(n,t);e&&(e.enumerable=!0,Object.defineProperty(n,t,e))}(this,"stats")}setByteRange(t,e){const i=t.split("@",2);let r;r=1===i.length?e?.byteRangeEndOffset||0:parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[bt_AUDIO]:null,[bt_VIDEO]:null,[bt_AUDIOVIDEO]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new tE),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=eE.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t.audio=null,t.video=null,t.audiovideo=null}}function rn(n){return"initSegment"!==n.sn}class nE extends ik{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange.length){const t=this.byteRange[0],e=this.byteRange[1];if(J(t)&&J(e))return e-t}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){var t;const{levelkeys:e}=this;if(!e||e.NONE)return null;if(e.identity)this._decryptdata||(this._decryptdata=e.identity.getDecryptData(this.sn));else if(null==(t=this._decryptdata)||!t.keyId){const i=Object.keys(e);if(1===i.length){const r=this._decryptdata=e[i[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,e))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const t=J(this.duration)?this.duration:0;return this.programDateTime+1e3*t}get encrypted(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){var e;const i=Object.keys(this.levelkeys),r=i.length;if(r>1||1===r&&null!=(e=this.levelkeys[i[0]])&&e.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){this._programDateTime=J(t)?t:this.rawProgramDateTime=null}get ref(){return rn(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){const e=this.levelkeys;if(e){var i;const r=e[t];r&&(null==(i=this._decryptdata)||!i.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,e))}}abortRequests(){var t,e;null==(t=this.loader)||t.abort(),null==(e=this.keyLoader)||e.abort()}setElementaryStreamInfo(t,e,i,r,s,o=!1){const{elementaryStreams:a}=this,l=a[t];l?(l.startPTS=Math.min(l.startPTS,e),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)):a[t]={startPTS:e,endPTS:i,startDTS:r,endDTS:s,partial:o}}}class KX extends ik{constructor(t,e,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=r;const o=t.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function rk(n,t){const e=Object.getPrototypeOf(n);if(e)return Object.getOwnPropertyDescriptor(e,t)||rk(e,t)}const sk=Math.pow(2,32)-1,qX=[].push,ok={video:1,audio:2,id3:3,text:4};function mn(n){return String.fromCharCode.apply(null,n)}function ak(n,t){const e=n[t]<<8|n[t+1];return e<0?65536+e:e}function De(n,t){const e=ck(n,t);return e<0?4294967296+e:e}function lk(n,t){let e=De(n,t);return e*=Math.pow(2,32),e+=De(n,t+4),e}function ck(n,t){return n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]}function Fe(n,t){const e=[];if(!t.length)return e;const i=n.byteLength;for(let r=0;r<i;){const s=De(n,r),a=s>1?r+s:i;if(mn(n.subarray(r+4,r+8))===t[0])if(1===t.length)e.push(n.subarray(r+8,a));else{const l=Fe(n.subarray(r+8,a),t.slice(1));l.length&&qX.apply(e,l)}r=a}return e}function QX(n){const t=[],e=n[0];let i=8;const r=De(n,i);i+=4;let s=0,o=0;0===e?(s=De(n,i),o=De(n,i+4),i+=8):(s=lk(n,i),o=lk(n,i+8),i+=16),i+=2;let a=n.length+o;const l=ak(n,i);i+=2;for(let c=0;c<l;c++){let u=i;const d=De(n,u);u+=4;const f=2147483647&d;if((2147483648&d)>>>31==1)return rt.warn("SIDX has hierarchical references (not supported)"),null;const p=De(n,u);u+=4,t.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/r,start:a,end:a+f-1}}),a+=f,u+=4,i=u}return{earliestPresentationTime:s,timescale:r,version:e,referencesCount:l,references:t}}function uk(n){const t=[],e=Fe(n,["moov","trak"]);for(let r=0;r<e.length;r++){const s=e[r],o=Fe(s,["tkhd"])[0];if(o){let a=o[0];const l=De(o,0===a?12:20),c=Fe(s,["mdia","mdhd"])[0];if(c){a=c[0];const u=De(c,0===a?12:20),d=Fe(s,["mdia","hdlr"])[0];if(d){const f=mn(d.subarray(8,12)),h={soun:"audio",vide:"video"}[f],g=XX(Fe(s,["mdia","minf","stbl","stsd"])[0]);h?(t[l]={timescale:u,type:h,stsd:g},t[h]=it({timescale:u,id:l},g)):t[l]={timescale:u,type:f,stsd:g}}}}}return Fe(n,["moov","mvex","trex"]).forEach(r=>{const s=De(r,4),o=t[s];o&&(o.default={duration:De(r,12),flags:De(r,20)})}),t}function XX(n){const t=n.subarray(8),e=t.subarray(86),i=mn(t.subarray(4,8));let s,r=i;const o="enca"===i||"encv"===i;if(o){const c=Fe(t,[i])[0].subarray("enca"===i?28:78);Fe(c,["sinf"]).forEach(d=>{const f=Fe(d,["schm"])[0];if(f){const h=mn(f.subarray(4,8));if("cbcs"===h||"cenc"===h){const p=Fe(d,["frma"])[0];p&&(r=mn(p))}}})}const a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Fe(e,["avcC"])[0];l&&l.length>3&&(r+="."+rg(l[1])+rg(l[2])+rg(l[3]),s=ig("avc1"===a?"dva1":"dvav",e));break}case"mp4a":{const l=Fe(t,[i])[0],c=Fe(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(3!==c[u++])break;u=iE(c,u),u+=2;const d=c[u++];if(128&d&&(u+=2),64&d&&(u+=c[u++]),4!==c[u++])break;u=iE(c,u);const f=c[u++];if(64!==f)break;if(r+="."+rg(f),u+=12,5!==c[u++])break;u=iE(c,u);const h=c[u++];let p=(248&h)>>3;31===p&&(p+=1+((7&h)<<3)+((224&c[u])>>5)),r+="."+p}break}case"hvc1":case"hev1":{const l=Fe(e,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=31&c,f=De(l,2),h=(32&c)>>5?"H":"L",p=l[12],g=l.subarray(6,12);r+="."+u+d,r+="."+function ZX(n){let t=0;for(let e=0;e<32;e++)t|=(n>>e&1)<<31-e;return t>>>0}(f).toString(16).toUpperCase(),r+="."+h+p;let m="";for(let y=g.length;y--;){const v=g[y];(v||m)&&(m="."+v.toString(16).toUpperCase()+m)}r+=m}s=ig("hev1"==a?"dvhe":"dvh1",e);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":r=ig(r,e)||r;break;case"vp09":{const l=Fe(e,["vpcC"])[0];if(l&&l.length>6){const u=l[5],d=l[6]>>4&15;r+="."+jr(l[4])+"."+jr(u)+"."+jr(d)}break}case"av01":{const l=Fe(e,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,d=l[2]>>>7?"H":"M",f=(64&l[2])>>6,p=2===c&&f?(32&l[2])>>5?12:10:f?10:8,g=(16&l[2])>>4,m=(8&l[2])>>3,y=(4&l[2])>>2,v=3&l[2];r+="."+c+"."+jr(31&l[1])+d+"."+jr(p)+"."+g+"."+m+y+v+"."+jr(1)+"."+jr(1)+"."+jr(1)+".0",s=ig("dav1",e)}break}}return{codec:r,encrypted:o,supplemental:s}}function ig(n,t){const e=Fe(t,["dvvC"]),i=e.length?e[0]:Fe(t,["dvcC"])[0];if(i){const s=i[2]<<5&32|i[3]>>3&31;return n+"."+jr(i[2]>>1&127)+"."+jr(s)}}function iE(n,t){const e=t+5;for(;128&n[t++]&&t<e;);return t}function rg(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function jr(n){return(n<10?"0":"")+n}function dk(n,t){Fe(n,["moov","trak"]).forEach(i=>{const r=Fe(i,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let o=Fe(s,["enca"]);const a=o.length>0;a||(o=Fe(s,["encv"])),o.forEach(l=>{Fe(l.subarray(a?28:78),["sinf"]).forEach(d=>{const f=fk(d);f&&t(f,a)})})})}function fk(n){const t=Fe(n,["schm"])[0];if(t){const e=mn(t.subarray(4,8));if("cbcs"===e||"cenc"===e){const i=Fe(n,["schi","tenc"])[0];if(i)return i}}}function Qi(n,t){const e=new Uint8Array(n.length+t.length);return e.set(n),e.set(t,n.length),e}function hk(n,t){const e=[],i=t.samples,r=t.timescale,s=t.id;let o=!1;return Fe(i,["moof"]).map(l=>{const c=l.byteOffset-8;Fe(l,["traf"]).map(d=>{const f=Fe(d,["tfdt"]).map(h=>{const p=h[0];let g=De(h,4);return 1===p&&(g*=Math.pow(2,32),g+=De(h,8)),g/r})[0];return void 0!==f&&(n=f),Fe(d,["tfhd"]).map(h=>{const p=De(h,4),g=16777215&De(h,0);let b=0;const E=!!(16&g);let D=0;const w=!!(32&g);let T=8;p===s&&(!!(1&g)&&(T+=8),!!(2&g)&&(T+=4),!!(8&g)&&(b=De(h,T),T+=4),E&&(D=De(h,T),T+=4),w&&(T+=4),"video"===t.type&&(o=sg(t.codec)),Fe(d,["trun"]).map(I=>{const R=I[0],C=16777215&De(I,0),k=!!(1&C);let W=0;const Y=!!(4&C),te=!!(256&C);let ee=0;const V=!!(512&C);let Z=0;const Q=!!(1024&C),ne=!!(2048&C);let he=0;const q=De(I,4);let K=8;k&&(W=De(I,K),K+=4),Y&&(K+=4);let we=W+c;for(let $e=0;$e<q;$e++){if(te?(ee=De(I,K),K+=4):ee=b,V?(Z=De(I,K),K+=4):Z=D,Q&&(K+=4),ne&&(he=0===R?De(I,K):ck(I,K),K+=4),"video"===t.type){let ve=0;for(;ve<Z;){const Me=De(i,we);we+=4,iZ(o,i[we])&&rE(i.subarray(we,we+Me),o?2:1,n+he/r,e),we+=Me,ve+=Me+4}}n+=ee/r}}))})})}),e}function sg(n){if(!n)return!1;const t=n.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function iZ(n,t){if(n){const e=t>>1&63;return 39===e||40===e}return 6==(31&t)}function rE(n,t,e,i){const r=pk(n);let s=0;s+=t;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(255===l);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(255===l);const c=r.length-s;let u=s;if(a<c)s+=a;else if(a>c){rt.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(4===o){if(181===r[u++]){const f=ak(r,u);if(u+=2,49===f){const h=De(r,u);if(u+=4,1195456820===h){const p=r[u++];if(3===p){const g=r[u++],y=64&g,v=y?2+3*(31&g):0,b=new Uint8Array(v);if(y){b[0]=g;for(let E=1;E<v;E++)b[E]=r[u++]}i.push({type:p,payloadType:o,pts:e,bytes:b})}}}}}else if(5===o&&a>16){const d=[];for(let p=0;p<16;p++){const g=r[u++].toString(16);d.push(1==g.length?"0"+g:g),(3===p||5===p||7===p||9===p)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=r[u++];i.push({payloadType:o,pts:e,uuid:d.join(""),userData:Si(h),userDataBytes:h})}}}function pk(n){const t=n.byteLength,e=[];let i=1;for(;i<t-2;)0===n[i]&&0===n[i+1]&&3===n[i+2]?(e.push(i+2),i+=2):i++;if(0===e.length)return n;const r=t-e.length,s=new Uint8Array(r);let o=0;for(i=0;i<r;o++,i++)o===e[0]&&(o++,e.shift()),s[i]=n[o];return s}function lZ(n){const t=n.getUint32(0),e=n.byteOffset,i=n.byteLength;if(i<t)return{offset:e,size:i};if(1886614376!==n.getUint32(4))return{offset:e,size:t};const s=n.getUint32(8)>>>24;if(0!==s&&1!==s)return{offset:e,size:t};const o=n.buffer,a=qn(new Uint8Array(o,e+12,16));let l=null,c=null,u=0;if(0===s)u=28;else{const f=n.getUint32(28);if(!f||i<32+16*f)return{offset:e,size:t};l=[];for(let h=0;h<f;h++)l.push(new Uint8Array(o,e+32+16*h,16));u=32+16*f}if(!u)return{offset:e,size:t};const d=n.getUint32(u);return t-32<d?{offset:e,size:t}:(c=new Uint8Array(o,e+u+4,d),{version:s,systemId:a,kids:l,data:c,offset:e,size:t})}const gk=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Wl={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function sE(n,t){const e=Wl[t];return!!e&&!!e[n.slice(0,4)]}function pd(n,t,e=!0){return!n.split(",").some(i=>!oE(i,t,e))}function oE(n,t,e=!0){var i;const r=oo(e);return null!=(i=r?.isTypeSupported(gd(n,t)))&&i}function gd(n,t){return`${t}/mp4;codecs=${n}`}function mk(n){if(n){const t=n.substring(0,4);return Wl.video[t]}return 2}function og(n){const t=gk();return n.split(",").reduce((e,i)=>{const s=t&&sg(i)?9:Wl.video[i];return s?(2*s+e)/(e?3:2):(Wl.audio[i]+e)/(e?2:1)},0)}const aE={},uZ=/flac|opus|mp4a\.40\.34/i;function ag(n,t=!0){return n.replace(uZ,e=>function cZ(n,t=!0){if(aE[n])return aE[n];const e={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<e.length;r++){var i;if(oE(e[r],"audio",t))return aE[n]=e[r],e[r];if("mp3"===e[r]&&null!=(i=oo(t))&&i.isTypeSupported("audio/mpeg"))return""}return n}(e.toLowerCase(),t))}function lg(n,t){if(n&&(n.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n))&&(yk(n,"audio")||yk(n,"video")))return n;if(t){const e=t.split(",");if(e.length>1){if(n)for(let i=e.length;i--;)if(e[i].substring(0,4)===n.substring(0,4))return e[i];return e[0]}}return t||n}function yk(n,t){return sE(n,t)&&oE(n,t)}function hZ(n){if(n.startsWith("av01.")){const t=n.split("."),e=["0","111","01","01","01","0"];for(let i=t.length;i>4&&i<10;i++)t[i]=e[i-4];return t.join(".")}return n}function _k(n){const t=oo(n)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function lE(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const gZ={supported:!1,smooth:!1,powerEfficient:!1},vk={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function bk(n,t){return{supported:!1,configurations:t,decodingInfoResults:[gZ],error:n}}function mZ(n,t,e,i,r,s){const o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=s?.audioCodec,c=s?.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(null!=a&&a.length)try{d=1===a.length&&a[0]?t.groups[a[0]].channels:a.reduce((f,h)=>{if(h){const p=t.groups[h];if(!p)throw new Error(`Audio track group ${h} not found`);Object.keys(p.channels).forEach(g=>{f[g]=(f[g]||0)+p.channels[g]})}return f},{2:0})}catch{return!0}return void 0!==o&&(o.split(",").some(f=>sg(f))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||"SDR"!==n.videoRange&&n.videoRange!==e||n.bitrate>Math.max(r,8e6))||!!d&&J(u)&&Object.keys(d).some(f=>parseInt(f)>u)}function Ek(n,t,e,i={}){const r=n.videoCodec;if(!r&&!n.audioCodec||!e)return Promise.resolve(vk);const s=[],o=function yZ(n){var t;const e=null==(t=n.videoCodec)?void 0:t.split(","),i=Dk(n),r=n.width||640,s=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return e?e.map(l=>{const c={contentType:gd(hZ(l),"video"),width:r,height:s,bitrate:i,framerate:o};return"sdr"!==a&&(c.transferFunction=a),c}):[]}(n),a=o.length,l=function _Z(n,t,e){var i;const r=null==(i=n.audioCodec)?void 0:i.split(","),s=Dk(n);return r&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;const c=a?null==(l=t.groups[a])?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===a){const f=parseFloat(d.channels||"");r.forEach(h=>{const p={contentType:gd(h,"audio"),bitrate:e?vZ(h,s):s};f&&(p.channels=""+f),u.push(p)})}return u},o):o},[]):[]}(n,t,a>0),c=l.length;for(let u=a||1*c||1;u--;){const d={type:"media-source"};if(a&&(d.video=o[u%a]),c){d.audio=l[u%c];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}s.push(d)}if(r){const u=navigator.userAgent;if(r.split(",").some(d=>sg(d))&&gk())return Promise.resolve(bk(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),s))}return Promise.all(s.map(u=>{const d=function bZ(n){let t="";const{audio:e,video:i}=n;return i&&(t+=`${lE(i.contentType)}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`),e&&(t+=`${i?"_":""}${lE(e.contentType)}_c${e.channels}`),t}(u);return i[d]||(i[d]=e.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:s,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:s,decodingInfoResults:[],error:u}))}function vZ(n,t){if(t<=1)return 1;let e=128e3;return"ec-3"===n?e=768e3:"ac-3"===n&&(e=64e4),Math.min(t/2,e)}function Dk(n){return 1e3*Math.ceil(Math.max(.9*n.bitrate,n.averageBitrate)/1e3)||1}const cE=["NONE","TYPE-0","TYPE-1",null],cg=["SDR","PQ","HLG"];function Tk(n){const{canSkipUntil:t,canSkipDateRanges:e,age:i}=n;return t&&i<t/2?e?"v2":"YES":""}class Sk{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class md{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const i=null==(e=t.supplemental)?void 0:e.videoCodec;i&&i!==t.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return Ck(this._audioGroups,t)}hasSubtitleGroup(t){return Ck(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e)if("audio"===t){let i=this._audioGroups;i||(i=this._audioGroups=[]),-1===i.indexOf(e)&&i.push(e)}else if("text"===t){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),-1===i.indexOf(e)&&i.push(e)}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return null==(t=this.audioGroups)?void 0:t[0]}get textGroupId(){var t;return null==(t=this.subtitleGroups)?void 0:t[0]}addFallback(){}}function Ck(n,t){return!(!t||!n)&&-1!==n.indexOf(t)}const Et=(n,t)=>JSON.stringify(n,(n=>{const t=new WeakSet;return(e,i)=>{if(n&&(i=n(e,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function Hr(n,t){rt.log(`[abr] start candidates with "${n}" ignored because ${t}`)}function Ik(n){return n.reduce((t,e)=>{let i=t.groups[e.groupId];i||(i=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(e);const r=e.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||e.default,i.hasAutoSelect=i.hasAutoSelect||e.autoselect,i.hasDefault&&(t.hasDefaultAudio=!0),i.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function wk(n){if(!n)return n;const{lang:t,assocLang:e,characteristics:i,channels:r,audioCodec:s}=n;return{lang:t,assocLang:e,characteristics:i,channels:r,audioCodec:s}}function Gr(n,t,e){if("attrs"in n){const i=t.indexOf(n);if(-1!==i)return i}for(let i=0;i<t.length;i++)if(aa(n,t[i],e))return i;return-1}function aa(n,t,e){const{groupId:i,name:r,lang:s,assocLang:o,default:a}=n,l=n.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===s||function AZ(n,t="--"){return n.length===t.length?n===t:n.startsWith(t)||t.startsWith(n)}(s,t.lang))&&(void 0===s||t.assocLang===o)&&(void 0===a||t.default===a)&&(void 0===l||t.forced===l)&&(!("characteristics"in n)||function xZ(n,t=""){const e=n.split(","),i=t.split(",");return e.length===i.length&&!e.some(r=>-1===i.indexOf(r))}(n.characteristics||"",t.characteristics))&&(void 0===e||e(n,t))}function la(n,t){const{audioCodec:e,channels:i}=n;return!(void 0!==e&&(t.audioCodec||"").substring(0,4)!==e.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function Ak(n,t,e){for(let i=t;i>-1;i--)if(e(n[i]))return i;for(let i=t+1;i<n.length;i++)if(e(n[i]))return i;return-1}function dg(n,t){var e;return!!n&&n!==(null==(e=t.loadLevelObj)?void 0:e.uri)}const xk_search=function(n,t){let e=0,i=n.length-1,r=null,s=null;for(;e<=i;){r=(e+i)/2|0,s=n[r];const o=t(s);if(o>0)e=r+1;else{if(!(o<0))return s;i=r-1}}return null};function ca(n,t,e=0,i=0,r=.005){let s=null;if(n){s=t[1+n.sn-t[0].sn]||null;const a=n.endDTS-e;a>0&&a<15e-7&&(e+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=t[2+n.sn-t[0].sn]||null)}else 0===e&&0===t[0].start&&(s=t[0]);if(s&&((!n||n.level===s.level)&&0===Rk(e,i,s)||function OZ(n,t,e){if(t&&0===t.start&&t.level<n.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((r,s)=>("INF"===s[0]&&(r+=parseFloat(s[1])),r),e);return n.start<=i}return!1}(s,n,Math.min(r,i))))return s;const o=xk_search(t,Rk.bind(null,e,i));return!o||o===n&&s?s:o}function Rk(n=0,t=0,e){if(e.start<=n&&e.start+e.duration>n)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=n?1:e.start-i>n&&e.start?-1:0}function kZ(n,t,e){const i=1e3*Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-i>n}function Mk(n,t,e){if(n&&n.startCC<=t&&n.endCC>=t){let i=n.fragments;const{fragmentHint:r}=n;let s;return r&&(i=i.concat(r)),xk_search(i,o=>o.cc<t?1:o.cc>t?-1:(s=o,o.end<=e?1:o.start>e?-1:0)),s||null}return null}function fg(n){switch(n.details){case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_TIMEOUT:case M.LEVEL_LOAD_TIMEOUT:case M.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Nk(n){return n.details.startsWith("key")}function Ok(n){return Nk(n)&&!!n.frag&&!n.frag.decryptdata}function kk(n,t){const e=fg(t);return n.default[(e?"timeout":"error")+"Retry"]}function uE(n,t){const e="linear"===n.backoff?1:Math.pow(2,t);return Math.min(e*n.retryDelayMs,n.maxRetryDelayMs)}function Lk(n){return it(it({},n),{errorRetry:null,timeoutRetry:null})}function hg(n,t,e,i){if(!n)return!1;const r=i?.code,s=t<n.maxNumRetry&&(function LZ(n){return dE(n)||!!n&&(n<400||n>499)}(r)||!!e);return n.shouldRetry?n.shouldRetry(n,t,e,i,s):s}function dE(n){return 0===n&&!1===navigator.onLine}function Kl(n){const t={action:0,flags:0};return n&&(t.resolved=!0),t}class FZ{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t&&(t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.BUFFER_APPENDED,this.onBufferAppended,this),t.on(_.FRAG_BUFFERED,this.onFragBuffered,this),t.on(_.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.BUFFER_APPENDED,this.onBufferAppended,this),t.off(_.FRAG_BUFFERED,this.onFragBuffered,this),t.off(_.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;if(s.start<=t&&t<=s.end&&s.loaded)return s}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,i){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if(a?.body.type===e&&(!i||a.buffered)){const l=a.body;if(l.start<=t&&t<=l.end)return l}}return null}detectEvictedFragments(t,e,i,r,s){this.timeRanges&&(this.timeRanges[t]=e);const o=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s))return void(l.body.type===i&&this.removeFragment(l.body));const c=l.range[t];if(c){if(0===c.time.length)return void this.removeFragment(l.body);c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,e);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(t){const e=this.timeRanges;if(!e||"initSegment"===t.frag.sn)return;const i=t.frag,r=zl(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;const o=!i.relurl;Object.keys(e).forEach(a=>{const l=i.elementaryStreams[a];l&&(s.range[a]=this.getBufferedTimes(i,t.part,o||!0===l.partial,e[a]))}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),pg(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(t,e){const i=this.activePartLists[e];i&&(this.activePartLists[e]=Pk(i,r=>r.fragment.sn>=t))}fragBuffered(t,e){const i=zl(t);let r=this.fragments[i];!r&&e&&(r=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(t,e,i,r){const s={time:[],partial:i},o=t.start,a=t.end,l=t.minEndPTS||a,c=t.maxStartPTS||o;for(let u=0;u<r.length;u++){const d=r.start(u)-this.bufferPadding,f=r.end(u)+this.bufferPadding;if(c>=d&&l<=f){s.time.push({startPTS:Math.max(o,r.start(u)),endPTS:Math.min(a,r.end(u))});break}if(o<f&&a>d){const h=Math.max(o,r.start(u)),p=Math.min(a,r.end(u));p>h&&(s.partial=!0,s.time.push({startPTS:h,endPTS:p}))}else if(a<=d)break}return s}getPartialFragment(t){let i,r,s,e=null,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&pg(u)&&(r=u.body.start-a,s=u.body.end+a,t>=r&&t<=s&&(i=Math.min(t-r,s-t),o<=i&&(e=u.body,o=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return void 0!==e&&(e.buffered||pg(e))}getState(t){const e=zl(t),i=this.fragments[e];return i?i.buffered?pg(i)?"PARTIAL":"OK":"APPENDING":"NOT_LOADED"}isTimeBuffered(t,e,i){let r,s;for(let o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,t>=r&&e<=s)return!0;if(e<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if("initSegment"===e.frag.sn||e.frag.bitrateTest)return;const i=e.frag,r=e.part?null:e,s=zl(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:r,timeRanges:s,type:o}=e;if("initSegment"===i.sn)return;const a=i.type;if(r){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(r)}this.timeRanges=s,this.detectEvictedFragments(o,s[o],a,r)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=zl(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,i=Object.keys(e);if(!t)return i.length>0;for(let r=i.length;r--;){const s=e[i[r]];if(s?.body.type===t)return!0}return!1}hasParts(t){var e;return!(null==(e=this.activePartLists[t])||!e.length)}removeFragmentsInRange(t,e,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==i||r&&!l.gap||l.start<e&&l.end>t&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(t){const e=zl(t);t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const r=t.sn;this.activePartLists[t.type]=Pk(i,s=>s.fragment.sn!==r)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const e=null==(t=this.hls)||null==(t=t.latestLevelDetails)?void 0:t.partList;e&&e.forEach(i=>i.clearElementaryStreamInfo())}}function pg(n){var t,e,i;return n.buffered&&!!(n.body.gap||null!=(t=n.range.video)&&t.partial||null!=(e=n.range.audio)&&e.partial||null!=(i=n.range.audiovideo)&&i.partial)}function zl(n){return`${n.type}_${n.level}_${n.sn}`}function Pk(n,t){return n.filter(e=>{const i=t(e);return i||e.clearElementaryStreamInfo(),i})}class BZ{constructor(t,e,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=i}decrypt(t,e){switch(this.aesMode){case 0:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case 1:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class $Z{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=e.getUint32(4*r);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,r=i[0],s=i[1],o=i[2],a=i[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let p=0,g=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let y=g^g<<1^g<<2^g<<3^g<<4;y=y>>>8^255&y^99,t[p]=y,e[y]=p;const v=h[p],b=h[v],E=h[b];let D=257*h[y]^16843008*y;r[p]=D<<24|D>>>8,s[p]=D<<16|D>>>16,o[p]=D<<8|D>>>24,a[p]=D,D=16843009*E^65537*b^257*v^16843008*p,c[y]=D<<24|D>>>8,u[y]=D<<16|D>>>16,d[y]=D<<8|D>>>24,f[y]=D,p?(p=v^h[h[h[E^v]]],g^=h[h[g]]):p=g=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,r=0;for(;r<e.length&&i;)i=e[r]===this.key[r],r++;if(i)return;this.key=e;const s=this.keySize=e.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);const o=this.ksRows=4*(s+6+1);let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],g=h[1],m=h[2],y=h[3];let v,b;for(a=0;a<o;a++)a<s?v=c[a]=e[a]:(b=v,a%s==0?(b=b<<8|b>>>24,b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[255&b],b^=f[a/s|0]<<24):s>6&&a%s==4&&(b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[255&b]),c[a]=v=(c[a-s]^b)>>>0);for(l=0;l<o;l++)a=o-l,b=3&l?c[a]:c[a-4],u[l]=l<4||a<=4?b:p[d[b>>>24]]^g[d[b>>>16&255]]^m[d[b>>>8&255]]^y[d[255&b]],u[l]=u[l]>>>0}networkToHostOrderSwap(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}decrypt(t,e,i){const r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(i);let h=f[0],p=f[1],g=f[2],m=f[3];const y=new Int32Array(t),v=new Int32Array(y.length);let b,E,D,w,T,I,R,C,k,W,Y,te,ee,V;const Z=this.networkToHostOrderSwap;for(;e<y.length;){for(k=Z(y[e]),W=Z(y[e+1]),Y=Z(y[e+2]),te=Z(y[e+3]),T=k^s[0],I=te^s[1],R=Y^s[2],C=W^s[3],ee=4,V=1;V<r;V++)b=l[T>>>24]^c[I>>16&255]^u[R>>8&255]^d[255&C]^s[ee],E=l[I>>>24]^c[R>>16&255]^u[C>>8&255]^d[255&T]^s[ee+1],D=l[R>>>24]^c[C>>16&255]^u[T>>8&255]^d[255&I]^s[ee+2],w=l[C>>>24]^c[T>>16&255]^u[I>>8&255]^d[255&R]^s[ee+3],T=b,I=E,R=D,C=w,ee+=4;b=o[T>>>24]<<24^o[I>>16&255]<<16^o[R>>8&255]<<8^o[255&C]^s[ee],E=o[I>>>24]<<24^o[R>>16&255]<<16^o[C>>8&255]<<8^o[255&T]^s[ee+1],D=o[R>>>24]<<24^o[C>>16&255]<<16^o[T>>8&255]<<8^o[255&I]^s[ee+2],w=o[C>>>24]<<24^o[T>>16&255]<<16^o[I>>8&255]<<8^o[255&R]^s[ee+3],v[e]=Z(b^h),v[e+1]=Z(w^p),v[e+2]=Z(D^g),v[e+3]=Z(E^m),h=k,p=W,g=Y,m=te,e+=4}return v.buffer}}class VZ{constructor(t,e,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=i}expandKey(){const t=function jZ(n){switch(n){case 0:return"AES-CBC";case 1:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}class fE{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?function UZ(n){const t=n.byteLength,e=t&&new DataView(n.buffer).getUint8(t-1);return e?n.slice(0,t-e):n}(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i,r){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(a,e,i,r);const l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i,r)}softwareDecrypt(t,e,i,r){const{currentIV:s,currentResult:o,remainderData:a}=this;if(0!==r||16!==e.byteLength)return rt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(t=Qi(a,t),this.remainderData=null);const l=this.getValidChunk(t);if(!l.length)return null;s&&(i=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new $Z),c.expandKey(e);const u=o;return this.currentResult=c.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(t,e,i,r){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,i,r));this.key=e,this.fastAesKey=new VZ(this.subtle,e,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new BZ(this.subtle,new Uint8Array(i),r).decrypt(t.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(rt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(t,e,i,r)))}onWebCryptoError(t,e,i,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%16;return i!==t.length&&(e=t.slice(0,i),this.remainderData=t.slice(i)),e}logOnce(t){this.logEnabled&&(rt.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Fk=Math.pow(2,17);class GZ{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Cs({type:le.NETWORK_ERROR,details:M.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),t.gap){if(t.tagList.some(p=>"GAP"===p[0]))return void l(Uk(t));t.gap=!1}const c=this.loader=s?new s(r):new o(r),u=Bk(t);t.loader=c;const d=Lk(r.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===t.sn?1/0:Fk};t.stats=c.stats;const h={onSuccess:(p,g,m,y)=>{this.resetLoader(t,c);let v=p.data;m.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),a({frag:t,part:null,payload:v,networkDetails:y})},onError:(p,g,m,y)=>{this.resetLoader(t,c),l(new Cs({type:le.NETWORK_ERROR,details:M.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:it({url:i,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:m,stats:y}))},onAbort:(p,g,m)=>{this.resetLoader(t,c),l(new Cs({type:le.NETWORK_ERROR,details:M.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:m,stats:p}))},onTimeout:(p,g,m)=>{this.resetLoader(t,c),l(new Cs({type:le.NETWORK_ERROR,details:M.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:p}))}};e&&(h.onProgress=(p,g,m,y)=>e({frag:t,part:null,payload:m,networkDetails:y})),c.load(u,f,h)})}loadPart(t,e,i){this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap)return void l(Uk(t,e));const c=this.loader=s?new s(r):new o(r),u=Bk(t,e);t.loader=c;const d=Lk(r.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Fk};e.stats=c.stats,c.load(u,f,{onSuccess:(h,p,g,m)=>{this.resetLoader(t,c),this.updateStatsFromPart(t,e);const y={frag:t,part:e,payload:h.data,networkDetails:m};i(y),a(y)},onError:(h,p,g,m)=>{this.resetLoader(t,c),l(new Cs({type:le.NETWORK_ERROR,details:M.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:it({url:u.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:m}))},onAbort:(h,p,g)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,c),l(new Cs({type:le.NETWORK_ERROR,details:M.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(t,c),l(new Cs({type:le.NETWORK_ERROR,details:M.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}})})}updateStatsFromPart(t,e){const i=t.stats,r=e.stats,s=r.total;if(i.loaded+=r.loaded,s){const l=Math.round(t.duration/e.duration),c=Math.min(Math.round(i.loaded/s),l),d=(l-c)*Math.round(i.loaded/c);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);const o=i.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Bk(n,t=null){const e=t||n,i={frag:n,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,s=e.byteRangeEndOffset;if(J(r)&&J(s)){var o;let a=r,l=s;if("initSegment"===n.sn&&function WZ(n){return"AES-128"===n||"AES-256"===n}(null==(o=n.decryptdata)?void 0:o.method)){const c=s-r;c%16&&(l=s+(16-c%16)),0!==r&&(i.resetIV=!0,a=r-16)}i.rangeStart=a,i.rangeEnd=l}return i}function Uk(n,t){const e=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:le.MEDIA_ERROR,details:M.FRAG_GAP,fatal:!1,frag:n,error:e,networkDetails:null};return t&&(i.part=t),(t||n).stats.aborted=!0,new Cs(i)}class Cs extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class $k extends Yi{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class hE{constructor(t,e,i,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=i,this.size=r,this.part=s,this.partial=o}}const Vk={length:0,start:()=>0,end:()=>0};class Ie{static isBuffered(t,e){if(t){const i=Ie.getBuffered(t);for(let r=i.length;r--;)if(e>=i.start(r)&&e<=i.end(r))return!0}return!1}static bufferedRanges(t){if(t){const e=Ie.getBuffered(t);return Ie.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e}static bufferInfo(t,e,i){if(t){const r=Ie.bufferedRanges(t);if(r.length)return Ie.bufferedInfo(r,e,i)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.length>1&&t.sort((u,d)=>u.start-d.start||d.end-u.end);let r=-1,s=[];if(i)for(let u=0;u<t.length;u++){e>=t[u].start&&e<=t[u].end&&(r=u);const d=s.length;if(d){const f=s[d-1].end;t[u].start-f<i?t[u].end>f&&(s[d-1].end=t[u].end):s.push(t[u])}else s.push(t[u])}else s=t;let a,o=0,l=e,c=e;for(let u=0;u<s.length;u++){const d=s[u].start,f=s[u].end;if(-1===r&&e>=d&&e<=f&&(r=u),e+i>=d&&e<f)l=d,c=f,o=c-e;else if(e+i<d){a=d;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:t,bufferedIndex:r}}static getBuffered(t){try{return t.buffered||Vk}catch(e){return rt.log("failed to get media.buffered",e),Vk}}}const jk=/\{\$([a-zA-Z0-9-_]+)\}/g;function Hk(n){return jk.test(n)}function pE(n,t){if(null!==n.variableList||n.hasVariableRefs){const e=n.variableList;return t.replace(jk,i=>{const r=i.substring(2,i.length-1),s=e?.[r];return void 0===s?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return t}function Gk(n,t,e){let r,s,i=n.variableList;if(i||(n.variableList=i={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const o=new self.URL(e).searchParams;if(!o.has(r))throw new Error(`"${r}" does not match any query parameter in URI: "${e}"`);s=o.get(r)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=t.NAME,s=t.VALUE;r in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function KZ(n,t,e){const i=t.IMPORT;if(e&&i in e){let r=n.variableList;r||(n.variableList=r={}),r[i]=e[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const zZ=/^(\d+)x(\d+)$/,Wk=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Pt{constructor(t,e){"string"==typeof t&&(t=Pt.parseAttrList(t,e)),ut(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>"X-"===t.substring(0,2))}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;const i=new Uint8Array(e.length/2);for(let r=0;r<e.length/2;r++)i[r]=parseInt(e.slice(2*r,2*r+2),16);return i}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const i=this[t];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),e)}bool(t){return"YES"===this[t]}decimalResolution(t){const e=zZ.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let i;const r={};for(Wk.lastIndex=0;null!==(i=Wk.exec(t));){const o=i[1].trim();let a=i[2];const l=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(e&&(l||c))a=pE(e,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":rt.warn(`${t}: attribute ${o} is missing quotes`)}r[o]=a}return r}}function YZ(n){return"ID"!==n&&"CLASS"!==n&&"CUE"!==n&&"START-DATE"!==n&&"DURATION"!==n&&"END-DATE"!==n&&"END-ON-NEXT"!==n}function QZ(n){return"SCTE35-OUT"===n||"SCTE35-IN"===n||"SCTE35-CMD"===n}class Kk{constructor(t,e,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=e?.tagAnchor||null,this.tagOrder=null!=(r=e?.tagOrder)?r:i,e){const s=e.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(t,o)&&t[o]!==s[o]){rt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=o;break}t=ut(new Pt({}),s,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const s=e?.endDate||new Date(this.attr["END-DATE"]);J(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return void 0===t?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return null===t||null===t.programDateTime?(rt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${t}`),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return null!==e?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(J(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&J(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class ZZ{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t)return this.advanced=!0,void(this.updated=!0);const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||0===e&&i>0,this.misses=this.updated||this.advanced?Math.floor(.6*t.misses):t.misses+1}hasKey(t){return this.encryptedFragments.some(e=>{let i=e.decryptdata;return i||(e.setKeyFormat(t.keyFormat),i=e.decryptdata),!!i&&t.matches(i)})}get hasProgramDateTime(){return!!this.fragments.length&&J(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(-1!==e){for(let i=t.length;i--;)if(t[i].index>e)return t[i].index;return e}}return 0}get lastPartSn(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){return!!(this.live&&this.age&&this.misses<3)&&this.age>Math.max(this.partEnd-this.fragmentStart,this.totalduration)+this.levelTargetDuration}}function mg(n,t){return n.length===t.length&&!n.some((e,i)=>e!==t[i])}function zk(n,t){return!n&&!t||!(!n||!t)&&mg(n,t)}function ql(n){return"AES-128"===n||"AES-256"===n||"AES-256-CTR"===n}function gE(n){switch(n){case"AES-128":case"AES-256":return 0;case"AES-256-CTR":return 1;default:throw new Error(`invalid full segment method ${n}`)}}function mE(n){return Uint8Array.from(atob(n),t=>t.charCodeAt(0))}function yE(n){return Uint8Array.from(unescape(encodeURIComponent(n)),t=>t.charCodeAt(0))}function qk(n){const t=function(i,r,s){const o=i[r];i[r]=i[s],i[s]=o};t(n,0,3),t(n,1,2),t(n,4,5),t(n,6,7)}function Yk(n){const t=n.split(":");let e=null;if("data"===t[0]&&2===t.length){const i=t[1].split(";"),r=i[i.length-1].split(",");if(2===r.length){const o=r[1];"base64"===r[0]?(i.splice(-1,1),e=mE(o)):e=function JZ(n){const t=yE(n).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}(o)}}return e}const yg=typeof self<"u"?self:void 0;var Ft={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Mn_FAIRPLAY="com.apple.streamingkeydelivery",Mn_PLAYREADY="com.microsoft.playready",Mn_WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function _g(n){switch(n){case Mn_FAIRPLAY:return Ft.FAIRPLAY;case Mn_PLAYREADY:return Ft.PLAYREADY;case Mn_WIDEVINE:return Ft.WIDEVINE;case"org.w3.clearkey":return Ft.CLEARKEY}}function _E(n){switch(n){case Ft.FAIRPLAY:return Mn_FAIRPLAY;case Ft.PLAYREADY:return Mn_PLAYREADY;case Ft.WIDEVINE:return Mn_WIDEVINE;case Ft.CLEARKEY:return"org.w3.clearkey"}}function yd(n){const{drmSystems:t,widevineLicenseUrl:e}=n,i=t?[Ft.FAIRPLAY,Ft.WIDEVINE,Ft.PLAYREADY,Ft.CLEARKEY].filter(r=>!!t[r]):[];return!i[Ft.WIDEVINE]&&e&&i.push(Ft.WIDEVINE),i}const Qk=null!=yg&&null!=(n=yg.navigator)&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var n;function Xk(n){const t=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),e=String.fromCharCode.apply(null,Array.from(t)),i=e.substring(e.indexOf("<"),e.length),o=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=mE(a).subarray(0,16);return qk(l),l}}return null}let vg={};class ua{static clearKeyUriToKeyIdMap(){vg={}}static setKeyIdForUri(t,e){vg[t]=e}constructor(t,e,i,r=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&!ql(t),null!=o&&o.startsWith("0x")&&(this.keyId=new Uint8Array(tk(o)))}matches(t){return t.uri===this.uri&&t.method===this.method&&t.encrypted===this.encrypted&&t.keyFormat===this.keyFormat&&mg(t.keyFormatVersions,this.keyFormatVersions)&&zk(t.iv,this.iv)&&zk(t.keyId,this.keyId)}isSupported(){if(this.method){if(ql(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Mn_FAIRPLAY:case Mn_WIDEVINE:case Mn_PLAYREADY:case"org.w3.clearkey":return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(t,e){if(!this.encrypted||!this.uri)return null;if(ql(this.method)){let s=this.iv;return s||("number"!=typeof t&&(rt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0),s=function rJ(n){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=n>>8*(15-e)&255;return t}(t)),new ua(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=vg[this.uri];if(s&&!mg(this.keyId,s)&&ua.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=Yk(this.uri);if(i)switch(this.keyFormat){case Mn_WIDEVINE:if(this.pssh=i,!this.keyId){const s=function aZ(n){const t=[];if(n instanceof ArrayBuffer){const e=n.byteLength;let i=0;for(;i+32<e;){const s=lZ(new DataView(n,i));t.push(s),i+=s.size}}return t}(i.buffer);if(s.length){var r;const o=s[0];this.keyId=null!=(r=o.kids)&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=Zk(e));break;case Mn_PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function oZ(n,t,e){if(16!==n.byteLength)throw new RangeError("Invalid system id");let i,r,s;i=0,r=new Uint8Array,s=new Uint8Array;const o=new Uint8Array(4);return e.byteLength>0&&new DataView(o.buffer).setUint32(0,e.byteLength,!1),function sZ(n,...t){const e=t.length;let i=8,r=e;for(;r--;)i+=t[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(n,4),r=0,i=8;r<e;r++)s.set(t[r],i),i+=t[r].byteLength;return s}([112,115,115,104],new Uint8Array([0,0,0,0]),n,s,r,o,e)}(s,0,i),this.keyId=Xk(i);break}default:{let s=i.subarray(0,16);if(16!==s.length){const o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||16!==this.keyId.byteLength){let s;s=function iJ(n){const t=n?.[Mn_WIDEVINE];return t?t.keyId:null}(e),s||(s=Zk(e),s||(s=vg[this.uri])),s&&(this.keyId=s,ua.setKeyIdForUri(this.uri,s))}return this}}function Zk(n){const t=n?.[Mn_PLAYREADY];if(t){const e=Yk(t.uri);if(e)return Xk(e)}return null}const Jk=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,eL=/#EXT-X-MEDIA:(.*)/g,sJ=/^#EXT(?:INF|-X-TARGETDURATION):/m,vE=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),oJ=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Wr{static findGroup(t,e){for(let i=0;i<t.length;i++){const r=t[i];if(r.id===e)return r}}static resolve(t,e){return eE.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return sJ.test(t)}static parseMasterPlaylist(t,e){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Hk(t)},s=[];if(Jk.lastIndex=0,!t.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;null!=(o=Jk.exec(t));)if(o[1]){var a;const c=new Pt(o[1],r),u=pE(r,o[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Wr.resolve(u,e)},f=c.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),rL(c.CODECS,d);const h=c["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},rL(h,d.supplemental)),null!=(a=d.unknownCodecs)&&a.length||s.push(d),r.levels.push(d)}else if(o[3]){const u=o[4];switch(o[3]){case"SESSION-DATA":{const d=new Pt(u,r),f=d["DATA-ID"];f&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[f]=d);break}case"SESSION-KEY":{const d=nL(u,e,r);d.encrypted&&d.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(d)):rt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":Gk(r,new Pt(u,r),e);break;case"CONTENT-STEERING":{const d=new Pt(u,r);r.contentSteering={uri:Wr.resolve(d["SERVER-URI"],e),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=iL(u)}}return r.levels=s.length>0&&s.length<r.levels.length?s:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(t,e,i){let r;const s={},o=i.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(eL.lastIndex=0;null!==(r=eL.exec(t));){const c=new Pt(r[1],i),u=c.TYPE;if(u){const d=a[u],f=s[u]||[];s[u]=f;const h=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],g=c.CHANNELS,m=c.CHARACTERISTICS,y=c["INSTREAM-ID"],v={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||h||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:h,url:c.URI?Wr.resolve(c.URI,e):""};if(p&&(v.assocLang=p),g&&(v.channels=g),m&&(v.characteristics=m),y&&(v.instreamId=y),null!=d&&d.length){const b=Wr.findGroup(d,v.groupId)||d[0];sL(v,b,"audioCodec"),sL(v,b,"textCodec")}f.push(v)}}return s}static parseLevelPlaylist(t,e,i,r,s,o){var a;const l={url:e},c=new ZZ(e),u=c.fragments,d=[];let E,D,w,C,f=null,h=0,p=0,g=0,m=0,y=0,v=null,b=new nE(r,l),T=-1,I=!1,R=null;if(vE.lastIndex=0,c.m3u8=t,c.hasVariableRefs=Hk(t),"#EXTM3U"!==(null==(a=vE.exec(t))?void 0:a[0]))return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;null!==(E=vE.exec(t));){I&&(I=!1,b=new nE(r,l),b.playlistOffset=g,b.setStart(g),b.sn=h,b.cc=m,y&&(b.bitrate=y),b.level=i,f&&(b.initSegment=f,f.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),R&&(b.setByteRange(R),R=null)));const te=E[1];if(te){b.duration=parseFloat(te);const ee=(" "+E[2]).slice(1);b.title=ee||null,b.tagList.push(ee?["INF",te,ee]:["INF",te])}else if(E[3]){if(J(b.duration)){b.playlistOffset=g,b.setStart(g),w&&aL(b,w,c),b.sn=h,b.level=i,b.cc=m,u.push(b);const ee=(" "+E[3]).slice(1);b.relurl=pE(c,ee),bE(b,v,d),v=b,g+=b.duration,h++,p=0,I=!0}}else{if(E=E[0].match(oJ),!E){rt.warn("No matches on slow regex match for level playlist!");continue}for(D=1;D<E.length&&void 0===E[D];D++);const ee=(" "+E[D]).slice(1),V=(" "+E[D+1]).slice(1),Z=E[D+2]?(" "+E[D+2]).slice(1):null;switch(ee){case"BYTERANGE":v?b.setByteRange(V,v):b.setByteRange(V);break;case"PROGRAM-DATE-TIME":b.rawProgramDateTime=V,b.tagList.push(["PROGRAM-DATE-TIME",V]),-1===T&&(T=u.length);break;case"PLAYLIST-TYPE":c.type&&Is(c,ee,E),c.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":0!==c.startSN?Is(c,ee,E):u.length>0&&lL(c,ee,E),h=c.startSN=parseInt(V);break;case"SKIP":{c.skippedSegments&&Is(c,ee,E);const Q=new Pt(V,c),ne=Q.decimalInteger("SKIPPED-SEGMENTS");if(J(ne)){c.skippedSegments+=ne;for(let q=ne;q--;)u.push(null);h+=ne}const he=Q.enumeratedString("RECENTLY-REMOVED-DATERANGES");he&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(he.split("\t")));break}case"TARGETDURATION":0!==c.targetduration&&Is(c,ee,E),c.targetduration=Math.max(parseInt(V),1);break;case"VERSION":null!==c.version&&Is(c,ee,E),c.version=parseInt(V);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Is(c,ee,E),c.live=!1;break;case"#":(V||Z)&&b.tagList.push(Z?[V,Z]:[V]);break;case"DISCONTINUITY":m++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([ee]);break;case"BITRATE":b.tagList.push([ee,V]),y=1e3*parseInt(V),J(y)?b.bitrate=y:y=0;break;case"DATERANGE":{const Q=new Pt(V,c),ne=new Kk(Q,c.dateRanges[Q.ID],c.dateRangeTagCount);c.dateRangeTagCount++,ne.isValid||c.skippedSegments?c.dateRanges[ne.id]=ne:rt.warn(`Ignoring invalid DATERANGE tag: "${V}"`),b.tagList.push(["EXT-X-DATERANGE",V]);break}case"DEFINE":{const Q=new Pt(V,c);"IMPORT"in Q?KZ(c,Q,o):Gk(c,Q,e)}break;case"DISCONTINUITY-SEQUENCE":0!==c.startCC?Is(c,ee,E):u.length>0&&lL(c,ee,E),c.startCC=m=parseInt(V);break;case"KEY":{const Q=nL(V,e,c);if(Q.isSupported()){if("NONE"===Q.method){w=void 0;break}w||(w={});const ne=w[Q.keyFormat];null!=ne&&ne.matches(Q)||(ne&&(w=ut({},w)),w[Q.keyFormat]=Q)}else rt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${V}"`);break}case"START":c.startTimeOffset=iL(V);break;case"MAP":{const Q=new Pt(V,c);if(b.duration){const ne=new nE(r,l);oL(ne,Q,i,w),f=ne,b.initSegment=f,f.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime)}else{const ne=b.byteRangeEndOffset;if(ne){const he=b.byteRangeStartOffset;R=`${ne-he}@${he}`}else R=null;oL(b,Q,i,w),f=b,I=!0}f.cc=m;break}case"SERVER-CONTROL":C&&Is(c,ee,E),C=new Pt(V),c.canBlockReload=C.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=C.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&C.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=C.optionalFloat("PART-HOLD-BACK",0),c.holdBack=C.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{c.partTarget&&Is(c,ee,E);const Q=new Pt(V);c.partTarget=Q.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Q=c.partList;Q||(Q=c.partList=[]);const ne=p>0?Q[Q.length-1]:void 0,he=p++,q=new Pt(V,c),K=new KX(q,b,l,he,ne);Q.push(K),b.duration+=K.duration;break}case"PRELOAD-HINT":{const Q=new Pt(V,c);c.preloadHint=Q;break}case"RENDITION-REPORT":{const Q=new Pt(V,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(Q);break}default:rt.warn(`line parsed but not handled: ${E}`)}}}v&&!v.relurl?(u.pop(),g-=v.duration,c.partList&&(c.fragmentHint=v)):c.partList&&(bE(b,v,d),b.cc=m,c.fragmentHint=b,w&&aL(b,w,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const k=u.length,W=u[0],Y=u[k-1];if(g+=c.skippedSegments*c.targetduration,g>0&&k&&Y){c.averagetargetduration=g/k;const te=Y.sn;c.endSN="initSegment"!==te?te:0,c.live||(Y.endList=!0),T>0&&(function lJ(n,t){let e=n[t];for(let i=t;i--;){const r=n[i];if(!r)return;r.programDateTime=e.programDateTime-1e3*r.duration,e=r}}(u,T),W&&d.unshift(W))}return c.fragmentHint&&(g+=c.fragmentHint.duration),c.totalduration=g,d.length&&c.dateRangeTagCount&&W&&tL(d,c),c.endCC=m,c}}function tL(n,t){let e=n.length;if(!e){if(!t.hasProgramDateTime)return;n.push(t.fragments[t.fragments.length-1]),e++}const i=n[e-1],r=t.live?1/0:t.totalduration,s=Object.keys(t.dateRanges);for(let a=s.length;a--;){const l=t.dateRanges[s[a]],c=l.startDate.getTime();l.tagAnchor=i.ref;for(let u=e;u--;){var o;if((null==(o=n[u])?void 0:o.sn)<t.startSN)break;const d=aJ(t,c,n,u,r);if(-1!==d){l.tagAnchor=t.fragments[d].ref;break}}}}function aJ(n,t,e,i,r){const s=e[i];if(s){const a=s.programDateTime;var o;if(t>=a||0===i)if(t<=a+1e3*(((null==(o=e[i+1])?void 0:o.start)||r)-s.start)){const c=e[i].sn-n.startSN;if(c<0)return-1;const u=n.fragments;if(u.length>e.length)for(let h=(e[i+1]||u[u.length-1]).sn-n.startSN;h>c;h--){const p=u[h].programDateTime;if(t>=p&&t<p+1e3*u[h].duration)return h}return c}}return-1}function nL(n,t,e){var i,r;const s=new Pt(n,e),o=null!=(i=s.METHOD)?i:"",a=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(r=s.KEYFORMAT)?r:"identity";a&&s.IV&&!l&&rt.error(`Invalid IV: ${s.IV}`);const d=a?Wr.resolve(a,t):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new ua(o,d,u,f,l,s.KEYID)}function iL(n){const e=new Pt(n).decimalFloatingPoint("TIME-OFFSET");return J(e)?e:null}function rL(n,t){let e=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=e.filter(s=>sE(s,i));r.length&&(t[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),e=e.filter(s=>-1===r.indexOf(s)))}),t.unknownCodecs=e}function sL(n,t,e){const i=t[e];i&&(n[e]=i)}function bE(n,t,e){n.rawProgramDateTime?e.push(n):null!=t&&t.programDateTime&&(n.programDateTime=t.endProgramDateTime)}function oL(n,t,e,i){n.relurl=t.URI,t.BYTERANGE&&n.setByteRange(t.BYTERANGE),n.level=e,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function aL(n,t,e){n.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(r=>t[r].isCommonEncryption)&&i.push(n)}function Is(n,t,e){n.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${e[0]})`)}function lL(n,t,e){n.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${e[0]})`)}function EE(n,t){const e=t.startPTS;if(J(e)){let r,i=0;t.sn>n.sn?(i=e-n.start,r=n):(i=n.start-e,r=t),r.duration!==i&&r.setDuration(i)}else t.setStart(t.sn>n.sn?n.cc===t.cc&&n.minEndPTS?n.start+(n.minEndPTS-n.start):n.start+n.duration:Math.max(n.start-t.duration,0))}function cL(n,t,e,i,r,s,o){i-e<=0&&(o.warn("Fragment should have a positive duration",t),i=e+t.duration,s=r+t.duration);let l=e,c=i;const u=t.startPTS,d=t.endPTS;if(J(u)){const y=Math.abs(u-e);n&&y>n.totalduration?o.warn(`media timestamps and playlist times differ by ${y}s for level ${t.level} ${n.url}`):t.deltaPTS=J(t.deltaPTS)?Math.max(y,t.deltaPTS):y,l=Math.max(e,u),e=Math.min(e,u),r=void 0!==t.startDTS?Math.min(r,t.startDTS):r,c=Math.min(i,d),i=Math.max(i,d),s=void 0!==t.endDTS?Math.max(s,t.endDTS):s}const f=e-t.start;0!==t.start&&t.setStart(e),t.setDuration(i-t.start),t.startPTS=e,t.maxStartPTS=l,t.startDTS=r,t.endPTS=i,t.minEndPTS=c,t.endDTS=s;const h=t.sn;if(!n||h<n.startSN||h>n.endSN)return 0;let p;const g=h-n.startSN,m=n.fragments;for(m[g]=t,p=g;p>0;p--)EE(m[p],m[p-1]);for(p=g;p<m.length-1;p++)EE(m[p],m[p+1]);return n.fragmentHint&&EE(m[m.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function uL(n,t,e,i,r){return new Error(`${n} ${r.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${e.startSN}\n${e.m3u8}`)}function dL(n,t,e=!0){const i=t.startSN+t.skippedSegments-n.startSN,r=n.fragments,s=i>=0;let o=0;if(s&&i<r.length)o=r[i].start;else if(s&&t.startSN===n.endSN+1)o=n.fragmentEnd;else if(s&&e)o=n.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;o=n.fragmentStart}DE(t,o)}function DE(n,t){if(t){const e=n.fragments;for(let i=n.skippedSegments;i<e.length;i++)e[i].addStart(t);n.fragmentHint&&n.fragmentHint.addStart(t)}}function fL(n,t=1/0){let e=1e3*n.targetduration;if(n.updated){const i=n.fragments;if(i.length&&4*e>t){const s=1e3*i[i.length-1].duration;s<e&&(e=s)}}else e/=2;return Math.round(e)}function hL(n,t,e){if(!n)return null;let i=n.fragments[t-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===t)?i:t<n.startSN&&e&&e.sn===t?e:null}function pL(n,t,e){return n?gL(n.partList,t,e):null}function gL(n,t,e){if(n)for(let i=n.length;i--;){const r=n[i];if(r.index===e&&r.fragment.sn===t)return r}return null}function mL(n){n.forEach((t,e)=>{var i;null==(i=t.details)||i.fragments.forEach(r=>{r.level=e,r.initSegment&&(r.initSegment.level=e)})})}function hJ(n,t){return!(n===t||!t)&&yL(n)!==yL(t)}function yL(n){return n.replace(/\?[^?]*$/,"")}function _d(n,t){for(let i=0,r=n.length;i<r;i++){var e;if((null==(e=n[i])?void 0:e.cc)===t)return n[i]}return null}function _L(n,t){const e=n.start+t;n.startPTS=e,n.setStart(e),n.endPTS=e+n.duration}function vL(n,t){const e=t.fragments;for(let i=0,r=e.length;i<r;i++)_L(e[i],n);t.fragmentHint&&_L(t.fragmentHint,n),t.alignedSliding=!0}function bL(n,t){if(!function pJ(n,t){return!!(n&&t.startCC<n.endCC&&t.endCC>n.startCC)}(t,n))return;const e=Math.min(t.endCC,n.endCC),i=_d(t.fragments,e),r=_d(n.fragments,e);i&&r&&(rt.log(`Aligning playlist at start of dicontinuity sequence ${e}`),vL(i.start-r.start,n))}function bg(n,t){if(!n.hasProgramDateTime||!t.hasProgramDateTime)return;const e=n.fragments,i=t.fragments;if(!e.length||!i.length)return;let r,s;const o=Math.min(t.endCC,n.endCC);t.startCC<o&&n.startCC<o&&(r=_d(i,o),s=_d(e,o)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=_d(e,r.cc)||e[Math.floor(e.length/2)]);const a=r.programDateTime,l=s.programDateTime;a&&l&&vL((l-a)/1e3-(s.start-r.start),n)}function Yn(n,t,e){ai(n,t,e),n.addEventListener(t,e)}function ai(n,t,e){n.removeEventListener(t,e)}class TE extends $k{constructor(t,e,i,r,s){super(r,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state="STOPPED",this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,f=Ie.bufferInfo(c||l,d,o.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${J(d)?d.toFixed(3):d}, state: ${u}, ${h?"out of":"in"} buffer`),"ENDED"===this.state)this.resetLoadingState();else if(a){const p=o.maxFragLookUpTolerance,g=a.start-p,m=a.start+a.duration+p;if(h||m<f.start||g>f.end){const y=d>m;(d<g||y)&&(y&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l&&(this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0),d>this.lastCurrentTime&&(this.lastCurrentTime=d),!this.loadingParts)){const g=Math.max(f.end,d),m=this.shouldLoadParts(this.getLevelDetails(),g);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=m)}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&"IDLE"===this.state&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=t,this.fragmentLoader=new GZ(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new fE(t.config)}registerListeners(){const{hls:t}=this;t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(_.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if("STOPPED"===this.state)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state="STOPPED"}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return-1===e&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const r=this.config.timelineOffset||0;if((t.end||0)<=r)return!1;const s=t.buffered;this.config.maxBufferHole&&s&&s.length>1&&(t=Ie.bufferedInfo(s,t.start,0));const o=t.nextStart;if(o&&o>r&&o<e.edge||this.media.currentTime<t.start)return!1;const l=e.partList;if(null!=l&&l.length){const u=l[l.length-1];return Ie.isBuffered(this.media,u.start+u.duration/2)}return this.fragmentTracker.isEndListAppended(e.fragments[e.fragments.length-1].type)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const t=this.config.timelineOffset;var e;return t?(null==(e=this.getLevelDetails())?void 0:e.appliedTimelineOffset)||t:0}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;Yn(i,"seeking",this.onMediaSeeking),Yn(i,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&"STOPPED"===this.state&&this.startLoad(r.startPosition)}onMediaDetaching(t,e){const i=!!e.transferMedia,r=this.media;if(null!==r){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ai(r,"seeking",this.onMediaSeeking),ai(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state="STOPPED",this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this.startFragRequested=!0,this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){this._doFragLoad(t,e,i,s=>{const o=s.frag;if(this.fragContextChanged(o))return this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(o);o.stats.chunkCount++,this._handleFragmentLoadProgress(s)}).then(s=>{if(!s)return;const o=this.state,a=s.frag;this.fragContextChanged(a)?("FRAG_LOADING"===o||!this.fragCurrent&&"PARSING"===o)&&(this.fragmentTracker.removeFragment(a),this.state="IDLE"):("payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(_.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s))}).catch(s=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if("APPENDING"===i.getState(t)){const o=this.getFwdBufferInfo(this.mediaBuffer,t.type),a=Math.max(t.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;(1==(l?t.sn-l.sn:0)||this.reduceMaxBufferLength(a,t.duration))&&i.removeFragment(t)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),"PARTIAL"===i.getState(t)&&i.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return e?.live&&"EVENT"!==e.type&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e,i=null){t-e&&this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:t,endOffset:e,type:i})}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{const r=i?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:s,payload:o}=i,a=s.decryptdata;if(o&&o.byteLength>0&&null!=a&&a.key&&a.iv&&ql(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,gE(a.method)).catch(c=>{throw r.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const u=self.performance.now();return r.trigger(_.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:l,tdecrypt:u}}),i.payload=c,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(i),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const i=t.frag.stats;"STOPPED"!==this.state&&(this.state="IDLE"),t.frag.data=new Uint8Array(t.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(t,e){var i,r;const s=t.tracks;if(s&&!e.encrypted&&(null!=(i=s.audio)&&i.encrypted||null!=(r=s.video)&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(e)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!(!o||o.mediaKeys||(this.hls.trigger(_.ERROR,{type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:e}),this.resetTransmuxer(),0))}return!1}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)} > buffer:${i?function(n){let t="";const e=n.length;for(let i=0;i<e;i++)t+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return t}(Ie.getBuffered(i)):"(detached)"})`),rn(t)){var r;if("subtitle"!==t.type){const o=t.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a]))return void(this.state="IDLE")}const s=null==(r=this.levels)?void 0:r[t.level];null!=s&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state="IDLE"}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:r,partsLoaded:s}=t,o=!s||0===s.length||s.some(l=>!l),a=new hE(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!o);e.flush(a)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,r){var s;this.fragCurrent=t;const o=e.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(!t.encrypted||null!=(s=t.decryptdata)&&s.key)t.encrypted||(a=this.keyLoader.loadClear(t,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log(`Loading key for ${t.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${t.level}`),this.state="KEY_LOADING",this.fragCurrent=t,a=this.keyLoader.load(t).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(_.KEY_LOADED,f),"KEY_LOADING"===this.state&&(this.state="IDLE"),f}),this.hls.trigger(_.KEY_LOADING,{frag:t}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const l=this.fragPrevious;if(rn(t)&&(!l||t.sn!==l.sn)){const f=this.shouldLoadParts(e.details,t.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l?.sn}->${t.sn}`),this.loadingParts=f)}if(i=Math.max(t.start,i||0),this.loadingParts&&rn(t)){const f=o.partList;if(f&&r){i>o.fragmentEnd&&o.fragmentHint&&(t=o.fragmentHint);const h=this.getNextPart(f,t,i);if(h>-1){const p=f[h];let g;return t=this.fragCurrent=p.fragment,this.log(`Loading ${t.type} sn: ${t.sn} part: ${p.index} (${h}/${f.length-1}) of ${this.fragInfo(t,!1,p)}) cc: ${t.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state="FRAG_LOADING",g=a?a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(t,p,e,r)).catch(m=>this.handleFragLoadError(m)):this.doFragPartsLoad(t,p,e,r).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(_.FRAG_LOADING,{frag:t,part:p,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}if(!t.url||this.loadedEndOfParts(f,i))return Promise.resolve(null)}}var c;if(rn(t)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${t.sn} loaded parts: ${null==(c=o.partList)?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log(`Loading ${t.type} sn: ${t.sn} of ${this.fragInfo(t,!1)}) cc: ${t.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),J(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state="FRAG_LOADING";const u=this.config.progressive;let d;return d=u&&a?a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(t,r)).catch(f=>this.handleFragLoadError(f)):Promise.all([this.fragmentLoader.load(t,u?r:void 0),a]).then(([f])=>(!u&&r&&r(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(_.FRAG_LOADING,{frag:t,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(t,e,i,r){return new Promise((s,o)=>{var a;const l=[],c=null==(a=i.details)?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(t,d,r).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(_.FRAG_LOADED,f);const p=pL(i.details,t.sn,d.index+1)||gL(c,t.sn,d.index+1);if(!p)return s({frag:t,part:h,partsLoaded:l});u(p)}).catch(o)};u(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;e.frag&&e.details===M.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):e.frag&&e.type===le.KEY_SYSTEM_ERROR?(e.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(e.frag)):this.hls.trigger(_.ERROR,e)}else this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||"PARSING"!==this.state)return void(!this.fragCurrent&&"STOPPED"!==this.state&&"ERROR"!==this.state&&(this.state="IDLE"));const{frag:i,part:r,level:s}=e,o=self.performance.now();i.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&i.sn>a.endSN||this.shouldLoadParts(a,i.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(i,r,s,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var i;const s=t.partList[0];if("subtitle"===s.fragment.type)return!1;var r;if(e>=s.end+((null==(i=t.fragmentHint)?void 0:i.duration)||0)&&(this.hls.hasEnoughToStart?(null==(r=this.media)?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:r,sn:s,part:o}=t;if(null==e||!e[r])return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=e[r],l=a.details,c=o>-1?pL(l,s,o):null,u=c?c.fragment:hL(l,s,i);return u?(i&&i!==u&&(u.stats=i.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(t,e,i,r,s){if("PARSING"!==this.state)return;const{data1:o,data2:a}=t;let l=o;if(a&&(l=Qi(o,a)),!l.length)return;const c=this.initPTS[e.cc];if(this.hls.trigger(_.BUFFER_APPENDING,{type:t.type,frag:e,part:i,chunkMeta:r,offset:c?-c.baseTime/c.timescale:void 0,parent:e.type,data:l}),t.dropped&&t.independent&&!i){if(s)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!Ie.isBuffered(e,e.currentTime))return void this.flushMainBuffer(0,t.start);const i=e.currentTime,r=Ie.bufferInfo(e,i,0),o=Math.min(2*this.config.maxFragLookUpTolerance,.25*t.duration),a=Math.max(Math.min(t.start-o,r.end-o),i+o);t.start-a>o&&this.flushMainBuffer(a,t.start)}getFwdBufferInfo(t,e){var i;const r=this.getLoadPosition();if(!J(r))return null;const o=this.lastCurrentTime>r||null!=(i=this.media)&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,r,e,o)}getFwdBufferInfoAtPos(t,e,i,r){const s=Ie.bufferInfo(t,e,r);if(0===s.len&&void 0!==s.nextStart){const o=this.fragmentTracker.getBufferedFrag(e,i);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-e,r);return Ie.bufferInfo(t,e,a)}}return s}getMaxBufferLength(t){const{config:e}=this;let i;return i=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const i=this.config,r=Math.max(Math.min(t-e,i.maxBufferLength),e),s=Math.max(t-3*e,i.maxMaxBufferLength/2,r);return s>=r&&(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0)}getAppendedFrag(t,e="main"){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(t,e){const i=e.fragments,r=i.length;if(!r)return null;const{config:s}=this,o=i[0].start,a=s.lowLatencyMode&&!!e.partList;let l=null;if(e.live){const d=s.initialLiveManifestSize;if(r<d)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${d})`),null;if(!e.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||t<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(e);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,p=l?(-1!==f&&f>=o?f:h)||l.start:t;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${null==(c=l)?void 0:c.start}`),this.startPosition=this.nextLoadPosition=p}}else t<=o&&(l=i[0]);l||(l=this.getFragmentAtPosition(t,this.loadingParts?e.partEnd:e.fragmentEnd,e));let u=this.filterReplacedPrimary(l,e);return!u&&l&&(u=this.filterReplacedPrimary(i[l.sn-e.startSN+1]||null,e)),this.mapToInitFragWhenRequired(u)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return("OK"===i||"PARTIAL"===i&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,r,s){let o=null;if(t.gap&&(o=this.getNextFragment(this.nextLoadPosition,e),o&&!o.gap&&i.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(null!==a&&i.len+a.len>=s){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){var t;return!(!EL(this.config)||!(null==(t=this.hls.interstitialsManager)||null==(t=t.playingItem)?void 0:t.event))}filterReplacedPrimary(t,e){if(!t)return t;if(EL(this.config)&&"subtitle"!==t.type){const i=this.hls.interstitialsManager,r=i?.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(t.start-r.start)>1||0===r.start)return null}else if(t.end<=r.start&&!1===e?.live||t.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||t.start-r.end>1))return null}const s=i?.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&t.start>=a.startTime&&t.end<=a.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return null==t||!t.initSegment||t.initSegment.data||this.bitrateTest?t:t.initSegment}getNextPart(t,e,i){let r=-1,s=!1,o=!0;for(let a=0,l=t.length;a<l;a++){const c=t[a];if(o=o&&!c.independent,r>-1&&i<c.start)break;const u=c.loaded;u?r=-1:(s||(c.independent||o)&&c.fragment===e)&&(c.fragment!==e&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${c.start}`),r=a),s=u}return r}loadedEndOfParts(t,e){let i;for(let r=t.length;r--;){if(i=t[r],!i.loaded)return!1;if(e>i.start)return!0}return!1}getInitialLiveFragment(t){const e=t.fragments,i=this.fragPrevious;let r=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=function NZ(n,t,e){if(null===t||!Array.isArray(n)||!n.length||!J(t))return null;if(t<(n[0].programDateTime||0))return null;if(t>=(n[n.length-1].endProgramDateTime||0))return null;for(let s=0;s<n.length;++s){const o=n[s];if(kZ(t,e,o))return o}return null}(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=t.startSN&&s<=t.endSN){const o=e[s-t.startSN];i.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=Mk(t,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;null!==s&&(r=this.getFragmentAtPosition(s,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r}getFragmentAtPosition(t,e,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=i;const{fragmentHint:l}=i,{maxFragLookUpTolerance:c}=r,u=i.partList,d=!!(this.loadingParts&&null!=u&&u.length&&l);let f;var h;(d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn),t<e)?f=ca(s,o,t,t<this.lastCurrentTime||t>e-c||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:c):f=o[o.length-1];if(f){const p=f.sn-i.startSN,g=this.fragmentTracker.getState(f);if(("OK"===g||"PARTIAL"===g&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||u[0].fragment.sn>f.sn||!i.live)&&f.level===s.level){const y=o[p+1];f=f.sn<a&&"OK"!==this.fragmentTracker.getState(y)?y:null}}return f}alignPlaylists(t,e,i){const r=t.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=t.fragmentStart,o=!e,a=t.alignedSliding&&J(s);if(o||!a&&!s){!function gJ(n,t){n&&(bL(t,n),t.alignedSliding||bg(t,n),!t.alignedSliding&&!t.skippedSegments&&dL(n,t,!1))}(i,t);const l=t.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)}setStartPosition(t,e){let i=this.startPosition;i<e&&(i=-1);const r=this.timelineOffset;if(-1===i){const s=null!==this.startTimeOffset,o=s?this.startTimeOffset:t.startTimeOffset;null!==o&&J(o)?(i=e+o,o<0&&(i+=t.edge),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):t.live?(i=this.hls.liveSyncPosition||e,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var t;const{media:e}=this;let i=0;return null!=(t=this.hls)&&t.hasEnoughToStart&&e?i=e.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&rn(t)&&t.stats.aborted&&(this.log(`Fragment ${t.sn}${e?" part "+e.index:""} of ${this.playlistLabel()} ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&"FRAG_LOADING_WAITING_RETRY"!==this.state)&&(this.state="IDLE")}onFragmentOrKeyLoadError(t,e){var i;if(e.chunkMeta&&!e.frag){const y=this.getCurrentContext(e.chunkMeta);y&&(e.frag=y.frag)}const r=e.frag;if(!r||r.type!==t||!this.levels)return;var s;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(s=this.fragCurrent)?void 0:s.url}`);const o=e.details===M.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=e.errorAction;if(!a)return void(this.state="ERROR");const{action:l,flags:c,retryCount:u=0,retryConfig:d}=a,f=!!d,h=f&&5===l,p=f&&!a.resolved&&1===c,g=null==(i=this.hls.latestLevelDetails)?void 0:i.live;if(!h&&p&&rn(r)&&!r.endList&&g&&!Ok(e))this.resetFragmentErrors(t),this.treatAsGap(r),a.resolved=!0;else if((h||p)&&u<d.maxNumRetry){var m;const y=dE(null==(m=e.response)?void 0:m.code),v=uE(d,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+v,this.state="FRAG_LOADING_WAITING_RETRY",a.resolved=!0,y)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(e.reason="offline");this.warn(`Fragment ${r.sn} of ${t} ${r.level} errored with ${e.details}, retrying loading ${u+1}/${d.maxNumRetry} in ${v}ms`)}else if(d){if(this.resetFragmentErrors(t),!(u<d.maxNumRetry))return void this.warn(`${e.details} reached or exceeded max retry (${u})`);!o&&3!==l&&(a.resolved=!0)}else this.state=2===l?"WAITING_LEVEL":"ERROR";this.tickImmediate()}checkRetryDate(){const t=self.performance.now(),e=this.retryDate,i=e===1/0;(!e||t>=e||i&&!dE(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state="IDLE")}reduceLengthAndFlushBuffer(t){if("PARSING"===this.state||"PARSED"===this.state){const e=t.frag,i=t.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,e?.duration||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(t){"audio"===t&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),"STOPPED"!==this.state&&(this.state="IDLE")}afterBufferFlushed(t,e,i){if(!t)return;const r=Ie.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,i),"ENDED"===this.state&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,"STOPPED"!==this.state&&(this.state="IDLE")}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=this.levelLastLoaded,e=t?t.details:null;null!=e&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.log(`Loading context changed while buffering sn ${t.sn} of ${this.playlistLabel()} ${-1===t.level?"<removed>":t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,r){const s=i.details;if(s){var a;if(!Object.keys(t.elementaryStreams).reduce((l,c)=>{const u=t.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${t.sn} ${c} duration reliably (${d})`),l||!1;const f=r?0:cL(s,t,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(_.LEVEL_PTS_UPDATED,{details:s,level:i,drift:f,type:c,frag:t,start:u.startPTS,end:u.endPTS}),!0}return l},!1)&&(0===i.fragmentError&&this.treatAsGap(t,i),null===(null==(a=this.transmuxer)?void 0:a.error))){const l=new Error(`Found no media in fragment ${t.sn} of ${this.playlistLabel()} ${t.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:t,reason:`Found no media in msn ${t.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state="PARSED",this.log(`Parsed ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)})`),this.hls.trigger(_.FRAG_PARSED,{frag:t,part:e})}else this.warn("level.details undefined")}playlistLabel(){return"main"===this.playlistType?"level":"track"}fragInfo(t,e=!0,i){var r,s;return`${this.playlistLabel()} ${t.level} (${i?"part":"frag"}:[${(null!=(r=e&&!i?t.startPTS:(i||t).start)?r:NaN).toFixed(3)}-${(null!=(s=e&&!i?t.endPTS:(i||t).end)?s:NaN).toFixed(3)}]${i&&"main"===t.type?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;null==(t=this.transmuxer)||t.reset()}recoverWorkerError(t){"demuxerWorker"===t.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function EL(n){return!!n.interstitialsController&&!1!==n.enableInterstitialPlayback}class DL{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;return t.length?(i=1===t.length?t[0]:function yJ(n,t){const e=new Uint8Array(t);let i=0;for(let r=0;r<n.length;r++){const s=n[r];e.set(s,i),i+=s.length}return e}(t,e),this.reset(),i):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var TL,SE={exports:{}},vJ=function _J(){return TL||(TL=1,function(n){var t=Object.prototype.hasOwnProperty,e="~";function i(){}function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,f){if("function"!=typeof u)throw new TypeError("The listener must be a function");var h=new r(u,d||l,f),p=e?e+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function o(l,c){0==--l._eventsCount?l._events=new i:delete l._events[c]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(e=!1)),a.prototype.eventNames=function(){var u,d,c=[];if(0===this._eventsCount)return c;for(d in u=this._events)t.call(u,d)&&c.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var d=this._events[e?e+c:c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},a.prototype.listenerCount=function(c){var d=this._events[e?e+c:c];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,f,h,p){var g=e?e+c:c;if(!this._events[g])return!1;var v,b,m=this._events[g],y=arguments.length;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,d),!0;case 4:return m.fn.call(m.context,u,d,f),!0;case 5:return m.fn.call(m.context,u,d,f,h),!0;case 6:return m.fn.call(m.context,u,d,f,h,p),!0}for(b=1,v=new Array(y-1);b<y;b++)v[b-1]=arguments[b];m.fn.apply(m.context,v)}else{var D,E=m.length;for(b=0;b<E;b++)switch(m[b].once&&this.removeListener(c,m[b].fn,void 0,!0),y){case 1:m[b].fn.call(m[b].context);break;case 2:m[b].fn.call(m[b].context,u);break;case 3:m[b].fn.call(m[b].context,u,d);break;case 4:m[b].fn.call(m[b].context,u,d,f);break;default:if(!v)for(D=1,v=new Array(y-1);D<y;D++)v[D-1]=arguments[D];m[b].fn.apply(m[b].context,v)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,f){var h=e?e+c:c;if(!this._events[h])return this;if(!u)return o(this,h),this;var p=this._events[h];if(p.fn)p.fn===u&&(!f||p.once)&&(!d||p.context===d)&&o(this,h);else{for(var g=0,m=[],y=p.length;g<y;g++)(p[g].fn!==u||f&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[h]=1===m.length?m[0]:m:o(this,h)}return this},a.prototype.removeAllListeners=function(c){var u;return c?this._events[u=e?e+c:c]&&o(this,u):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,n.exports=a}(SE)),SE.exports}(),CE=GX(vJ);const vd="1.6.14",Yl={};function SL(n,t){return t+10<=n.length&&51===n[t]&&68===n[t+1]&&73===n[t+2]&&n[t+3]<255&&n[t+4]<255&&n[t+6]<128&&n[t+7]<128&&n[t+8]<128&&n[t+9]<128}function IE(n,t){return t+10<=n.length&&73===n[t]&&68===n[t+1]&&51===n[t+2]&&n[t+3]<255&&n[t+4]<255&&n[t+6]<128&&n[t+7]<128&&n[t+8]<128&&n[t+9]<128}function Eg(n,t){let e=0;return e=(127&n[t])<<21,e|=(127&n[t+1])<<14,e|=(127&n[t+2])<<7,e|=127&n[t+3],e}function bd(n,t){const e=t;let i=0;for(;IE(n,t);)i+=10,i+=Eg(n,t+6),SL(n,t+10)&&(i+=10),t+=i;if(i>0)return n.subarray(e,e+i)}function CL(n,t){return 255===n[t]&&240==(246&n[t+1])}function IL(n,t){return 1&n[t+1]?7:9}function wE(n,t){return(3&n[t+3])<<11|n[t+4]<<3|(224&n[t+5])>>>5}function Dg(n,t){return t+1<n.length&&CL(n,t)}function wJ(n,t){if(Dg(n,t)){const e=IL(n,t);if(t+e>=n.length)return!1;const i=wE(n,t);if(i<=e)return!1;const r=t+i;return r===n.length||Dg(n,r)}return!1}function wL(n,t,e,i,r){if(!n.samplerate){const s=function SJ(n,t,e,i){const s=t[e+2],o=s>>2&15;if(o>12){const h=new Error(`invalid ADTS sampling index:${o}`);return void n.emit(_.ERROR,_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message})}const a=1+(s>>6&3),l=t[e+3]>>6&3|(1&s)<<2,c="mp4a.40."+a,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][o];let d=o;(5===a||29===a)&&(d-=3);const f=[a<<3|(14&d)>>1,(1&d)<<7|l<<3];return rt.log(`manifest codec:${i}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:i}}(t,e,i,r);if(!s)return;ut(n,s)}}function AL(n){return 9216e4/n}function xL(n,t,e,i,r){const o=i+r*AL(n.samplerate),a=function AJ(n,t){const e=IL(n,t);if(t+e<=n.length){const i=wE(n,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}(t,e);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,p=Math.max(0,e+h-t.length);p?(l=new Uint8Array(h-f),l.set(t.subarray(e+f,t.length),0)):l=t.subarray(e+f,e+h);const g={unit:l,pts:o};return p||n.samples.push(g),{sample:g,length:h,missing:p}}const c=t.length-e;return l=new Uint8Array(c),l.set(t.subarray(e,t.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function xJ(n,t){return IE(n,t)&&Eg(n,t+6)+10<=n.length-t}function AE(n,t=0,e=1/0){return function MJ(n,t,e,i){const r=function NJ(n){return n instanceof ArrayBuffer?n:n.buffer}(n);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const o=function OJ(n){return n&&n.buffer instanceof ArrayBuffer&&void 0!==n.byteLength&&void 0!==n.byteOffset}(n)?n.byteOffset:0,a=(o+n.byteLength)/s,c=Math.floor(Math.max(0,Math.min((o+t)/s,a)));return new i(r,c,Math.floor(Math.min(c+Math.max(e,0),a))-c)}(n,t,e,Uint8Array)}function BJ(n){return"PRIV"===n.type?function LJ(n){if(n.size<2)return;const t=Si(n.data,!0),e=new Uint8Array(n.data.subarray(t.length+1));return{key:n.type,info:t,data:e.buffer}}(n):"W"===n.type[0]?function FJ(n){if("WXXX"===n.type){if(n.size<2)return;let e=1;const i=Si(n.data.subarray(e),!0);e+=i.length+1;const r=Si(n.data.subarray(e));return{key:n.type,info:i,data:r}}const t=Si(n.data);return{key:n.type,info:"",data:t}}(n):"APIC"===n.type?function kJ(n){const t={key:n.type,description:"",data:"",mimeType:null,pictureType:null};if(n.size<2)return;if(3!==n.data[0])return void console.log("Ignore frame with unrecognized character encoding");const i=n.data.subarray(1).indexOf(0);if(-1===i)return;const r=Si(AE(n.data,1,i)),s=n.data[2+i],o=n.data.subarray(3+i).indexOf(0);if(-1===o)return;const a=Si(AE(n.data,3+i,o));let l;return l="--\x3e"===r?Si(AE(n.data,4+i+o)):function RJ(n){return n instanceof ArrayBuffer?n:0==n.byteOffset&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}(n.data.subarray(4+i+o)),t.mimeType=r,t.pictureType=s,t.description=a,t.data=l,t}(n):function PJ(n){if(n.size<2)return;if("TXXX"===n.type){let e=1;const i=Si(n.data.subarray(e),!0);e+=i.length+1;const r=Si(n.data.subarray(e));return{key:n.type,info:i,data:r}}const t=Si(n.data.subarray(1));return{key:n.type,info:"",data:t}}(n)}function UJ(n){const t=String.fromCharCode(n[0],n[1],n[2],n[3]),e=Eg(n,4);return{type:t,size:e,data:n.subarray(10,10+e)}}function RL(n){let t=0;const e=[];for(;IE(n,t);){const i=Eg(n,t+6);n[t+5]>>6&1&&(t+=10),t+=10;const r=t+i;for(;t+10<r;){const s=UJ(n.subarray(t)),o=BJ(s);o&&e.push(o),t+=s.size+10}SL(n,t)&&(t+=10)}return e}function ML(n){return n&&"PRIV"===n.key&&"com.apple.streaming.transportStreamTimestamp"===n.info}function VJ(n){if(8===n.data.byteLength){const t=new Uint8Array(n.data);let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,1&t[3]&&(i+=47721858.84),Math.round(i)}}function xE(n){const t=RL(n);for(let e=0;e<t.length;e++){const i=t[e];if(ML(i))return VJ(i)}}let Ii=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Kr(n="",t=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class RE{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=Qi(this.cachedData,t),this.cachedData=null);let s,i=bd(t,0),r=i?i.length:0;const o=this._audioTrack,a=this._id3Track,l=i?xE(i):void 0,c=t.length;for((null===this.basePTS||0===this.frameIndex&&J(l))&&(this.basePTS=jJ(l,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ii.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(t,r)){const u=this.appendFrame(o,t,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,s=r):r=c}else xJ(t,r)?(i=bd(t,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ii.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===c&&s!==c){const u=t.slice(s);this.cachedData=this.cachedData?Qi(this.cachedData,u):u}}return{audioTrack:o,videoTrack:Kr(),id3Track:a,textTrack:Kr()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Kr(),id3Track:this._id3Track,textTrack:Kr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const jJ=(n,t,e)=>J(n)?90*n:9e4*t+(e?9e4*e.baseTime/e.timescale:0);let Sg=null;const HJ=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],GJ=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],WJ=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],KJ=[0,1,1,4];function NL(n,t,e,i,r){if(e+24>t.length)return;const s=OL(t,e);if(s&&e+s.frameLength<=t.length){const a=i+r*(9e4*s.samplesPerFrame/s.sampleRate),l={unit:t.subarray(e,e+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function OL(n,t){const e=n[t+1]>>3&3,i=n[t+1]>>1&3,r=n[t+2]>>4&15,s=n[t+2]>>2&3;if(1!==e&&0!==r&&15!==r&&3!==s){const a=n[t+3]>>6,c=1e3*HJ[14*(3===e?3-i:3===i?3:4)+r-1],d=GJ[3*(3===e?0:2===e?1:2)+s],f=3===a?1:2,h=WJ[e][i],p=KJ[i],g=8*h*p,m=Math.floor(h*c/d+(n[t+2]>>1&1))*p;if(null===Sg){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Sg=b?parseInt(b[1]):0}return!!Sg&&Sg<=87&&2===i&&c>=224e3&&0===a&&(n[t+3]=128|n[t+3]),{sampleRate:d,channelCount:f,frameLength:m,samplesPerFrame:g}}}function ME(n,t){return!(255!==n[t]||224&~n[t+1]||!(6&n[t+1]))}function kL(n,t){return t+1<n.length&&ME(n,t)}function LL(n,t){if(t+1<n.length&&ME(n,t)){const i=OL(n,t);let r=4;null!=i&&i.frameLength&&(r=i.frameLength);const s=t+r;return s===n.length||kL(n,s)}return!1}const PL=(n,t)=>{let e=0,i=5;t+=i;const r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=n[t];const a=Math.min(i,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,e=e?e<<a|r[0]:r[0],t+=1,i-=a}return e};function FL(n,t,e,i,r){if(e+8>t.length||11!==t[e]||119!==t[e+1])return-1;const s=t[e+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=63&t[e+4],u=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*l+s];if(e+u>t.length)return-1;const d=t[e+6]>>5;let f=0;2===d?f+=2:(1&d&&1!==d&&(f+=2),4&d&&(f+=2));const h=(t[e+6]<<8|t[e+7])>>12-f&1,g=[2,1,2,3,3,4,4,5][d]+h,y=7&t[e+5],v=new Uint8Array([s<<6|t[e+5]>>3<<1|y>>2,(3&y)<<6|d<<3|h<<2|l>>4,l<<4&224]),E=i+r*(1536/a*9e4),D=t.subarray(e,e+u);return n.config=v,n.channelCount=g,n.samplerate=a,n.samples.push({unit:D,pts:E}),u}const XJ=/\/emsg[-/]ID3/i;function BL(n,t){return J(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale}class JJ{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new fE(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,0)}decryptAacSample(t,e,i){const r=t[e].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)}).catch(i)}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32||(this.decryptAacSample(t,e,i),this.decrypter.isSync())))return}}getAvcEncryptedData(t){const e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e);let r=0;for(let s=32;s<t.length-16;s+=160,r+=16)i.set(t.subarray(s,s+16),r);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let r=0;for(let s=32;s<t.length-16;s+=160,r+=16)t.set(i.subarray(r,r+16),s);return t}decryptAvcSample(t,e,i,r,s){const o=pk(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,r)}).catch(r)}decryptAvcSamples(t,e,i,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length)return void r();const s=t[e].units;for(;!(i>=s.length);i++){const o=s[i];if(!(o.data.length<=48||1!==o.type&&5!==o.type||(this.decryptAvcSample(t,e,i,r,o),this.decrypter.isSync())))return}}}}class UL{constructor(){this.VideoSample=null}createVideoSample(t,e,i){return{key:t,frame:!1,pts:e,dts:i,units:[],length:0}}getLastNalUnit(t){var e;let r,i=this.VideoSample;if((!i||0===i.units.length)&&(i=t[t.length-1]),null!=(e=i)&&e.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){const i=e.samples,r=i.length;if(!r)return void e.dropped++;{const s=i[r-1];t.pts=s.pts,t.dts=s.dts}}e.samples.push(t)}}parseNALu(t,e,i){const r=e.byteLength;let s=t.naluState||0;const o=s,a=[];let c,u,d,l=0,f=-1,h=0;for(-1===s&&(f=0,h=this.getNALuType(e,0),s=0,l=1);l<r;)if(c=e[l++],s)if(1!==s)if(c)if(1===c){if(u=l-s-1,f>=0){const p={data:e.subarray(f,u),type:h};a.push(p)}else{const p=this.getLastNalUnit(t.samples);p&&(o&&l<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),u>0&&(p.data=Qi(p.data,e.subarray(0,u)),p.state=0))}l<r?(d=this.getNALuType(e,l),f=l,h=d,s=0):s=-1}else s=0;else s=3;else s=c?0:2;else s=c?0:1;if(f>=0&&s>=0){const p={data:e.subarray(f,r),type:h,state:s};a.push(p)}if(0===a.length){const p=this.getLastNalUnit(t.samples);p&&(p.data=Qi(p.data,e))}return t.naluState=s,a}}class Ed{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,r=new Uint8Array(4),s=Math.min(4,e);if(0===s)throw new Error("no bytes available");r.set(t.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s}skipBits(t){let e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&rt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(this.word&2147483648>>>t)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class eee extends UL{parsePES(t,e,i,r){const s=this.parseNALu(t,i.data,r);let a,o=this.VideoSample,l=!1;i.data=null,o&&s.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(c=>{var u,d;switch(c.type){case 1:{let g=!1;a=!0;const m=c.data;if(l&&m.length>4){const y=this.readSliceType(m);(2===y||4===y||7===y||9===y)&&(g=!0)}var f;g&&null!=(f=o)&&f.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=g;break}case 5:a=!0,null!=(u=o)&&u.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:a=!0,rE(c.data,1,i.pts,e.samples);break;case 7:{var h,p;a=!0,l=!0;const g=c.data,m=this.readSPS(g);if(!t.sps||t.width!==m.width||t.height!==m.height||(null==(h=t.pixelRatio)?void 0:h[0])!==m.pixelRatio[0]||(null==(p=t.pixelRatio)?void 0:p[1])!==m.pixelRatio[1]){t.width=m.width,t.height=m.height,t.pixelRatio=m.pixelRatio,t.sps=[g];const y=g.subarray(1,4);let v="avc1.";for(let b=0;b<3;b++){let E=y[b].toString(16);E.length<2&&(E="0"+E),v+=E}t.codec=v}break}case 8:a=!0,t.pps=[c.data];break;case 9:a=!0,t.audFound=!0,null!=(d=o)&&d.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:a=!0;break;default:a=!1}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}getNALuType(t,e){return 31&t[e]}readSliceType(t){const e=new Ed(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let s,i=8,r=8;for(let o=0;o<t;o++)0!==r&&(s=e.readEG(),r=(i+s+256)%256),i=0===r?i:r}readSPS(t){const e=new Ed(t);let a,l,c,i=0,r=0,s=0,o=0;const u=e.readUByte.bind(e),d=e.readBits.bind(e),f=e.readUEG.bind(e),h=e.readBoolean.bind(e),p=e.skipBits.bind(e),g=e.skipEG.bind(e),m=e.skipUEG.bind(e),y=this.skipScalingList.bind(this);u();const v=u();if(d(5),p(3),u(),m(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const I=f();if(3===I&&p(1),m(),m(),p(1),h())for(l=3!==I?8:12,c=0;c<l;c++)h()&&y(c<6?16:64,e)}m();const b=f();if(0===b)f();else if(1===b)for(p(1),g(),g(),a=f(),c=0;c<a;c++)g();m(),p(1);const E=f(),D=f(),w=d(1);0===w&&p(1),p(1),h()&&(i=f(),r=f(),s=f(),o=f());let T=[1,1];if(h()&&h())switch(u()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil(16*(E+1)-2*i-2*r),height:(2-w)*(D+1)*16-(w?2:4)*(s+o),pixelRatio:T}}}class tee extends UL{constructor(...t){super(...t),this.initVPS=null}parsePES(t,e,i,r){const s=this.parseNALu(t,i.data,r);let a,o=this.VideoSample,l=!1;i.data=null,o&&s.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:var f;a=!0,l&&null!=(f=o)&&f.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,null!=(u=o)&&u.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,rE(c.data,2,i.pts,e.samples);break;case 32:a=!0,t.vps||("object"!=typeof t.params&&(t.params={}),t.params=ut(t.params,this.readVPS(c.data)),this.initVPS=c.data),t.vps=[c.data];break;case 33:if(a=!0,l=!0,void 0!==t.vps&&t.vps[0]!==this.initVPS&&void 0!==t.sps&&!this.matchSPS(t.sps[0],c.data)&&(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const h=this.readSPS(c.data);t.width=h.width,t.height=h.height,t.pixelRatio=h.pixelRatio,t.codec=h.codecString,t.sps=[],"object"!=typeof t.params&&(t.params={});for(const p in h.params)t.params[p]=h.params[p]}this.pushParameterSet(t.sps,c.data,t.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(a=!0,"object"==typeof t.params){if(!t.pps){t.pps=[];const h=this.readPPS(c.data);for(const p in h)t.params[p]=h[p]}this.pushParameterSet(t.pps,c.data,t.vps)}break;case 35:a=!0,t.audFound=!0,null!=(d=o)&&d.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:a=!1}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}pushParameterSet(t,e,i){(i&&i[0]===this.initVPS||!i&&!t.length)&&t.push(e)}getNALuType(t,e){return(126&t[e])>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let i=0;for(let r=0;r<t.byteLength;r++)r>=2&&3===t[r]&&0===t[r-1]&&0===t[r-2]||(e[i]=t[r],i++);return new Uint8Array(e.buffer,0,i)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new Ed(t);return e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6),{numTemporalLayers:e.readBits(3)+1,temporalIdNested:e.readBoolean()}}readSPS(t){const e=new Ed(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const i=e.readBits(3);e.readBoolean();const r=e.readBits(2),s=e.readBoolean(),o=e.readBits(5),a=e.readUByte(),l=e.readUByte(),c=e.readUByte(),u=e.readUByte(),d=e.readUByte(),f=e.readUByte(),h=e.readUByte(),p=e.readUByte(),g=e.readUByte(),m=e.readUByte(),y=e.readUByte(),v=[],b=[];for(let je=0;je<i;je++)v.push(e.readBoolean()),b.push(e.readBoolean());if(i>0)for(let je=i;je<8;je++)e.readBits(2);for(let je=0;je<i;je++)v[je]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),b[je]&&e.readUByte();e.readUEG();const E=e.readUEG();3==E&&e.skipBits(1);const D=e.readUEG(),w=e.readUEG(),T=e.readBoolean();let I=0,R=0,C=0,k=0;T&&(I+=e.readUEG(),R+=e.readUEG(),C+=e.readUEG(),k+=e.readUEG());const W=e.readUEG(),Y=e.readUEG(),te=e.readUEG();for(let je=e.readBoolean()?0:i;je<=i;je++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(let _n=0;_n<4;_n++)for(let di=0;di<(3===_n?2:6);di++)if(e.readBoolean()){const vn=Math.min(64,1<<4+(_n<<1));_n>1&&e.readEG();for(let Tr=0;Tr<vn;Tr++)e.readEG()}else e.readUEG();e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const Q=e.readUEG();let ne=0;for(let je=0;je<Q;je++){let _n=!1;if(0!==je&&(_n=e.readBoolean()),_n){je===Q&&e.readUEG(),e.readBoolean(),e.readUEG();let di=0;for(let Ms=0;Ms<=ne;Ms++){const vn=e.readBoolean();let Tr=!1;vn||(Tr=e.readBoolean()),(vn||Tr)&&di++}ne=di}else{const di=e.readUEG(),Ms=e.readUEG();ne=di+Ms;for(let vn=0;vn<di;vn++)e.readUEG(),e.readBoolean();for(let vn=0;vn<Ms;vn++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const je=e.readUEG();for(let _n=0;_n<je;_n++){for(let di=0;di<te+4;di++)e.readBits(1);e.readBits(1)}}let q=0,K=1,we=1,$e=!0,ve=1,Me=0;e.readBoolean(),e.readBoolean();let Yt=!1;if(e.readBoolean()){if(e.readBoolean()){const Zr=e.readUByte();Zr>0&&Zr<16?(K=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Zr-1],we=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Zr-1]):255===Zr&&(K=e.readBits(16),we=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),Yt=e.readBoolean(),Yt&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG()),e.readBoolean()&&(ve=e.readBits(32),Me=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){const ho=e.readBoolean(),Bd=e.readBoolean();let po=!1;(ho||Bd)&&(po=e.readBoolean(),po&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),po&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let Ud=0;Ud<=i;Ud++){$e=e.readBoolean();let I2=!1;$e||e.readBoolean()?e.readEG():I2=e.readBoolean();const w2=I2?1:e.readUEG()+1;if(ho)for(let $d=0;$d<w2;$d++)e.readUEG(),e.readUEG(),po&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(Bd)for(let $d=0;$d<w2;$d++)e.readUEG(),e.readUEG(),po&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),q=e.readUEG())}let Fn=D,Ji=w;if(T){let je=1,_n=1;1===E?je=_n=2:2==E&&(je=2),Fn=D-je*R-je*I,Ji=w-_n*k-_n*C}const Dr=r?["A","B","C"][r]:"",$D=a<<24|l<<16|c<<8|u;let dc=0;for(let je=0;je<32;je++)dc=(dc|($D>>je&1)<<31-je)>>>0;let Pd=dc.toString(16);return 1===o&&"2"===Pd&&(Pd="6"),{codecString:`hvc1.${Dr}${o}.${Pd}.${s?"H":"L"}${y}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[d,f,h,p,g,m],general_level_idc:y,bit_depth:W+8,bit_depth_luma_minus8:W,bit_depth_chroma_minus8:Y,min_spatial_segmentation_idc:q,chroma_format_idc:E,frame_rate:{fixed:$e,fps:Me/ve}},width:Fn,height:Ji,pixelRatio:[K,we]}}readPPS(t){const e=new Ed(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const r=e.readBoolean(),s=e.readBoolean();let o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const In=188;class lo{constructor(t,e,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(t,e){const i=lo.syncOffset(t);return i>0&&e.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),-1!==i}static syncOffset(t){const e=t.length;let i=Math.min(940,e-In)+1,r=0;for(;r<i;){let s=!1,o=-1,a=0;for(let l=r;l<e;l+=In){if(71!==t[l]||e-l!==In&&71!==t[l+In]){if(a)return-1;break}if(a++,-1===o&&(o=l,0!==o&&(i=Math.min(o+18612,t.length-In)+1)),s||(s=0===NE(t,l)),s&&a>1&&(0===o&&a>2||l+In>i))return o}r++}return-1}static createTrack(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:ok[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}}resetInitSegment(t,e,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=lo.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=lo.createTrack("audio",r),this._id3Track=lo.createTrack("id3"),this._txtTrack=lo.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,i=!1,r=!1){let s;i||(this.sampleAes=null);const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,f=a.pid,h=l.pid,p=a.pesData,g=l.pesData,m=null,y=this.pmtParsed,v=this._pmtId,b=t.length;if(this.remainderData&&(b=(t=Qi(this.remainderData,t)).length,this.remainderData=null),b<In&&!r)return this.remainderData=t,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const E=Math.max(0,lo.syncOffset(t));b-=(b-E)%In,b<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,b,t.buffer.byteLength-b));let D=0;for(let T=E;T<b;T+=In)if(71===t[T]){const I=!!(64&t[T+1]),R=NE(t,T);let k;if((48&t[T+3])>>4>1){if(k=T+5+t[T+4],k===T+In)continue}else k=T+4;switch(R){case u:I&&(d&&(s=Ql(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(o,c,s,!1)),d={data:[],size:0}),d&&(d.data.push(t.subarray(k,T+In)),d.size+=T+In-k);break;case f:if(I){if(p&&(s=Ql(p,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s)}p={data:[],size:0}}p&&(p.data.push(t.subarray(k,T+In)),p.size+=T+In-k);break;case h:I&&(g&&(s=Ql(g,this.logger))&&this.parseID3PES(l,s),g={data:[],size:0}),g&&(g.data.push(t.subarray(k,T+In)),g.size+=T+In-k);break;case 0:I&&(k+=t[k]+1),v=this._pmtId=nee(t,k);break;case v:{I&&(k+=t[k]+1);const W=iee(t,k,this.typeSupported,i,this.observer,this.logger);u=W.videoPid,u>0&&(o.pid=u,o.segmentCodec=W.segmentVideoCodec),f=W.audioPid,f>0&&(a.pid=f,a.segmentCodec=W.segmentAudioCodec),h=W.id3Pid,h>0&&(l.pid=h),null!==m&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${T} after unknown PID '${m}'. Backtracking to sync byte @${E} to parse all TS packets.`),m=null,T=E-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=R}}else D++;D>0&&OE(this.observer,new Error(`Found ${D} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=p,l.pesData=g;const w={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(w),w}flush(){const{remainderData:t}=this;let e;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:r,textTrack:s}=t,o=i.pesData,a=e.pesData,l=r.pesData;let c;if(o&&(c=Ql(o,this.logger))?(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(i,s,c,!0),i.pesData=null)):i.pesData=o,a&&(c=Ql(a,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,c);break;case"mp3":this.parseMPEGPES(e,c);break;case"ac3":this.parseAC3PES(e,c)}e.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=a;l&&(c=Ql(l,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(t,e,i){const r=this.demux(t,i,!0,!this.config.progressive),s=this.sampleAes=new JJ(this.observer,this.config,e);return this.decrypt(r,s)}readyVideoParser(t){null===this.videoParser&&("avc"===t?this.videoParser=new eee:"hevc"===t&&(this.videoParser=new tee))}decrypt(t,e){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=t;r.samples&&"aac"===r.segmentCodec?e.decryptAacSamples(r.samples,0,()=>{s.samples?e.decryptAvcSamples(s.samples,0,0,()=>{i(t)}):i(t)}):s.samples&&e.decryptAvcSamples(s.samples,0,0,()=>{i(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let i=0;const r=this.aacOverFlow;let o,a,l,s=e.data;if(r){this.aacOverFlow=null;const d=r.missing,f=r.sample.unit.byteLength;if(-1===d)s=Qi(r.sample.unit,s);else{const h=f-d;r.sample.unit.set(s.subarray(0,d),h),t.samples.push(r.sample),i=r.missing}}for(o=i,a=s.length;o<a-1&&!Dg(s,o);o++);if(o!==i){let d;const f=o<a-1;if(d=f?`AAC PES did not start with ADTS header,offset:${o}`:"No ADTS header found in AAC PES",OE(this.observer,new Error(d),f,this.logger),!f)return}if(wL(t,this.observer,s,o,this.audioCodec),void 0!==e.pts)l=e.pts;else{if(!r)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const d=AL(t.samplerate);l=r.sample.pts+d}}let u,c=0;for(;o<a;){if(u=xL(t,s,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}for(c++;o<a-1&&!Dg(s,o);o++);}}parseMPEGPES(t,e){const i=e.data,r=i.length;let s=0,o=0;const a=e.pts;if(void 0!==a)for(;o<r;)if(kL(i,o)){const l=NL(t,i,o,a,s);if(!l)break;o+=l.length,s++}else o++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(t,e){{const i=e.data,r=e.pts;if(void 0===r)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const s=i.length;let l,o=0,a=0;for(;a<s&&(l=FL(t,i,a,r,o++))>0;)a+=l}}parseID3PES(t,e){if(void 0===e.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const i=ut({},e,{type:this._videoTrack?Ii.emsg:Ii.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function NE(n,t){return((31&n[t+1])<<8)+n[t+2]}function nee(n,t){return(31&n[t+10])<<8|n[t+11]}function iee(n,t,e,i,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=t+3+((15&n[t+1])<<8|n[t+2])-4;for(t+=12+((15&n[t+10])<<8|n[t+11]);t<l;){const u=NE(n,t),d=(15&n[t+3])<<8|n[t+4];switch(n[t]){case 207:if(!i){kE("ADTS AAC",s);break}case 15:-1===o.audioPid&&(o.audioPid=u);break;case 21:-1===o.id3Pid&&(o.id3Pid=u);break;case 219:if(!i){kE("H.264",s);break}case 27:-1===o.videoPid&&(o.videoPid=u);break;case 3:case 4:e.mpeg||e.mp3?-1===o.audioPid&&(o.audioPid=u,o.segmentAudioCodec="mp3"):s.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){kE("AC-3",s);break}case 129:e.ac3?-1===o.audioPid&&(o.audioPid=u,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===o.audioPid&&d>0){let f=t+5,h=d;for(;h>2;){106===n[f]&&(!0!==e.ac3?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3"));const g=n[f+1]+2;f+=g,h-=g}}break;case 194:case 135:return OE(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:-1===o.videoPid&&(o.videoPid=u,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"))}t+=d+5}return o}function OE(n,t,e,i){i.warn(`parsing error: ${t.message}`),n.emit(_.ERROR,_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:t,reason:t.message})}function kE(n,t){t.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Ql(n,t){let i,r,s,o,a,e=0;const l=n.data;if(!n||0===n.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Qi(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>n.size-6)return null;const u=i[7];192&u&&(o=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,64&u?(a=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2,o-a>54e5&&(t.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=i[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let h=0,p=l.length;h<p;h++){i=l[h];let g=i.byteLength;if(d){if(d>g){d-=g;continue}i=i.subarray(d),g-=d,d=0}f.set(i,e),e+=g}return r&&(r-=s+3),{data:f,pts:o,dts:a,len:r}}return null}class ree{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const co=Math.pow(2,32)-1;let Xl=(()=>{class n{static init(){let e;for(e in n.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},n.types)n.types.hasOwnProperty(e)&&(n.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);n.HDLR_TYPES={video:i,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);n.STTS=n.STSC=n.STCO=o,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);n.FTYP=n.box(n.types.ftyp,a,c,a,l),n.DINF=n.box(n.types.dinf,n.box(n.types.dref,s))}static box(e,...i){let r=8,s=i.length;const o=s;for(;s--;)r+=i[s].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4),s=0,r=8;s<o;s++)a.set(i[s],r),r+=i[s].byteLength;return a}static hdlr(e){return n.box(n.types.hdlr,n.HDLR_TYPES[e])}static mdat(e){return n.box(n.types.mdat,e)}static mdhd(e,i){i*=e;const r=Math.floor(i/(co+1)),s=Math.floor(i%(co+1));return n.box(n.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))}static mdia(e){return n.box(n.types.mdia,n.mdhd(e.timescale||0,e.duration||0),n.hdlr(e.type),n.minf(e))}static mfhd(e){return n.box(n.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return n.box(n.types.minf,"audio"===e.type?n.box(n.types.smhd,n.SMHD):n.box(n.types.vmhd,n.VMHD),n.DINF,n.stbl(e))}static moof(e,i,r){return n.box(n.types.moof,n.mfhd(e),n.traf(r,i))}static moov(e){let i=e.length;const r=[];for(;i--;)r[i]=n.trak(e[i]);return n.box.apply(null,[n.types.moov,n.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(n.mvex(e)))}static mvex(e){let i=e.length;const r=[];for(;i--;)r[i]=n.trex(e[i]);return n.box.apply(null,[n.types.mvex,...r])}static mvhd(e,i){i*=e;const r=Math.floor(i/(co+1)),s=Math.floor(i%(co+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.box(n.types.mvhd,o)}static sdtp(e){const i=e.samples||[],r=new Uint8Array(4+i.length);let s,o;for(s=0;s<i.length;s++)o=i[s].flags,r[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return n.box(n.types.sdtp,r)}static stbl(e){return n.box(n.types.stbl,n.stsd(e),n.box(n.types.stts,n.STTS),n.box(n.types.stsc,n.STSC),n.box(n.types.stsz,n.STSZ),n.box(n.types.stco,n.STCO))}static avc1(e){let s,o,a,i=[],r=[];for(s=0;s<e.sps.length;s++)o=e.sps[s],a=o.byteLength,i.push(a>>>8&255),i.push(255&a),i=i.concat(Array.prototype.slice.call(o));for(s=0;s<e.pps.length;s++)o=e.pps[s],a=o.byteLength,r.push(a>>>8&255),r.push(255&a),r=r.concat(Array.prototype.slice.call(o));const l=n.box(n.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(r))),c=e.width,u=e.height,d=e.pixelRatio[0],f=e.pixelRatio[1];return n.box(n.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))}static esds(e){return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e.config,6,1,2])}static audioStsd(e){const i=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,i>>8&255,255&i,0,0])}static mp4a(e){return n.box(n.types.mp4a,n.audioStsd(e),n.box(n.types.esds,n.esds(e)))}static mp3(e){return n.box(n.types[".mp3"],n.audioStsd(e))}static ac3(e){return n.box(n.types["ac-3"],n.audioStsd(e),n.box(n.types.dac3,e.config))}static stsd(e){const{segmentCodec:i}=e;if("audio"===e.type){if("aac"===i)return n.box(n.types.stsd,n.STSD,n.mp4a(e));if("ac3"===i&&e.config)return n.box(n.types.stsd,n.STSD,n.ac3(e));if("mp3"===i&&"mp3"===e.codec)return n.box(n.types.stsd,n.STSD,n.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===i)return n.box(n.types.stsd,n.STSD,n.avc1(e));if("hevc"===i&&e.vps)return n.box(n.types.stsd,n.STSD,n.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${i}/${e.codec})`)}static tkhd(e){const i=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,o=e.height||0,a=Math.floor(r/(co+1)),l=Math.floor(r%(co+1));return n.box(n.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,o>>8&255,255&o,0,0]))}static traf(e,i){const r=n.sdtp(e),s=e.id,o=Math.floor(i/(co+1)),a=Math.floor(i%(co+1));return n.box(n.types.traf,n.box(n.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),n.box(n.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),n.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,n.box(n.types.trak,n.tkhd(e),n.mdia(e))}static trex(e){const i=e.id;return n.box(n.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,i){const r=e.samples||[],s=r.length,o=12+16*s,a=new Uint8Array(o);let l,c,u,d,f,h;for(a.set(["video"===e.type?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,(i+=8+o)>>>24&255,i>>>16&255,i>>>8&255,255&i],0),l=0;l<s;l++)c=r[l],u=c.duration,d=c.size,f=c.flags,h=c.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,d>>>24&255,d>>>16&255,d>>>8&255,255&d,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*l);return n.box(n.types.trun,a)}static initSegment(e){n.types||n.init();const i=n.moov(e);return Qi(n.FTYP,i)}static hvc1(e){const i=e.params,r=[e.vps,e.sps,e.pps],o=new Uint8Array([1,i.general_profile_space<<6|(i.general_tier_flag?32:0)|i.general_profile_idc,i.general_profile_compatibility_flags[0],i.general_profile_compatibility_flags[1],i.general_profile_compatibility_flags[2],i.general_profile_compatibility_flags[3],i.general_constraint_indicator_flags[0],i.general_constraint_indicator_flags[1],i.general_constraint_indicator_flags[2],i.general_constraint_indicator_flags[3],i.general_constraint_indicator_flags[4],i.general_constraint_indicator_flags[5],i.general_level_idc,240|i.min_spatial_segmentation_idc>>8,255&i.min_spatial_segmentation_idc,252|i.parallelismType,252|i.chroma_format_idc,248|i.bit_depth_luma_minus8,248|i.bit_depth_chroma_minus8,0,parseInt(i.frame_rate.fps),3|i.temporal_id_nested<<2|i.num_temporal_layers<<3|(i.frame_rate.fixed?64:0),r.length]);let a=o.length;for(let g=0;g<r.length;g+=1){a+=3;for(let m=0;m<r[g].length;m+=1)a+=2+r[g][m].length}const l=new Uint8Array(a);l.set(o,0),a=o.length;const c=r.length-1;for(let g=0;g<r.length;g+=1){l.set(new Uint8Array([32+g|(g===c?128:0),0,r[g].length]),a),a+=3;for(let m=0;m<r[g].length;m+=1)l.set(new Uint8Array([r[g][m].length>>8,255&r[g][m].length]),a),a+=2,l.set(r[g][m],a),a+=r[g][m].length}const u=n.box(n.types.hvcC,l),d=e.width,f=e.height,h=e.pixelRatio[0],p=e.pixelRatio[1];return n.box(n.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,f>>8&255,255&f,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,p>>24,p>>16&255,p>>8&255,255&p])))}}return n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,n})();function LE(n,t,e=1,i=!1){const r=n*t*e;return i?Math.round(r):r}function Dd(n,t=!1){return LE(n,1e3,1/9e4,t)}function VL(n){const{baseTime:t,timescale:e,trackId:i}=n;return`${t/e} (${t}/${e}) trackId: ${i}`}let ws,Zl=null,PE=null;function jL(n,t,e,i){return{duration:t,size:e,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Cg extends Yi{constructor(t,e,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,null===Zl){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zl=o?parseInt(o[1]):0}if(null===PE){const s=navigator.userAgent.match(/Safari\/(\d+)/i);PE=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){const e=this._initPTS;(!e||!t||t.trackId!==e.trackId||t.baseTime!==e.baseTime||t.timescale!==e.timescale)&&this.log(`Reset initPTS: ${e&&VL(e)} > ${t&&VL(t)}`),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const i=t[0].pts,r=t.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(e=!0,a=wi(a,i),l=a-s),l>0?s:a},i);return e&&this.debug("PTS rollover detected"),r}remux(t,e,i,r,s,o,a,l){let c,u,d,f,h,p,g=s,m=s;const v=e.pid>-1,b=e.samples.length,E=t.samples.length>0,D=a&&b>0||b>1;if((!(t.pid>-1)||E)&&(!v||D)||this.ISGenerated||a){if(this.ISGenerated){var T,I,R,C;const te=this.videoTrackConfig;(te&&(e.width!==te.width||e.height!==te.height||(null==(T=e.pixelRatio)?void 0:T[0])!==(null==(I=te.pixelRatio)?void 0:I[0])||(null==(R=e.pixelRatio)?void 0:R[1])!==(null==(C=te.pixelRatio)?void 0:C[1]))||!te&&D||null===this.nextAudioTs&&E)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(t,e,s,o));const k=this.isVideoContiguous;let Y,W=-1;if(D&&(W=function dee(n){for(let t=0;t<n.length;t++)if(n[t].key)return t;return-1}(e.samples),!k&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,W>0){this.warn(`Dropped ${W} out of ${b} video samples due to a missing keyframe`);const te=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(W),e.dropped+=W,m+=(e.samples[0].pts-te)/e.inputTimeScale,Y=m}else-1===W&&(this.warn(`No keyframe found out of ${b} video samples`),p=!1);if(this.ISGenerated){if(E&&D){const te=this.getVideoStartPts(e.samples),V=(wi(t.samples[0].pts,te)-te)/e.inputTimeScale;g+=Math.max(0,V),m+=Math.max(0,-V)}if(E){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(t,e,s,o)),u=this.remuxAudio(t,g,this.isAudioContiguous,o,v||D||"audio"===l?m:void 0),D){const te=u?u.endPTS-u.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(t,e,s,o)),c=this.remuxVideo(e,m,k,te)}}else D&&(c=this.remuxVideo(e,m,k,0));c&&(c.firstKeyFrame=W,c.independent=-1!==W,c.firstKeyFramePTS=Y)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(h=HL(i,s,this._initPTS,this._initDTS)),r.samples.length&&(f=GL(r,s,this._initPTS))),{audio:u,video:c,initSegment:d,independent:p,text:f,id3:h}}computeInitPts(t,e,i,r){const s=Math.round(i*e);let o=wi(t,s);if(o<s+e)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/e} ${r}`);o<s+e;)o+=8589934592;return o-s}generateIS(t,e,i,r){const s=t.samples,o=e.samples,a=this.typeSupported,l={},c=this._initPTS;let f,h,p,u=!c||r,d="audio/mp4",g=-1;if(u&&(f=h=1/0),t.config&&s.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",t.codec=""):a.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}l.audio={id:"audio",container:d,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&a.mpeg?new Uint8Array(0):Xl.initSegment([t]),metadata:{channelCount:t.channelCount}},u&&(g=t.id,p=t.inputTimeScale,c&&p===c.timescale?u=!1:f=h=this.computeInitPts(s[0].pts,p,i,"audio"))}if(e.sps&&e.pps&&o.length){if(e.timescale=e.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Xl.initSegment([e]),metadata:{width:e.width,height:e.height}},u)if(g=e.id,p=e.inputTimeScale,c&&p===c.timescale)u=!1;else{const m=this.getVideoStartPts(o),y=wi(o[0].dts,m),v=this.computeInitPts(y,p,i,"video"),b=this.computeInitPts(m,p,i,"video");h=Math.min(h,v),f=Math.min(f,b)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${f/p} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${f/p} (${f}/${p}) trackId: ${g}`),this._initPTS={baseTime:f,timescale:p,trackId:g},this._initDTS={baseTime:h,timescale:p,trackId:g}):f=p=void 0,{tracks:l,initPTS:f,timescale:p,trackId:g}}remuxVideo(t,e,i,r){const s=t.inputTimeScale,o=t.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*s/c.timescale;let p,g,d=this.nextVideoTs,f=8,h=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,v=!1;if(!i||null===d){const q=u+e*s,K=o[0].pts-wi(o[0].dts,o[0].pts);Zl&&null!==d&&Math.abs(q-K-(d+u))<15e3?i=!0:d=q-K-u}const b=d+u;for(let q=0;q<l;q++){const K=o[q];K.pts=wi(K.pts,b),K.dts=wi(K.dts,b),K.dts<o[q>0?q-1:q].dts&&(v=!0)}v&&o.sort(function(q,K){return q.dts-K.dts||q.pts-K.pts}),p=o[0].dts,g=o[o.length-1].dts;const E=g-p,D=E?Math.round(E/(l-1)):h||t.inputTimeScale/30;if(i){const q=p-b,K=q>D,we=q<-1;if((K||we)&&(this.warn(K?`${(t.segmentCodec||"").toUpperCase()}: ${Dd(q,!0)} ms (${q}dts) hole between fragments detected at ${e.toFixed(3)}`:`${(t.segmentCodec||"").toUpperCase()}: ${Dd(-q,!0)} ms (${q}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!we||b>=o[0].pts||Zl)){p=b;const $e=o[0].pts-q;if(K)o[0].dts=p,o[0].pts=$e;else{let ve=!0;for(let Me=0;Me<o.length&&!(o[Me].dts>$e&&ve);Me++){const Yt=o[Me].pts;if(o[Me].dts-=q,o[Me].pts-=q,Me<o.length-1){const wt=o[Me+1].pts;ve=wt<=o[Me].pts==wt<=Yt}}}this.log(`Video: Initial PTS/DTS adjusted: ${Dd($e,!0)}/${Dd(p,!0)}, delta: ${Dd(q,!0)} ms`)}}p=Math.max(0,p);let w=0,T=0,I=p;for(let q=0;q<l;q++){const K=o[q],we=K.units,$e=we.length;let ve=0;for(let Me=0;Me<$e;Me++)ve+=we[Me].data.length;T+=ve,w+=$e,K.length=ve,K.dts<I?(K.dts=I,I+=D/4|0||1):I=K.dts,m=Math.min(K.pts,m),y=Math.max(K.pts,y)}g=o[l-1].dts;const R=T+4*w+8;let C;try{C=new Uint8Array(R)}catch(q){return void this.observer.emit(_.ERROR,_.ERROR,{type:le.MUX_ERROR,details:M.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:R,reason:`fail allocating video mdat ${R}`})}const k=new DataView(C.buffer);k.setUint32(0,R),C.set(Xl.types.mdat,4);let W=!1,Y=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY;for(let q=0;q<l;q++){const K=o[q],we=K.units;let ve,$e=0;for(let Yt=0,wt=we.length;Yt<wt;Yt++){const Fn=we[Yt],Ji=Fn.data,Dr=Fn.data.byteLength;k.setUint32(f,Dr),f+=4,C.set(Ji,f),f+=Dr,$e+=4+Dr}if(q<l-1)h=o[q+1].dts-K.dts,ve=o[q+1].pts-K.pts;else{const Yt=this.config,wt=q>0?K.dts-o[q-1].dts:D;if(ve=q>0?K.pts-o[q-1].pts:D,Yt.stretchShortVideoTrack&&null!==this.nextAudioTs){const Fn=Math.floor(Yt.maxBufferHole*s),Ji=(r?m+r*s:this.nextAudioTs+u)-K.pts;Ji>Fn?(h=Ji-wt,h<0?h=wt:W=!0,this.log(`It is approximately ${Ji/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=wt}else h=wt}const Me=Math.round(K.pts-K.dts);Y=Math.min(Y,h),ee=Math.max(ee,h),te=Math.min(te,ve),V=Math.max(V,ve),a.push(jL(K.key,h,$e,Me))}if(a.length)if(Zl){if(Zl<70){const q=a[0].flags;q.dependsOn=2,q.isNonSync=0}}else if(PE&&V-te<ee-Y&&D/ee<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let q=p;for(let K=0,we=a.length;K<we;K++){const $e=q+a[K].duration;a[K].duration=K<we-1?$e+a[K+1].cts-(q+a[K].cts):K?a[K-1].duration:D,a[K].cts=0,q=$e}}h=W||!h?D:h,this.nextVideoTs=d=g+h-u,this.videoSampleDuration=h,this.isVideoContiguous=!0;const he={data1:Xl.moof(t.sequenceNumber++,p,ut(t,{samples:a})),data2:C,startPTS:(m-u)/s,endPTS:(y+h-u)/s,startDTS:(p-u)/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:t.dropped};return t.samples=[],t.dropped=0,he}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(t,e,i,r,s){const o=t.inputTimeScale,l=o/(t.samplerate?t.samplerate:o),c=this.getSamplesPerFrame(t),u=c*l,d=this._initPTS,f="mp3"===t.segmentCodec&&this.typeSupported.mpeg,h=[],p=void 0!==s;let g=t.samples,m=f?0:8,y=this.nextAudioTs||-1;const v=d.baseTime*o/d.timescale,b=v+e*o;if(this.isAudioContiguous=i=i||g.length&&y>0&&(r&&Math.abs(b-(y+v))<9e3||Math.abs(wi(g[0].pts,b)-(y+v))<20*u),g.forEach(function(V){V.pts=wi(V.pts,b)}),!i||y<0){const V=g.length;if(g=g.filter(Z=>Z.pts>=0),V!==g.length&&this.warn(`Removed ${g.length-V} of ${V} samples (initPTS ${v} / ${o})`),!g.length)return;y=0===s?0:r&&!p?Math.max(0,b-v):g[0].pts-v}if("aac"===t.segmentCodec){const V=this.config.maxAudioFramesDrift;for(let Z=0,Q=y+v;Z<g.length;Z++){const ne=g[Z],he=ne.pts,q=he-Q,K=Math.abs(1e3*q/o);if(q<=-V*u&&p)0===Z&&(this.warn(`Audio frame @ ${(he/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*q/o)} ms.`),this.nextAudioTs=y=he-v,Q=he);else if(q>=V*u&&K<1e4&&p){let we=Math.round(q/u);for(Q=he-we*u;Q<0&&we&&u;)we--,Q+=u;0===Z&&(this.nextAudioTs=y=Q-v),this.warn(`Injecting ${we} audio frames @ ${((Q-v)/o).toFixed(3)}s due to ${Math.round(1e3*q/o)} ms gap.`);for(let $e=0;$e<we;$e++){let ve=ree.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);ve||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ve=ne.unit.subarray()),g.splice(Z,0,{unit:ve,pts:Q}),Q+=u,Z++}}ne.pts=Q,Q+=u}}let w,E=null,D=null,T=0,I=g.length;for(;I--;)T+=g[I].unit.byteLength;for(let V=0,Z=g.length;V<Z;V++){const Q=g[V],ne=Q.unit;let he=Q.pts;if(null!==D)h[V-1].duration=Math.round((he-D)/l);else{if(i&&"aac"===t.segmentCodec&&(he=y+v),E=he,!(T>0))return;T+=m;try{w=new Uint8Array(T)}catch(K){return void this.observer.emit(_.ERROR,_.ERROR,{type:le.MUX_ERROR,details:M.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:T,reason:`fail allocating audio mdat ${T}`})}f||(new DataView(w.buffer).setUint32(0,T),w.set(Xl.types.mdat,4))}w.set(ne,m);const q=ne.byteLength;m+=q,h.push(jL(!0,c,q,0)),D=he}const R=h.length;if(!R)return;y=D-v,this.nextAudioTs=y+l*h[h.length-1].duration;const k=f?new Uint8Array(0):Xl.moof(t.sequenceNumber++,E/l,ut({},t,{samples:h}));t.samples=[];const W=(E-v)/o,Y=y/o,ee={data1:k,data2:w,startPTS:W,endPTS:Y,startDTS:W,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,ee}}function wi(n,t){let e;if(null===t)return n;for(e=t<n?-8589934592:8589934592;Math.abs(n-t)>4294967296;)n+=e;return n}function HL(n,t,e,i){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let a=0;a<r;a++){const l=n.samples[a];l.pts=wi(l.pts-e.baseTime*s/e.timescale,t*s)/s,l.dts=wi(l.dts-i.baseTime*s/i.timescale,t*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function GL(n,t,e){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let o=0;o<i;o++){const a=n.samples[o];a.pts=wi(a.pts-e.baseTime*r/e.timescale,t*r)/r}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}function Ig(n,t,e=!1){return void 0!==n?.start?(n.start+(e?n.duration:0))/n.timescale:t}function WL(n,t,e){const i=n.codec;return i&&i.length>4?i:"audio"===t?"ec-3"===i||"ac-3"===i||"alac"===i?i:"fLaC"===i||"Opus"===i?ag(i,!1):(e.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(e.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}try{ws=self.performance.now.bind(self.performance)}catch{ws=Date.now}const wg=[{demux:class ZJ{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,r){const s=this.videoTrack=Kr("video",1),o=this.audioTrack=Kr("audio",1),a=this.txtTrack=Kr("text",1);if(this.id3Track=Kr("id3",1),this.timeOffset=0,null==t||!t.byteLength)return;const l=uk(t);if(l.video){const{id:c,timescale:u,codec:d,supplemental:f}=l.video;s.id=c,s.timescale=a.timescale=u,s.codec=d,s.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=ok.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(t){return function YX(n){const t=n.byteLength;for(let e=0;e<t;){const i=De(n,e);if(i>8&&109===n[e+4]&&111===n[e+5]&&111===n[e+6]&&102===n[e+7])return!0;e=i>1?e+i:t}return!1}(t)}demux(t,e){this.timeOffset=e;let i=t;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Qi(this.remainderData,t));const a=function nZ(n){const t={valid:null,remainder:null},e=Fe(n,["moof"]);if(e.length<2)return t.remainder=n,t;const i=e[e.length-1];return t.valid=n.slice(0,i.byteOffset-8),t.remainder=n.slice(i.byteOffset-8),t}(i);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=i;const o=this.extractID3Track(r,e);return s.samples=hk(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(e,this.timeOffset);return i.samples=hk(t,e),{videoTrack:e,audioTrack:Kr(),id3Track:r,textTrack:Kr()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const r=Fe(t.samples,["emsg"]);r&&r.forEach(s=>{const o=function rZ(n){const t=n[0];let e="",i="",r=0,s=0,o=0,a=0,l=0,c=0;if(0===t){for(;"\0"!==mn(n.subarray(c,c+1));)e+=mn(n.subarray(c,c+1)),c+=1;for(e+=mn(n.subarray(c,c+1)),c+=1;"\0"!==mn(n.subarray(c,c+1));)i+=mn(n.subarray(c,c+1)),c+=1;i+=mn(n.subarray(c,c+1)),c+=1,r=De(n,12),s=De(n,16),a=De(n,20),l=De(n,24),c=28}else if(1===t){c+=4,r=De(n,c),c+=4;const d=De(n,c);c+=4;const f=De(n,c);for(c+=4,o=2**32*d+f,kX(o)||(o=Number.MAX_SAFE_INTEGER,rt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=De(n,c),c+=4,l=De(n,c),c+=4;"\0"!==mn(n.subarray(c,c+1));)e+=mn(n.subarray(c,c+1)),c+=1;for(e+=mn(n.subarray(c,c+1)),c+=1;"\0"!==mn(n.subarray(c,c+1));)i+=mn(n.subarray(c,c+1)),c+=1;i+=mn(n.subarray(c,c+1)),c+=1}return{schemeIdUri:e,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:n.subarray(c,n.byteLength)}}(s);if(XJ.test(o.schemeIdUri)){const a=BL(o,e);let l=4294967295===o.eventDuration?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;i.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Ii.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=BL(o,e);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Ii.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class fee extends Yi{constructor(t,e,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(t){this.lastEndTime=null;const e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,i,r){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(t,r),this.emitInitSegment=!0}generateInitSegment(t,e){let{audioCodec:i,videoCodec:r}=this;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:s,video:o}=this.initData=uk(t);if(e)!function JX(n,t){if(!n||!t)return;const e=t.keyId;e&&t.isCommonEncryption&&dk(n,(i,r)=>{const s=i.subarray(8,24);s.some(o=>0!==o)||(rt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${qn(s)} -> ${qn(e)}`),i.set(e,8))})}(t,e);else{const l=s||o;null!=l&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(i=WL(s,"audio",this)),o&&(r=WL(o,"video",this));const a={};s&&o?a.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:s?a.audio={container:"audio/mp4",codec:i,encrypted:s.encrypted,initSegment:t,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(t,e,i,r,s,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};J(u)||(u=this.lastEndTime=s||0);const f=e.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if(null!=(a=p)&&a.length||(this.generateInitSegment(f),p=this.initData),null==(l=p)||!l.length)return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=function tZ(n,t,e){const i={},r=Fe(n,["moof","traf"]);for(let s=0;s<r.length;s++){const o=r[s],a=Fe(o,["tfhd"])[0],l=De(a,4),c=t[l];if(!c)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=i[l],d=Fe(o,["tfdt"])[0];if(d){const b=d[0];let E=De(d,4);1===b&&(E===sk?e.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(E*=sk+1,E+=De(d,8))),J(E)&&(!J(u.start)||E<u.start)&&(u.start=E)}const f=c.default,h=De(a,0)|f?.flags;let p=f?.duration||0;8&h&&(p=De(a,2&h?12:8));const g=Fe(o,["trun"]);let m=u.start||0,y=0,v=p;for(let b=0;b<g.length;b++){const E=g[b],D=De(E,4),w=u.sampleCount;u.sampleCount+=D;const R=1&E[2],C=2&E[2],k=4&E[2],W=8&E[2];let Y=8,te=D;for(1&E[3]&&(Y+=4),4&E[3]&&D&&(!(1&E[Y+1])&&void 0===u.keyFrameIndex&&(u.keyFrameIndex=w),Y+=4,R?(v=De(E,Y),Y+=4):v=p,C&&(Y+=4),W&&(Y+=4),m+=v,y+=v,te--);te--;)R?(v=De(E,Y),Y+=4):v=p,C&&(Y+=4),k&&(1&E[Y+1]||void 0===u.keyFrameIndex&&(u.keyFrameIndex=u.sampleCount-(te+1),u.keyFrameStart=m),Y+=4),W&&(Y+=4),m+=v,y+=v;!y&&p&&(y+=p*D)}u.duration+=y}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,o=0;const a=Fe(n,["sidx"]);for(let l=0;l<a.length;l++){const c=QX(a[l]);if(null!=c&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,f)=>d+f.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&J(o)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=o*i[l].timescale-i[l].start)})}return i}(f,p,this),m=p.audio?g[p.audio.id]:null,y=p.video?g[p.video.id]:null,v=Ig(y,1/0),b=Ig(m,1/0),E=Ig(y,0,!0),D=Ig(m,0,!0);let w=s,T=0;const I=m&&(!y||!c&&b<v||c&&c.trackId===p.audio.id),R=I?m:y;if(R){const Q=R.timescale,ne=R.start-s*Q,he=I?p.audio.id:p.video.id;w=R.start/Q,T=I?D-b:E-v,(o||!c)&&(function hee(n,t,e,i){if(null===n)return!0;const r=Math.max(i,1);return Math.abs(t-n.baseTime/n.timescale-e)>r}(c,w,s,T)||Q!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${ne/Q} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${w-s} (${ne}/${Q}) trackId: ${he}`),c=null,h.initPTS=ne,h.timescale=Q,h.trackId=he)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(h.initPTS=c.baseTime,h.timescale=c.timescale,h.trackId=c.trackId):((!h.timescale||void 0===h.trackId||void 0===h.initPTS)&&(this.warn("Could not set initPTS"),h.initPTS=w,h.timescale=1,h.trackId=-1),this.initPTS=c={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const C=w-c.baseTime/c.timescale,k=C+T;T>0?this.lastEndTime=k:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const W=!!p.audio,Y=!!p.video;let te="";W&&(te+="audio"),Y&&(te+="video");const V={data1:f,startPTS:C,startDTS:C,endPTS:k,endDTS:k,type:te,hasAudio:W,hasVideo:Y,nb:1,dropped:0,encrypted:!!p.audio&&p.audio.encrypted||!!p.video&&p.video.encrypted};d.audio=W&&!Y?V:void 0,d.video=Y?V:void 0;const Z=y?.sampleCount;if(Z){const Q=y.keyFrameIndex,ne=-1!==Q;V.nb=Z,V.dropped=0===Q||this.isVideoContiguous?0:ne?Q:Z,V.independent=ne,V.firstKeyFrame=Q,ne&&y.keyFrameStart&&(V.firstKeyFramePTS=(y.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=ne),this.isVideoContiguous||(this.isVideoContiguous=ne),V.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Q}/${Z} dropped: ${V.dropped} start: ${V.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=HL(i,s,c,c),r.samples.length&&(d.text=GL(r,s,c)),d}}},{demux:lo,remux:Cg},{demux:class qJ extends RE{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,r){super.resetInitSegment(t,e,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const i=bd(t,0);let r=i?.length||0;if(LL(t,r))return!1;for(let s=t.length;r<s;r++)if(wJ(t,r))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return function IJ(n,t){return function CJ(n,t){return t+5<n.length}(n,t)&&CL(n,t)&&wE(n,t)<=n.length-t}(t,e)}appendFrame(t,e,i){wL(t,this.observer,e,i,t.manifestCodec);const r=xL(t,e,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:Cg},{demux:class QJ extends RE{resetInitSegment(t,e,i,r){super.resetInitSegment(t,e,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=bd(t,0);let i=e?.length||0;if(e&&11===t[i]&&119===t[i+1]&&void 0!==xE(e)&&PL(t,i)<=16)return!1;for(let r=t.length;i<r;i++)if(LL(t,i))return rt.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return function zJ(n,t){return ME(n,t)&&4<=n.length-t}(t,e)}appendFrame(t,e,i){if(null!==this.basePTS)return NL(t,e,i,this.basePTS,this.frameIndex)}},remux:Cg}];wg.splice(2,0,{demux:class YJ extends RE{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,i,r){super.resetInitSegment(t,e,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,i){const r=FL(t,e,i,this.basePTS,this.frameIndex);if(-1!==r)return{sample:t.samples[t.samples.length-1],length:r,missing:0}}static probe(t){if(!t)return!1;const e=bd(t,0);if(!e)return!1;const i=e.length;return 11===t[i]&&119===t[i+1]&&void 0!==xE(e)&&PL(t,i)<16}},remux:Cg});class KL{constructor(t,e,i,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.id=s,this.logger=o}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,r){const s=i.transmuxing;s.executeStart=ws();let o=new Uint8Array(t);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=r||a,{audioCodec:g,videoCodec:m,defaultInitPts:y,duration:v,initSegmentData:b}=l,E=function pee(n,t){let e=null;return n.byteLength>0&&null!=t?.key&&null!==t.iv&&null!=t.method&&(e=t),e}(o,e);if(E&&ql(E.method)){const I=this.getDecrypter(),R=gE(E.method);if(!I.isSync())return this.asyncResult=!0,this.decryptionPromise=I.webCryptoDecrypt(o,E.key.buffer,E.iv.buffer,R).then(C=>{const k=this.push(C,null,i);return this.decryptionPromise=null,k}),this.decryptionPromise;{let C=I.softwareDecrypt(o,E.key.buffer,E.iv.buffer,R);if(i.part>-1){const W=I.flush();C=W&&W.buffer}if(!C)return s.executeEnd=ws(),FE(i);o=new Uint8Array(C)}}const D=this.needsProbing(u,d);if(D){const I=this.configureTransmuxer(o);if(I)return this.logger.warn(`[transmuxer] ${I.message}`),this.observer.emit(_.ERROR,_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),s.executeEnd=ws(),FE(i)}(u||d||p||D)&&this.resetInitSegment(b,g,m,v,e),(u||p||D)&&this.resetInitialTimestamp(y),c||this.resetContiguity();const w=this.transmux(o,E,h,f,i);this.asyncResult=Td(w);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,s.executeEnd=ws(),w}flush(t){const e=t.transmuxing;e.executeStart=ws();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(t));const o=[],{timeOffset:a}=r;if(i){const d=i.flush();d&&o.push(this.push(d.buffer,null,t))}const{demuxer:l,remuxer:c}=this;if(!l||!c){e.executeEnd=ws();const d=[FE(t)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(a);return Td(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(o,d,t),o))):(this.flushRemux(o,u,t),this.asyncResult?Promise.resolve(o):o)}flushRemux(t,e,i){const{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=e,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${"main"===this.id?"level":"track"} ${i.level}`);const u=this.remuxer.remux(r,s,o,a,c,l,!0,this.id);t.push({remuxResult:u,chunkMeta:i}),i.transmuxing.executeEnd=ws()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,r,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(t,e,i,r),a.resetInitSegment(t,e,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,r,s){let o;return o=e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,i,r,s):this.transmuxUnencrypted(t,i,r,s),o}transmuxUnencrypted(t,e,i,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,e,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(t,e,i,r,s){return this.demuxer.demuxSampleAes(t,e,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:r}=this;let s;for(let d=0,f=wg.length;d<f;d++){var o;if(null!=(o=wg[d].demux)&&o.probe(t,this.logger)){s=wg[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=s.remux,u=s.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(i,e,r,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(i,e,r,this.logger),this.probe=u.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new fE(this.config)),t}}const FE=n=>({remuxResult:{},chunkMeta:n});function Td(n){return"then"in n&&n.then instanceof Function}class gee{constructor(t,e,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class mee{constructor(t,e,i,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}}let zL=0;class qL{constructor(t,e,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=zL++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(u&&null!=c&&c.event&&c.instanceNo===this.instanceNo)switch(c.event){case"init":{var d;const f=null==(d=this.workerContext)?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":this.handleTransmuxComplete(c.data);break;case"flush":this.onFlush(c.data);break;case"workerLog":u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break;default:c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data)}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=t.config;this.hls=t,this.id=e,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const o=(l,c)=>{(c=c||{}).frag=this.frag||void 0,l===_.ERROR&&(c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new CE,this.observer.on(_.FRAG_DECRYPTED,o),this.observer.on(_.ERROR,o);const a=_k(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||function bJ(){return"function"==typeof __HLS_WORKER_BUNDLE__}()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${e}"`),this.workerContext=function DJ(n){const t=Yl[n];if(t)return t.clientCount++,t;const e=new self.URL(n,self.location.href).href,r={worker:new self.Worker(e),scriptURL:e,clientCount:1};return Yl[n]=r,r}(s.workerPath)):(l.log(`injecting Web Worker for "${e}"`),this.workerContext=function EJ(){const n=Yl[vd];if(n)return n.clientCount++,n;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t),r={worker:new self.Worker(e),objectURL:e,clientCount:1};return Yl[vd]=r,r}());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:e,config:Et(s)})}catch(u){l.warn(`Error setting up "${e}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new KL(this.observer,a,s,"",e,t.logger)}return}}this.transmuxer=new KL(this.observer,a,s,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=zL++;const e=this.hls.config,i=_k(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:i,id:this.id,config:Et(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),function TJ(n){const t=Yl[n||vd];if(t&&1==t.clientCount--){const{worker:i,objectURL:r}=t;delete Yl[n||vd],r&&self.URL.revokeObjectURL(r),i.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,i,r,s,o,a,l,c,u){var d,f;c.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:p}=this,g=o?o.start:s.start,m=s.decryptdata,y=this.frag,v=!(y&&s.cc===y.cc),b=!(y&&c.level===y.level),E=y?c.sn-y.sn:-1,D=this.part?c.part-this.part.index:-1,T=!b&&(1===E||0===E&&(1===D||0===E&&c.id>1&&c.id===y?.stats.chunkCount&&D<=0)),I=self.performance.now();(b||E||0===s.stats.parsing.start)&&(s.stats.parsing.start=I),o&&(D||!T)&&(o.stats.parsing.start=I);const R=!(y&&(null==(d=s.initSegment)?void 0:d.url)===(null==(f=y.initSegment)?void 0:f.url)),C=new mee(v,T,l,b,g,R);if(!T||v||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${"main"===this.id?"level":"track"}: ${c.level} id: ${c.id}\n        discontinuity: ${v}\n        trackSwitch: ${b}\n        contiguous: ${T}\n        accurateTimeOffset: ${l}\n        timeOffset: ${g}\n        initSegmentChange: ${R}`);const k=new gee(i,r,e,a,u);this.configureTransmuxer(k)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:t,decryptdata:m,chunkMeta:c,state:C},t instanceof ArrayBuffer?[t]:[]);else if(p){const k=p.push(t,m,c,C);Td(k)?k.then(W=>{this.handleTransmuxComplete(W)}).catch(W=>{this.transmuxerError(W,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(k)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(i){const r=i.flush(t);Td(r)?r.then(s=>{this.handleFlushResult(s,t)}).catch(s=>{this.transmuxerError(s,t,"transmuxer-interface flush error")}):this.handleFlushResult(r,t)}}transmuxerError(t,e,i){this.hls&&(this.error=t,this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):i&&i.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}class BE extends Yi{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,i){const r=e?.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,e.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===t){s=o;break}l===t.substring(0,l.length)&&(s=o)}if(-1!==s){const o=r[s],a=parseInt(o["LAST-MSN"])||e.lastPartSn;let l=parseInt(o["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(e.age-e.partTarget,e.targetduration);l>=0&&u>e.partTarget&&(l+=1)}const c=i&&Tk(i);return new Sk(a,l>=0?l:void 0,c)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return t}playlistLoaded(t,e,i){const{details:r,stats:s}=e,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const u=Math.max(l||0,0);r.appliedTimelineOffset=u,r.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(r.live||null!=i&&i.live){const u="levelInfo"in e?e.levelInfo:e.track;if(r.reloaded(i),i&&r.fragments.length>0){!function cJ(n,t,e){if(n===t)return;let i=null;const r=n.fragments;for(let u=r.length-1;u>=0;u--){const d=r[u].initSegment;if(d){i=d;break}}let s;n.fragmentHint&&delete n.fragmentHint.endPTS,function fJ(n,t,e){const i=t.skippedSegments,r=Math.max(n.startSN,t.startSN)-t.startSN,s=(n.fragmentHint?1:0)+(i?t.endSN:Math.min(n.endSN,t.endSN))-t.startSN,o=t.startSN-n.startSN,a=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=r;c<=s;c++){const u=l[o+c];let d=a[c];if(i&&!d&&u&&(d=t.fragments[c]=u),u&&d){e(u,d,c,a);const f=u.relurl;if(f&&hJ(f,d.relurl))return void(t.playlistParsingError=uL(`media sequence mismatch ${d.sn}:`,n,t,0,d));if(u.cc!==d.cc)return void(t.playlistParsingError=uL(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,n,t,0,d))}}}(n,t,(u,d,f,h)=>{if((!t.startCC||t.skippedSegments)&&d.cc!==u.cc){const p=u.cc-d.cc;for(let g=f;g<h.length;g++)h[g].cc+=p;t.endCC=h[h.length-1].cc}J(u.startPTS)&&J(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(s=d),t.PTSKnown=t.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,i=u.initSegment)});const o=t.fragments,a=t.fragmentHint?o.concat(t.fragmentHint):o;if(i&&a.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===(null==(d=i)?void 0:d.relurl))&&(u.initSegment=i)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(u=>!u),t.deltaUpdateFailed){e.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=t.skippedSegments;u--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function uJ(n,t,e){const{dateRanges:i,recentlyRemovedDateranges:r}=t,s=ut({},n);r&&r.forEach(l=>{delete s[l]});const a=Object.keys(s).length;return a?(Object.keys(i).forEach(l=>{const c=s[l],u=new Kk(i[l].attr,c);u.isValid?(s[l]=u,c||(u.tagOrder+=a)):e.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Et(i[l].attr)}"`)}),s):i}(n.dateRanges,t,e));const u=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!t.hasProgramDateTime)for(let d=1;d<a.length;d++)null===a[d].programDateTime&&bE(a[d],a[d-1],u);tL(u,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var l;const u=hL(n,t.startSN-1);t.startCC=null!=(l=u?.cc)?l:o[0].cc}(function dJ(n,t,e){if(n&&t){let i=0;for(let r=0,s=n.length;r<=s;r++){const o=n[r],a=t[r+i];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?e(o,a):i--}}})(n.partList,t.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),s?cL(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,e):dL(n,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=n.driftStartTime,t.driftStart=n.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const u=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=u),t.driftEndTime=c,t.driftEnd=u}else t.driftEndTime=n.driftEndTime,t.driftEnd=n.driftEnd,t.advancedDateTime=n.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=n.requestScheduled)}(i,r,this);const v=r.playlistParsingError;if(v){this.warn(v);const b=this.hls;if(!b.config.ignorePlaylistParsingErrors){var c;const{networkDetails:E}=e;return void b.trigger(_.ERROR,{type:le.NETWORK_ERROR,details:M.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:v,reason:v.message,level:e.level||void 0,parent:null==(c=r.fragments[0])?void 0:c.type,networkDetails:E,stats:s})}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,p=fL(r,1e3*(r.edge-(d?d.end-d.len:0)));if(r.requestScheduled+p<o?r.requestScheduled=o:r.requestScheduled+=p,this.log(`live playlist ${t} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let g,m,y;if(r.canBlockReload&&r.endSN&&r.advanced){const v=this.hls.config.lowLatencyMode,b=r.lastPartSn,E=r.endSN,D=r.lastPartIndex,T=b===E;-1!==D?T?(m=E+1,y=v?0:D):(m=b,y=v?D+1:r.maxPartIndex):m=E+1;const I=r.age,R=I+r.ageHeader;let C=Math.min(R-r.partTarget,1.5*r.targetduration);if(C>0){if(R>3*r.targetduration)this.log(`Playlist last advanced ${I.toFixed(2)}s ago. Omitting segment and part directives.`),m=void 0,y=void 0;else if(null!=i&&i.tuneInGoal&&R-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${C} with playlist age: ${r.age}`),C=0;else{const k=Math.floor(C/r.targetduration);m+=k,void 0!==y&&(y+=Math.round(C%r.targetduration/r.partTarget)),this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${I.toFixed(2)}s goal: ${C} skip sn ${k} to part ${y}`)}r.tuneInGoal=C}if(g=this.getDeliveryDirectives(r,e.deliveryDirectives,m,y),v||!T)return r.requestScheduled=o,void this.loadingPlaylist(u,g)}else(r.canBlockReload||r.canSkipUntil)&&(g=this.getDeliveryDirectives(r,e.deliveryDirectives,m,y));g&&void 0!==m&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(p-2*a,p/2)),this.scheduleLoading(u,g,r)}else this.clearTimer()}scheduleLoading(t,e,i){const r=i||t.details;if(!r)return void this.loadingPlaylist(t,e);const s=self.performance.now(),o=r.requestScheduled;if(s>=o)return void this.loadingPlaylist(t,e);const a=o-s;this.log(`reload live playlist ${t.name||t.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),a)}getDeliveryDirectives(t,e,i,r){let s=Tk(t);return null!=e&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,r=e.part,s=""),new Sk(i,r,s)}checkRetry(t){const e=t.details,i=fg(t),r=t.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(5===s||!r.resolved&&2===s);if(l){var c;if(o>=a.maxNumRetry)return!1;if(i&&null!=(c=t.context)&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const u=uE(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${e}" in ${u}ms`)}t.levelRetry=!0,r.resolved=!0}return l}}function QL(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(!Sd(n[e].attrs,t[e].attrs))return!1;return!0}function Sd(n,t,e){const i=n["STABLE-RENDITION-ID"];return i&&!e?i===t["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==t[r])}function UE(n,t){return t.label.toLowerCase()===n.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(n.lang||"").toLowerCase())}class vee{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,i){if(null===this.queues||null===this.tracks)return;const r=this.queues[e];r.push(t),1===r.length&&!i&&this.executeNext(e)}appendBlocker(t){return new Promise(e=>{this.append({label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}},t)})}prependBlocker(t){return new Promise(e=>{this.queues&&this.queues[t].unshift({label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}})})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const i=null==(e=t[0])?void 0:e.label;("async-blocker"===i||"async-blocker-prepend"===i)&&(t[0].execute(),t.splice(0,1))})}unblockAudio(t){null!==this.queues&&this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(null===this.queues||null===this.tracks)return;const e=this.queues[t];if(e.length){const r=e[0];try{r.execute()}catch(s){var i;if(r.onError(s),null===this.queues||null===this.tracks)return;const o=null==(i=this.tracks[t])?void 0:i.buffer;null!=o&&o.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){null!==this.queues&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return(null==(e=this.queues)?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return null===t||null===e?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(t){var e,i;return null!=(e=this.queues)&&e[t]||null!=(i=this.tracks)&&i[t]?`${t}: (${this.listSbInfo(t)}) ${this.listOps(t)}`:""}listSbInfo(t){var e;const i=null==(e=this.tracks)?void 0:e[t],r=i?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(t){var e;return(null==(e=this.queues)?void 0:e[t].map(i=>i.label).join(", "))||""}}const XL=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ZL="HlsJsTrackRemovedError";class bee extends Error{constructor(t){super(t),this.name=ZL}}function JL(n){const t=n.querySelectorAll("source");[].slice.call(t).forEach(e=>{n.removeChild(e)})}function $E(n){return"audio"===n?1:0}class VE{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(_.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(_.BUFFER_CODECS,this.onBufferCodecs,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(_.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(_.BUFFER_CODECS,this.onBufferCodecs,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&J(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const t=this.hls.levels;if(t.length){const e=this.hls,i=this.getMaxLevel(t.length-1);i!==this.autoLevelCapping&&e.logger.log(`Setting autoLevelCapping to ${i}: ${t[i].height}p@${t[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=i,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((r,s)=>this.isLevelAllowed(r)&&s<=t);return this.clientRect=null,VE.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(i=>t.bitrate===i.bitrate&&t.width===i.width&&t.height===i.height)}static getMaxLevelByMediaSize(t,e,i){if(null==t||!t.length)return-1;const r=(a,l)=>!l||a.width!==l.width||a.height!==l.height;let s=t.length-1;const o=Math.max(e,i);for(let a=0;a<t.length;a+=1){const l=t[a];if((l.width>=o||l.height>=o)&&r(l,t[a+1])){s=a;break}}return s}}class zr{constructor(t,e){Array.isArray(t)&&(t=t.map(i=>i instanceof zr?i:new zr(i))),this.value=t,this.params=e}}function qr(n,t,e){return function Iee(n,t,e,i){return new Error(`failed to ${n} "${function Cee(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":"object"==typeof n?JSON.stringify(n):String(n)}(t)}" as ${e}`,{cause:i})}("serialize",n,t,e)}class eP{constructor(t){this.description=t}}const tP="Bare Item";function nP(n){if(function Oee(n){return n<-999999999999999||999999999999999<n}(n))throw qr(n,"Integer");return n.toString()}function iP(n,t){if(n<0)return-iP(-n,t);const e=Math.pow(10,t);if(Math.abs(n*e%1-.5)<Number.EPSILON){const r=Math.floor(n*e);return(r%2==0?r:r+1)/e}return Math.round(n*e)/e}function Pee(n){const t=iP(n,3);if(Math.floor(Math.abs(t)).toString().length>12)throw qr(n,"Decimal");const e=t.toString();return e.includes(".")?e:`${e}.0`}const Bee=/[\x00-\x1f\x7f]+/;function rP(n){const t=function $ee(n){return n.description||n.toString().slice(7,-1)}(n);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw qr(t,"Token");return t}function jE(n){switch(typeof n){case"number":if(!J(n))throw qr(n,tP);return Number.isInteger(n)?nP(n):Pee(n);case"string":return function Uee(n){if(Bee.test(n))throw qr(n,"String");return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(n);case"symbol":return rP(n);case"boolean":return function Aee(n){if("boolean"!=typeof n)throw qr(n,"Boolean");return n?"?1":"?0"}(n);case"object":if(n instanceof Date)return function kee(n){return`@${nP(n.getTime()/1e3)}`}(n);if(n instanceof Uint8Array)return function Mee(n){if(!1===ArrayBuffer.isView(n))throw qr(n,"Byte Sequence");return`:${function xee(n){return btoa(String.fromCharCode(...n))}(n)}:`}(n);if(n instanceof eP)return rP(n);default:throw qr(n,tP)}}function HE(n){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(n))throw qr(n,"Key");return n}function GE(n){return null==n?"":Object.entries(n).map(([t,e])=>!0===e?`;${HE(t)}`:`;${HE(t)}=${jE(e)}`).join("")}function sP(n){return n instanceof zr?`${jE(n.value)}${GE(n.params)}`:jE(n)}function oP(n,t){return function Gee(n,t={whitespace:!0}){if("object"!=typeof n||null==n)throw qr(n,"Dict");const e=n instanceof Map?n.entries():Object.entries(n),i=t?.whitespace?" ":"";return Array.from(e).map(([r,s])=>{s instanceof zr||(s=new zr(s));let o=HE(r);return!0===s.value?o+=GE(s.params):(o+="=",Array.isArray(s.value)?o+=function Hee(n){return`(${n.value.map(sP).join(" ")})${GE(n.params)}`}(s):o+=sP(s)),o}).join(`,${i}`)}(n,t)}const Yr="CMCD-Object",Ht="CMCD-Request",da="CMCD-Session",uo="CMCD-Status",Wee={br:Yr,ab:Yr,d:Yr,ot:Yr,tb:Yr,tpb:Yr,lb:Yr,tab:Yr,lab:Yr,url:Yr,pb:Ht,bl:Ht,tbl:Ht,dl:Ht,ltc:Ht,mtp:Ht,nor:Ht,nrr:Ht,rc:Ht,sn:Ht,sta:Ht,su:Ht,ttfb:Ht,ttfbb:Ht,ttlb:Ht,cmsdd:Ht,cmsds:Ht,smrt:Ht,df:Ht,cs:Ht,ts:Ht,cid:da,pr:da,sf:da,sid:da,st:da,v:da,msd:da,bs:uo,bsd:uo,cdn:uo,rtp:uo,bg:uo,pt:uo,ec:uo,e:uo},Kee_REQUEST=Ht;const aP="event",Ag=n=>Math.round(n),WE=(n,t)=>Array.isArray(n)?n.map(e=>WE(e,t)):n instanceof zr&&"string"==typeof n.value?new zr(WE(n.value,t),n.params):(t.baseUrl&&(n=function Xee(n,t){const e=new URL(n),i=new URL(t);if(e.origin!==i.origin)return n;const r=e.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+e.search+e.hash}(n,t.baseUrl)),1===t.version?encodeURIComponent(n):n),xg=n=>100*Ag(n/100),Zee={br:Ag,d:Ag,bl:xg,dl:xg,mtp:xg,nor:(n,t)=>{let e=n;return t.version>=2&&(n instanceof zr&&"string"==typeof n.value?e=new zr([n]):"string"==typeof n&&(e=[n])),WE(e,t)},rtp:xg,tb:Ag},lP="request",cP="response",KE=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Jee=["e"],ete=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Rg(n){return ete.test(n)}const uP=["d","dl","nor","ot","rtp","su"],ite=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],ste=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function ote(n){return ste.includes(n)||Rg(n)}const ate={[cP]:function rte(n){return KE.includes(n)||uP.includes(n)||ite.includes(n)||Rg(n)},[aP]:function tte(n){return KE.includes(n)||Jee.includes(n)||Rg(n)},[lP]:function nte(n){return KE.includes(n)||uP.includes(n)||Rg(n)}};function dP(n,t={}){const e={};if(null==n||"object"!=typeof n)return e;const i=t.version||n.v||1,r=t.reportingMode||lP,s=1===i?ote:ate[r];let o=Object.keys(n).filter(s);const a=t.filter;"function"==typeof a&&(o=o.filter(a));const l=r===cP||"event"===r;l&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const c=ut({},Zee,t.formatters),u={version:i,reportingMode:r,baseUrl:t.baseUrl};return o.sort().forEach(d=>{let f=n[d];const h=c[d];if("function"==typeof h&&(f=h(f,u)),"v"===d){if(1===i)return;f=i}"pr"==d&&1===f||(l&&"ts"===d&&!J(f)&&(f=Date.now()),function Qee(n){return"number"==typeof n?J(n):null!=n&&""!==n&&!1!==n}(f)&&(function Yee(n){return["ot","sf","st","e","sta"].includes(n)}(d)&&"string"==typeof f&&(f=new eP(f)),e[d]=f))}),e}function cte(n,t,e){return ut(n,function lte(n,t={}){const e={};if(!n)return e;const r=function qee(n,t){const e={};if(!n)return e;const i=Object.keys(n),r=t?function zee(n){return Object.keys(n).reduce((t,e)=>{var i;return null===(i=n[e])||void 0===i||i.forEach(r=>t[r]=e),t},{})}(t):{};return i.reduce((s,o)=>{var a;const l=Wee[o]||r[o]||Kee_REQUEST;return(null!==(a=s[l])&&void 0!==a?a:s[l]={})[o]=n[o],s},e)}(dP(n,t),t?.customHeaderMap);return Object.entries(r).reduce((s,[o,a])=>{const l=oP(a,{whitespace:!1});return l&&(s[o]=l),s},e)}(t,e))}const fP=/CMCD=[^&#]+/;function pte(n,t,e){const i=function hte(n,t={}){return n?`CMCD=${function fte(n,t={}){if(!n)return"";const e=function dte(n,t={}){return n?oP(dP(n,t),{whitespace:!1}):""}(n,t);return encodeURIComponent(e)}(n,t)}`:""}(t,e);if(!i)return n;if(fP.test(n))return n.replace(fP,i);const r=n.includes("?")?"&":"?";return`${n}${r}${i}`}function hP(n,t,e,i){n&&Object.keys(t).forEach(r=>{const s=n.filter(o=>o.groupId===r).map(o=>{const a=ut({},o);return a.details=void 0,a.attrs=new Pt(a.attrs),a.url=a.attrs.URI=pP(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=i,a});n.push(...s)})}function pP(n,t,e,i){const{HOST:r,PARAMS:s,[e]:o}=i;let a;t&&(a=o?.[t],a&&(n=a));const l=new self.URL(n);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}let _te=(()=>{class n extends Yi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=i=>{const{initDataType:r,initData:s}=i,o=`"${i.type}" event: init data type: "${r}"`;if(this.debug(o),null!==s){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=yd(this.config));const l=a.map(_E).filter(c=>!!c);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(a=>{const l=_g(a);if("sinf"!==r||l!==Ft.FAIRPLAY)return void this.log(`Ignoring "${i.type}" event with init data type: "${r}" for selected key-system ${l}`);let c;try{const p=mn(new Uint8Array(s)),m=fk(mE(JSON.parse(p).sinf));if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(m.subarray(8,24))}catch(p){return void this.warn(`${o} Failed to parse sinf: ${p}`)}const u=qn(c),{keyIdToKeySessionPromise:d,mediaKeySessions:f}=this;let h=d[u];for(let p=0;p<f.length;p++){const g=f[p],m=g.decryptdata;if(!m.keyId)continue;const y=qn(m.keyId);if(mg(c,m.keyId)||-1!==m.uri.replace(/-/g,"").indexOf(u)){if(h=d[y],!h)continue;if(m.pssh)break;delete d[y],m.pssh=new Uint8Array(s),m.keyId=c,h=d[u]=h.then(()=>this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-key-match")),h.catch(v=>this.handleError(v));break}}h||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${f.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=i=>{this.log(`"${i.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(_.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(_.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:i,widevineLicenseUrl:r}=this.config,s=i?.[e];return s?s.licenseUrl:e===Ft.WIDEVINE&&r?r:void 0}getLicenseServerUrlOrThrow(e){const i=this.getLicenseServerUrl(e);if(void 0===i)throw new Error(`no license server URL configured for key-system "${e}"`);return i}getServerCertificateUrl(e){const{drmSystems:i}=this.config,r=i?.[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const i=this.hls.levels,r=(a,l,c)=>!!a&&c.indexOf(a)===l,s=i.map(a=>a.audioCodec).filter(r),o=i.map(a=>a.videoCodec).filter(r);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,l)=>{const c=u=>{const d=u.shift();this.getMediaKeysPromise(d,s,o).then(f=>a({keySystem:d,mediaKeys:f})).catch(f=>{u.length?c(u):l(f instanceof Ai?f:new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};c(e)})}requestMediaKeySystemAccess(e,i){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===Qk&&"http:"===self.location.protocol&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,i)}getMediaKeysPromise(e,i,r){var s;const o=function eJ(n,t,e,i){let r;switch(n){case Ft.FAIRPLAY:r=["cenc","sinf"];break;case Ft.WIDEVINE:case Ft.PLAYREADY:r=["cenc"];break;case Ft.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return function tJ(n,t,e,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}(r,t,e,i)}(e,i,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],l=null==(s=a)?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Et(o)}`),l=this.requestMediaKeySystemAccess(e,o);const c=a=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),l.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const d=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const f=c.mediaKeys=u.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),c.hasMediaKeys=!0,d.then(p=>p?this.setMediaKeysServerCertificate(h,e,p):h)));return f.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),f})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:i,mediaKeys:r}){this.log(`Creating key-system session "${i}" keyId: ${qn(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),o={decryptdata:e,keySystem:i,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(e){const i=e.decryptdata;if(i.pssh){const r=this.createMediaKeySessionContext(e),s=Mg(i);this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,"cenc",i.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,i){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${qn(e.decryptdata.keyId||[])}\n      } (data length: ${i.byteLength})`),r.update(i)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>_E(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:i,mediaKeys:r})=>this.attemptSetMediaKeys(i,r))}selectKeySystem(e){return new Promise((i,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const o=_E(s);o?i(o):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const i=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)),this.keyFormatPromise}getKeyFormatPromise(e){const i=yd(this.config),r=e.map(_g).filter(s=>!!s&&-1!==i.indexOf(s));return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:i}=this;for(let r=0;r<i.length;r++){const s=vte(e,i[r]);if(s)return s}}loadKey(e){const i=e.keyInfo.decryptdata,r=Mg(i),s=this.bannedKeyIds[r];if(s||"internal-error"===this.getKeyStatus(i)){const l=gP(s||"internal-error",i);return this.handleError(l,e.frag),Promise.reject(l)}const o=`(keyId: ${r} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`;this.log(`Starting session for key ${o}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const l=this.getKeySystemForKeyPromise(i).then(({keySystem:c,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${o}`),this.attemptSetMediaKeys(c,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:u,decryptdata:i}))))).then(c=>this.generateRequestWithPreferredKeySession(c,"cenc",i.pssh?i.pssh.buffer:null,"playlist-key"));return l.catch(c=>this.handleError(c,e.frag)),this.keyIdToKeySessionPromise[r]=l,l}return a.catch(l=>{if(l instanceof Ai){const c=it({},l.data);"internal-error"===this.getKeyStatus(i)&&(c.decryptdata=i);const u=new Ai(c,l.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,i){if(this.hls)if(e instanceof Ai){i&&(e.data.frag=i);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${qn(r.keyId||[])})`:""}`),this.hls.trigger(_.ERROR,e.data)}else this.error(e.message),this.hls.trigger(_.ERROR,{type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const i=Mg(e),r=this.keyIdToKeySessionPromise[i];if(!r){const s=_g(e.keyFormat),o=s?[s]:yd(this.config);return this.attemptKeySystemAccess(o)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=yd(this.config)),0===e.length)throw new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Et({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,i){if(this.mediaResolved=void 0,this.mediaKeys===i)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(i):new Promise((o,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=i,this.media.setMediaKeys(i).then(o).catch(a)}}));return this.mediaKeys=i,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>-1===r.indexOf(o))})}generateRequestWithPreferredKeySession(e,i,r,s){var o;const a=null==(o=this.config.drmSystems)||null==(o=o[e.keySystem])?void 0:o.generateRequest;if(a)try{const g=a.call(this.hls,i,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");i=g.initDataType,e.decryptdata.pssh=(r=g.initData?g.initData:null)?new Uint8Array(r):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(null===r)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const l=Mg(e.decryptdata),c=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${l} URI: ${c} (init data type: ${i} length: ${r.byteLength})`);const u=new CE,d=e._onmessage=g=>{const m=e.mediaKeysSession;if(!m)return void u.emit("error",new Error("invalid state"));const{messageType:y,message:v}=g;this.log(`"${y}" message event for session "${m.sessionId}" message size: ${v.byteLength}`),"license-request"===y||"license-renewal"===y?this.renewLicense(e,v).catch(b=>{u.eventNames().length?u.emit("error",b):this.handleError(b)}):"license-release"===y?e.keySystem===Ft.FAIRPLAY&&this.updateKeySession(e,yE("acknowledged")).then(()=>this.removeSession(e)).catch(b=>this.handleError(b)):this.warn(`unhandled media key message type "${y}"`)},f=(g,m)=>{let y;m.keyStatus=g,g.startsWith("usable")?u.emit("resolved"):"internal-error"===g||"output-restricted"===g||"output-downscaled"===g?y=gP(g,m.decryptdata):"expired"===g?y=new Error(`key expired (keyId: ${l})`):"released"===g?y=new Error("key released"):"status-pending"===g||this.warn(`unhandled key status change "${g}" (keyId: ${l})`),y&&(u.eventNames().length?u.emit("error",y):this.handleError(y))},h=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession)return void u.emit("error",new Error("invalid state"));const y=this.getKeyStatuses(e);if(!Object.keys(y).some(D=>"status-pending"!==y[D]))return;if("expired"===y[l])return this.log(`Expired key ${Et(y)} in key-session "${e.mediaKeysSession.sessionId}"`),void this.renewKeySession(e);let b=y[l];var E;b?f(b,e):(e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[l]||(E[l]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&"status-pending"!==w)return this.log(`No status for keyId ${l} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),f(w,e);this.log(`key status for ${l} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),b="internal-error",f(b,e)},1e3)),this.log(`No status for keyId ${l} (${Et(y)}).`))};Yn(e.mediaKeysSession,"message",d),Yn(e.mediaKeysSession,"keystatuseschange",h);const p=new Promise((g,m)=>{u.on("error",m),u.on("resolved",g)});return e.mediaKeysSession.generateRequest(i,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${l} URI: ${c}`)}).catch(g=>{throw new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>p).catch(g=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const i={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if("string"==typeof s&&"object"==typeof r){const l=s;s=r,r=l}const o="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);e.keySystem===Ft.PLAYREADY&&16===o.length&&qk(o);const a=qn(o);"internal-error"===r&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),i[a]=r}),i}fetchServerCertificate(e){const i=this.config,s=new(0,i.loader)(i),o=this.getServerCertificateUrl(e);return o?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,l)=>{const c={responseType:"arraybuffer",url:o},u=i.certLoadPolicy.default;s.load(c,{loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(h,p,g,m)=>{a(h.data)},onError:(h,p,g,m)=>{l(new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:it({url:c.url,data:void 0},h)},`"${e}" certificate request failed (${o}). Status: ${h.code} (${h.text})`))},onTimeout:(h,p,g)=>{l(new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:c.url,data:void 0}},`"${e}" certificate request timed out (${o})`))},onAbort:(h,p,g)=>{l(new Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(e,i,r){return new Promise((s,o)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${i}"`),s(e)}).catch(a=>{o(new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,i){return this.requestLicense(e,new Uint8Array(i)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,i){const r=String.fromCharCode.apply(null,new Uint16Array(i.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),i;const s=(new DOMParser).parseFromString(r,"application/xml"),o=s.querySelectorAll("HttpHeader");if(o.length>0){let d;for(let f=0,h=o.length;f<h;f++){var a,l;d=o[f];const p=null==(a=d.querySelector("name"))?void 0:a.textContent,g=null==(l=d.querySelector("value"))?void 0:l.textContent;p&&g&&e.setRequestHeader(p,g)}}const c=s.querySelector("Challenge"),u=c?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return yE(atob(u))}setupLicenseXHR(e,i,r,s){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return o.call(this.hls,e,i,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",i,!0),o.call(this.hls,e,i,r,s)}).then(a=>(e.readyState||e.open("POST",i,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",i,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,i){const r=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(4===l.readyState)if(200===l.status){this._requestLicenseFailureCount=0;let c=l.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const u=this.config.licenseResponseCallback;if(u)try{c=u.call(this.hls,l,a,e)}catch(d){this.error(d)}s(c)}else{const c=r.errorRetry,u=c?c.maxNumRetry:0;this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||l.status>=400&&l.status<500?o(new Ai({type:le.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`)):(this.warn(`Retrying license request, ${u-this._requestLicenseFailureCount+1} attempts left`),this.requestLicense(e,i).then(s,o))}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,a,e,i).then(({xhr:c,licenseChallenge:u})=>{e.keySystem==Ft.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(c,u)),c.send(u)}).catch(o)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,i){if(!this.config.emeEnabled)return;const r=i.media;this.media=r,Yn(r,"encrypted",this.onMediaEncrypted),Yn(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(ai(e,"encrypted",this.onMediaEncrypted),ai(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const i=this.mediaResolved;if(i&&i(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ua.clearKeyUriToKeyIdMap();const o=s.length;n.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((null==r||null==(e=r.setMediaKeys(null))?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{o&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:i}){if(i&&this.config.emeEnabled&&!this.keyFormatPromise){const r=i.reduce((s,o)=>(-1===s.indexOf(o.keyFormat)&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:i,licenseXhr:r,decryptdata:s}=e;if(i){this.log(`Remove licenses and keys and close session "${i.sessionId}" keyId: ${qn(s?.keyId||[])}`),e._onmessage&&(i.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const o=this.mediaKeySessions.indexOf(e);o>-1&&this.mediaKeySessions.splice(o,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:l}=this.config;return(function nJ(n){var t;return!(!n||"persistent-license"!==n.sessionType&&(null==(t=n.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(l)?new Promise((u,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),i.remove().then(u).catch(d)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>i.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}return n.CDMCleanupPromise=void 0,n})();function Mg(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(null===n.keyId)throw new Error("keyId is null");return qn(n.keyId)}function vte(n,t){return n.keyId&&t.mediaKeysSession.keyStatuses.has(n.keyId)?t.mediaKeysSession.keyStatuses.get(n.keyId):n.matches(t.decryptdata)?t.keyStatus:void 0}class Ai extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}function gP(n,t){const e="output-restricted"===n;return new Ai({type:le.KEY_SYSTEM_ERROR,details:e?M.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:M.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!1,decryptdata:t},e?"HDCP level output restricted":`key status changed to "${n}"`)}function mP(n,t){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=n,t.dispatchEvent(e)}function yP(n,t){const e=n.mode;if("disabled"===e&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(t.id))try{if(n.addCue(t),!n.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){rt.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,n.addCue(r)}catch(r){rt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}"disabled"===e&&(n.mode=e)}function Jl(n,t){const e=n.mode;if("disabled"===e&&(n.mode="hidden"),n.cues)for(let i=n.cues.length;i--;)t&&n.cues[i].removeEventListener("enter",t),n.removeCue(n.cues[i]);"disabled"===e&&(n.mode=e)}function zE(n,t,e,i){const r=n.mode;if("disabled"===r&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=function Dte(n,t,e){const i=[],r=function Ete(n,t){if(t<=n[0].startTime)return 0;const e=n.length-1;if(t>n[e].endTime)return-1;let s,i=0,r=e;for(;i<=r;)if(s=Math.floor((r+i)/2),t<n[s].startTime)r=s-1;else{if(!(t>n[s].startTime&&i<e))return s;i=s+1}return n[i].startTime-t<t-n[r].startTime?i:r}(n,t);if(r>-1)for(let s=r,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=t&&a.endTime<=e)i.push(a);else if(a.startTime>e)return i}return i}(n.cues,t,e);for(let o=0;o<s.length;o++)(!i||i(s[o]))&&n.removeCue(s[o])}"disabled"===r&&(n.mode=r)}function Ng(n){const t=[];for(let e=0;e<n.length;e++){const i=n[e];("subtitles"===i.kind||"captions"===i.kind)&&i.label&&t.push(n[e])}return t}function Cd(n){let t=5381,e=n.length;for(;e;)t=33*t^n.charCodeAt(--e);return(t>>>0).toString()}const ec=.025;let Og=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function Cte(n,t,e){return`${n.identifier}-${e+1}-${Cd(t)}`}class Ite{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,null==(t=this.assetListLoader)||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const i=this.playoutLimit;return!(t<=0||isNaN(i))&&(0===i||((null==(e=this.assetList[t])?void 0:e.startOffset)||0)>i)}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return qE(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime;return e-qE(e,t)<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=J(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return qE(t,e)}return t}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ec))}set appendInPlace(t){this.appendInPlaceStarted?this.resetOnResume=!t:this.appendInPlaceDisabled=!t}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return e=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?Og.Range:Og.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return function wte(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}(this)}}function qE(n,t){return n-t.start<t.duration/2&&!(Math.abs(n-(t.start+t.duration))<ec)?t.start:t.start+t.duration}function _P(n,t,e){const i=new self.URL(n,e);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function YE(n,t){for(;null!=(e=n.assetList[++t])&&e.error;)var e;return t}function tc(n){const t=n.timelineStart,e=n.duration||0;return`["${n.identifier}" ${t.toFixed(2)}-${(t+e).toFixed(2)}]`}class Ate{constructor(t,e,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(_.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new t(e);this.interstitial=i,this.assetItem=r;const o=()=>{this.hasDetails=!0};s.once(_.LEVEL_LOADED,o),s.once(_.AUDIO_TRACK_LOADED,o),s.once(_.SUBTITLE_TRACK_LOADED,o),s.on(_.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(_.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,s.trigger(_.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const t=this.hls;if(t)if(t.url)t.levels.length&&!t.started&&t.startLoad(-1,!0);else{let e=this.assetItem.uri;try{e=_P(e,t.config.primarySessionId||"").href}catch{}t.loadSource(e)}}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if(null!=(e=this.hls)&&e.bufferedToEnd)return!0;if(!t)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),s=Ie.bufferInfo(t,this.timelineOffset,0);return this.getAssetTime(s.end)>=i-.02}reachedPlayout(t){return this.startOffset+t>=this.interstitial.playoutLimit}get destroyed(){var t;return!(null!=(t=this.hls)&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return(null==(t=this.hls)?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=Ie.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;if(!t)return 0;const e=this.interstitial.playoutLimit;if(e){const i=e-this.startOffset;if(i>0&&i<t)return i}return t}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return(null==(t=this.hls)?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e&&Math.abs(t-e)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}getAssetTime(t){const i=this.duration;return Math.min(Math.max(0,t-this.timelineOffset),i)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var t;this.mediaAttached&&null!=(t=this.hls)&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){var e;this.loadSource(),null==(e=this.hls)||e.attachMedia(t)}detachMedia(){var t;this.removeMediaListeners(),this.mediaAttached=null,null==(t=this.hls)||t.detachMedia()}resumeBuffering(){var t;null==(t=this.hls)||t.resumeBuffering()}pauseBuffering(){var t;null==(t=this.hls)||t.pauseBuffering()}transferMedia(){var t;return this.bufferSnapShot(),(null==(t=this.hls)?void 0:t.transferMedia())||null}resetDetails(){const t=this.hls;if(t&&this.hasDetails){t.stopLoad();const e=i=>delete i.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,i){var r;null==(r=this.hls)||r.on(t,e)}once(t,e,i){var r;null==(r=this.hls)||r.once(t,e)}off(t,e,i){var r;null==(r=this.hls)||r.off(t,e)}toString(){var t;return`HlsAssetPlayer: ${tc(this.assetItem)} ${null==(t=this.hls)?void 0:t.sessionId} ${this.appendInPlace?"append-in-place":""}`}}class xte extends Yi{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((i,r)=>t<=r.startOffset&&e>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let i=-1;t.nextEvent?i=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(i=this.findEventIndex(t.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(void 0===e&&(e=t.start),i=this.findItemIndexAtTime(e));i>=0&&null!=(s=r[i])&&s.event;){var s;i--}return i}findItemIndexAtTime(t,e){const i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(e&&"primary"!==e&&(s=s[e]),t===s.start||t>s.start&&t<s.end)return r}return-1}findJumpRestrictedIndex(t,e){const i=this.items;if(i)for(let r=t;r<=e&&i[r];r++){const s=i[r].event;if(null!=s&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(t){const e=this.items;if(e)for(let r=e.length;r--;){var i;if((null==(i=e[r].event)?void 0:i.identifier)===t)return r}return-1}findAssetIndex(t,e){const i=t.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){const o=i[s];if(!o.error){const a=o.timelineStart;if(e===a||e>a&&(e<a+(o.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var t;const e=null==(t=this.items)||null==(t=t[this.length-1])?void 0:t.event;if(e){const i=e.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(t,e){const i=t.main.details,{dateRanges:r}=i,s=this.events,o=this.parseDateRanges(r,{url:i.url},e),a=Object.keys(r),l=s?s.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const d=c.cue.pre,f=c.cue.post,h=u.cue.pre,p=u.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!p)return 1;if(p&&!f)return-1;if(!(d||h||f||p)){const g=c.startTime,m=u.startTime;if(g!==m)return g-m}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(t,l)}updateSchedule(t,e=[],i=!1){const r=this.events||[];if(r.length||e.length||this.length<2){const s=this.items,o=this.parseSchedule(r,t);(i||e.length||s?.length!==o.length||o.some((l,c)=>Math.abs(l.playout.start-s[c].playout.start)>.005||Math.abs(l.playout.end-s[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(e,s))}}parseDateRanges(t,e,i){const r=[],s=Object.keys(t);for(let o=0;o<s.length;o++){const a=s[o],l=t[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new Ite(l,e),this.eventMap[a]=c,!1===i&&(c.appendInPlace=i)),r.push(c)}}return r}parseSchedule(t,e){const i=[],r=e.main.details,s=r.live?1/0:r.edge;let o=0;if((t=t.filter(l=>!(l.error||l.cue.once&&l.hasPlayed))).length){this.resolveOffsets(t,e);let l=0,c=0;if(t.forEach((u,d)=>{const f=u.cue.pre,h=u.cue.post,p=t[d-1]||null,g=u.appendInPlace,m=h?s:u.startOffset,y=u.duration,v=u.timelineOccupancy===Og.Range?y:0,b=u.resumptionOffset,E=p?.startTime===m,D=m+u.cumulativeDuration;let w=g?D+y:m+b;if(f||!h&&m<=0){const I=c;c+=v,u.timelineStart=D;const R=o;o+=y,i.push({event:u,start:D,end:w,playout:{start:R,end:o},integrated:{start:I,end:c}})}else{if(!(m<=s))return;{if(!E){const C=m-l;if(C>.033){const W=c;c+=C;const Y=o;o+=C,i.push({previousEvent:t[d-1]||null,nextEvent:u,start:l,end:l+C,playout:{start:Y,end:o},integrated:{start:W,end:c}})}else C>0&&p&&(p.cumulativeDuration+=C,i[i.length-1].end=m)}h&&(w=D),u.timelineStart=D;const I=c;c+=v;const R=o;o+=y,i.push({event:u,start:D,end:w,playout:{start:R,end:o},integrated:{start:I,end:c}})}}const T=u.resumeTime;l=h||T>s?s:T}),l<s){var a;const d=c,f=s-l;c+=f;const h=o;o+=f,i.push({previousEvent:(null==(a=i[i.length-1])?void 0:a.event)||null,nextEvent:null,start:l,end:l+f,playout:{start:h,end:o},integrated:{start:d,end:c}})}this.setDurations(s,o,c)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(t,e,i){this.durations={primary:t,playout:e,integrated:i}}resolveOffsets(t,e){const i=e.main.details,r=i.live?1/0:i.edge;let s=0,o=-1;t.forEach((a,l)=>{const u=a.cue.post,d=a.cue.pre?0:u?r:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=s:(s=0,o=d),!u&&a.snapOptions.in&&(a.resumeAnchor=ca(null,i.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,e)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<t.length&&t[l+1].startTime-t[l].resumeTime<.033&&(t[l+1].appendInPlace=!1,t[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=J(a.resumeOffset)?a.resumeOffset:a.duration;s+=h})}primaryCanResumeInPlaceAt(t,e){const i=t.resumeTime,r=t.startTime+t.resumptionOffset;return Math.abs(i-r)>ec?(this.log(`"${t.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(e).some(o=>{const a=e[o].details,l=a.edge;if(i>=l)return this.log(`"${t.identifier}" resumption ${i} past ${o} playlist end ${l}`),!1;const c=ca(null,a.fragments,i);if(!c)return this.log(`"${t.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u="audio"===o?.175:0;return!(Math.abs(c.start-i)<ec+u||Math.abs(c.end-i)<ec+u||(this.log(`"${t.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),0))})}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let i=0,r=!1,s=!1;for(let o=0;o<t.assetList.length;o++){const a=t.assetList[o],l=e+i;a.startOffset=i,a.timelineStart=l,r||(r=null===a.duration),s||(s=!!a.error),i+=a.error?0:a.duration||0}t.duration=r&&!s?Math.max(i,t.duration):i}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function yr(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class Rte{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const i=t.assetListUrl;let r;try{r=_P(i,this.hls.sessionId,t.baseUrl)}catch(f){const h=this.assignAssetListError(t,M.ASSET_LIST_LOAD_ERROR,f,i);return void this.hls.trigger(_.ERROR,h)}e&&"data:"!==r.protocol&&r.searchParams.set("_HLS_start_offset",""+e);const s=this.hls.config,a=new(0,s.loader)(s),c=s.interstitialAssetListLoadPolicy.default;return a.load({responseType:"json",url:r.href},{loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(f,h,p,g)=>{const m=f.data,y=m?.ASSETS;if(Array.isArray(y))t.assetListResponse=m,this.hls.trigger(_.ASSET_LIST_LOADED,{event:t,assetListResponse:m,networkDetails:g});else{const v=this.assignAssetListError(t,M.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,h,g);this.hls.trigger(_.ERROR,v)}},onError:(f,h,p,g)=>{const m=this.assignAssetListError(t,M.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,g,p);this.hls.trigger(_.ERROR,m)},onTimeout:(f,h,p)=>{const g=this.assignAssetListError(t,M.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,p);this.hls.trigger(_.ERROR,g)}}),this.hls.trigger(_.ASSET_LIST_LOADING,{event:t}),a}assignAssetListError(t,e,i,r,s,o){return t.error=i,{type:le.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:r,error:i,networkDetails:o,stats:s}}}function bP(n){var t;null==n||null==(t=n.play())||t.catch(()=>{})}function kg(n,t){return`[${n}] Advancing timeline position to ${t}`}class Ote{constructor(t){this.buffered=void 0;const e=(i,r,s)=>{if((r>>>=0)>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return t[r][i]};this.buffered={get length(){return t.length},end:i=>e("end",i,t.length),start:i=>e("start",i,t.length)}}}const kte={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},DP=n=>String.fromCharCode(kte[n]||n),As=100,Lte={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Pte={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Fte={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Bte={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ute=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class $te{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i="function"==typeof e?e():e;rt.log(`${this.time} [${t}] ${i}`)}}}const fa=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].toString(16));return e};class TP{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const r=e[i];t.hasOwnProperty(r)&&(this[r]=t[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Vte{constructor(){this.uchar=" ",this.penState=new TP}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class jte{constructor(t){this.chars=[],this.pos=0,this.currPenState=new TP,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<As;e++)this.chars.push(new Vte);this.logger=t}equals(t){for(let e=0;e<As;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<As;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<As;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>As&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=As)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=DP(t);this.pos>=As?this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))}clearFromPos(t){let e;for(e=t;e<As;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<As;i++){const r=this.chars[i].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class QE{constructor(t){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<15;e++)this.rows.push(new jte(t));this.logger=t}reset(){for(let t=0;t<15;t++)this.rows[t].clear();this.currRow=14}equals(t){let e=!0;for(let i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<15;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+Et(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let a=0;a<15;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(null!==a&&null!==l&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[e-this.nrRollUpRows+c+1].copy(o.rows[s+c])}}this.currRow=e;const i=this.rows[this.currRow];if(null!==t.indent){const o=Math.max(t.indent-1,0);i.setCursor(t.indent),t.color=i.chars[o].penState.foreground}this.setPen({foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1})}setBkgData(t){this.logger.log(2,()=>"bkgData = "+Et(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",r=-1;for(let s=0;s<15;s++){const o=this.rows[s].getTextString();o&&(r=s+1,e.push(t?"Row "+r+": '"+o+"'":o.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i}getTextAndFormat(){return this.rows}}class SP{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new QE(i),this.nonDisplayedMemory=new QE(i),this.lastOutputScreen=new QE(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(2,"MIDROW: "+Et(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class CP{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new $te;this.channels=[null,new SP(t,e,r),new SP(t+1,i,r)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let i=0;i<e.length;i+=2){const r=127&e[i],s=127&e[i+1];let o=!1,a=null;if(0===r&&0===s)continue;this.logger.log(3,()=>"["+fa([e[i],e[i+1]])+"] -> ("+fa([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(Hte(r,s,l)){Lg(null,null,l),this.logger.log(3,()=>"Repeated command ("+fa([r,s])+") is dropped");continue}Lg(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else Lg(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+fa([r,s])+" orig: "+fa([e[i],e[i+1]]))}}parseCmd(t,e){if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;const s=20===t||21===t||23===t?1:2,o=this.channels[s];return 20===t||21===t||28===t||29===t?32===e?o.ccRCL():33===e?o.ccBS():34===e?o.ccAOF():35===e?o.ccAON():36===e?o.ccDER():37===e?o.ccRU(2):38===e?o.ccRU(3):39===e?o.ccRU(4):40===e?o.ccFON():41===e?o.ccRDC():42===e?o.ccTR():43===e?o.ccRTD():44===e?o.ccEDM():45===e?o.ccCR():46===e?o.ccENM():47===e&&o.ccEOC():o.ccTO(e-32),this.currentChannel=s,!0}parseMidrow(t,e){let i=0;if((17===t||25===t)&&e>=32&&e<=47){if(i=17===t?1:2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return!!r&&(r.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+fa([t,e])+")"),!0)}return!1}parsePAC(t,e){let i;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;const o=t<=23?1:2;i=e>=64&&e<=95?1===o?Lte[t]:Fte[t]:1===o?Pte[t]:Bte[t];const a=this.channels[o];return!!a&&(a.setPAC(this.interpretPAC(i,e)),this.currentChannel=o,!0)}interpretPAC(t,e){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,r.underline=!(1&~i),i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r}parseChars(t,e){let i,r=null,s=null;if(t>=25?(i=2,s=t-8):(i=1,s=t),s>=17&&s<=19){let o;o=17===s?e+80:18===s?e+112:e+144,this.logger.log(2,()=>"Special char '"+DP(o)+"' in channel "+i),r=[o]}else t>=32&&t<=127&&(r=0===e?[t]:[t,e]);return r&&this.logger.log(3,()=>"Char codes =  "+fa(r).join(",")),r}parseBackgroundAttributes(t,e){if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;let s;const o={};return 16===t||24===t?(s=Math.floor((e-32)/2),o.background=Ute[s],e%2==1&&(o.background=o.background+"_semi")):45===e?o.background="transparent":(o.foreground="black",47===e&&(o.underline=!0)),this.channels[t<=23?1:2].setBkgData(o),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}Lg(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function Lg(n,t,e){e.a=n,e.b=t}function Hte(n,t,e){return e.a===n&&e.b===t}var XE=function(){if(null!=yg&&yg.VTTCue)return self.VTTCue;const n=["","lr","rl"],t=["start","middle","end","left","right"];function e(a,l){if("string"!=typeof l||!Array.isArray(a))return!1;const c=l.toLowerCase();return!!~a.indexOf(c)&&c}function r(a){return e(t,a)}function s(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let f="",h=!1,p=a,g=l,m=c,y=null,v="",b=!0,E="auto",D="start",w=50,T="middle",I=50,R="middle";Object.defineProperty(u,"id",s({},d,{get:function(){return f},set:function(C){f=""+C}})),Object.defineProperty(u,"pauseOnExit",s({},d,{get:function(){return h},set:function(C){h=!!C}})),Object.defineProperty(u,"startTime",s({},d,{get:function(){return p},set:function(C){if("number"!=typeof C)throw new TypeError("Start time must be set to a number.");p=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},d,{get:function(){return g},set:function(C){if("number"!=typeof C)throw new TypeError("End time must be set to a number.");g=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},d,{get:function(){return m},set:function(C){m=""+C,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},d,{get:function(){return y},set:function(C){y=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},d,{get:function(){return v},set:function(C){const k=function i(a){return e(n,a)}(C);if(!1===k)throw new SyntaxError("An invalid or illegal string was specified.");v=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},d,{get:function(){return b},set:function(C){b=!!C,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},d,{get:function(){return E},set:function(C){if("number"!=typeof C&&"auto"!==C)throw new SyntaxError("An invalid number or illegal string was specified.");E=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},d,{get:function(){return D},set:function(C){const k=r(C);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");D=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},d,{get:function(){return w},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");w=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},d,{get:function(){return T},set:function(C){const k=r(C);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");T=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},d,{get:function(){return I},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");I=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},d,{get:function(){return R},set:function(C){const k=r(C);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");R=k,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class Wte{decode(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function IP(n){function t(i,r,s,o){return 3600*(0|i)+60*(0|r)+(0|s)+parseFloat(o||0)}const e=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class Kte{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&""!==e&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let r=0;r<i.length;++r)if(e===i[r]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function wP(n,t,e,i){const r=i?n.split(i):[n];for(const s in r){if("string"!=typeof r[s])continue;const o=r[s].split(e);2===o.length&&t(o[0],o[1])}}const ZE=new XE(0,0,""),Pg="middle"===ZE.align?"middle":"center";function zte(n,t,e){const i=n;function r(){const a=IP(n);if(null===a)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function o(){n=n.replace(/^\s+/,"")}if(o(),t.startTime=r(),o(),"--\x3e"!==n.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);n=n.slice(3),o(),t.endTime=r(),o(),function s(a,l){const c=new Kte;wP(a,function(f,h){let p;switch(f){case"region":for(let g=e.length-1;g>=0;g--)if(e[g].id===h){c.set(f,e[g].region);break}break;case"vertical":c.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),c.integer(f,p[0]),c.percent(f,p[0])&&c.set("snapToLines",!1),c.alt(f,p[0],["auto"]),2===p.length&&c.alt("lineAlign",p[1],["start",Pg,"end"]);break;case"position":p=h.split(","),c.percent(f,p[0]),2===p.length&&c.alt("positionAlign",p[1],["start",Pg,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,h);break;case"align":c.alt(f,h,["start",Pg,"end","left","right"])}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");"auto"===u&&-1===ZE.line&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Pg);let d=c.get("position","auto");"auto"===d&&50===ZE.position&&(d="start"===l.align||"left"===l.align?0:"end"===l.align||"right"===l.align?100:50),l.position=d}(n,t)}function AP(n){return n.replace(/<br(?: \/)?>/gi,"\n")}class qte{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Wte,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;function i(){let s=e.buffer,o=0;for(s=AP(s);o<s.length&&"\r"!==s[o]&&"\n"!==s[o];)++o;const a=s.slice(0,o);return"\r"===s[o]&&++o,"\n"===s[o]&&++o,e.buffer=s.slice(o),a}function r(s){wP(s,function(o,a){},/:/)}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{let s="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;s=i();const a=s.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==a||!a[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let o=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:s=i(),e.state){case"HEADER":/:/.test(s)?r(s):s||(e.state="ID");continue;case"NOTE":s||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){e.state="NOTE";break}if(!s)continue;if(e.cue=new XE(0,0,""),e.state="CUE",-1===s.indexOf("--\x3e")){e.cue.id=s;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{zte(s,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const a=-1!==s.indexOf("--\x3e");if(!s||a&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=s}continue;case"BADCUE":s||(e.state="ID")}}}catch{"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const Yte=/\r\n|\n\r|\n|\r/g,JE=function(t,e,i=0){return t.slice(i,i+e.length)===e};function eD(n,t,e){return Cd(n.toString())+Cd(t.toString())+Cd(e)}const tD="stpp.ttml.im1t",xP=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,RP=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Jte={left:"start",center:"center",right:"end",start:"start",end:"end"};function MP(n,t,e,i){const r=Fe(new Uint8Array(n),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const s=r.map(a=>Si(a)),o=function see(n,t,e=1,i=!1){return LE(n,t,1/e,i)}(t.baseTime,1,t.timescale);try{s.forEach(a=>e(function ene(n,t){const r=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,f)=>(d[f]=r.getAttribute(`ttp:${f}`)||s[f],d),{}),a="preserve"!==r.getAttribute("xml:space"),l=NP(nD(r,"styling","style")),c=NP(nD(r,"layout","region")),u=nD(r,"body","[begin]");return[].map.call(u,d=>{const f=OP(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=rD(d.getAttribute("begin"),o),p=rD(d.getAttribute("dur"),o);let g=rD(d.getAttribute("end"),o);if(null===h)throw kP(d);if(null===g){if(null===p)throw kP(d);g=h+p}const m=new XE(h-t,g-t,f);m.id=eD(m.startTime,m.endTime,m.text);const b=function tne(n,t,e){const i="http://www.w3.org/ns/ttml#styling";let r=null;const o=null!=n&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&e.hasOwnProperty(o)&&(r=e[o]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((a,l)=>{const c=iD(t,i,l)||iD(n,i,l)||iD(r,i,l);return c&&(a[l]=c),a},{})}(c[d.getAttribute("region")],l[d.getAttribute("style")],l),{textAlign:E}=b;if(E){const D=Jte[E];D&&(m.lineAlign=D),m.align=E}return ut(m,b),m}).filter(d=>null!==d)}(a,o)))}catch(a){i(a)}}function nD(n,t,e){const i=n.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function NP(n){return n.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function OP(n,t){return[].slice.call(n.childNodes).reduce((e,i,r)=>{var s;return"br"===i.nodeName&&r?e+"\n":null!=(s=i.childNodes)&&s.length?OP(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function iD(n,t,e){return n&&n.hasAttributeNS(t,e)?n.getAttributeNS(t,e):null}function kP(n){return new Error(`Could not parse ttml timestamp ${n}`)}function rD(n,t){if(!n)return null;let e=IP(n);return null===e&&(xP.test(n)?e=function nne(n,t){const e=xP.exec(n);return 3600*(0|e[1])+60*(0|e[2])+(0|e[3])+((0|e[4])+(0|e[5])/t.subFrameRate)/t.frameRate}(n,t):RP.test(n)&&(e=function ine(n,t){const e=RP.exec(n),i=Number(e[1]);switch(e[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(n,t))),e}class Fg{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function LP(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function PP(n,t){return!!n&&n.kind===LP(t)&&UE(t,n)}function sne(n,t,e,i){return Math.min(t,i)-Math.max(n,e)}const one=/\s/,ane={newCue(n,t,e,i){const r=[];let s,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<i.rows.length;f++)if(s=i.rows[f],a=!0,l=0,c="",!s.isEmpty()){var d;for(let g=0;g<s.chars.length;g++)one.test(s.chars[g].uchar)&&a?l++:(c+=s.chars[g].uchar,a=!1);s.cueStartTime=t,t===e&&(e+=1e-4),l>=16?l--:l++;const h=AP(c.trim()),p=eD(t,e,h);null!=n&&null!=(d=n.cues)&&d.getCueById(p)||(o=new u(t,e,h),o.id=p,o.line=f+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(o))}return n&&r.length&&(r.sort((f,h)=>"auto"===f.line||"auto"===h.line?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),r.forEach(f=>yP(n,f))),r}},cne=/(\d+)-(\d+)\/(\d+)/;class BP{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||hne,this.controller=new self.AbortController,this.stats=new tE}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=function une(n,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(ut({},n.headers))};return n.rangeEnd&&e.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),e}(t,this.controller.signal),o="arraybuffer"===t.responseType,a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,s),self.clearTimeout(this.requestTimeout),e.timeout=l&&J(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,t,this.response))},e.timeout),(Td(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,t,this.response))},c-(h-r.loading.start)),!d.ok){const{status:g,statusText:m}=d;throw new pne(m||"fetch, bad network response",g,d)}r.loading.first=h,r.total=function fne(n){const t=n.get("Content-Range");if(t){const i=function dne(n){const t=cne.exec(n);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(J(i))return i}const e=n.get("Content-Length");if(e)return parseInt(e)}(d.headers)||r.total;const p=null==(f=this.callbacks)?void 0:f.onProgress;return p&&J(e.highWaterMark)?this.loadProgressively(d,r,t,e.highWaterMark,p):o?d.arrayBuffer():"json"===t.responseType?d.json():d.text()}).then(d=>{var f,h;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const g=d[a];g&&(r.loaded=r.total=g);const m={url:p.url,data:d,code:p.status},y=null==(f=this.callbacks)?void 0:f.onProgress;y&&!J(e.highWaterMark)&&y(r,t,d,p),null==(h=this.callbacks)||h.onSuccess(m,r,t,p)}).catch(d=>{var f;self.clearTimeout(this.requestTimeout),r.aborted||null==(f=this.callbacks)||f.onError({code:d&&d.code||0,text:d?d.message:null},t,d?d.details:null,r)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,r=0,s){const o=new DL,a=t.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&s(e,i,o.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return e.loaded+=d,d<r||o.dataLength?(o.push(u),o.dataLength>=r&&s(e,i,o.flush().buffer,t)):s(e,i,u.buffer,t),l()}).catch(()=>Promise.reject());return l()}}function hne(n,t){return new self.Request(n.url,t)}class pne extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const gne=/^age:\s*[\d.]+\s*$/im;class UP{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new tE,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(this.loader===i&&!this.stats.aborted)return s(i,e.url)}).catch(o=>{if(this.loader===i&&!this.stats.aborted)return i.open("GET",e.url,!0),s(i,e.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(o=>{var a;null==(a=this.callbacks)||a.onError({code:i.status,text:o.message},e,i,r)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const r=e.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=i.loadPolicy;if(r)for(const a in r)t.setRequestHeader(a,r[a]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&J(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const r=e.readyState,s=this.config;if(!i.aborted&&r>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const c=e.status;if(c>=200&&c<300){const p=("text"===e.responseType?e.responseText:null)??e.response;if(null!=p){var o,a;i.loading.end=Math.max(self.performance.now(),i.loading.first),i.loaded=i.total="arraybuffer"===e.responseType?p.byteLength:p.length,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first);const m=null==(o=this.callbacks)?void 0:o.onProgress;return m&&m(i,t,p,e),void(null==(a=this.callbacks)||a.onSuccess({url:e.responseURL,data:p,code:c},i,t,e))}}const d=s.loadPolicy.errorRetry;var l;hg(d,i.retry,!1,{url:t.url,data:void 0,code:c})?this.retry(d):(rt.error(`${c} while loading ${t.url}`),null==(l=this.callbacks)||l.onError({code:c,text:e.statusText},t,e,i))}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry;if(hg(t,this.stats.retry,!0))this.retry(t);else{var i;rt.warn(`timeout while loading ${null==(i=this.context)?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=uE(t,i.retry),i.retry++,rt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e?.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&gne.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const yne=it(it({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:UP,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class MZ extends Yi{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var i;const{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;const c=performance.now(),u=s?s.stats:r.stats,d=s?s.duration:r.duration,f=c-u.loading.start,h=o.minAutoLevel,p=r.level,g=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||p<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const m=g>-1&&g!==p,y=!!e||m;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const v=o.mainForwardBufferInfo;if(!y&&null===v)return;const b=this.bwEstimator.getEstimateTTFB(),E=Math.abs(l.playbackRate);if(f<=Math.max(b,d/(2*E)*1e3))return;const D=v?v.len/E:0,w=u.loading.first?u.loading.first-u.loading.start:-1,T=u.loaded&&w>-1,I=this.getBwEstimate(),R=o.levels,k=Math.max(u.loaded,Math.round(d*(r.bitrate||R[p].averageBitrate)/8));let W=T?f-w:f;W<1&&T&&(W=Math.min(f,8*u.loaded/I));const Y=T?1e3*u.loaded/W:0,te=b/1e3,ee=Y?(k-u.loaded)/Y:8*k/I+te;if(ee<=D)return;const V=Y?8*Y:I,Z=!0===(null==(i=e?.details||this.hls.latestLevelDetails)?void 0:i.live),Q=this.hls.config.abrBandWidthUpFactor;let he,ne=Number.POSITIVE_INFINITY;for(he=p-1;he>h&&(ne=this.getTimeToLoadFrag(te,V,d*R[he].maxBitrate,!R[he].details||Z),!(ne<Math.min(D,d+te)));he--);if(ne>=ee||ne>10*d)return;T?this.bwEstimator.sample(f-Math.min(b,w),u.loaded):this.bwEstimator.sampleTTFB(f);const q=R[he].maxBitrate;this.getBwEstimate()*Q>q&&this.resetEstimator(q);const K=this.findBestLevel(q,h,he,0,D,1,1);K>-1&&(he=K),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;\n      Fragment duration: ${r.duration.toFixed(3)}\n      Time to underbuffer: ${D.toFixed(3)} s\n      Estimated load time for current fragment: ${ee.toFixed(3)} s\n      Estimated load time for down switch fragment: ${ne.toFixed(3)} s\n      TTFB estimate: ${0|w} ms\n      Current BW estimate: ${J(I)?0|I:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${he} @ ${0|q} bps`),o.nextLoadLevel=o.nextAutoLevel=he,this.clearTimer();const we=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===he&&he>0){const $e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${he>0?"and switching down":""}\n      Fragment duration: ${r.duration.toFixed(3)} s\n      Time to underbuffer: ${$e.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,he>h){let ve=this.findBestLevel(this.hls.levels[h].bitrate,h,he,0,$e,1,1);-1===ve&&(ve=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ve,this.resetEstimator(this.hls.levels[ve].bitrate)}}};m||ee>2*ne?we():this.timer=self.setInterval(we,1e3*ne),o.trigger(_.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:u})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new PX(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.FRAG_LOADING,this.onFragLoading,this),t.on(_.FRAG_LOADED,this.onFragLoaded,this),t.on(_.FRAG_BUFFERED,this.onFragBuffered,this),t.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(_.LEVEL_LOADED,this.onLevelLoaded,this),t.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.FRAG_LOADING,this.onFragLoading,this),t.off(_.FRAG_LOADED,this.onFragLoaded,this),t.off(_.FRAG_BUFFERED,this.onFragBuffered,this),t.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(_.LEVEL_LOADED,this.onLevelLoaded,this),t.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(_.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const i=e.frag;var r;this.ignoreFragment(i)||(i.bitrateTest||(this.fragCurrent=i,this.partCurrent=null!=(r=e.part)?r:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case M.BUFFER_ADD_CODEC_ERROR:case M.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case M.FRAG_LOAD_TIMEOUT:{const i=e.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const o=performance.now(),a=s?s.stats:i.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(t,e,i,r){return t+i/e+(r?t+this.lastLevelLoadSec:0)}onLevelLoaded(t,e){const i=this.hls.config,{loading:r}=e.stats,s=r.end-r.first;J(s)&&(this.lastLevelLoadSec=s/1e3),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,{frag:e,part:i}){const r=i?i.stats:e.stats;if("main"===e.type&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const o=this.hls.levels[e.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+(i?i.duration:e.duration);o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}e.bitrateTest?(this.onFragBuffered(_.FRAG_BUFFERED,{stats:r,frag:e,part:i,id:e.type}),e.bitrateTest=!1):this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:i,part:r}=e,s=null!=r&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),this.bitrateTestDelay=i.bitrateTest?o/1e3:0}ignoreFragment(t){return"main"!==t.type||"initSegment"===t.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,i=this.getBwEstimate(),s=this.findBestLevel(i,e,t,0,this.hls.config.maxStarvationDelay,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,e),t);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(-1===t||i&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==t){const o=this.hls.levels;if(o.length>Math.max(t,s)&&o[t].loadError<=o[s].loadError)return t}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:o}=i,a=e?e.duration:t?t.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(c){const m=this.findBestLevel(l,o,r,c,0,u,d);if(m>=0)return this.rebufferNotice=-1,m}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const m=this.bitrateTestDelay;m&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-m,this.info(`bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=d=1)}const h=this.findBestLevel(l,o,r,c,f,u,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const p=i.levels[o],g=i.loadLevelObj;return g&&p?.bitrate<g.bitrate?o:i.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const i=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,r=t.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,i,r,s,o,a){var l;const c=r+s,u=this.lastLoadedFragLevel,d=-1===u?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:h}=this,{levels:p,allAudioTracks:g,loadLevel:m,config:y}=this.hls;if(1===p.length)return 0;const v=p[d],b=!(null==(l=this.hls.latestLevelDetails)||!l.live),E=-1===m||-1===u;let D,w="SDR",T=v?.frameRate||0;const{audioPreference:I,videoPreference:R}=y,C=this.audioTracksByGroup||(this.audioTracksByGroup=Ik(g));let k=-1;if(E){if(-1!==this.firstSelection)return this.firstSelection;const V=this.codecTiers||(this.codecTiers=function wZ(n,t,e,i){return n.slice(e,i+1).reduce((r,s,o)=>{if(!s.codecSet)return r;const a=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const d=t.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||t.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),r},{})}(p,C,e,i)),Z=function IZ(n,t,e,i,r){const s=Object.keys(n),o=i?.channels,a=i?.audioCodec,l=r?.videoCodec,c=o&&2===parseInt(o);let u=!1,d=!1,f=1/0,h=1/0,p=1/0,g=1/0,m=0,y=[];const{preferHDR:v,allowedVideoRanges:b}=function SZ(n,t){let e=!1,i=[];if(n&&(e="SDR"!==n,i=[n]),t){i=t.allowedVideoRanges||cg.slice(0);const r="SDR"!==i.join("")&&!t.videoCodec;e=void 0!==t.preferHDR?t.preferHDR:r&&function TZ(){if("function"==typeof matchMedia){const n=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(n.media!==t.media)return!0===n.matches}return!1}(),e||(i=["SDR"])}return{preferHDR:e,allowedVideoRanges:i}}(t,r);for(let I=s.length;I--;){const R=n[s[I]];u||(u=R.channels[2]>0),f=Math.min(f,R.minHeight),h=Math.min(h,R.minFramerate),p=Math.min(p,R.minBitrate),b.filter(k=>R.videoRanges[k]>0).length>0&&(d=!0)}f=J(f)?f:0,h=J(h)?h:0;const E=Math.max(1080,f),D=Math.max(30,h);p=J(p)?p:e,e=Math.max(p,e),d||(t=void 0);const w=s.length>1;return{codecSet:s.reduce((I,R)=>{const C=n[R];if(R===I)return I;if(y=d?b.filter(k=>C.videoRanges[k]>0):[],w){if(C.minBitrate>e)return Hr(R,`min bitrate of ${C.minBitrate} > current estimate of ${e}`),I;if(!C.hasDefaultAudio)return Hr(R,"no renditions with default or auto-select sound found"),I;if(a&&R.indexOf(a.substring(0,4))%5!=0)return Hr(R,`audio codec preference "${a}" not found`),I;if(o&&!c){if(!C.channels[o])return Hr(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(C.channels)})`),I}else if((!a||c)&&u&&0===C.channels[2])return Hr(R,"no renditions with stereo sound found"),I;if(C.minHeight>E)return Hr(R,`min resolution of ${C.minHeight} > maximum of ${E}`),I;if(C.minFramerate>D)return Hr(R,`min framerate of ${C.minFramerate} > maximum of ${D}`),I;if(!y.some(k=>C.videoRanges[k]>0))return Hr(R,`no variants with VIDEO-RANGE of ${Et(y)} found`),I;if(l&&R.indexOf(l.substring(0,4))%5!=0)return Hr(R,`video codec preference "${l}" not found`),I;if(C.maxScore<m)return Hr(R,`max score of ${C.maxScore} < selected max of ${m}`),I}return I&&(og(R)>=og(I)||C.fragmentError>n[I].fragmentError)?I:(g=C.minIndex,m=C.maxScore,R)},void 0),videoRanges:y,preferHDR:v,minFramerate:h,minBitrate:p,minIndex:g}}(V,w,t,I,R),{codecSet:Q,videoRanges:ne,minFramerate:he,minBitrate:q,minIndex:K,preferHDR:we}=Z;k=K,D=Q,w=we?ne[ne.length-1]:ne[0],T=he,t=Math.max(t,q),this.log(`picked start tier ${Et(Z)}`)}else D=v?.codecSet,w=v?.videoRange;const W=h?h.duration:f?f.duration:0,Y=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let V=i;V>=e;V--){var ee;const Z=p[V],Q=V>d;if(!Z)continue;if(y.useMediaCapabilities&&!Z.supportedResult&&!Z.supportedPromise){const ve=navigator.mediaCapabilities;"function"==typeof ve?.decodingInfo&&mZ(Z,C,w,T,t,I)?(Z.supportedPromise=Ek(Z,C,ve,this.supportedCache),Z.supportedPromise.then(Me=>{if(!this.hls)return;Z.supportedResult=Me;const Yt=this.hls.levels,wt=Yt.indexOf(Z);Me.error?this.warn(`MediaCapabilities decodingInfo error: "${Me.error}" for level ${wt} ${Et(Me)}`):Me.supported?Me.decodingInfoResults.some(Fn=>!1===Fn.smooth||!1===Fn.powerEfficient)&&this.log(`MediaCapabilities decodingInfo for level ${wt} not smooth or powerEfficient: ${Et(Me)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${wt} ${Et(Me)}`),wt>-1&&Yt.length>1&&(this.log(`Removing unsupported level ${wt}`),this.hls.removeLevel(wt),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(Me=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Me}`)})):Z.supportedResult=vk}if((D&&Z.codecSet!==D||w&&Z.videoRange!==w||Q&&T>Z.frameRate||!Q&&T>0&&T<Z.frameRate||null!=(ee=Z.supportedResult)&&null!=(ee=ee.decodingInfoResults)&&ee.some(ve=>!1===ve.smooth))&&(!E||V!==k)){te.push(V);continue}const ne=Z.details,he=(h?ne?.partTarget:ne?.averagetargetduration)||W;let q;q=Q?a*t:o*t;const K=W&&r>=2*W&&0===s?Z.averageBitrate:Z.maxBitrate,we=this.getTimeToLoadFrag(Y,q,K*he,void 0===ne);if(q>=K&&(V===u||0===Z.loadError&&0===Z.fragmentError)&&(we<=Y||!J(we)||b&&!this.bitrateTestDelay||we<c)){const ve=this.forcedAutoLevel;return V!==m&&(-1===ve||ve!==m)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${p[te[0]].codecs}" ${p[te[0]].videoRange}; not compatible with "${D}" ${w}`),this.info(`switch candidate:${d}->${V} adjustedbw(${Math.round(q)})-bitrate=${Math.round(q-K)} ttfb:${Y.toFixed(1)} avgDuration:${he.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${we.toFixed(1)} firstSelection:${E} codecSet:${Z.codecSet} videoRange:${Z.videoRange} hls.loadLevel:${m}`)),E&&(this.firstSelection=V),V}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:i}=this.hls;return Math.min(Math.max(t,i),e)}},bufferController:class Eee extends Yi{constructor(t,e){super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&"open"===(null==(r=this.mediaSource)?void 0:r.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),r&&s&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(_.MEDIA_ATTACHED,{media:r,mediaSource:s}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=t,this.fragmentTracker=e,this.appendSource=function HX(n){return typeof self<"u"&&n===self.ManagedMediaSource}(oo(t.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.BUFFER_RESET,this.onBufferReset,this),t.on(_.BUFFER_APPENDING,this.onBufferAppending,this),t.on(_.BUFFER_CODECS,this.onBufferCodecs,this),t.on(_.BUFFER_EOS,this.onBufferEos,this),t.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(_.FRAG_PARSED,this.onFragParsed,this),t.on(_.FRAG_CHANGED,this.onFragChanged,this),t.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.BUFFER_RESET,this.onBufferReset,this),t.off(_.BUFFER_APPENDING,this.onBufferAppending,this),t.off(_.BUFFER_CODECS,this.onBufferCodecs,this),t.off(_.BUFFER_EOS,this.onBufferEos,this),t.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(_.FRAG_PARSED,this.onFragParsed,this),t.off(_.FRAG_CHANGED,this.onFragChanged,this),t.off(_.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const i={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===e?ut(i,r.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(i[o]=ut({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:t,mediaSource:e,tracks:i}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var i;let r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),null!=(i=this.transferData)&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(t,e){const i=this.media=e.media;this.transferData=this.overrides=void 0;const r=oo(this.appendSource);if(r){const s=!!e.mediaSource;(s||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const o=this.mediaSource=e.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=i.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&o instanceof l,JL(i),function Dee(n,t){const e=self.document.createElement("source");e.type="video/mp4",e.src=t,n.appendChild(e)}(i,a),i.load()}catch{i.src=a}else i.src=a}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,i;this.log(`${(null==(e=this.transferData)?void 0:e.mediaSource)===t?"transferred":"created"} media source: ${null==(i=t.constructor)?void 0:i.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const i=this.tracks,r=e.tracks,s=r?Object.keys(r):null,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&s&&s.length){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${Et(i,(l,c)=>"initSegment"===l?void 0:c)};\ntransfer tracks: ${Et(r,(l,c)=>"initSegment"===l?void 0:c)}}`),!ek(r,i)){e.mediaSource=null,e.tracks=void 0;const l=t.currentTime,c=this.details,u=Math.max(l,c?.fragments[0].start||0);return u-l>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(_.MEDIA_DETACHING,{}),this.onMediaAttaching(_.MEDIA_ATTACHING,e),void(t.currentTime=u))}this.transferData=void 0,s.forEach(l=>{const c=l,u=r[c];if(u){const d=u.buffer;if(d){const f=this.fragmentTracker,h=u.id;if(f.hasFragments(h)||f.hasParts(h)){const m=Ie.getBuffered(d);f.detectEvictedFragments(c,m,h,null,!0)}const p=$E(c);this.sourceBuffers[p]=[c,d],d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var t;const e=null==(t=this.mediaSource)?void 0:t.readyState;return"open"===e||"ended"===e}onMediaDetaching(t,e){const i=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log("media source "+(i?"transferring":"detaching")),i)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a="open"===s.readyState;try{const l=s.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),s.removeSourceBuffer(l[c]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&JL(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(_.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(([t])=>{t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(t){var e;const i=null==(e=this.tracks[t])?void 0:e.buffer;if(this.removeBuffer(t),i)try{var r;null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${t}`,s)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[$E(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new vee(this.tracks)}onBufferCodecs(t,e){var i;const r=this.tracks,s=Object.keys(e);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in e&&(r.audio||r.video)||r.audiovideo&&("audio"in e||"video"in e),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);o||a?this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`):(s.forEach(l=>{var c,u;const d=e[l],{id:f,codec:h,levelCodec:p,container:g,metadata:m,supplemental:y}=d;let v=r[l];const b=null==(c=this.transferData)||null==(c=c.tracks)?void 0:c[l],E=null!=b&&b.buffer?b:v,D=E?.pendingCodec||E?.codec,w=E?.levelCodec;v||(v=r[l]={buffer:void 0,listeners:[],codec:h,supplemental:y,container:g,levelCodec:p,metadata:m,id:f});const T=lg(D,w),I=T?.replace(XL,"$1");let R=lg(h,p);const C=null==(u=R)?void 0:u.replace(XL,"$1");R&&T&&I!==C&&("audio"===l.slice(0,5)&&(R=ag(R,this.appendSource)),this.log(`switching codec ${D} to ${R}`),R!==(v.pendingCodec||v.codec)&&(v.pendingCodec=R),v.container=g,this.appendChangeType(l,g,R))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!e.video&&"main"===(null==(i=e.audio)?void 0:i.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const i=this.tracks[e];return t[e]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},t},{})}appendChangeType(t,e,i){const r=`${e};codecs=${i}`;this.append({label:`change-type=${r}`,execute:()=>{const o=this.tracks[t];if(o){const a=o.buffer;null!=a&&a.changeType&&(this.log(`changing ${t} sourceBuffer type to ${r}`),a.changeType(r),o.codec=i,o.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${t} SourceBuffer type`,o)}},t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const i=t.start,r=i+.05*t.duration;if(!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,"main"))?void 0:e.gap))return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>r||null!=l&&l.buffer&&Ie.isBuffered(l.buffer,r)||!0===(null==(a=this.fragmentTracker.getAppendedFrag(r,"main"))?void 0:a.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:t},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:i}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=e,d=c.buffering[s],{sn:f,cc:h}=a,p=self.performance.now();d.start=p;const g=a.stats.buffering,m=l?l.stats.buffering:null;0===g.start&&(g.start=p),m&&0===m.start&&(m.start=p);const y=i.audio;let v=!1;"audio"===s&&"audio/mpeg"===y?.container&&(v=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const b=i.video,E=b?.buffer;if(E&&"initSegment"!==f){const T=l||a,I=this.blockedAudioAppend;if("audio"!==s||"main"===o||this.blockedAudioAppend||b.ending||b.ended){if("video"===s){const R=T.end;if(I){const C=I.frag.start;(R>C||R<this.lastVideoAppendEnd||Ie.isBuffered(E,C))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}else{const C=T.start+.05*T.duration,k=E.buffered,W=this.currentOp("video");k.length||W?!W&&!Ie.isBuffered(E,C)&&this.lastVideoAppendEnd<C&&this.blockAudio(T):this.blockAudio(T)}}const D=(l||a).start,w={label:`append-${s}`,execute:()=>{var T;d.executeStart=self.performance.now();const I=null==(T=this.tracks[s])?void 0:T.buffer;I&&(v?this.updateTimestampOffset(I,D,.1,s,f,h):void 0!==u&&J(u)&&this.updateTimestampOffset(I,u,1e-6,s,f,h)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const T=self.performance.now();d.executeEnd=d.end=T,0===g.first&&(g.first=T),m&&0===m.first&&(m.first=T);const I={};this.sourceBuffers.forEach(([R,C])=>{R&&(I[R]=Ie.getBuffered(C))}),this.appendErrors[s]=0,"audio"===s||"video"===s?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(_.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:I})},onError:T=>{var I;const R={type:le.MEDIA_ERROR,parent:a.type,details:M.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:c,error:T,err:T,fatal:!1},C=null==(I=this.media)?void 0:I.error;if(T.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==T.name||"quota"in T)R.details=M.BUFFER_FULL_ERROR;else if(T.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!C)R.errorAction=Kl(!0);else if(T.name===ZL&&0===this.sourceBufferCount)R.errorAction=Kl(!0);else{const k=++this.appendErrors[s];this.warn(`Failed ${k}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${C||"no media error"})`),(k>=this.hls.config.appendErrorMaxRetry||C)&&(R.fatal=!0)}this.hls.trigger(_.ERROR,R)}};this.log(`queuing "${s}" append sn: ${f}${l?" p: "+l.index:""} of ${"main"===a.type?"level":"track"} ${a.level} cc: ${h}`),this.append(w,s,this.isPending(this.tracks[s]))}getFlushOp(t,e,i){return this.log(`queuing "${t}" remove ${e}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(t,e,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(_.BUFFER_FLUSHED,{type:t})},onError:r=>{this.warn(`Failed to remove ${e}-${i} from "${t}" SourceBuffer`,r)}}}onBufferFlushing(t,e){const{type:i,startOffset:r,endOffset:s}=e;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(t,e){const{frag:i,part:r}=e,s=[],o=r?r.elementaryStreams:i.elementaryStreams;o.audiovideo?s.push("audiovideo"):(o.audio&&s.push("audio"),o.video&&s.push("video")),0===s.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(()=>{const l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l),this.hls.trigger(_.FRAG_BUFFERED,{frag:i,part:r,stats:r?r.stats:i.stats,id:i.type})},s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(t,e){var i;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!e.type||e.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=!1!==(null==(i=this.overrides)?void 0:i.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!(null!=(a=this.tracks[o])&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;o&&"open"===o.readyState?(this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(_.BUFFERED_TO_END,void 0)):o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`)})):(this.tracksEnded(),this.hls.trigger(_.BUFFERED_TO_END,void 0)):"video"===e.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([t])=>{if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const t=this.getDurationAndRange();t&&this.updateMediaSource(t)})}onError(t,e){if(e.details===M.BUFFER_APPEND_ERROR&&e.frag){var i;const r=null==(i=e.errorAction)?void 0:i.nextAutoLevel;J(r)&&r!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:i}=this;if(!i||null===e||!this.sourceBufferCount)return;const r=t.config,s=i.currentTime,o=e.levelTargetDuration,a=e.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(J(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(s/o)*o-c;this.flushBackBuffer(s,o,u)}const l=r.frontBufferFlushThreshold;if(J(l)&&l>0){const c=Math.max(r.maxBufferLength,l),u=Math.max(c,o),d=Math.floor(s/o)*o+u;this.flushFrontBuffer(s,o,d)}}flushBackBuffer(t,e,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=Ie.getBuffered(s);if(a.length>0&&i>a.start(0)){var o;this.hls.trigger(_.BACK_BUFFER_REACHED,{bufferEnd:i});const l=this.tracks[r];if(null!=(o=this.details)&&o.live)this.hls.trigger(_.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(null!=l&&l.ended)return void this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(t,e,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=Ie.getBuffered(s),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(i>l||t>=l&&t<=c)return;this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var t;const{details:e,mediaSource:i}=this;if(!e||!this.media||"open"!==i?.readyState)return null;const r=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&i.setLiveSeekableRange){const c=Math.max(0,e.fragmentStart);return{duration:1/0,start:c,end:Math.max(c,r)}}return{duration:1/0}}const s=null==(t=this.overrides)?void 0:t.duration;if(s)return J(s)?{duration:s}:null;const o=this.media.duration;return r>(J(i.duration)?i.duration:0)&&r>o||!J(o)?{duration:r}:null}updateMediaSource({duration:t,start:e,end:i}){const r=this.mediaSource;!this.media||!r||"open"!==r.readyState||(r.duration!==t&&(J(t)&&this.log(`Updating MediaSource duration to ${t.toFixed(3)}`),r.duration=t),void 0!==e&&void 0!==i&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${e}-${i}.`),r.setLiveSeekableRange(e,i)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${e} codec events expected: ${t}) ${Et(i)}`),this.tracksReady){var r;const s=null==(r=this.transferData)?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(([e,i])=>{if(e){const r=this.tracks[e];t[e]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(_.BUFFER_CREATED,{tracks:t}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in t){const o=s,a=t[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${Et(a)}`);try{const u=i.addSourceBuffer(c);e[$E(o)]=[o,u],a.buffer=u}catch(u){var r;return this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),null==(r=this.operationQueue)||r.removeBlockers(),delete this.tracks[o],void this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id})}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(t,e){const i=t.supplemental;let r=t.codec;i&&("video"===e||"audiovideo"===e)&&pd(i,"video")&&(r=function dZ(n,t){const e=[];if(n){const i=n.split(",");for(let r=0;r<i.length;r++)sE(i[r],"video")||e.push(i[r])}return t&&e.push(t),e.join(",")}(r,i));const s=lg(r,t.levelCodec);return s?"audio"===e.slice(0,5)?ag(s,this.appendSource):s:""}trackSourceBuffer(t,e){const i=e.buffer;if(!i)return;const r=this.getTrackCodec(e,t);this.tracks[t]={buffer:i,codec:r,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(s,o)=>{const a=o.removedRanges;null!=a&&a.length&&this.hls.trigger(_.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var t,e;const i=(null==(t=this.media)||null==(e=t.querySelector)?void 0:e.call(t,"source"))||this.media;return i?.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if("closed"===(null==(e=this.mediaSource)?void 0:e.readyState))return void this.resetBuffer(t);const i=this.currentOp(t);i&&(i.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var i;const r=new Error(`${t} SourceBuffer error. MediaSource readyState: ${null==(i=this.mediaSource)?void 0:i.readyState}`);this.error(`${r}`,e),this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:r,fatal:!1});const s=this.currentOp(t);s&&s.onError(r)}updateTimestampOffset(t,e,i,r,s,o){Math.abs(e-t.timestampOffset)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${e} (sn: ${s} cc: ${o})`),t.timestampOffset=e)}removeExecutor(t,e,i){const{media:r,mediaSource:s}=this,o=this.tracks[t],a=o?.buffer;if(!r||!s||!a)return this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(t);const l=J(r.duration)?r.duration:1/0,c=J(s.duration)?s.duration:1/0,u=Math.max(0,e),d=Math.min(i,l,c);d>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${d}] from the ${t} SourceBuffer`),a.remove(u,d)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const i=this.tracks[e],r=i?.buffer;if(!r)throw new bee(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([t,e])=>t&&e.updating)}isQueued(){return this.sourceBuffers.some(([t])=>t&&!!this.currentOp(t))}isPending(t){return!!t&&!t.buffer}blockBuffers(t,e=this.sourceBufferTypes){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:i}=this,r=e.map(o=>this.appendBlocker(o));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{i===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(e=>{var i;const r=null==(i=this.tracks[e])?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(e)})}append(t,e,i){this.operationQueue&&this.operationQueue.append(t,e,i)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,[e])=>t+(e?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([t])=>t).filter(t=>!!t)}addBufferListener(t,e,i){const r=this.tracks[t];if(!r)return;const s=r.buffer;if(!s)return;const o=i.bind(this,t);r.listeners.push({event:e,listener:o}),s.addEventListener(e,o)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const i=e.buffer;i&&(e.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),e.listeners.length=0)}},capLevelController:VE,errorController:class PZ extends Yi{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(_.ERROR,this.onError,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(_.ERROR,this.onError,this),t.off(_.ERROR,this.onErrorOut,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return"main"===t?.type?t.level:this.getVariantIndex()}getVariantIndex(){var t;const e=this.hls,i=e.currentLevel;return null!=(t=e.loadLevelObj)&&t.details||-1===i?e.loadLevel:i}variantHasKey(t,e){if(t){var i;if(null!=(i=t.details)&&i.hasKey(e))return!0;const r=t.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return null==(a=o.details)?void 0:a.hasKey(e)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(t,e){var i;if(e.fatal)return;const r=this.hls,s=e.context;switch(e.details){case M.FRAG_LOAD_ERROR:case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_ERROR:case M.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case M.FRAG_PARSING_ERROR:if(null!=(i=e.frag)&&i.gap)return void(e.errorAction=Kl());case M.FRAG_GAP:case M.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=2);case M.LEVEL_EMPTY_ERROR:case M.LEVEL_PARSING_ERROR:{var o;const l="main"===e.parent?e.level:r.loadLevel;e.details===M.LEVEL_EMPTY_ERROR&&null!=(o=e.context)&&null!=(o=o.levelDetails)&&o.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,l):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,l))}return;case M.LEVEL_LOAD_ERROR:case M.LEVEL_LOAD_TIMEOUT:return void("number"==typeof s?.level&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.level)));case M.AUDIO_TRACK_LOAD_ERROR:case M.AUDIO_TRACK_LOAD_TIMEOUT:case M.SUBTITLE_LOAD_ERROR:case M.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&("audioTrack"===s.type&&l.hasAudioGroup(s.groupId)||"subtitleTrack"===s.type&&l.hasSubtitleGroup(s.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=2,void(e.errorAction.flags=1)}return;case M.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(e.errorAction={action:2,flags:2});case M.KEY_SYSTEM_SESSION_UPDATE_FAILED:case M.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case M.KEY_SYSTEM_NO_SESSION:return void(e.errorAction={action:2,flags:4});case M.BUFFER_ADD_CODEC_ERROR:case M.REMUX_ALLOC_ERROR:case M.BUFFER_APPEND_ERROR:var a;return void(e.errorAction||(e.errorAction=this.getLevelSwitchAction(e,null!=(a=e.level)?a:r.loadLevel)));case M.INTERNAL_EXCEPTION:case M.BUFFER_APPENDING_ERROR:case M.BUFFER_FULL_ERROR:case M.LEVEL_SWITCH_ERROR:case M.BUFFER_STALLED_ERROR:case M.BUFFER_SEEK_OVER_HOLE:case M.BUFFER_NUDGE_ON_STALL:return void(e.errorAction=Kl())}e.type===le.KEY_SYSTEM_ERROR&&(e.levelRetry=!1,e.errorAction=Kl())}getPlaylistRetryOrSwitchAction(t,e){const r=kk(this.hls.config.playlistLoadPolicy,t),s=this.playlistError++;if(hg(r,s,fg(t),t.response))return{action:5,flags:0,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(t,e);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),r=e.levels[i],{fragLoadPolicy:s,keyLoadPolicy:o}=e.config,a=kk(Nk(t)?o:s,t),l=e.levels.reduce((u,d)=>u+d.fragmentError,0);if(r&&(t.details!==M.FRAG_GAP&&r.fragmentError++,!Ok(t)&&hg(a,l,fg(t),t.response)))return{action:5,flags:0,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(t,i);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(t,e){const i=this.hls;null==e&&(e=i.loadLevel);const r=this.hls.levels[e];if(r){var s,o;const c=t.details;r.loadError++,c===M.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:p}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const g=null==(s=t.frag)?void 0:s.type,y=("audio"===g&&c===M.FRAG_PARSING_ERROR||"audio"===t.sourceBufferName&&(c===M.BUFFER_ADD_CODEC_ERROR||c===M.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:w})=>r.audioCodec!==w),b="video"===t.sourceBufferName&&(c===M.BUFFER_ADD_CODEC_ERROR||c===M.BUFFER_APPEND_ERROR)&&d.some(({codecSet:w,audioCodec:T})=>r.codecSet!==w&&r.audioCodec===T),{type:E,groupId:D}=null!=(o=t.context)?o:{};for(let w=d.length;w--;){const T=(w+f)%d.length;if(T!==f&&T>=h&&T<=p&&0===d[T].loadError){var a,l;const I=d[T];if(c===M.FRAG_GAP&&"main"===g&&t.frag){const R=d[T].details;if(R){const C=ca(t.frag,R.fragments,t.frag.start);if(null!=C&&C.gap)continue}}else{if("audioTrack"===E&&I.hasAudioGroup(D)||"subtitleTrack"===E&&I.hasSubtitleGroup(D))continue;if("audio"===g&&null!=(a=r.audioGroups)&&a.some(R=>I.hasAudioGroup(R))||"subtitle"===g&&null!=(l=r.subtitleGroups)&&l.some(R=>I.hasSubtitleGroup(R))||y&&r.audioCodec===I.audioCodec||b&&r.codecSet===I.codecSet||!y&&r.codecSet!==I.codecSet)continue}u=T;break}}if(u>-1&&i.loadLevel!==u)return t.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:u}}return{action:2,flags:1}}onErrorOut(t,e){var i;switch(null==(i=e.errorAction)?void 0:i.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===M.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):e.fatal=!0}e.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:r}=i,s=i.nextAutoLevel;switch(r){case 0:this.switchLevel(t,s);break;case 2:{const l=this.getVariantLevelIndex(t.frag),c=e.levels[l],u=c?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=u,"NONE"===u)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){e.maxHdcpLevel=cE[cE.indexOf(u)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}}case 4:{const l=t.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let f=u;f--;)if(this.variantHasKey(c[f],l)){var o,a;this.log(`Banned key found in level ${f} (${c[f].bitrate}bps) or audio group "${null==(o=c[f].audioGroups)?void 0:o.join(",")}" (${null==(a=t.frag)?void 0:a.type} fragment) ${qn(l.keyId||[])}`),c[f].fragmentError++,c[f].loadError++,this.log(`Removing level ${f} with key error (${t.error})`),this.hls.removeLevel(f)}const d=t.frag;if(this.hls.levels.length<u)i.resolved=!0;else if(d&&"main"!==d.type){const f=d.decryptdata;f&&!l.matches(f)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(t,s)}switchLevel(t,e){if(void 0!==e&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===M.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&"audiovideo"!==t.sourceBufferName)){const i=lE(t.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${t.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${s} for ${t.details} ("${i}" not supported)`),this.hls.removeLevel(s))}}},fpsController:class bte{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,i){const r=performance.now();if(e){if(this.lastTime){const o=i-this.lastDroppedFrames,a=e-this.lastDecodedFrames,l=1e3*o/(r-this.lastTime),c=this.hls;if(c.trigger(_.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:i}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=u)&&(u-=1,c.trigger(_.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Qk,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},function _ne(){return{cueHandler:ane,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:class Nte extends TE{constructor(t,e,i){super(t,e,i,"subtitle-stream-controller","subtitle"),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(_.LEVEL_LOADED,this.onLevelLoaded,this),t.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(_.LEVEL_LOADED,this.onLevelLoaded,this),t.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state="IDLE",this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:r}=e;if(this.fragContextChanged(i)||(rn(i)&&(this.fragPrevious=i),this.state="IDLE"),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=i.start;for(let c=0;c<s.length;c++)if(a>=s[c].start&&a<=s[c].end){o=s[c];break}const l=i.start+i.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:i,endOffset:r}=e;if(0===i&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;e.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;)if(o[a].end<=s)o.shift();else{if(!(o[a].start<s))break;o[a].start=s,a++}}),this.fragmentTracker.removeFragmentsInRange(i,s,"subtitle")}}onError(t,e){const i=e.frag;"subtitle"===i?.type&&(e.details===M.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),"STOPPED"!==this.state&&(this.state="IDLE"))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){this.levels&&QL(this.levels,e)?this.levels=e.map(i=>new md(i)):(this.tracksBuffered=[],this.levels=e.map(i=>{const r=new md(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,"subtitle"),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(t,e){var i;if(this.currentTrackId=e.id,null==(i=this.levels)||!i.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];this.mediaBuffer=null!=r&&r.details?this.mediaBufferTimeRanges:null,r&&"STOPPED"!==this.state&&this.setInterval(500)}onSubtitleTrackLoaded(t,e){var i;const{currentTrackId:r,levels:s}=this,{details:o,id:a}=e;if(!s)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||null!=(i=l.details)&&i.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d)return void(this.startFragRequested=!1);const f=d.fragments[0];var u;l.details?(c=this.alignPlaylists(o,l.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===c&&f&&(c=f.start,DE(o,c))):o.hasProgramDateTime&&d.hasProgramDateTime?(bg(o,d),c=o.fragmentStart):f&&(c=f.start,DE(o,c)),d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(_.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:e.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&"IDLE"===this.state&&(ca(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,r=e.decryptdata,s=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&ql(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,gE(r.method)).catch(a=>{throw s.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:e}),a}).then(a=>{const l=performance.now();s.trigger(_.FRAG_DECRYPTED,{frag:e,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state="IDLE"})}}doTick(){if(this.media){if("IDLE"===this.state){const{currentTrackId:t,levels:e}=this,i=e?.[t];if(!i||!e.length||!i.details||this.waitForLive(i))return;const{config:r}=this,s=this.getLoadPosition(),o=Ie.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,c=i.details;if(l>this.hls.maxBufferLength+c.levelTargetDuration)return;const d=c.fragments,f=d.length,h=c.edge;let p=null;const g=this.fragPrevious;if(a<h){const v=r.maxFragLookUpTolerance,b=a>h-v?0:v;p=ca(g,d,Math.max(d[0].start,a),b),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[f-1];if(p=this.filterReplacedPrimary(p,i.details),!p)return;const y=d[p.sn-c.startSN-1];if(y&&y.cc===p.cc&&"NOT_LOADED"===this.fragmentTracker.getState(y)&&(p=y),"NOT_LOADED"===this.fragmentTracker.getState(p)){const v=this.mapToInitFragWhenRequired(p);v&&this.loadFragment(v,i,a)}}}else this.state="IDLE"}loadFragment(t,e,i){rn(t)?super.loadFragment(t,e,i):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new Ote(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class Tte extends BE{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const i=Ng(this.media.textTracks);for(let s=0;s<i.length;s++)if("hidden"===i[s].mode)e=i[s];else if("showing"===i[s].mode){e=i[s];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.LEVEL_LOADING,this.onLevelLoading,this),t.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(_.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const i=this.media;if(!i)return;const r=!!e.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r||Ng(i.textTracks).forEach(o=>{Jl(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,groupId:r,details:s}=e,o=this.tracksInGroup[i];if(!o||o.groupId!==r)return void this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${o?.groupId}`);const a=o.details;o.details=e.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const i=e.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||r?.length!==i?.length||null!=i&&i.some(o=>-1===r?.indexOf(o))){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!i||-1!==i.indexOf(u.groupId));if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,d)=>{u.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const u=Gr(a,o);if(u>-1)s=o[u];else{const d=Gr(a,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);-1===l&&s&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(_.SUBTITLE_TRACKS_UPDATED,c),-1!==l&&-1===this.trackId&&this.setSubtitleTrack(l)}}findTrackId(t){const e=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<e.length;r++){const s=e[r];if((!i||s.default)&&(i||t)&&(!t||aa(s,t)))return r}if(t){for(let r=0;r<e.length;r++)if(Sd(t.attrs,e[r].attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r;for(let r=0;r<e.length;r++)if(Sd(t.attrs,e[r].attrs,["LANGUAGE"]))return r}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++)if(UE(e[i],t))return i}return-1}onError(t,e){e.fatal||!e.context||"subtitleTrack"===e.context.type&&e.context.id===this.trackId&&(!this.groupIds||-1!==this.groupIds.indexOf(e.context.groupId))&&this.checkRetry(e)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(-1===t.id)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const i=this.currentTrack;if(i&&aa(t,i))return i;const r=Gr(t,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}if(i)return null;{const s=Gr(t,e);if(s>-1)return e[s]}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=t.id,r=t.groupId,s=this.getUrlWithDirectives(t.url,e),o=t.details,a=o?.age;this.log(`Loading subtitle ${i} "${t.name}" lang:${t.lang} group:${r}${void 0!==e?.msn?" at sn "+e.msn+" part "+e.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type?" "+o.type||0:""):""} ${s}`),this.hls.trigger(_.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=Ng(t.textTracks),i=this.currentTrack;let r;if(i&&(r=e.filter(s=>UE(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(e).forEach(s=>{"disabled"!==s.mode&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=t);if(t<-1||t>=e.length||!J(t))return void this.warn(`Invalid subtitle track id: ${t}`);this.selectDefaultTrack=!1;const i=this.currentTrack,r=e[t]||null;if(this.trackId=t,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:t});if(t===this.trackId&&r===i&&r.details&&!r.details.live)return;this.log(`Switching to subtitle-track ${t}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=r;this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(d)}},timelineController:class rne{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(_.FRAG_LOADING,this.onFragLoading,this),t.on(_.FRAG_LOADED,this.onFragLoaded,this),t.on(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(_.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(_.FRAG_LOADING,this.onFragLoading,this),t.off(_.FRAG_LOADED,this.onFragLoaded,this),t.off(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(_.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new Fg(this,"textTrack1"),e=new Fg(this,"textTrack2"),i=new Fg(this,"textTrack3"),r=new Fg(this,"textTrack4");this.cea608Parser1=new CP(1,t,e),this.cea608Parser2=new CP(3,i,r)}addCues(t,e,i,r,s){let o=!1;for(let a=s.length;a--;){const l=s[a],c=sne(l[0],l[1],e,i);if(c>=0&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],i),o=!0,c/(i-e)>.5))return}if(o||s.push([e,i]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[t],e,i,r);else{const a=this.Cues.newCue(null,e,i,r);this.hls.trigger(_.CUES_PARSED,{type:"captions",cues:a,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:r,timescale:s,trackId:o}){const{unparsedVttFrags:a}=this;"main"===i&&(this.initPTS[e.cc]={baseTime:r,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(_.FRAG_LOADED,l):this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(t,e){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(PP(s,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:r}=this,{label:s,languageCode:o}=e[t],a=this.getExistingTrack(s,o);if(a)i[t]=a,Jl(i[t]),mP(i[t],r);else{const l=this.createTextTrack("captions",s,o);l&&(l[t]=!0,i[t]=l)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const r={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(t,e,i){const r=this.media;if(r)return r.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const i=!!e.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{Jl(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)Jl(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],r=i.some(s=>s.textCodec===tD);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(QL(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,a=o?Ng(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&PP(a[f],l)){d=a[f],a[f]=null;break}d&&(u=d)}if(u)Jl(u);else{const d=LP(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),null!=a&&a.length){const l=a.filter(c=>null!==c).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const o=this.captionsProperties[`textTrack${r[1]}`];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e?.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&"main"===e.frag.type){var i,r;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=e.frag,u=null!=(i=null==(r=e.part)?void 0:r.index)?i:-1;s&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(t,e){const{frag:i,payload:r}=e;if("subtitle"===i.type)if(r.byteLength){const s=i.decryptdata;if(null==s||!s.encrypted||"stats"in e){const a=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),a&&a.textCodec===tD?this._parseIMSC1(i,r):this._parseVTTs(e)}}else this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;MP(e,this.initPTS[t.cc],r=>{this._appendCues(r,t.level),i.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})})}_parseVTTs(t){var e;const{frag:i,payload:r}=t,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[i.cc]&&-1===a)return void o.push(t);const l=this.hls;!function Zte(n,t,e,i,r,s,o){const a=new qte,l=Si(new Uint8Array(n)).trim().replace(Yte,"\n").split("\n"),c=[],u=t?function oee(n,t=1){return LE(n,9e4,1/t)}(t.baseTime,t.timescale):0;let p,d="00:00.000",f=0,h=0,g=!0;a.oncue=function(m){const y=e[i];let v=e.ccOffset;const b=(f-u)/9e4;if(null!=y&&y.new&&(void 0!==h?v=e.ccOffset=y.start:function(t,e,i){let r=t[e],s=t[r.prevCC];if(!s||!s.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;null!=(o=s)&&o.new;){var o;t.ccOffset+=r.start-s.start,r.new=!1,r=s,s=t[r.prevCC]}t.presentationOffset=i}(e,i,b)),b){if(!t)return void(p=new Error("Missing initPTS for VTT MPEGTS"));v=b-e.presentationOffset}const E=m.endTime-m.startTime,D=wi(9e4*(m.startTime+v-h),9e4*r)/9e4;m.startTime=Math.max(D,0),m.endTime=Math.max(D+E,0);const w=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(w)),m.id||(m.id=eD(m.startTime,m.endTime,w)),m.endTime>0&&c.push(m)},a.onparsingerror=function(m){p=m},a.onflush=function(){p?o(p):s(c)},l.forEach(m=>{if(g){if(JE(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(y=>{JE(y,"LOCAL:")?d=y.slice(6):JE(y,"MPEGTS:")&&(f=parseInt(y.slice(7)))});try{h=function(t){let e=parseInt(t.slice(-3));const i=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),s=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(J(e)&&J(i)&&J(r)&&J(s)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*i,e+=6e4*r,e+=36e5*s,e}(d)/1e3}catch(y){p=y}return}""===m&&(g=!1)}a.parse(m+"\n")}),a.flush()}(null!=(e=i.initSegment)&&e.data?Qi(i.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,u=>{this._appendCues(u,i.level),l.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},u=>{const d="Missing initPTS for VTT MPEGTS"===u.message;d?o.push(t):this._fallbackToIMSC1(i,r),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&a>i.cc)&&l.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:u})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||MP(e,this.initPTS[t.cc],()=>{i.textCodec=tD,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[e];if(!r||"disabled"===r.mode)return;t.forEach(s=>yP(r,s))}else{const r=this.tracks[e];if(!r)return;i.trigger(_.CUES_PARSED,{type:"subtitles",cues:t,track:r.default?"default":"subtitles"+e})}}onFragDecrypted(t,e){const{frag:i}=e;"subtitle"===i.type&&this.onFragLoaded(_.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=e;if("main"!==i.type||"NONE"!==this.closedCaptionsForLevel(i))for(let s=0;s<r.length;s++){const o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:o}=this;if(o&&!(o.currentTime<i)){if(!s||"video"===s){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>zE(a[l],e,i))}if(this.config.renderTextTracksNatively&&0===e&&void 0!==r){const{textTracks:a}=this;Object.keys(a).forEach(l=>zE(a[l],e,r))}}}extractCea608Data(t){const e=[[],[]],i=31&t[0];let r=2;for(let s=0;s<i;s++){const o=t[r++],a=127&t[r++],l=127&t[r++];if((0!==a||0!==l)&&4&o){const u=3&o;(0===u||1===u)&&(e[u].push(a),e[u].push(l))}}return e}},audioStreamController:class yee extends TE{constructor(t,e,i){super(t,e,i,"audio-stream-controller","audio"),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(_.LEVEL_LOADED,this.onLevelLoaded,this),t.on(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(_.BUFFER_RESET,this.onBufferReset,this),t.on(_.BUFFER_CREATED,this.onBufferCreated,this),t.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(_.FRAG_LOADING,this.onFragLoading,this),t.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(_.LEVEL_LOADED,this.onLevelLoaded,this),t.off(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(_.BUFFER_RESET,this.onBufferReset,this),t.off(_.BUFFER_CREATED,this.onBufferCreated,this),t.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(_.FRAG_LOADING,this.onFragLoading,this),t.off(_.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,{frag:e,id:i,initPTS:r,timescale:s,trackId:o}){if("main"===i){const a=e.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/s} (${r}/${s}) trackId: ${o}`),this.mainAnchor=e,"WAITING_INIT_PTS"===this.state){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(e,c?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(e,l)):"IDLE"===this.state&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var i;const r=(null==(i=this.mainFragLoading)?void 0:i.frag)||null;if(e&&r?.cc===e.cc)return;const s=(r||t).cc,l=Mk(this.getLevelDetails(),s,this.getLoadPosition());l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),"IDLE"===this.state&&this.doTickIdle())}startLoad(t,e){if(!this.levels)return this.startPosition=t,void(this.state="STOPPED");const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),i>0&&-1===t?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),t=i,this.state="IDLE"):this.state="WAITING_TRACK",this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case"IDLE":this.doTickIdle();break;case"WAITING_TRACK":{const{levels:t,trackId:e}=this,i=t?.[e],r=i?.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state="WAITING_INIT_PTS"}break}case"FRAG_LOADING_WAITING_RETRY":this.checkRetryDate();break;case"WAITING_INIT_PTS":{const t=this.waitingData;if(t){const{frag:e,part:i,cache:r,complete:s}=t,o=this.mainAnchor;if(void 0!==this.initPTS[e.cc]){this.waitingData=null,this.state="FRAG_LOADING";const l={frag:e,part:i,payload:r.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==t.frag.cc&&this.syncWithAnchor(o,t.frag)}else this.state="IDLE"}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:i,media:r,trackId:s}=this;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||null==i||!i[s])return;const a=i[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l))return this.state="WAITING_TRACK",void(this.startFragRequested=!1);const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,"audio","audio"));const u=this.getFwdBufferInfo(c,"audio");if(null===u)return;if(!this.switchingTrack&&this._streamEnded(u,l))return e.trigger(_.BUFFER_EOS,{type:"audio"}),void(this.state="ENDED");const d=u.len,f=e.maxBufferLength,h=l.fragments,p=h[0].start,g=this.getLoadPosition(),m=this.flushing?g:u.end;if(this.switchingTrack&&r&&l.PTSKnown&&g<p&&(u.end>p||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=p+.05),d>=f&&!this.switchingTrack&&m<h[h.length-1].start)return;let y=this.getNextFragment(m,l);if(y&&this.isLoopLoading(y,m)&&(y=this.getNextFragmentLoopLoading(y,l,u,"main",f)),!y)return void(this.bufferFlushed=!0);let v=(null==(t=this.mainFragLoading)?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&rn(y)&&!y.endList&&(!l.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&("OK"===this.fragmentTracker.getState(v)&&(this.mainFragLoading=v=null),v&&rn(v))){if(y.start>v.end){const E=this.fragmentTracker.getFragAtPos(m,"main");E&&E.end>v.end&&(v=E,this.mainFragLoading={frag:E,targetBufferTime:null})}if(y.start>v.end)return}this.loadFragment(y,a,m)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new md(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=e,this.flushAudioIfNeeded(e),"STOPPED"!==this.state&&(this.setInterval(100),this.state="IDLE",this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(_.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(t,e){var i;const{levels:r}=this,{details:s,id:o,groupId:a,track:l}=e;if(!r)return void this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired)return this.cachedTrackLoadedData=e,void("STOPPED"!==this.state&&(this.state="WAITING_TRACK"));this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const u=r[o];let d=0;if(s.live||null!=(i=u.details)&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;var f;u.details&&(d=this.alignPlaylists(s,u.details,null==(f=this.levelLastLoaded)?void 0:f.details)),s.alignedSliding||(bL(s,c),s.alignedSliding||bg(s,c),d=s.fragmentStart)}u.details=s,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(_.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:e.groupId}),"WAITING_TRACK"===this.state&&!this.waitForCdnTuneIn(s)&&(this.state="IDLE"),this.tick()}_handleFragmentLoadProgress(t){var e;const i=t.frag,{part:r,payload:s}=t,{config:o,trackId:a,levels:l}=this;if(!l)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const c=l[a];if(!c)return void this.warn("Audio track is undefined on fragment load progress");const u=c.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new qL(this.hls,"audio",this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[i.cc],p=null==(e=i.initSegment)?void 0:e.data;if(void 0!==h){const m=r?r.index:-1,v=new hE(i.level,i.sn,i.stats.chunkCount,s.byteLength,m,-1!==m);f.push(s,p,d,"",i,r,u.totalduration,!1,v,h)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:g}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new DL,complete:!1};g.push(new Uint8Array(s)),"STOPPED"!==this.state&&(this.state="WAITING_INIT_PTS")}}_handleFragmentLoadComplete(t){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(t,e){!this.audioOnly&&"main"===e.frag.type&&rn(e.frag)&&(this.mainFragLoading=e,"IDLE"===this.state&&this.tick())}onFragBuffered(t,e){const{frag:i,part:r}=e;if("audio"===i.type)if(this.fragContextChanged(i))this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(rn(i)){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(_.AUDIO_TRACK_SWITCHED,it({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}else!this.audioOnly&&"main"===i.type&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null)}onError(t,e){var i;if(e.fatal)this.state="ERROR";else switch(e.details){case M.FRAG_GAP:case M.FRAG_PARSING_ERROR:case M.FRAG_DECRYPT_ERROR:case M.FRAG_LOAD_ERROR:case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_ERROR:case M.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError("audio",e);break;case M.AUDIO_TRACK_LOAD_ERROR:case M.AUDIO_TRACK_LOAD_TIMEOUT:case M.LEVEL_PARSING_ERROR:!e.levelRetry&&"WAITING_TRACK"===this.state&&"audioTrack"===(null==(i=e.context)?void 0:i.type)&&(this.state="IDLE");break;case M.BUFFER_ADD_CODEC_ERROR:case M.BUFFER_APPEND_ERROR:if("audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case M.BUFFER_FULL_ERROR:if("audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case M.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onBufferFlushing(t,{type:e}){"video"!==e&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if("video"!==e){this.flushing=!1,this.bufferFlushed=!0,"ENDED"===this.state&&(this.state="IDLE");const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,e,"audio"),this.tick())}}_handleTransmuxComplete(t){var e;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=t,a=this.getCurrentContext(o);if(!a)return void this.resetWhenMissingContext(o);const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:f,text:h,id3:p,initSegment:g}=s;if(!this.fragContextChanged(l)&&d){if(this.state="PARSING",this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const m=l.initSegment||l;if(this.unhandledEncryptionError(g,l))return;this._bufferInitSegment(u,g.tracks,m,o),r.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:i,tracks:g.tracks})}if(f){const{startPTS:m,endPTS:y,startDTS:v,endDTS:b}=f;c&&(c.elementaryStreams.audio={startPTS:m,endPTS:y,startDTS:v,endDTS:b}),l.setElementaryStreamInfo("audio",m,y,v,b),this.bufferFragmentData(f,l,c,o)}if(null!=p&&null!=(e=p.samples)&&e.length){const m=ut({id:i,frag:l,details:d},p);r.trigger(_.FRAG_PARSING_METADATA,m)}if(h){const m=ut({id:i,frag:l,details:d},h);r.trigger(_.FRAG_PARSING_USERDATA,m)}}else this.fragmentTracker.removeFragment(l)}_bufferInitSegment(t,e,i,r){if("PARSING"!==this.state||(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio))return;const s=e.audio;s.id="audio";const o=t.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&1===o.split(",").length&&(s.levelCodec=o),this.hls.trigger(_.BUFFER_CODECS,e);const a=s.initSegment;null!=a&&a.byteLength&&this.hls.trigger(_.BUFFER_APPENDING,{type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:a}),this.tickImmediate()}loadFragment(t,e,i){const r=this.fragmentTracker.getState(t);var s;if(this.switchingTrack||"NOT_LOADED"===r||"PARTIAL"===r)if(rn(t))if(null!=(s=e.details)&&s.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state="WAITING_INIT_PTS";const o=this.mainDetails;o&&o.fragmentStart!==e.details.fragmentStart&&bg(e.details,o)}else super.loadFragment(t,e,i);else this._loadInitSegment(t,e);else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;aa({name:e,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a},t,la)||(dg(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(_.AUDIO_TRACK_SWITCHED,it({},t))}},audioTrackController:class _ee extends BE{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.LEVEL_LOADING,this.onLevelLoading,this),t.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(_.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:r,details:s}=e,o=this.tracksInGroup[i];if(!o||o.groupId!==r)return void this.warn(`Audio track with id:${i} and group:${r} not found in active group ${o?.groupId}`);const a=o.details;o.details=e.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const i=e.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||r?.length!==i?.length||null!=i&&i.some(a=>-1===r?.indexOf(a))){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!i||-1!==i.indexOf(f.groupId));if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Gr(l,a,la);if(f>-1)s=a[f];else{const h=Gr(l,this.tracks);s=this.tracks[h]}}let c=this.findTrackId(s);-1===c&&s&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(_.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(-1!==c&&-1===d)this.setAudioTrack(c);else if(a.length&&-1===d){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${null==(o=this.groupIds)?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(t,e){e.fatal||!e.context||"audioTrack"===e.context.type&&e.context.id===this.trackId&&(!this.groupIds||-1!==this.groupIds.indexOf(e.context.groupId))&&this.checkRetry(e)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&aa(t,r,la))return r;const s=Gr(t,this.tracksInGroup,la);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}if(r){let o=e.loadLevel;-1===o&&(o=e.firstAutoLevel);const a=function RZ(n,t,e,i,r){const s=t[i],a=t.reduce((f,h,p)=>{const g=h.uri;return(f[g]||(f[g]=[])).push(p),f},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));const l=s.videoRange,c=s.frameRate,u=s.codecSet.substring(0,4),d=Ak(t,i,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const h=f.audioGroups,p=e.filter(g=>!h||-1!==h.indexOf(g.groupId));return Gr(n,p,r)>-1});return d>-1?d:Ak(t,i,f=>{const h=f.audioGroups,p=e.filter(g=>!h||-1!==h.indexOf(g.groupId));return Gr(n,p,r)>-1})}(t,e.levels,i,o,la);if(-1===a)return null;e.nextLoadLevel=a}if(t.channels||t.audioCodec){const o=Gr(t,i);if(o>-1)return i[o]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length)return void this.warn(`Invalid audio track id: ${t}`);this.selectDefaultTrack=!1;const i=this.currentTrack,r=e[t],s=r.details&&!r.details.live;if(t===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${t} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=t,this.currentTrack=r,this.hls.trigger(_.AUDIO_TRACK_SWITCHING,it({},r)),s))return;const o=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(o)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||aa(t,r,la)))return i}if(t){const{name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=t;for(let c=0;c<e.length;c++)if(aa({name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},e[c],la))return c;for(let c=0;c<e.length;c++)if(Sd(t.attrs,e[c].attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c;for(let c=0;c<e.length;c++)if(Sd(t.attrs,e[c].attrs,["LANGUAGE"]))return c}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&dg(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=t.id,r=t.groupId,s=this.getUrlWithDirectives(t.url,e),o=t.details,a=o?.age;this.log(`Loading audio-track ${i} "${t.name}" lang:${t.lang} group:${r}${void 0!==e?.msn?" at sn "+e.msn+" part "+e.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type?" "+o.type||0:""):""} ${s}`),this.hls.trigger(_.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:e||null,track:t})}},emeController:_te,cmcdController:class gte{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:"m",su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),c={d:1e3*(o||s).duration,ot:l};("v"===l||"a"===l||"av"==l)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(s);null!=u&&u.url&&u.url!==s.url&&(c.nor=u.url),this.apply(r,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;null!=i&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||t.sessionId,this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHED,this.onMediaDetached,this),t.on(_.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHED,this.onMediaDetached,this),t.off(_.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,r;this.audioBuffer=null==(i=e.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(r=e.tracks.video)?void 0:r.buffer}createData(){var t;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){ut(e,this.createData()),this.starved&&("i"===e.ot||"v"===e.ot||"av"===e.ot)&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering);const{includeKeys:r}=this;r&&(e=Object.keys(e).reduce((o,a)=>(r.includes(a)&&(o[a]=e[a]),o),{}));const s={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),cte(t.headers,e,s)):t.url=pte(t.url,e,s)}getNextFrag(t){var e;const i=null==(e=this.hls.levels[t.level])?void 0:e.details;if(i)return i.fragments[t.sn-i.startSN+1]}getNextPart(t){var e;const{index:i,fragment:r}=t,s=null==(e=this.hls.levels[r.level])||null==(e=e.details)?void 0:e.partList;if(s){const{sn:o}=r;for(let a=s.length-1;a>=0;a--){const l=s[a];if(l.index===i&&l.fragment.sn===o)return s[a+1]}}}getObjectType(t){const{type:e}=t;return"subtitle"===e?"tt":"initSegment"===t.sn?"i":"audio"===e?"a":"main"===e?this.hls.audioTracks.length?"v":"av":void 0}getTopBandwidth(t){let i,e=0;const r=this.hls;if("a"===t)i=r.audioTracks;else{const s=r.maxAutoLevel;i=r.levels.slice(0,s>-1?s+1:r.levels.length)}return i.forEach(s=>{s.bitrate>e&&(e=s.bitrate)}),e>0?e:NaN}getBufferLength(t){const e=this.media,i="a"===t?this.audioBuffer:this.videoBuffer;return i&&e?1e3*Ie.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){e(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){e(s),this.loader.load(s,o,a)}}}},contentSteeringController:class yte extends Yi{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(_.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(_.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if(2===i?.action&&1===i.flags){const r=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(e.context){const{groupId:a,pathwayId:l,type:c}=e.context;a&&r?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==o),e.details!==M.BUFFER_APPEND_ERROR||e.fatal?i.resolved||this.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${Et(s)} penalized: ${Et(this.penalizedPathways)}`):i.resolved=!0}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(0===e.length){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return null===this.levels?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){let e;this._pathwayPriority=t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>3e5&&delete i[s]});for(let s=0;s<t.length;s++){const o=t[s];if(o in i)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(e=this.getLevelsForPathway(o),e.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,mL(e),this.hls.trigger(_.LEVELS_UPDATED,{levels:e});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(t,e,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if("audioTrack"===e&&r[s].hasAudioGroup(t)||"subtitleTrack"===e&&r[s].hasSubtitleGroup(t))return r[s].pathwayId;return i}clonePathways(t){const e=this.levels;if(!e)return;const i={},r={};t.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(e.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=new Pt(u.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(i[d.AUDIO]=f,d.AUDIO=f),h&&(r[d.SUBTITLES]=h,d.SUBTITLES=h);const p=pP(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),g=new md({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:p,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let m=1;m<u.audioGroups.length;m++)g.addGroupId("audio",`${u.audioGroups[m]}_clone_${o}`);if(u.subtitleGroups)for(let m=1;m<u.subtitleGroups.length;m++)g.addGroupId("text",`${u.subtitleGroups[m]}_clone_${o}`);return g});e.push(...c),hP(this.audioTracks,i,l,o),hP(this.subtitleTracks,r,l,o)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;let r;this.loader&&this.loader.destroy(),this.loader=new i(e);try{r=new self.URL(t)}catch{return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${t}`)}if("data:"!==r.protocol){const u=0|(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:r.href},o=e.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,f,h)=>{this.log(`Loaded steering manifest: "${r}"`);const p=u.data;if(1!==p?.VERSION)return void this.log(`Steering VERSION ${p.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":y}=p;if(g)try{this.uri=new self.URL(g,r).href}catch{return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`)}this.scheduleRefresh(this.uri||f.url),m&&this.clonePathways(m);const v={steeringManifest:p,url:r.toString()};this.hls.trigger(_.STEERING_MANIFEST_LOADED,v),y&&this.updatePathwayPriority(y)},onError:(u,d,f,h)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),410===u.code)return this.enabled=!1,void this.log(`Steering manifest ${d.url} no longer available`);let p=1e3*this.timeToLoad;if(429!==u.code)this.scheduleRefresh(this.uri||d.url,p);else{const g=this.loader;if("function"==typeof g?.getResponseHeader){const m=g.getResponseHeader("Retry-After");m&&(p=1e3*parseFloat(m))}this.log(`Steering manifest ${d.url} rate limited`)}},onTimeout:(u,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,c)}scheduleRefresh(t,e=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=null==(i=this.hls)?void 0:i.media;!r||r.ended?this.scheduleRefresh(t,1e3*this.timeToLoad):this.loadSteeringManifest(t)},e)}},interstitialsController:class Mte extends Yi{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(void 0===i||this.playbackDisabled||!this.schedule)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const a=this.playingItem;if(!a)return void this.checkBuffer();if(o&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<a.start||i>=a.end){var l;const h=this.findItemIndex(a);let p=this.schedule.findItemIndexAtTime(i);if(-1===p&&(p=h+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${h} to ${p})`)),!this.isInterstitial(a)&&null!=(l=this.media)&&l.paused&&(this.shouldPlay=!1),!o&&p>h){const g=this.schedule.findJumpRestrictedIndex(h+1,p);if(g>h)return void this.setSchedulePosition(g)}return void this.setSchedulePosition(p)}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const h=a.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,h))}return}const u=c.timelineStart;var f;(o&&i<u||i>=u+(c.duration||0))&&(null!=(f=a.event)&&f.appendInPlace&&(this.clearInterstitial(a.event,a),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,c))},this.onTimeupdate=()=>{const i=this.currentTime;if(void 0===i||this.playbackDisabled)return;if(!(i>this.timelinePos))return;this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const a=this.findItemIndex(r);this.setSchedulePosition(a+1)}const s=this.playingAsset;s&&i>=s.timelineStart+(s.duration||0)&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{const s=this.schedule;if(!s)return;const o=this.playingItem,a=s.events||[],l=s.items||[],c=s.durations,u=i.map(g=>g.identifier),d=!(!a.length&&!u.length);(d||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}\nSchedule: ${l.map(g=>yr(g))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,h=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(h=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,h)?this.bufferingItem=h:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),i.forEach(g=>{g.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const m=g.assetItem.timelineStart,y=g.timelineOffset-m;if(y)try{g.timelineOffset=m}catch(v){Math.abs(y)>ec&&this.warn(`${v} ("${g.assetId}" ${g.timelineOffset}->${m})`)}}}),d||r){if(this.hls.trigger(_.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier))return this.warn(`Interstitial "${o.event.identifier}" removed while playing`),void this.primaryFallback(o.event);o&&this.trimInPlace(f,o),p&&h!==f&&this.trimInPlace(h,p),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new Rte(t),this.schedule=new xte(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t&&(t.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(_.BUFFER_APPENDED,this.onBufferAppended,this),t.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(_.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(_.MEDIA_ENDED,this.onMediaEnded,this),t.on(_.ERROR,this.onError,this),t.on(_.DESTROYING,this.onDestroying,this))}unregisterListeners(){const t=this.hls;t&&(t.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(_.BUFFER_CODECS,this.onBufferCodecs,this),t.off(_.BUFFER_APPENDED,this.onBufferAppended,this),t.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(_.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(_.MEDIA_ENDED,this.onMediaEnded,this),t.off(_.ERROR,this.onError,this),t.off(_.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;null==(t=this.getBufferingPlayer())||t.resumeBuffering()}pauseBuffering(){var t;null==(t=this.getBufferingPlayer())||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){ai(t,"play",this.onPlay),ai(t,"pause",this.onPause),ai(t,"seeking",this.onSeeking),ai(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const i=this.media=e.media;Yn(i,"seeking",this.onSeeking),Yn(i,"timeupdate",this.onTimeupdate),Yn(i,"play",this.onPlay),Yn(i,"pause",this.onPause)}onMediaAttached(t,e){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,null===i)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const i=!!e.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const t=this,e=()=>t.bufferingItem||t.waitingItem,i=d=>d&&t.getAssetPlayer(d.identifier),r=(d,f,h,p,g)=>{if(d){let m=d[f].start;const y=d.event;if(y){if("playout"===f||y.timelineOccupancy!==Og.Point){const v=i(h);v?.interstitial===y&&(m+=v.assetItem.startOffset+v[g])}}else m+=("bufferedPos"===p?o():t[p])-d.start;return m}return 0},o=()=>{const d=t.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f,h;return null!=(f=t.primaryDetails)&&f.live?t.primaryDetails.edge:(null==(h=t.schedule)?void 0:h.durations[d])||0},l=(d,f)=>{var h,p;const g=t.effectivePlayingItem;if(null!=g&&null!=(h=g.event)&&h.restrictions.skip||!t.schedule)return;t.log(`seek to ${d} "${f}"`);const m=t.effectivePlayingItem,y=t.schedule.findItemIndexAtTime(d,f),v=null==(p=t.schedule.items)?void 0:p[y],b=t.getBufferingPlayer(),E=b?.interstitial,D=E?.appendInPlace,w=m&&t.itemsMatch(m,v);if(m&&(D||w)){const T=i(t.playingAsset),I=T?.media||t.primaryMedia;if(I){const R="primary"===f?I.currentTime:r(m,f,t.playingAsset,"timelinePos","currentTime"),k=(D?R:I.currentTime)+(d-R);if(k>=0&&(!T||D||k<=T.duration))return void(I.currentTime=k)}}if(v){let T=d;"primary"!==f&&(T=v.start+(d-v[f].start));const I=!t.isInterstitial(v);if(t.isInterstitial(m)&&!m.event.appendInPlace||!I&&!v.event.appendInPlace){if(m){const R=t.findItemIndex(m);if(y>R){const k=t.schedule.findJumpRestrictedIndex(R+1,y);if(k>R)return void t.setSchedulePosition(k)}let C=0;if(I)t.timelinePos=T,t.checkBuffer();else{const k=v.event.assetList,W=d-(v[f]||v).start;for(let Y=k.length;Y--;){const te=k[Y];if(te.duration&&W>=te.startOffset&&W<te.startOffset+te.duration){C=Y;break}}}t.setSchedulePosition(y,C)}}else{const R=t.media||(D?b?.media:null);R&&(R.currentTime=T)}}},c=()=>{const d=t.effectivePlayingItem;if(t.isInterstitial(d))return d;const f=e();return t.isInterstitial(f)?f:null},u={get bufferedEnd(){const d=e(),f=t.bufferingItem;var h;return f&&f===d&&(r(f,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||(null==(h=t.bufferingAsset)?void 0:h.startOffset))||0},get currentTime(){const d=c(),f=t.effectivePlayingItem;return f&&f===d?r(f,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=c(),h=t.effectivePlayingItem;h&&h===f&&l(d+h.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=null==(d=c())?void 0:d.event.assetList;return f?f.map(h=>t.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=null==(d=c())?void 0:d.event;return f&&t.effectivePlayingAsset?f.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return(null==(d=t.schedule)||null==(d=d.events)?void 0:d.slice(0))||[]},get schedule(){var d;return(null==(d=t.schedule)||null==(d=d.items)?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const d=e();return t.findItemIndex(d)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){return t.findItemIndex(t.effectivePlayingItem)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=t.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return(null==(d=t.primaryDetails)?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return((d,f)=>{var h;if(0!==d&&null!=(h=t.schedule)&&h.length){var p;const g=t.schedule.findItemIndexAtTime(d),m=null==(p=t.schedule.items)?void 0:p[g];if(m)return d+(m[f].start-m.start)}return d})((null==(d=t.primaryDetails)?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=t.effectivePlayingItem,f=d?.event;if(f&&!f.restrictions.skip){const h=t.findItemIndex(d);f.appendInPlace?l(d.playout.start+d.event.duration+.001,"playout"):t.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,i=null==(t=this.schedule)?void 0:t.items;return!!(this.playbackStarted&&e&&i)&&this.findItemIndex(e)===i.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var t,e;if(null===this.mediaSelection)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&null!=(t=this.bufferingItem)&&null!=(t=t.event)&&t.appendInPlace&&(r=this.primaryMedia);const s=null==(e=r)?void 0:e.currentTime;return void 0!==s&&J(s)?s:void 0}get primaryMedia(){var t;return this.media||(null==(t=this.detachedData)?void 0:t.media)||null}isInterstitial(t){return!(null==t||!t.event)}retreiveMediaSource(t,e){const i=this.getAssetPlayer(t);i&&this.transferMediaFromPlayer(i,e)}transferMediaFromPlayer(t,e){const r=t.media;if(t.interstitial.appendInPlace&&r===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&r)return void(this.detachedData={media:r});const s=t.transferMedia();this.log(`transfer MediaSource from ${t} ${Et(s)}`),this.detachedData=s}else e&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(t,e){var i,r;if(t.media===e)return;let s=null;const o=this.hls,a=t!==o,l=a&&t.interstitial.appendInPlace,c=null==(i=this.detachedData)?void 0:i.mediaSource;let u;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),u="Primary";else if(c){const p=this.getBufferingPlayer();p?(s=p.transferMedia(),u=`${p}`):u="detached MediaSource"}else u="detached media";if(!s)if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${Et(s)}`);else if(!this.detachedData||o.media===e){const p=this.playerQueue;p.length>1&&p.forEach(g=>{if(a&&g.interstitial.appendInPlace!==l){const m=g.interstitial;this.clearInterstitial(g.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:e}}const d=s&&"mediaSource"in s&&"closed"!==(null==(r=s.mediaSource)?void 0:r.readyState),f=d&&s?s:e;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?t:"Primary"} from ${u} (media.currentTime: ${e.currentTime})`);const h=this.schedule;f===s&&h&&(f.overrides={duration:h.duration,endOfStream:!a||a&&t.assetId===h.assetIdAtEnd,cueRemoval:!a}),t.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=t?.events;if(!e||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const r=this.effectivePlayingItem;if(-1===this.timelinePos){const s=this.hls.startPosition;if(this.log(kg("checkStart",s)),this.timelinePos=s,e.length&&e[0].cue.pre){const o=t.findEventIndex(e[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=t.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){const s=t.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(t,e){const i=t.event,r=i.findAssetIndex(e),s=YE(i,r);if(i.isAssetPastPlayoutLimit(s)){if(this.schedule){var o;const a=null==(o=this.schedule.items)?void 0:o[this.findItemIndex(t)+1];a&&this.bufferedToItem(a)}}else this.bufferedToEvent(t,s)}advanceAfterAssetEnded(t,e,i){const r=YE(t,i);if(t.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const o=e+1;if(o>=s.length)return void this.setSchedulePosition(-1);const l=t.resumeTime;this.timelinePos<l&&(this.log(kg("advanceAfterAssetEnded",l)),this.timelinePos=l,t.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(t.appendInPlace){const s=t.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(e,r)}}setScheduleToAssetAtTime(t,e){const i=this.schedule;if(!i)return;const r=e.parentIdentifier,s=i.getEvent(r);if(s){const o=i.findEventIndex(r),a=i.findAssetIndex(s,t);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(t,e){var i;const r=null==(i=this.schedule)?void 0:i.items;if(!r||this.playbackDisabled)return;const s=t>=0?r[t]:null;this.log(`setSchedulePosition ${t}, ${e} (${s&&yr(s)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,d=this.playingAsset,f=d?.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(o,s)||void 0!==e&&f!==u.assetList[e].identifier)){var l;const p=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${u.assetList.length} ${tc(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(_.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:p,event:u,schedule:r.slice(0),scheduleIndex:t,player:h}),o!==this.playingItem)return void(this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),p));this.retreiveMediaSource(f,s),h.media&&(null==(l=this.detachedData)||!l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${yr(o)}`),u.hasPlayed=!0,this.hls.trigger(_.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:t}),u.cue.once)){var c;this.updateSchedule();const p=null==(c=this.schedule)?void 0:c.items;if(s&&p){const g=this.findItemIndex(s);this.advanceSchedule(g,p,e,o,a)}return}}this.advanceSchedule(t,r,e,o,a)}advanceSchedule(t,e,i,r,s){const o=this.schedule;if(!o)return;const a=e[t]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,f=o.findEventIndex(d.identifier);(f<t||f>t+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(void 0===i){const p=YE(u,(i=o.findAssetIndex(u,this.timelinePos))-1);if(u.isAssetPastPlayoutLimit(p)||u.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(u,t,i);i=p}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(u,i);if(this.eventItemsMatch(a,d||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${yr(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(_.INTERSTITIAL_STARTED,{event:u,schedule:e.slice(0),scheduleIndex:t})),!u.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${u}`);if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l)return void this.log(`Waiting for attachMedia to start Interstitial ${u}`);this.waitingItem=this.endedItem=null,this.playingItem=a;const h=u.assetList[i];if(!h)return void this.advanceAfterAssetEnded(u,t,i||0);if(f||(f=this.getAssetPlayer(h.identifier)),(null===f||f.destroyed)&&(this.warn(`asset ${i+1}/${u.assetList.length} player destroyed ${u}`),f=this.createAssetPlayer(u,h,i),f.loadSource()),!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,i,e,t,l),this.shouldPlay&&bP(f.media)}else a?(this.resumePrimary(a,t,r),this.shouldPlay&&bP(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var t;return null==(t=this.mediaSelection)?void 0:t.main.details}get primaryLive(){var t;return!(null==(t=this.primaryDetails)||!t.live)}resumePrimary(t,e,i){var r,s;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log(`resuming ${yr(t)}`),null==(r=this.detachedData)||!r.mediaSource){let a=this.timelinePos;(a<t.start||a>=t.end)&&(a=this.getPrimaryResumption(t,e),this.log(kg("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,t)}if(!i)return;const o=null==(s=this.schedule)?void 0:s.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${yr(t)}`),this.hls.trigger(_.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const i=t.start;if(this.primaryLive){const r=this.primaryDetails;if(0===e)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);return null!=e&&e.hls?e.hls.bufferedToEnd:Ie.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,i){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(t,i)),i||(this.log(kg("attachPrimary",t)),this.timelinePos=t,this.startLoadingPrimaryAt(t,i))}startLoadingPrimaryAt(t,e){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs(((null==(i=r.mainForwardBufferInfo)?void 0:i.start)||r.media.currentTime)-t)>.5?r.startLoad(t,e):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var t;this.stopLoad(),null==(t=this.schedule)||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(_.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(_.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(-1===e.level||!this.schedule)return;const i=this.hls.levels[e.level];if(!i.details)return;const r=it(it({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const i=this.hls.audioTracks[e.id],r=this.mediaSelection;if(!r)return void(this.altSelection=it(it({},this.altSelection),{},{audio:i}));const s=it(it({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(t,e){const i=this.hls.subtitleTracks[e.id],r=this.mediaSelection;if(!r)return void(this.altSelection=it(it({},this.altSelection),{},{subtitles:i}));const s=it(it({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(t,e){const i=wk(e);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(e)||r.setAudioOption(i)))}onSubtitleTrackSwitch(t,e){const i=wk(e);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(e)||-1!==e.id&&r.setSubtitleOption(i)))}onBufferCodecs(t,e){const i=e.tracks;i&&(this.requiredTracks=i)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const i=this.playingItem;!i||this.itemsMatch(i,this.bufferingItem)||this.isInterstitial(i)||(this.bufferedPos=this.timelinePos,this.checkBuffer())}onBufferedToEnd(t){if(!this.schedule)return;const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let r=0;r<e.length;r++){const s=e[r];if(s.cue.post){var i;const o=this.schedule.findEventIndex(s.identifier),a=null==(i=this.schedule.items)?void 0:i[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const i=this.findItemIndex(e);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(t,e){var i;const r=null==(i=this.schedule)?void 0:i.items;return t&&r&&r[this.findItemIndex(t,e)]||null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((s,o)=>{t.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});const i=t.end+.25,r=Ie.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${yr(t)} (was ${yr(e)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var i;return!!e&&(t===e||t.event.identifier===(null==(i=e.event)?void 0:i.identifier))}findItemIndex(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1}updateSchedule(t=!1){var e;const i=this.mediaSelection;i&&(null==(e=this.schedule)||e.updateSchedule(i,[],t))}checkBuffer(t){var e;const i=null==(e=this.schedule)?void 0:e.items;if(!i)return;const r=Ie.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=r.len<1),this.updateBufferedPos(r.end,i,t)}updateBufferedPos(t,e,i){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>t||!r)return;if(1===e.length&&this.itemsMatch(e[0],s))return void(this.bufferedPos=t);const o=this.playingItem,a=this.findItemIndex(o);let l=r.findItemIndexAtTime(t);if(this.bufferedPos<t){var c;const u=this.findItemIndex(s),d=Math.min(u+1,e.length-1),f=e[d];if((-1===l&&s&&t>=s.end||null!=(c=f.event)&&c.appendInPlace&&t+.01>=f.start)&&(l=d),this.isInterstitial(s)){const h=s.event;if(d-a>1&&!1===h.appendInPlace||0===h.assetList.length&&h.assetListLoader)return}if(this.bufferedPos=t,l>u&&l>a)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&t>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else i&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(e[l]))}assetsBuffered(t,e){return 0!==t.event.assetList.length&&!t.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(null!=s&&s.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(t,e)&&i){const{items:r,events:s}=i;if(!r||!s)return e;const o=this.isInterstitial(t),a=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const l=a?a.remaining:e?e.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${yr(t)}`+(e?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=i.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((u,d)=>{const f=this.getAssetPlayer(u.identifier);f&&(d===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(_.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return e}bufferedToItem(t,e=0){const i=this.setBufferingItem(t);if(!this.playbackDisabled)if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(null!==i){this.bufferingAsset=null;const r=this.detachedData;r&&r.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t)}}preloadPrimary(t){const e=this.findItemIndex(t),i=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(i)}bufferedToEvent(t,e){const i=t.event;if(0===i.assetList.length&&!i.assetListLoader||!i.cue.once){const o=this.preloadAssets(i,e);if(null!=o&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(t,e){const i=t.assetUrl,r=t.assetList.length;if(0!==r||t.assetListLoader){if(!t.cue.once&&r){for(let c=e;c<r;c++){const u=t.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(-1===d||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(t,u,c)}const l=t.assetList[e];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}}else{const l=t.timelineStart;if(t.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(null==f||null==(a=f.nextEvent)?void 0:a.identifier)===t.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,-1===u&&(u=this.hls.liveSyncPosition||0)),u&&!t.cue.pre&&!t.cue.post){const f=u-l;f>0&&(c=Math.round(1e3*f)/1e3)}if(this.log(`Load interstitial asset ${e+1}/${i?1:r} ${t}${c?` live-start: ${u} start-offset: ${c}`:""}`),i)return this.createAsset(t,0,0,l,t.duration,i);const d=this.assetListLoader.loadAssetList(t,c);d&&(t.assetListLoader=d)}return null}flushFrontBuffer(t){const e=this.requiredTracks;e&&(this.log(`Removing front buffer starting at ${t}`),Object.keys(e).forEach(r=>{this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:r})}))}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let i=0;i<e.length;i++)if(t===e[i].assetId)return i;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e)for(let i=0;i<t.length;i++)if(t[i].media===e)return t[i];return null}createAsset(t,e,i,r,s,o){const a={parentIdentifier:t.identifier,identifier:Cte(t,o,e),duration:s,startOffset:i,timelineStart:r,uri:o};return this.createAssetPlayer(t,a,e)}createAssetPlayer(t,e,i){const r=this.hls,s=r.userConfig;let o=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=ut({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let u=0;if(this.primaryLive||t.appendInPlace){const E=this.timelinePos-e.timelineStart;if(E>1){const D=e.duration;D&&E<D&&(u=E)}}const d=e.identifier,f=it(it({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:c||s.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(f.timelineOffset=e.timelineStart));const h=f.cmcd;null!=h&&h.sessionId&&h.contentId&&(f.cmcd=ut({},h,{contentId:Cd(e.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${t} and asset ${d}`);const p=new Ate(this.HlsPlayerClass,f,t,e);this.playerQueue.push(p),t.assetList[i]=e;let g=!0;const m=E=>{if(E.live){var D;const I=new Error(`Interstitials MUST be VOD assets ${t}`),R={fatal:!0,type:le.OTHER_ERROR,details:M.INTERSTITIAL_ASSET_ITEM_ERROR,error:I},C=(null==(D=this.schedule)?void 0:D.findEventIndex(t.identifier))||-1;return void this.handleAssetItemError(R,t,C,i,I.message)}const w=E.edge-E.fragmentStart,T=e.duration;(g||null===T||w>T)&&(g=!1,this.log(`Interstitial asset "${d}" duration change ${T} > ${w}`),e.duration=w,this.updateSchedule())};p.on(_.LEVEL_UPDATED,(E,{details:D})=>m(D)),p.on(_.LEVEL_PTS_UPDATED,(E,{details:D})=>m(D)),p.on(_.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(E,D)=>{const w=this.getAssetPlayer(d);if(w&&D.tracks){w.off(_.BUFFER_CODECS,y),w.tracks=D.tracks;const T=this.primaryMedia;this.bufferingAsset===w.assetItem&&T&&!w.media&&this.bufferAssetPlayer(w,T)}};p.on(_.BUFFER_CODECS,y),p.on(_.BUFFERED_TO_END,()=>{var E;const D=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${D}`),!D||!this.schedule)return;const w=this.schedule.findEventIndex(t.identifier),T=null==(E=this.schedule.items)?void 0:E[w];this.isInterstitial(T)&&this.advanceAssetBuffering(T,e)});const b=E=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const w=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,w,E)};return p.once(_.MEDIA_ENDED,b(i)),p.once(_.PLAYOUT_LIMIT_REACHED,b(1/0)),p.on(_.ERROR,(E,D)=>{if(!this.schedule)return;const w=this.getAssetPlayer(d);if(D.details===M.BUFFER_STALLED_ERROR)return null!=w&&w.appendInPlace?void this.handleInPlaceStall(t):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(D,t,this.schedule.findEventIndex(t.identifier),i,`Asset player error ${D.error} ${t}`)}),p.on(_.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const D=new Error(`Asset player destroyed unexpectedly ${d}`);this.handleAssetItemError({fatal:!0,type:le.OTHER_ERROR,details:M.INTERSTITIAL_ASSET_ITEM_ERROR,error:D},t,this.schedule.findEventIndex(t.identifier),i,D.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${tc(e)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:i,event:t,player:p}),p}clearInterstitial(t,e){t.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,e)}),t.reset()}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(-1!==e){this.log(`reset asset player "${t}" after error`);const i=this.playerQueue[e];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(t,e){const i=this.getAssetPlayerQueueIndex(t);if(-1!==i){const r=this.playerQueue[i];this.log(`clear ${r} toSegment: ${e&&yr(e)}`),this.transferMediaFromPlayer(r,e),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,i,r,s){const{interstitial:o,assetItem:a,assetId:l}=t,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,i[r]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${e+1}/${c} ${tc(a)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:e,event:o,schedule:i.slice(0),scheduleIndex:r,player:t})),this.bufferAssetPlayer(t,s)}bufferAssetPlayer(t,e){var i,r;if(!this.schedule)return;const{interstitial:s,assetItem:o}=t,a=this.schedule.findEventIndex(s.identifier),l=null==(i=this.schedule.items)?void 0:i[a];if(!l)return;t.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===t)return;const u=s.appendInPlace;if(u&&!1===c?.interstitial.appendInPlace)return;const d=c?.tracks||(null==(r=this.detachedData)?void 0:r.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!t.tracks)return void this.log(`Waiting for track info before buffering ${t}`);if(d&&!ek(d,t.tracks)){const f=new Error(`Asset ${tc(o)} SourceBuffer tracks ('${Object.keys(t.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:le.OTHER_ERROR,details:M.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},p=s.findAssetIndex(o);return void this.handleAssetItemError(h,s,a,p,f.message)}}this.transferMediaTo(t,e)}handleInPlaceStall(t){const e=this.schedule,i=this.primaryMedia;if(!e||!i)return;const r=i.currentTime,s=e.findAssetIndex(t,r),o=t.assetList[s];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||r-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${t} (media.currentTime: ${r})`),l&&(c/i.playbackRate<.5||a.bufferedInPlaceToEnd(i))&&a.hls){const u=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,u,s)}}}}advanceInPlace(t){const e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)}handleAssetItemError(t,e,i,r,s){if(t.details===M.BUFFER_STALLED_ERROR)return;const o=e.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&tc(o)} ${t.error}`),!this.schedule)return;const a=o?.identifier||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,d=ut({},t,{fatal:!1,errorAction:Kl(!0),asset:o,assetListIndex:r,event:e,schedule:u,scheduleIndex:i,player:c});if(this.hls.trigger(_.INTERSTITIAL_ASSET_ERROR,d),!t.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,p=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=p),e.assetList.some(g=>!g.error))for(let g=r;g<e.assetList.length;g++)this.resetAssetPlayer(e.assetList[g].identifier);else e.error=p;this.updateSchedule(!0),e.error?this.primaryFallback(e):f&&f.identifier===a?this.advanceAfterAssetEnded(e,i,r):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(t){const e=t.timelineStart,i=this.effectivePlayingItem;if(i){this.log(`Fallback to primary from event "${t.identifier}" start: ${e} pos: ${this.timelinePos} playing: ${yr(i)} error: ${t.error}`);let r=this.timelinePos;-1===r&&(r=this.hls.startPosition);const s=this.updateItem(i,r);if(this.itemsMatch(i,s)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(t,e){var i,r;const s=e.event,o=s.identifier,a=e.assetListResponse.ASSETS;if(null==(i=this.schedule)||!i.hasEvent(o))return;const l=s.timelineStart,c=s.duration;let u=0;a.forEach((g,m)=>{const y=parseFloat(g.DURATION);this.createAsset(s,m,u,l+u,y,g.URI),u+=y}),s.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${s}`);const d=this.waitingItem,f=d?.event.identifier===o;this.updateSchedule();const h=null==(r=this.bufferingItem)?void 0:r.event;if(f){var p;const g=this.schedule.findEventIndex(o),m=null==(p=this.schedule.items)?void 0:p[g];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g)return s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.updateSchedule(!0),void this.primaryFallback(s);this.setBufferingItem(m)}this.setSchedulePosition(g)}else if(h?.identifier===o){const g=s.assetList[0];if(g){const m=this.getAssetPlayer(g.identifier);if(h.appendInPlace){const y=this.primaryMedia;m&&y&&this.bufferAssetPlayer(m,y)}else m&&m.loadSource()}}}onError(t,e){if(this.schedule)switch(e.details){case M.ASSET_LIST_PARSING_ERROR:case M.ASSET_LIST_LOAD_ERROR:case M.ASSET_LIST_LOAD_TIMEOUT:{const i=e.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case M.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace)return void this.handleInPlaceStall(i.event);this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function sD(n){return n&&"object"==typeof n?Array.isArray(n)?n.map(sD):Object.keys(n).reduce((t,e)=>(t[e]=sD(n[e]),t),{}):n}class Sne extends $k{constructor(t,e){super("gap-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;null!=(i=this.media)&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var i;this.hls&&(this.ended=(null==(i=this.media)?void 0:i.currentTime)||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1}))},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(100),this.mediaSource=e.mediaSource;const i=this.media=e.media;Yn(i,"playing",this.onMediaPlaying),Yn(i,"waiting",this.onMediaWaiting),Yn(i,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:i}=this;i&&(ai(i,"playing",this.onMediaPlaying),ai(i,"waiting",this.onMediaWaiting),ai(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(null==(t=this.media)||!t.readyState||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var i,r;const s=null==(i=this.hls)?void 0:i.config;if(!s)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||0===o.playbackRate;if(this.seeking=a,t!==e)return e&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!u&&t>e&&this.nudgeOnVideoHole(t,e)),void(0===this.waiting&&this.stallResolved(t));if(c||l)return void(l&&this.stallResolved(t));if(u)return this.nudgeRetry=0,this.stallResolved(t),void(!this.ended&&o.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1})));if(!Ie.getBuffered(o).length)return void(this.nudgeRetry=0);const d=Ie.bufferInfo(o,t,0),f=d.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const w=$P(this.hls.inFlightFragments,t),T=d.len>2,I=!f||w||f-t>2&&!h.getPartialFragment(t);if(T||I)return;this.moved=!1}const p=null==(r=this.hls)?void 0:r.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(d.len>0||f))return;const T=Math.max(f,d.start||0)-t,R=null!=p&&p.live?2*p.targetduration:2,C=Ug(t,h);if(T>0&&(T<=R||C))return void(o.paused||this._trySkipBufferHole(C))}const g=s.detectStallWithCurrentTimeMs,m=self.performance.now(),y=this.waiting;let v=this.stalled;if(null===v){if(!(y>0&&m-y<g))return void(this.stalled=m);v=this.stalled=y}const b=m-v;if(!a&&(b>=g||y)&&this.hls){var E;if("ended"===(null==(E=this.mediaSource)?void 0:E.readyState)&&(null==p||!p.live)&&Math.abs(t-(p?.edge||0))<1){if(this.ended)return;return this.ended=t||1,void this.hls.trigger(_.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(d),!this.media||!this.hls)return}const D=Ie.bufferInfo(o,t,s.maxBufferHole);this._tryFixBufferStall(D,b,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-e;this.log(`playback not stuck anymore @${t}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(_.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(i=this.buffered.audio)&&i.length&&r&&r.length>1&&t>r.end(0)){const s=Ie.bufferedInfo(Ie.timeRangesToArray(this.buffered.audio),t,0);if(s.len>1&&e>=s.start){const o=Ie.timeRangesToArray(r),a=Ie.bufferedInfo(o,e,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=Ie.bufferedInfo(o,t,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((-1===l||l>a)&&u-c<1&&t-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${t} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=Ug(t,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=Ie.bufferInfo(this.media,t,0);this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(t,e,i){var r,s;const{fragmentTracker:o,media:a}=this,l=null==(r=this.hls)?void 0:r.config;if(!a||!o||!l)return;const c=null==(s=this.hls)?void 0:s.latestLevelDetails,u=Ug(i,o);if((u||null!=c&&c.live&&i<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=t.buffered,f=this.adjacentTraversal(t,i);(d&&d.length>1&&t.len>l.maxBufferHole||t.nextStart&&(t.nextStart-i<l.maxBufferHole||f))&&(e>1e3*l.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const i=this.fragmentTracker,r=t.nextStart;if(i&&r){const s=i.getFragAtPos(e,"main"),o=i.getFragAtPos(r,"main");if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(t){const{hls:e,media:i,stallReported:r,stalled:s}=this;if(!r&&null!==s&&i&&e){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Et(t)})`);this.warn(o.message),e.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:t.len,bufferInfo:t,stalled:{start:s}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:i,media:r}=this,s=null==(e=this.hls)?void 0:e.config;if(!r||!i||!s)return 0;const o=r.currentTime,a=Ie.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const f=l-o;if(f>0&&(a.len<=s.maxBufferHole||a.len>0&&a.len<1&&r.readyState<3)){if(f>s.maxBufferHole){let p=!1;if(0===o){const g=i.getAppendedFrag(0,"main");g&&l<g.end&&(p=!0)}if(!p&&t){var c;if(null==(c=this.hls.loadLevelObj)||!c.details||$P(this.hls.inFlightFragments,l))return 0;let m=!1,y=t.end;for(;y<l;){const v=Ug(y,i);if(!v){m=!0;break}y+=v.duration}if(m)return 0}}const h=Math.max(l+.05,o+.1);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${h}`),this.moved=!0,r.currentTime=h,null==t||!t.gap){const p=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${h}`),g={type:le.MEDIA_ERROR,details:M.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:a.len,bufferInfo:a};t&&("fragment"in t?g.part=t:g.frag=t),this.hls.trigger(_.ERROR,g)}return h}}return 0}_tryNudgeBuffer(t){const{hls:e,media:i,nudgeRetry:r}=this,s=e?.config;if(!i||!s)return 0;const o=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),i.currentTime=a,e.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:t.len,bufferInfo:t})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),e.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:t.len,bufferInfo:t})}}}function $P(n,t){const e=VP(n.main);if(e&&e.start<=t)return e;const i=VP(n.audio);return i&&i.start<=t?i:null}function VP(n){if(!n)return null;switch(n.state){case"IDLE":case"STOPPED":case"ENDED":case"ERROR":return null}return n.frag}function Ug(n,t){return t.getAppendedFrag(n,"main")||t.getPartialFragment(n)}function oD(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function aD(n,t,e,i,r){let s=new n(t,e,"");try{s.value=i,r&&(s.type=r)}catch{s=new n(t,e,Et(r?it({type:r},i):i))}return s}const $g=(()=>{const n=oD();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Ine{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(_.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t&&(t.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(t,e){var i;this.media=e.media,!1===(null==(i=e.overrides)?void 0:i.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var t;const e=null==(t=this.hls)?void 0:t.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(t,e){this.media=null,!e.transferMedia&&(this.id3Track&&(this.removeCues&&Jl(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const i=t[e];if("metadata"===i.kind&&"id3"===i.label)return mP(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;const{samples:s}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=oD();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Ii.emsg&&!i||!r)continue;const c=RL(s[a].data),u=s[a].pts;let d=u+s[a].duration;d>$g&&(d=$g),d-u<=0&&(d=u+.25);for(let h=0;h<c.length;h++){const p=c[h];if(!ML(p)){this.updateId3CueEnds(u,l);const g=aD(o,u,d,p,l);g&&this.id3Track.addCue(g)}}}}updateId3CueEnds(t,e){var i;const r=null==(i=this.id3Track)?void 0:i.cues;if(r)for(let s=r.length;s--;){const o=r[s];o.type===e&&o.startTime<t&&o.endTime===$g&&(o.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:r}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let c;c="audio"===r?u=>u.type===Ii.audioId3&&l:"video"===r?u=>u.type===Ii.emsg&&a:u=>u.type===Ii.audioId3&&l||u.type===Ii.emsg&&a,zE(s,e,i,c)}}onLevelUpdated(t,{details:e}){this.updateDateRangeCues(e,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;const a=oD();if(i&&r&&!o){const{fragmentStart:g,fragmentEnd:m}=t;let y=this.assetCue;y?(y.startTime=g,y.endTime=m):a&&(y=this.assetCue=aD(a,g,m,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!t.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=t,u=Object.keys(c);let d=this.dateRangeCuesAppended;var f;if(l&&e)if(null!=(f=l.cues)&&f.length){const g=Object.keys(d).filter(m=>!u.includes(m));for(let m=g.length;m--;){var h;const y=g[m],v=null==(h=d[y])?void 0:h.cues;delete d[y],v&&Object.keys(v).forEach(b=>{const E=v[b];if(E){E.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(E)}catch{}}})}}else d=this.dateRangeCuesAppended={};const p=t.fragments[t.fragments.length-1];if(0!==u.length&&J(p?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let g=0;g<u.length;g++){const m=u[g],y=c[m],v=y.startTime,b=d[m],E=b?.cues||{};let D=b?.durationKnown||!1,w=$g;const{duration:T,endDate:I}=y;if(I&&null!==T)w=v+T,D=!0;else if(y.endOnNext&&!D){const C=u.reduce((k,W)=>{if(W!==y.id){const Y=c[W];if(Y.class===y.class&&Y.startDate>y.startDate&&(!k||y.startDate<k.startDate))return Y}return k},null);C&&(w=C.startTime,D=!0)}const R=Object.keys(y.attr);for(let C=0;C<R.length;C++){const k=R[C];if(!YZ(k))continue;const W=E[k];if(W)!D||null!=b&&b.durationKnown?Math.abs(W.startTime-v)>.01&&(W.startTime=v,W.endTime=w):W.endTime=w;else if(a){let Y=y.attr[k];QZ(k)&&(Y=tk(Y));const ee=aD(a,v,w,{key:k,data:Y},Ii.dateRange);ee&&(ee.id=m,this.id3Track.addCue(ee),E[k]=ee,o&&("X-ASSET-LIST"===k||"X-ASSET-URL"===k)&&ee.addEventListener("enter",this.onEventCueEnter))}}d[m]={cues:E,dateRange:y,durationKnown:D}}}}}class wne{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,i=this.levelDetails;if(!e||!i)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||1===o||!i.live)return;const a=this.targetLatency;if(null===a)return;const l=r-a;if(l<Math.min(this.maxLatency,a+i.targetduration)&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(e,h)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return(null==(t=this.hls)?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(void 0!==t.liveMaxLatencyDuration)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(null===t||null===this.hls)return null;const{holdBack:e,partHoldBack:i,targetduration:r}=t,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&i||e;return(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||0===c)&&(c=void 0!==s?s:o*r),c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,r)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(null===t||null===e)return null;const i=this.levelDetails;if(null===i)return null;const r=i.edge,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(r-i.totalduration,t-e-this.edgeStalled),a)}get drift(){const t=this.levelDetails;return null===t?1:t.drift}get edgeStalled(){const t=this.levelDetails;return null===t?0:Math.max(t.age-3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration),0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(_.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(_.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var i;e.details===M.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(i=this.levelDetails)&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var i,r;t.playbackRate!==e&&(null==(i=this.hls)||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(r=this.targetLatency)?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${t.playbackRate} to ${e}`),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return null===t?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return null===t?null:t-this.currentTime}}class Ane extends BE{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(_.LEVEL_LOADED,this.onLevelLoaded,this),t.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(_.FRAG_BUFFERED,this.onFragBuffered,this),t.on(_.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(_.LEVEL_LOADED,this.onLevelLoaded,this),t.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(_.FRAG_BUFFERED,this.onFragBuffered,this),t.off(_.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=this.hls.config.preferManagedMediaSource,r=[],s={},o={};let a=!1,l=!1,c=!1;e.levels.forEach(u=>{const d=u.attrs;let{audioCodec:f,videoCodec:h}=u;f&&(u.audioCodec=f=ag(f,i)||void 0),h&&(h=u.videoCodec=function fZ(n){const t=n.split(",");for(let e=0;e<t.length;e++){const i=t[e].split(".");i.length>2&&"avc1"===i[0]&&(t[e]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return t.join(",")}(h));const{width:p,height:g,unknownCodecs:m}=u;if(a||(a=!(!p||!g)),l||(l=!!h),c||(c=!!f),m?.length||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h))return void this.log(`Some or all CODECS not supported "${d.CODECS}"`);const{CODECS:v,"FRAME-RATE":b,"HDCP-LEVEL":E,"PATHWAY-ID":D,RESOLUTION:w,"VIDEO-RANGE":T}=d,R=`${D||"."}-${u.bitrate}-${w}-${b}-${v}-${T}-${E}`;if(s[R])if(s[R].uri===u.url||u.attrs["PATHWAY-ID"])s[R].addGroupId("audio",d.AUDIO),s[R].addGroupId("text",d.SUBTITLES);else{const C=o[R]+=1;u.attrs["PATHWAY-ID"]=new Array(C+1).join(".");const k=this.createLevel(u);s[R]=k,r.push(k)}else{const C=this.createLevel(u);s[R]=C,o[R]=1,r.push(C)}}),this.filterAndSortMediaOptions(r,e,a,l,c)}createLevel(t){const e=new md(t),i=t.supplemental;if(null!=i&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),e.supportedResult=bk(r,[])}return e}isAudioSupported(t){return pd(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return pd(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,i,r,s){var o;let a=[],l=[],c=t;const u=(null==(o=e.stats)?void 0:o.parsing)||{};if((i||r)&&s&&(c=c.filter(({videoCodec:v,videoRange:b,width:E,height:D})=>(!!v||!(!E||!D))&&function DZ(n){return!!n&&cg.indexOf(n)>-1}(b))),0===c.length)return Promise.resolve().then(()=>{if(this.hls){let v="no level with compatible codecs found in manifest",b=v;e.levels.length&&(b=`one or more CODECS in variant not supported: ${Et(e.levels.map(D=>D.attrs.CODECS).filter((D,w,T)=>T.indexOf(D)===w))}`,this.warn(b),v+=` (${b})`);const E=new Error(v);this.hls.trigger(_.ERROR,{type:le.MEDIA_ERROR,details:M.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:E,reason:b})}}),void(u.end=performance.now());e.audioTracks&&(a=e.audioTracks.filter(v=>!v.audioCodec||this.isAudioSupported(v.audioCodec)),jP(a)),e.subtitles&&(l=e.subtitles,jP(l));const d=c.slice(0);c.sort((v,b)=>{if(v.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(v.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&v.height!==b.height)return v.height-b.height;if(v.frameRate!==b.frameRate)return v.frameRate-b.frameRate;if(v.videoRange!==b.videoRange)return cg.indexOf(v.videoRange)-cg.indexOf(b.videoRange);if(v.videoCodec!==b.videoCodec){const E=mk(v.videoCodec),D=mk(b.videoCodec);if(E!==D)return D-E}if(v.uri===b.uri&&v.codecSet!==b.codecSet){const E=og(v.codecSet),D=og(b.codecSet);if(E!==D)return D-E}return v.averageBitrate!==b.averageBitrate?v.averageBitrate-b.averageBitrate:0});let f=d[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==d.length))for(let v=0;v<d.length;v++)if(d[v].pathwayId===c[0].pathwayId){f=d[v];break}this._levels=c;for(let v=0;v<c.length;v++)if(c[v]===f){var h;this._firstLevel=v;const b=f.bitrate,E=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${b}`),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const D=Math.min(b,this.hls.config.abrEwmaDefaultEstimateMax);D>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=D)}break}const g=this.hls.config,y={levels:c,audioTracks:a,subtitleTracks:l,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:r,altAudio:!(!g.audioStreamController||!g.audioTrackController)&&!(s&&!r)&&a.some(v=>!!v.url)};u.end=performance.now(),this.hls.trigger(_.MANIFEST_PARSED,y)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(0===e.length)return;if(t<0||t>=e.length){const u=new Error("invalid level idx"),d=t<0;if(this.hls.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.LEVEL_SWITCH_ERROR,level:t,fatal:d,error:u,reason:u.message}),d)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=e[t],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=o,i===t&&r&&s===a)return;this.log(`Switching to level ${t} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${i}${s?" with Pathway "+s:""}`),this.hls.trigger(_.LEVEL_SWITCHING,{level:t,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds});const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,r?.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(void 0===this._startLevel){const t=this.hls.config.startLevel;return void 0!==t?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),i=t.filter(r=>-1!==e.indexOf(r));if(t.length<1)return void this.warn(`pathwayPriority ${t} should contain at least one pathway from list: ${e}`);this.steering.pathwayPriority=i}}onError(t,e){e.fatal||!e.context||"level"===e.context.type&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(void 0!==e&&"main"===e.type){const i=e.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[e.level];null!=r&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(t,e){var i;const{level:r,details:s}=e,o=e.levelInfo;var a;if(!o)return this.warn(`Invalid level index ${r}`),void(null!=(a=e.deliveryDirectives)&&a.skip&&(s.deltaUpdateFailed=!0));if(o===this.currentLevel||e.withoutMultiVariant){0===o.fragmentError&&(o.loadError=0);let l=o.details;l===e.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,e,l)}else null!=(i=e.deliveryDirectives)&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=this.getUrlWithDirectives(t.uri,e),r=this.currentLevelIndex,s=t.attrs["PATHWAY-ID"],o=t.details,a=o?.age;this.log(`Loading level index ${r}${void 0!==e?.msn?" at sn "+e.msn+" part "+e.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type?" "+o.type||0:""):""} ${i}`),this.hls.trigger(_.LEVEL_LOADING,{url:i,level:r,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(1===this._levels.length)return;const i=this._levels.filter((s,o)=>o!==t||(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));mL(i),this._levels=i,this.currentLevelIndex>-1&&null!=(e=this.currentLevel)&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(_.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(_.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function jP(n){const t={};n.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}function HP(){return self.SourceBuffer||self.WebKitSourceBuffer}function GP(){if(!oo())return!1;const t=HP();return!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove}class Nne extends TE{constructor(t,e,i){super(t,e,i,"stream-controller","main"),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(null===s||!J(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(r,s,"main",0);null!==o&&0!==o.len?this.tick():this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(_.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.LEVEL_LOADED,this.onLevelLoaded,this),t.on(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(_.BUFFER_CREATED,this.onBufferCreated,this),t.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(_.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.LEVEL_LOADED,this.onLevelLoaded,this),t.off(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(_.BUFFER_CREATED,this.onBufferCreated,this),t.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(_.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let s=r.startLevel;-1===s&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!e}i>0&&-1===t&&!e&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),t=i),this.state="IDLE",this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state="STOPPED"}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case"WAITING_LEVEL":{const{levels:t,level:e}=this,i=t?.[e],r=i?.details;if(r&&(!r.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(r))break;this.state="IDLE";break}if(this.hls.nextLoadLevel!==this.level){this.state="IDLE";break}break}case"FRAG_LOADING_WAITING_RETRY":this.checkRetryDate()}"IDLE"===this.state&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),null!=(t=this.media)&&t.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:r}=this;if(null===e||!r&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?t.nextLoadLevel:t.loadLevel;if(null==i||!i[s])return;const o=i[s],a=this.getMainFwdBufferInfo();if(null===a)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const g={};return 2===this.altAudio&&(g.type="video"),this.hls.trigger(_.BUFFER_EOS,g),void(this.state="ENDED")}if(!this.buffering)return;t.loadLevel!==s&&-1===t.manualLevel&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=t.nextLoadLevel=s;const c=o.details;if(!c||"WAITING_LEVEL"===this.state||this.waitForLive(o))return this.level=s,this.state="WAITING_LEVEL",void(this.startFragRequested=!1);const u=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&h&&rn(h)&&"OK"!==this.fragmentTracker.getState(h)){var p;const m=(null!=(p=this.backtrackFragment)?p:h).sn-c.startSN,y=c.fragments[m-1];y&&h.cc===y.cc&&(h=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const m=this.audioOnly&&!this.altAudio?"audio":"video",y=("video"===m?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,m,"main")}h=this.getNextFragmentLoopLoading(h,c,a,"main",d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(t,e,i){const r=this.fragmentTracker.getState(t);"NOT_LOADED"===r||"PARTIAL"===r?rn(t)?this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,i):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,"main")}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(null!=e&&e.readyState){let i;const r=this.getAppendedFrag(e.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(null!=s&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<2*s.targetduration)return}if(!e.paused&&t){const c=this.fragLastKbps;i=c&&this.fragCurrent?this.fragCurrent.duration*t[this.hls.nextLoadLevel].maxBitrate/(1e3*c)+1:0}else i=0;const o=this.getBufferedFrag(e.currentTime+i);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const c=a.duration,u=Math.max(o.end,(a.maxStartPTS?a.maxStartPTS:a.start)+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case"KEY_LOADING":case"FRAG_LOADING":case"FRAG_LOADING_WAITING_RETRY":case"PARSING":case"PARSED":this.state="IDLE"}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,2===this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;Yn(i,"playing",this.onMediaPlaying),Yn(i,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:i}=this;i&&(ai(i,"playing",this.onMediaPlaying),ai(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e),!e.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let i=!1,r=!1;for(let s=0;s<e.levels.length;s++){const o=e.levels[s].audioCodec;o&&(i=i||-1!==o.indexOf("mp4a.40.2"),r=r||-1!==o.indexOf("mp4a.40.5"))}this.audioCodecSwitch=i&&r&&!function Rne(){var n;const t=HP();return"function"==typeof(null==t||null==(n=t.prototype)?void 0:n.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||"IDLE"!==this.state)return;const r=e.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state="WAITING_LEVEL")}onLevelLoaded(t,e){var i;const{levels:r,startFragRequested:s}=this,o=e.level,a=e.details,l=a.totalduration;if(!r)return void this.warn(`Levels were reset while loading level ${o}`);this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=e.levelInfo,u=this.fragCurrent;u&&("FRAG_LOADING"===this.state||"FRAG_LOADING_WAITING_RETRY"===this.state)&&u.level!==e.level&&u.loader&&this.abortCurrentFrag();let d=0;if(a.live||null!=(i=c.details)&&i.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,c.details,null==(f=this.levelLastLoaded)?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,s||this.setStartPosition(a,d),this.hls.trigger(_.LEVEL_UPDATED,{details:a,level:o}),"WAITING_LEVEL"===this.state){if(this.waitForCdnTuneIn(a))return;this.state="IDLE"}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=t.edge,l=s>=t.fragmentStart-e.maxFragLookUpTolerance&&s<=a;if(null!==r&&i.duration>r&&(s<r||!l)&&(!l&&i.readyState<4||s<a-(void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration))&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),"buffered"===this.config.liveSyncMode){var c;const d=Ie.bufferInfo(i,r,0);if(null==(c=d.buffered)||!c.length)return void(i.currentTime=r);if(d.start<=s)return void(i.currentTime=r);const{nextStart:h}=Ie.bufferedInfo(d.buffered,s,0);h&&(i.currentTime=h)}else i.currentTime=r}_handleFragmentLoadProgress(t){var e;const i=t.frag,{part:r,payload:s}=t,{levels:o}=this;if(!o)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const a=o[i.level];if(!a)return void this.warn(`Level ${i.level} not found on progress`);const l=a.details;if(!l)return this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),void this.fragmentTracker.removeFragment(i);const c=a.videoCodec,u=l.PTSKnown||!l.live,d=null==(e=i.initSegment)?void 0:e.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new qL(this.hls,"main",this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=r?r.index:-1,m=new hE(i.level,i.sn,i.stats.chunkCount,s.byteLength,p,-1!==p);h.push(s,d,f,c,i,r,l.totalduration,u,m,this.initPTS[i.cc])}onAudioTrackSwitching(t,e){const i=this.hls,r=2===this.altAudio;if(dg(e.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r)return this.fragmentTracker.removeAllFragments(),i.once(_.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(_.AUDIO_TRACK_SWITCHED,e)}),void i.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});i.trigger(_.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=dg(e.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(t,e){const i=e.tracks;let r,s,o=!1;for(const a in i){const l=i[a];if("main"===l.id){if(s=a,r=l,"video"===a){const c=i[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:r}=e,s="main"===i.type;if(s){if(this.fragContextChanged(i))return this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),void("PARSED"===this.state&&(this.state="IDLE"));const a=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),rn(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Ie.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var i;if(e.fatal)this.state="ERROR";else switch(e.details){case M.FRAG_GAP:case M.FRAG_PARSING_ERROR:case M.FRAG_DECRYPT_ERROR:case M.FRAG_LOAD_ERROR:case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_ERROR:case M.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError("main",e);break;case M.LEVEL_LOAD_ERROR:case M.LEVEL_LOAD_TIMEOUT:case M.LEVEL_PARSING_ERROR:!e.levelRetry&&"WAITING_LEVEL"===this.state&&"level"===(null==(i=e.context)?void 0:i.type)&&(this.state="IDLE");break;case M.BUFFER_ADD_CODEC_ERROR:case M.BUFFER_APPEND_ERROR:if("main"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case M.BUFFER_FULL_ERROR:if("main"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case M.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onFragLoadEmergencyAborted(){this.state="IDLE",this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,{type:e}){if("audio"!==e||!this.altAudio){const i=("video"===e?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,e,"main"),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking)return void this.log(`could not seek to ${i}, already seeking at ${e}`);const r=this.timelineOffset;r&&i&&(i+=r);const s=this.getLevelDetails(),o=Ie.getBuffered(t),a=o.length?o.start(0):0,l=a-i,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*(s?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),e<i&&(this.log(`seek to target start position ${i} from current time ${e} buffer start ${a}`),t.currentTime=i)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:r}=this,s=i?.frag;if(!s||this.fragContextChanged(s))return;e.fragmentError=0,this.state="IDLE",this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(_.FRAG_LOADED,i),s.bitrateTest=!1}).catch(i=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(i),this.resetFragmentLoading(t))})}_handleTransmuxComplete(t){const e=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:s}=t,o=this.getCurrentContext(s);if(!o)return void this.resetWhenMissingContext(s);const{frag:a,part:l,level:c}=o,{video:u,text:d,id3:f,initSegment:h}=r,{details:p}=c,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state="PARSING",h){const m=h.tracks;if(m){const E=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(c,m,E,s),i.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:e,tracks:m})}const y=h.initPTS,v=h.timescale,b=this.initPTS[a.cc];if(J(y)&&(!b||b.baseTime!==y||b.timescale!==v)){const E=h.trackId;this.initPTS[a.cc]={baseTime:y,timescale:v,trackId:E},i.trigger(_.INIT_PTS_FOUND,{frag:a,id:e,initPTS:y,timescale:v,trackId:E})}}if(u&&p){g&&"audiovideo"===u.type&&this.logMuxedErr(a);const m=p.fragments[a.sn-1-p.startSN],y=a.sn===p.startSN,v=!m||a.cc>m.cc;if(!1!==r.independent){const{startPTS:b,endPTS:E,startDTS:D,endDTS:w}=u;if(l)l.elementaryStreams[u.type]={startPTS:b,endPTS:E,startDTS:D,endDTS:w};else if(u.firstKeyFrame&&u.independent&&1===s.id&&!v&&(this.couldBacktrack=!0),u.dropped&&u.independent){const T=this.getMainFwdBufferInfo(),I=(T?T.end:this.getLoadPosition())+this.config.maxBufferHole;if(!y&&I<(u.firstKeyFramePTS?u.firstKeyFramePTS:b)-this.config.maxBufferHole&&!v)return void this.backtrack(a);v&&(a.gap=!0),a.setElementaryStreamInfo(u.type,a.start,E,a.start,w,!0)}else y&&b-(p.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(u.type,b,E,D,w),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,s,y||v)}else{if(!y&&!v)return void this.backtrack(a);a.gap=!0}}if(g){const{startPTS:m,endPTS:y,startDTS:v,endDTS:b}=g;l&&(l.elementaryStreams.audio={startPTS:m,endPTS:y,startDTS:v,endDTS:b}),a.setElementaryStreamInfo("audio",m,y,v,b),this.bufferFragmentData(g,a,l,s)}p&&null!=f&&f.samples.length&&i.trigger(_.FRAG_PARSING_METADATA,{id:e,frag:a,details:p,samples:f.samples}),p&&d&&i.trigger(_.FRAG_PARSING_USERDATA,{id:e,frag:a,details:p,samples:d.samples})}}logMuxedErr(t){this.warn(`${rn(t)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${t.url}`)}_bufferInitSegment(t,e,i,r){if("PARSING"!==this.state)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(i));const{audio:s,video:o,audiovideo:a}=e;if(s){const c=t.audioCodec;let u=lg(s.codec,c);"mp4a"===u&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&1!==(f.channelCount||1)&&-1===d.indexOf("firefox")&&(u="mp4a.40.5")}u&&-1!==u.indexOf("mp4a.40.5")&&-1!==d.indexOf("android")&&"audio/mpeg"!==s.container&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),s.levelCodec=u,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${s.codec}]`),delete e.audiovideo}if(o){o.levelCodec=t.videoCodec,o.id="main";const c=o.codec;if(4===c?.length)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e"}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${t.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete e.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${t.codecs}/${a.codec}]`),delete e.video,delete e.audio);const l=Object.keys(e);if(l.length){if(this.hls.trigger(_.BUFFER_CODECS,e),!this.hls)return;l.forEach(c=>{const d=e[c].initSegment;null!=d&&d.byteLength&&this.hls.trigger(_.BUFFER_APPENDING,{type:c,data:d,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media,"main")}get maxBufferLength(){const{levels:t,level:e}=this,i=t?.[e];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state="IDLE"}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&!1===t.seeking){const i=t.currentTime;if(Ie.isBuffered(t,i)?e=this.getAppendedFrag(i):Ie.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const r=this.fragPlaying,s=e.level;(!r||e.sn!==r.sn||r.level!==s)&&(this.fragPlaying=e,this.hls.trigger(_.FRAG_CHANGED,{frag:e}),(!r||r.level!==s)&&this.hls.trigger(_.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=(null==(t=this.media)?void 0:t.currentTime)||this.lastCurrentTime;return J(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=(null==(t=this.media)?void 0:t.currentTime)||this.lastCurrentTime;if(J(e)){const i=this.getLevelDetails(),r=this.currentFrag||(i?ca(null,i.fragments,e):null);if(r){const s=r.programDateTime;if(null!==s)return new Date(s+1e3*(e-r.start))}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class One extends Yi{constructor(t,e){super("key-loader",e),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const i in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[i].loader;if(r){var e;if(t&&t!==(null==(e=r.context)?void 0:e.frag.type))return;r.abort()}}}detach(){for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t].loader;e&&e.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(t,e=M.KEY_LOAD_ERROR,i,r,s){return new Cs({type:le.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:s,error:i,networkDetails:r})}loadClear(t,e,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length)for(let r=0,s=e.length;r<s;r++){const o=e[r];if(t.cc<=o.cc&&(!rn(t)||!rn(o)||t.sn<o.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=_g(a);return l?this.emeController.getKeySystemAccess([l]):void 0})}if(this.config.requireKeySystemAccessOnStart){const r=yd(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,r;e&&t.setKeyFormat(e);const s=t.decryptdata;if(!s){const c=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(t,M.KEY_LOAD_ERROR,c))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(t,M.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=lD(s);let l=this.keyIdToKeyInfo[a];if(null!=(i=l)&&i.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:t,keyInfo:l});if(this.emeController&&null!=(r=l)&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:d}=u;return s.key=d.decryptdata.key,{frag:t,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+qn(s.keyId):""} URI: ${s.uri} from ${t.type} ${t.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(l,t):this.loadKeyEME(l,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,t);default:return Promise.reject(this.createKeyLoadError(t,M.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var r;if(!t.decryptdata.keyId&&null!=(r=e.initSegment)&&r.data){const o=function eZ(n){const t=[];return dk(n,e=>t.push(e.subarray(8,24))),t}(e.initSegment.data);if(o.length){const a=o[0];a.some(l=>0!==l)&&(this.log(`Using keyId found in init segment ${qn(a)}`),t.decryptdata.keyId=a,ua.setKeyIdForUri(t.decryptdata.uri,a))}}const s=this.emeController.loadKey(i);return(t.keyLoadPromise=s.then(o=>(t.mediaKeySessionContext=o,i))).catch(o=>{throw t.keyLoadPromise=null,"data"in o&&(o.data.frag=e),o})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,s=new(0,i.loader)(i);return e.keyLoader=t.loader=s,t.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},c=i.keyLoadPolicy.default;s.load(l,{loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(f,h,p,g)=>{const{frag:m,keyInfo:y}=p,v=lD(y.decryptdata);if(!m.decryptdata||y!==this.keyIdToKeyInfo[v])return a(this.createKeyLoadError(m,M.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));y.decryptdata.key=m.decryptdata.key=new Uint8Array(f.data),m.keyLoader=null,y.loader=null,o({frag:m,keyInfo:y})},onError:(f,h,p,g)=>{this.resetLoader(h),a(this.createKeyLoadError(e,M.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,it({url:l.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(e,M.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(e,M.INTERNAL_ABORTED,new Error("key loading aborted"),p))}})})}resetLoader(t){const{frag:e,keyInfo:i,url:r}=t,s=i.loader;e.keyLoader===s&&(e.keyLoader=null,i.loader=null);const o=lD(i.decryptdata)||r;delete this.keyIdToKeyInfo[o],s&&s.destroy()}}function lD(n){if(n.keyFormat!==Mn_FAIRPLAY){const t=n.keyId;if(t)return qn(t)}return n.uri}function WP(n){const{type:t}=n;switch(t){case"audioTrack":return"audio";case"subtitleTrack":return"subtitle";default:return"main"}}function cD(n,t){let e=n.url;return(void 0===e||0===e.indexOf("data:"))&&(e=t.url),e}class kne{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(_.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(_.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.LEVEL_LOADING,this.onLevelLoading,this),t.off(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,o=new(e.pLoader||e.loader)(e);return this.loaders[t.type]=o,o}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:"manifest",url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:i,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=e;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:"level",url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(t,e){const{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=e;this.load({id:i,groupId:r,level:null,responseType:"text",type:"audioTrack",url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(t,e){const{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=e;this.load({id:i,groupId:r,level:null,responseType:"text",type:"subtitleTrack",url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(t,e){const i=this.loaders.level;if(i){const r=i.context;r&&!e.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders.level)}}load(t){var e;const i=this.hls.config;let s,r=this.getInternalLoader(t);if(r){const c=this.hls.logger,u=r.context;if(u&&u.levelOrTrack===t.levelOrTrack&&(u.url===t.url||u.deliveryDirectives&&!t.deliveryDirectives))return void c.log(u.url===t.url?`[playlist-loader]: ignore ${t.url} ongoing request`:`[playlist-loader]: ignore ${t.url} in favor of ${u.url}`);c.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),r.abort()}if(s="manifest"===t.type?i.manifestLoadPolicy.default:ut({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(t),J(null==(e=t.deliveryDirectives)?void 0:e.part)){let c;if("level"===t.type&&null!==t.level?c=this.hls.levels[t.level].details:"audioTrack"===t.type&&null!==t.id?c=this.hls.audioTracks[t.id].details:"subtitleTrack"===t.type&&null!==t.id&&(c=this.hls.subtitleTracks[t.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const f=1e3*Math.max(3*u,.8*d);s=ut({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{};r.load(t,{loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},{onSuccess:(c,u,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=c.data;u.parsing.start=performance.now(),Wr.isMediaPlaylist(p)||"manifest"!==d.type?this.handleTrackOrLevelPlaylist(c,u,d,f||null,h):this.handleMasterPlaylist(c,u,d,f)},onError:(c,u,d,f)=>{this.handleNetworkError(u,d,!1,c,f)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}})}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:i}=this.hls;(t||i)&&(this.hls.logger.log(`${t?"auto":"force"} startLoad with configured startPosition ${e}`),this.hls.startLoad(e))}handleMasterPlaylist(t,e,i,r){const s=this.hls,o=t.data,a=cD(t,i),l=Wr.parseMasterPlaylist(o,a);if(l.playlistParsingError)return e.parsing.end=performance.now(),void this.handleManifestParsingError(t,i,l.playlistParsingError,r,e);const{contentSteering:c,levels:u,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p}=l;this.variableList=p,u.forEach(v=>{const{unknownCodecs:b}=v;if(b){const{preferManagedMediaSource:E}=this.hls.config;let{audioCodec:D,videoCodec:w}=v;for(let T=b.length;T--;){const I=b[T];pd(I,"audio",E)?(v.audioCodec=D=D?`${D},${I}`:I,Wl.audio[D.substring(0,4)]=2,b.splice(T,1)):pd(I,"video",E)&&(v.videoCodec=w=w?`${w},${I}`:I,Wl.video[w.substring(0,4)]=2,b.splice(T,1))}}});const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":y}=Wr.parseMasterPlaylistMedia(o,a,l);g.length&&!g.some(b=>!b.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Pt({}),bitrate:0,url:""})),s.trigger(_.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:m,captions:y,contentSteering:c,url:a,stats:e,networkDetails:r,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(t,e,i,r,s){const o=this.hls,{id:a,level:l,type:c}=i,u=cD(t,i),d=J(l)?l:J(a)?a:0,f=WP(i),h=Wr.parseLevelPlaylist(t.data,u,d,f,0,this.variableList);if("manifest"===c){const p={attrs:new Pt({}),bitrate:0,details:h,name:"",url:u};h.requestScheduled=e.loading.start+fL(h,0),o.trigger(_.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:e,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=h,this.handlePlaylistLoaded(h,t,e,i,r,s)}handleManifestParsingError(t,e,i,r,s){this.hls.trigger(_.ERROR,{type:le.NETWORK_ERROR,details:M.MANIFEST_PARSING_ERROR,fatal:"manifest"===e.type,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:r,stats:s})}handleNetworkError(t,e,i=!1,r,s){let o=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${t.type}`;"level"===t.type?o+=`: ${t.level} id: ${t.id}`:("audioTrack"===t.type||"subtitleTrack"===t.type)&&(o+=` id: ${t.id} group-id: "${t.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=M.UNKNOWN,c=!1;const u=this.getInternalLoader(t);switch(t.type){case"manifest":l=i?M.MANIFEST_LOAD_TIMEOUT:M.MANIFEST_LOAD_ERROR,c=!0;break;case"level":l=i?M.LEVEL_LOAD_TIMEOUT:M.LEVEL_LOAD_ERROR,c=!1;break;case"audioTrack":l=i?M.AUDIO_TRACK_LOAD_TIMEOUT:M.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case"subtitleTrack":l=i?M.SUBTITLE_TRACK_LOAD_TIMEOUT:M.SUBTITLE_LOAD_ERROR,c=!1}u&&this.resetInternalLoader(t.type);const d={type:le.NETWORK_ERROR,details:l,fatal:c,url:t.url,loader:u,context:t,error:a,networkDetails:e,stats:s};r&&(d.response=it({url:e?.url||t.url,data:void 0},r)),this.hls.trigger(_.ERROR,d)}handlePlaylistLoaded(t,e,i,r,s,o){const a=this.hls,{type:l,level:c,levelOrTrack:u,id:d,groupId:f,deliveryDirectives:h}=r,p=cD(e,r),g=WP(r);let m="number"==typeof r.level&&"main"===g?c:void 0;const y=t.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${t.url}`),!a.config.ignorePlaylistParsingErrors)return void a.trigger(_.ERROR,{type:le.NETWORK_ERROR,details:M.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:y,reason:y.message,response:e,context:r,level:m,parent:g,networkDetails:s,stats:i});t.playlistParsingError=null}if(t.fragments.length)switch(t.live&&o&&(o.getCacheAge&&(t.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),l){case"manifest":case"level":if(m)if(u){if(u!==a.levels[m]){const v=a.levels.indexOf(u);v>-1&&(m=v)}}else m=0;a.trigger(_.LEVEL_LOADED,{details:t,levelInfo:u||a.levels[0],level:m||0,id:d||0,stats:i,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:"manifest"===l});break;case"audioTrack":a.trigger(_.AUDIO_TRACK_LOADED,{details:t,track:u,id:d||0,groupId:f||"",stats:i,networkDetails:s,deliveryDirectives:h});break;case"subtitleTrack":a.trigger(_.SUBTITLE_TRACK_LOADED,{details:t,track:u,id:d||0,groupId:f||"",stats:i,networkDetails:s,deliveryDirectives:h})}else{const v=t.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(_.ERROR,{type:le.NETWORK_ERROR,details:M.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:v,reason:v.message,response:e,context:r,level:m,parent:g,networkDetails:s,stats:i})}}}let nc=(()=>{class n{static get version(){return vd}static isMSESupported(){return GP()}static isSupported(){return function xne(){if(!GP())return!1;const n=oo();return"function"==typeof n?.isTypeSupported&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>n.isTypeSupported(gd(t,"video")))||["mp4a.40.2","fLaC"].some(t=>n.isTypeSupported(gd(t,"audio"))))}()}static getMediaSource(){return oo()}static get Events(){return _}static get MetadataSchema(){return Ii}static get ErrorTypes(){return le}static get ErrorDetails(){return M}static get DefaultConfig(){return n.defaultConfig?n.defaultConfig:yne}static set DefaultConfig(e){n.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new CE,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const i=this.logger=function jX(n,t,e){const i=Xb();if("object"==typeof console&&!0===n||"object"==typeof n){const r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=JO(s,n,e)});try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.14`)}catch{return Xb()}r.forEach(s=>{Zb[s]=JO(s,n)})}else ut(Zb,i);return i}(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=function vne(n,t,e){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=sD(n),s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(o=>{const a=`${"level"===o?"playlist":o}LoadPolicy`,l=void 0===t[a],c=[];s.forEach(u=>{const d=`${o}Loading${u}`,f=t[d];if(void 0!==f&&l){c.push(d);const h=i[a].default;switch(t[a]={default:h},u){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f}}}),c.length&&e.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${Et(t[a])}`)}),it(it({},i),t)}(n.DefaultConfig,e,i);this.userConfig=e,r.progressive&&function bne(n,t){const e=n.loader;e!==BP&&e!==UP?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):function lne(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(n.loader=BP,n.progressive=!0,n.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(r,i);const{abrController:s,bufferController:o,capLevelController:a,errorController:l,fpsController:c}=r,u=new l(this),d=this.abrController=new s(this),f=new FZ(this),h=r.interstitialsController,p=h?this.interstitialsController=new h(this,n):null,g=this.bufferController=new o(this,f),m=this.capLevelController=new a(this),y=new c(this),v=new kne(this),b=r.contentSteeringController,E=b?new b(this):null,D=this.levelController=new Ane(this,E),w=new Ine(this),T=new One(this.config,this.logger),I=this.streamController=new Nne(this,f,T),R=this.gapController=new Sne(this,f);m.setStreamController(I),y.setStreamController(I);const C=[v,D,I];p&&C.splice(1,0,p),E&&C.splice(1,0,E),this.networkControllers=C;const k=[d,g,R,m,y,w,f];this.audioTrackController=this.createController(r.audioTrackController,C);const W=r.audioStreamController;W&&C.push(this.audioStreamController=new W(this,f,T)),this.subtitleTrackController=this.createController(r.subtitleTrackController,C);const Y=r.subtitleStreamController;Y&&C.push(this.subtititleStreamController=new Y(this,f,T)),this.createController(r.timelineController,k),T.emeController=this.emeController=this.createController(r.emeController,k),this.cmcdController=this.createController(r.cmcdController,k),this.latencyController=this.createController(wne,k),this.coreComponents=k,C.push(u);const te=u.onErrorOut;"function"==typeof te&&this.on(_.ERROR,te,u),this.on(_.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,i){if(e){const r=new e(this);return i&&i.push(r),r}return null}on(e,i,r=this){this._emitter.on(e,i,r)}once(e,i,r=this){this._emitter.once(e,i,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,i,r=this,s){this._emitter.off(e,i,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,i,r){return this._emitter.emit(e,i,r)}trigger(e,i){if(this.config.debug)return this.emit(e,e,i);try{return this.emit(e,e,i)}catch(r){this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.triggeringException||(this.triggeringException=!0,this.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.INTERNAL_EXCEPTION,fatal:e===_.ERROR,event:e,error:r}),this.triggeringException=!1)}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(_.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(i=>i.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(i=>i.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const o=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(_.ERROR,{type:le.OTHER_ERROR,details:M.ATTACH_MEDIA_ERROR,fatal:!0,error:o})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const i="media"in e,r=i?e.media:e,s=i?e:{media:r};this._media=r,this.trigger(_.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(_.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(_.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const i=this.media,r=this._url,s=this._url=eE.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),i&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(i)),this.trigger(_.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,i){this.logger.log(`startLoad(${e+(i?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,i),this.started&&this.networkControllers);r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[se_MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e.audio=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e.subtitle=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,i=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),i&&this.startLoad(i))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function Ste(){try{return crypto.randomUUID()}catch{try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?s:3&s|8).toString(16)})}}}()),e}get levels(){return this.levelController.levels||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const i=!!e;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function EZ(n){return cE.indexOf(n)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:i}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=i)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:i,maxHdcpLevel:r}=this;let s;if(s=-1===i&&null!=e&&e.length?e.length-1:i,r)for(let o=s;o--;){const a=e[o].attrs["HDCP-LEVEL"];if(a&&a<=r)return o}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var i;return(null==(i=this.audioTrackController)?void 0:i.setAudioOption(e))||null}setSubtitleOption(e){var i;return(null==(i=this.subtitleTrackController)?void 0:i.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const i=this.audioTrackController;i&&(i.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const i=this.subtitleTrackController;i&&(i.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const i=this.subtitleTrackController;i&&(i.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,i=this.allAudioTracks){return Ek(e,Ik(i),navigator.mediaCapabilities)}}return n.defaultConfig=void 0,n})();var KP=function(n){return n[n.COMBINED=0]="COMBINED",n[n.VIDEO_ONLY=1]="VIDEO_ONLY",n[n.AUDIO_ONLY=2]="AUDIO_ONLY",n[n.OTHER=3]="OTHER",n}(KP||{});class Lne extends kn{constructor(t,e){super()}schedule(t,e=0){return this}}const Vg={setInterval(n,t,...e){const{delegate:i}=Vg;return i?.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=Vg;return(t?.clearInterval||clearInterval)(n)},delegate:void 0},zP={now:()=>(zP.delegate||Date).now(),delegate:void 0};class Id{constructor(t,e=Id.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}Id.now=zP.now;const uD=new class Fne extends Id{constructor(t,e=Id.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}(class Pne extends Lne{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return Vg.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&Vg.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,zd(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}),Bne=uD;function dD(n=0,t,e=Bne){let i=-1;return null!=t&&(lM(t)?e=t:i=t),new Dt(r=>{let s=function $ne(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let o=0;return e.schedule(function(){r.closed||(r.next(o++),0<=i?this.schedule(void 0,i):r.complete())},s)})}const zne=["addListener","removeListener"],qne=["addEventListener","removeEventListener"],Yne=["on","off"];function Nn(n,t,e,i){if(We(e)&&(i=e,e=void 0),i)return Nn(n,t,e).pipe(zv(i));const[r,s]=function Zne(n){return We(n.addEventListener)&&We(n.removeEventListener)}(n)?qne.map(o=>a=>n[o](t,a,e)):function Qne(n){return We(n.addListener)&&We(n.removeListener)}(n)?zne.map(YP(n,t)):function Xne(n){return We(n.on)&&We(n.off)}(n)?Yne.map(YP(n,t)):[];if(!r&&Wv(n))return Sn(o=>Nn(o,t,e))(Tn(n));if(!r)throw new TypeError("Invalid event target");return new Dt(o=>{const a=(...l)=>o.next(1<l.length?l:l[0]);return r(a),()=>s(a)})}function YP(n,t){return e=>i=>n[e](t,i)}const{isArray:Jne}=Array;function QP(n){return 1===n.length&&Jne(n[0])?n[0]:n}function XP(...n){return 1===(n=QP(n)).length?Tn(n[0]):new Dt(function eie(n){return t=>{let e=[];for(let i=0;e&&!t.closed&&i<n.length;i++)e.push(Tn(n[i]).subscribe(dt(t,r=>{if(e){for(let s=0;s<e.length;s++)s!==i&&e[s].unsubscribe();e=null}t.next(r)})))}}(n))}function fD(...n){const t=lp(n),e=QP(n);return e.length?new Dt(i=>{let r=e.map(()=>[]),s=e.map(()=>!1);i.add(()=>{r=s=null});for(let o=0;!i.closed&&o<e.length;o++)Tn(e[o]).subscribe(dt(i,a=>{if(r[o].push(a),r.every(l=>l.length)){const l=r.map(c=>c.shift());i.next(t?t(...l):l),r.some((c,u)=>!c.length&&s[u])&&i.complete()}},()=>{s[o]=!0,!r[o].length&&i.complete()}));return()=>{r=s=null}}):oi}function hD(...n){const t=lp(n);return Wt((e,i)=>{const r=n.length,s=new Array(r);let o=n.map(()=>!1),a=!1;for(let l=0;l<r;l++)Tn(n[l]).subscribe(dt(i,c=>{s[l]=c,!a&&!o[l]&&(o[l]=!0,(a=o.every(es))&&(o=null))},pc));e.subscribe(dt(i,l=>{if(a){const c=[l,...s];i.next(t?t(...c):c)}}))})}function ZP(n,t){return t?e=>Fu(t.pipe(Ki(1),function iie(){return Wt((n,t)=>{n.subscribe(dt(t,pc))})}()),e.pipe(ZP(n))):Sn((e,i)=>Tn(n(e,i)).pipe(Ki(1),function rie(n){return Ne(()=>n)}(e)))}var cie={left:"right",right:"left",bottom:"top",top:"bottom"};function jg(n){return n.replace(/left|right|bottom|top/g,function(t){return cie[t]})}function Qr(n){return n.split("-")[0]}var uie={start:"end",end:"start"};function JP(n){return n.replace(/start|end/g,function(t){return uie[t]})}var xi="top",vr="bottom",br="right",Ri="left",pD="auto",wd=[xi,vr,br,Ri],ic="start",Ad="end",eF="viewport",xd="popper",tF=wd.reduce(function(n,t){return n.concat([t+"-"+ic,t+"-"+Ad])},[]),nF=[].concat(wd,[pD]).reduce(function(n,t){return n.concat([t,t+"-"+ic,t+"-"+Ad])},[]),Die=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Mi(n){if(null==n)return window;if("[object Window]"!==n.toString()){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function ha(n){return n instanceof Mi(n).Element||n instanceof Element}function Xi(n){return n instanceof Mi(n).HTMLElement||n instanceof HTMLElement}function gD(n){return!(typeof ShadowRoot>"u")&&(n instanceof Mi(n).ShadowRoot||n instanceof ShadowRoot)}function fo(n){return((ha(n)?n.ownerDocument:n.document)||window.document).documentElement}var pa=Math.max,Hg=Math.min,rc=Math.round;function mD(){var n=navigator.userAgentData;return null!=n&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function iF(){return!/^((?!chrome|android).)*safari/i.test(mD())}function sc(n,t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=n.getBoundingClientRect(),r=1,s=1;t&&Xi(n)&&(r=n.offsetWidth>0&&rc(i.width)/n.offsetWidth||1,s=n.offsetHeight>0&&rc(i.height)/n.offsetHeight||1);var a=(ha(n)?Mi(n):window).visualViewport,l=!iF()&&e,c=(i.left+(l&&a?a.offsetLeft:0))/r,u=(i.top+(l&&a?a.offsetTop:0))/s,d=i.width/r,f=i.height/s;return{width:d,height:f,top:u,right:c+d,bottom:u+f,left:c,x:c,y:u}}function yD(n){var t=Mi(n);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function _D(n){return sc(fo(n)).left+yD(n).scrollLeft}function Rs(n){return Mi(n).getComputedStyle(n)}function Xr(n){return n?(n.nodeName||"").toLowerCase():null}function Gg(n){return"html"===Xr(n)?n:n.assignedSlot||n.parentNode||(gD(n)?n.host:null)||fo(n)}function vD(n){var t=Rs(n);return/auto|scroll|overlay|hidden/.test(t.overflow+t.overflowY+t.overflowX)}function rF(n){return["html","body","#document"].indexOf(Xr(n))>=0?n.ownerDocument.body:Xi(n)&&vD(n)?n:rF(Gg(n))}function Rd(n,t){var e;void 0===t&&(t=[]);var i=rF(n),r=i===(null==(e=n.ownerDocument)?void 0:e.body),s=Mi(i),o=r?[s].concat(s.visualViewport||[],vD(i)?i:[]):i,a=t.concat(o);return r?a:a.concat(Rd(Gg(o)))}function Cie(n){return["table","td","th"].indexOf(Xr(n))>=0}function sF(n){return Xi(n)&&"fixed"!==Rs(n).position?n.offsetParent:null}function Md(n){for(var t=Mi(n),e=sF(n);e&&Cie(e)&&"static"===Rs(e).position;)e=sF(e);return e&&("html"===Xr(e)||"body"===Xr(e)&&"static"===Rs(e).position)?t:e||function Iie(n){var t=/firefox/i.test(mD());if(/Trident/i.test(mD())&&Xi(n)&&"fixed"===Rs(n).position)return null;var r=Gg(n);for(gD(r)&&(r=r.host);Xi(r)&&["html","body"].indexOf(Xr(r))<0;){var s=Rs(r);if("none"!==s.transform||"none"!==s.perspective||"paint"===s.contain||-1!==["transform","perspective"].indexOf(s.willChange)||t&&"filter"===s.willChange||t&&s.filter&&"none"!==s.filter)return r;r=r.parentNode}return null}(n)||t}function oF(n,t){var e=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(e&&gD(e)){var i=t;do{if(i&&n.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function bD(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function aF(n,t,e){return t===eF?bD(function Tie(n,t){var e=Mi(n),i=fo(n),r=e.visualViewport,s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;var c=iF();(c||!c&&"fixed"===t)&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a+_D(n),y:l}}(n,e)):ha(t)?function wie(n,t){var e=sc(n,!1,"fixed"===t);return e.top=e.top+n.clientTop,e.left=e.left+n.clientLeft,e.bottom=e.top+n.clientHeight,e.right=e.left+n.clientWidth,e.width=n.clientWidth,e.height=n.clientHeight,e.x=e.left,e.y=e.top,e}(t,e):bD(function Sie(n){var t,e=fo(n),i=yD(n),r=null==(t=n.ownerDocument)?void 0:t.body,s=pa(e.scrollWidth,e.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=pa(e.scrollHeight,e.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+_D(n),l=-i.scrollTop;return"rtl"===Rs(r||e).direction&&(a+=pa(e.clientWidth,r?r.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(fo(n)))}function oc(n){return n.split("-")[1]}function ED(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function lF(n){var l,t=n.reference,e=n.element,i=n.placement,r=i?Qr(i):null,s=i?oc(i):null,o=t.x+t.width/2-e.width/2,a=t.y+t.height/2-e.height/2;switch(r){case xi:l={x:o,y:t.y-e.height};break;case vr:l={x:o,y:t.y+t.height};break;case br:l={x:t.x+t.width,y:a};break;case Ri:l={x:t.x-e.width,y:a};break;default:l={x:t.x,y:t.y}}var c=r?ED(r):null;if(null!=c){var u="y"===c?"height":"width";switch(s){case ic:l[c]=l[c]-(t[u]/2-e[u]/2);break;case Ad:l[c]=l[c]+(t[u]/2-e[u]/2)}}return l}function uF(n){return Object.assign({},{top:0,right:0,bottom:0,left:0},n)}function dF(n,t){return t.reduce(function(e,i){return e[i]=n,e},{})}function DD(n,t){void 0===t&&(t={});var i=t.placement,r=void 0===i?n.placement:i,s=t.strategy,o=void 0===s?n.strategy:s,a=t.boundary,l=void 0===a?"clippingParents":a,c=t.rootBoundary,u=void 0===c?eF:c,d=t.elementContext,f=void 0===d?xd:d,h=t.altBoundary,p=void 0!==h&&h,g=t.padding,m=void 0===g?0:g,y=uF("number"!=typeof m?m:dF(m,wd)),b=n.rects.popper,E=n.elements[p?f===xd?"reference":xd:f],D=function xie(n,t,e,i){var r="clippingParents"===t?function Aie(n){var t=Rd(Gg(n)),i=["absolute","fixed"].indexOf(Rs(n).position)>=0&&Xi(n)?Md(n):n;return ha(i)?t.filter(function(r){return ha(r)&&oF(r,i)&&"body"!==Xr(r)}):[]}(n):[].concat(t),s=[].concat(r,[e]),a=s.reduce(function(l,c){var u=aF(n,c,i);return l.top=pa(u.top,l.top),l.right=Hg(u.right,l.right),l.bottom=Hg(u.bottom,l.bottom),l.left=pa(u.left,l.left),l},aF(n,s[0],i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(ha(E)?E:E.contextElement||fo(n.elements.popper),l,u,o),w=sc(n.elements.reference),T=lF({reference:w,element:b,strategy:"absolute",placement:r}),I=bD(Object.assign({},b,T)),R=f===xd?I:w,C={top:D.top-R.top+y.top,bottom:R.bottom-D.bottom+y.bottom,left:D.left-R.left+y.left,right:R.right-D.right+y.right},k=n.modifiersData.offset;if(f===xd&&k){var W=k[r];Object.keys(C).forEach(function(Y){var te=[br,vr].indexOf(Y)>=0?1:-1,ee=[xi,vr].indexOf(Y)>=0?"y":"x";C[Y]+=W[ee]*te})}return C}const Oie={name:"flip",enabled:!0,phase:"main",fn:function Nie(n){var t=n.state,e=n.options,i=n.name;if(!t.modifiersData[i]._skip){for(var r=e.mainAxis,s=void 0===r||r,o=e.altAxis,a=void 0===o||o,l=e.fallbackPlacements,c=e.padding,u=e.boundary,d=e.rootBoundary,f=e.altBoundary,h=e.flipVariations,p=void 0===h||h,g=e.allowedAutoPlacements,m=t.options.placement,y=Qr(m),b=l||(y!==m&&p?function Mie(n){if(Qr(n)===pD)return[];var t=jg(n);return[JP(n),t,JP(t)]}(m):[jg(m)]),E=[m].concat(b).reduce(function($e,ve){return $e.concat(Qr(ve)===pD?function Rie(n,t){void 0===t&&(t={});var r=t.boundary,s=t.rootBoundary,o=t.padding,a=t.flipVariations,l=t.allowedAutoPlacements,c=void 0===l?nF:l,u=oc(t.placement),d=u?a?tF:tF.filter(function(p){return oc(p)===u}):wd,f=d.filter(function(p){return c.indexOf(p)>=0});0===f.length&&(f=d);var h=f.reduce(function(p,g){return p[g]=DD(n,{placement:g,boundary:r,rootBoundary:s,padding:o})[Qr(g)],p},{});return Object.keys(h).sort(function(p,g){return h[p]-h[g]})}(t,{placement:ve,boundary:u,rootBoundary:d,padding:c,flipVariations:p,allowedAutoPlacements:g}):ve)},[]),D=t.rects.reference,w=t.rects.popper,T=new Map,I=!0,R=E[0],C=0;C<E.length;C++){var k=E[C],W=Qr(k),Y=oc(k)===ic,te=[xi,vr].indexOf(W)>=0,ee=te?"width":"height",V=DD(t,{placement:k,boundary:u,rootBoundary:d,altBoundary:f,padding:c}),Z=te?Y?br:Ri:Y?vr:xi;D[ee]>w[ee]&&(Z=jg(Z));var Q=jg(Z),ne=[];if(s&&ne.push(V[W]<=0),a&&ne.push(V[Z]<=0,V[Q]<=0),ne.every(function($e){return $e})){R=k,I=!1;break}T.set(k,ne)}if(I)for(var q=function(ve){var Me=E.find(function(Yt){var wt=T.get(Yt);if(wt)return wt.slice(0,ve).every(function(Fn){return Fn})});if(Me)return R=Me,"break"},K=p?3:1;K>0&&"break"!==q(K);K--);t.placement!==R&&(t.modifiersData[i]._skip=!0,t.placement=R,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Nd(n,t,e){return pa(n,Hg(t,e))}function TD(n){var t=sc(n),e=n.offsetWidth,i=n.offsetHeight;return Math.abs(t.width-e)<=1&&(e=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:n.offsetLeft,y:n.offsetTop,width:e,height:i}}const Fie={name:"preventOverflow",enabled:!0,phase:"main",fn:function Pie(n){var t=n.state,e=n.options,i=n.name,r=e.mainAxis,s=void 0===r||r,o=e.altAxis,a=void 0!==o&&o,f=e.tether,h=void 0===f||f,p=e.tetherOffset,g=void 0===p?0:p,m=DD(t,{boundary:e.boundary,rootBoundary:e.rootBoundary,padding:e.padding,altBoundary:e.altBoundary}),y=Qr(t.placement),v=oc(t.placement),b=!v,E=ED(y),D=function kie(n){return"x"===n?"y":"x"}(E),w=t.modifiersData.popperOffsets,T=t.rects.reference,I=t.rects.popper,R="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,C="number"==typeof R?{mainAxis:R,altAxis:R}:Object.assign({mainAxis:0,altAxis:0},R),k=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,W={x:0,y:0};if(w){if(s){var Y,te="y"===E?xi:Ri,ee="y"===E?vr:br,V="y"===E?"height":"width",Z=w[E],Q=Z+m[te],ne=Z-m[ee],he=h?-I[V]/2:0,q=v===ic?T[V]:I[V],K=v===ic?-I[V]:-T[V],we=t.elements.arrow,$e=h&&we?TD(we):{width:0,height:0},ve=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Me=ve[te],Yt=ve[ee],wt=Nd(0,T[V],$e[V]),Fn=b?T[V]/2-he-wt-Me-C.mainAxis:q-wt-Me-C.mainAxis,Ji=b?-T[V]/2+he+wt+Yt+C.mainAxis:K+wt+Yt+C.mainAxis,Dr=t.elements.arrow&&Md(t.elements.arrow),$D=Dr?"y"===E?Dr.clientTop||0:Dr.clientLeft||0:0,dc=null!=(Y=k?.[E])?Y:0,C2=Z+Ji-dc,je=Nd(h?Hg(Q,Z+Fn-dc-$D):Q,Z,h?pa(ne,C2):ne);w[E]=je,W[E]=je-Z}if(a){var _n,vn=w[D],Tr="y"===D?"height":"width",Zr=vn+m["x"===E?xi:Ri],Fd=vn-m["x"===E?vr:br],ho=-1!==[xi,Ri].indexOf(y),Bd=null!=(_n=k?.[D])?_n:0,po=ho?Zr:vn-T[Tr]-I[Tr]-Bd+C.altAxis,Ud=ho?vn+T[Tr]+I[Tr]-Bd-C.altAxis:Fd,am=h&&ho?function Lie(n,t,e){var i=Nd(n,t,e);return i>e?e:i}(po,vn,Ud):Nd(h?po:Zr,vn,h?Ud:Fd);w[D]=am,W[D]=am-vn}t.modifiersData[i]=W}},requiresIfExists:["offset"]},Vie={name:"arrow",enabled:!0,phase:"main",fn:function Uie(n){var t,e=n.state,i=n.name,r=n.options,s=e.elements.arrow,o=e.modifiersData.popperOffsets,a=Qr(e.placement),l=ED(a),u=[Ri,br].indexOf(a)>=0?"height":"width";if(s&&o){var d=function(t,e){return uF("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:dF(t,wd))}(r.padding,e),f=TD(s),h="y"===l?xi:Ri,p="y"===l?vr:br,g=e.rects.reference[u]+e.rects.reference[l]-o[l]-e.rects.popper[u],m=o[l]-e.rects.reference[l],y=Md(s),v=y?"y"===l?y.clientHeight||0:y.clientWidth||0:0,w=v/2-f[u]/2+(g/2-m/2),T=Nd(d[h],w,v-f[u]-d[p]);e.modifiersData[i]=((t={})[l]=T,t.centerOffset=T-w,t)}},effect:function $ie(n){var t=n.state,i=n.options.element,r=void 0===i?"[data-popper-arrow]":i;null!=r&&("string"==typeof r&&!(r=t.elements.popper.querySelector(r))||oF(t.elements.popper,r)&&(t.elements.arrow=r))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Wie(n,t,e){void 0===e&&(e=!1);var i=Xi(t),r=Xi(t)&&function Gie(n){var t=n.getBoundingClientRect(),e=rc(t.width)/n.offsetWidth||1,i=rc(t.height)/n.offsetHeight||1;return 1!==e||1!==i}(t),s=fo(t),o=sc(n,r,e),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!e)&&(("body"!==Xr(t)||vD(s))&&(a=function Hie(n){return n!==Mi(n)&&Xi(n)?function jie(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}(n):yD(n)}(t)),Xi(t)?((l=sc(t,!0)).x+=t.clientLeft,l.y+=t.clientTop):s&&(l.x=_D(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function Kie(n){var t=new Map,e=new Set,i=[];function r(s){e.add(s.name),[].concat(s.requires||[],s.requiresIfExists||[]).forEach(function(a){if(!e.has(a)){var l=t.get(a);l&&r(l)}}),i.push(s)}return n.forEach(function(s){t.set(s.name,s)}),n.forEach(function(s){e.has(s.name)||r(s)}),i}function qie(n){var t;return function(){return t||(t=new Promise(function(e){Promise.resolve().then(function(){t=void 0,e(n())})})),t}}var fF={placement:"bottom",modifiers:[],strategy:"absolute"};function hF(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return!t.some(function(i){return!(i&&"function"==typeof i.getBoundingClientRect)})}function Qie(n){void 0===n&&(n={});var e=n.defaultModifiers,i=void 0===e?[]:e,r=n.defaultOptions,s=void 0===r?fF:r;return function(a,l,c){void 0===c&&(c=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},fF,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},d=[],f=!1,h={state:u,setOptions:function(y){var v="function"==typeof y?y(u.options):y;g(),u.options=Object.assign({},s,u.options,v),u.scrollParents={reference:ha(a)?Rd(a):a.contextElement?Rd(a.contextElement):[],popper:Rd(l)};var b=function zie(n){var t=Kie(n);return Die.reduce(function(e,i){return e.concat(t.filter(function(r){return r.phase===i}))},[])}(function Yie(n){var t=n.reduce(function(e,i){var r=e[i.name];return e[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,e},{});return Object.keys(t).map(function(e){return t[e]})}([].concat(i,u.options.modifiers)));return u.orderedModifiers=b.filter(function(E){return E.enabled}),function p(){u.orderedModifiers.forEach(function(m){var v=m.options,E=m.effect;if("function"==typeof E){var D=E({state:u,name:m.name,instance:h,options:void 0===v?{}:v});d.push(D||function(){})}})}(),h.update()},forceUpdate:function(){if(!f){var y=u.elements,v=y.reference,b=y.popper;if(hF(v,b)){u.rects={reference:Wie(v,Md(b),"fixed"===u.options.strategy),popper:TD(b)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(C){return u.modifiersData[C.name]=Object.assign({},C.data)});for(var E=0;E<u.orderedModifiers.length;E++)if(!0!==u.reset){var D=u.orderedModifiers[E],w=D.fn,T=D.options;"function"==typeof w&&(u=w({state:u,options:void 0===T?{}:T,name:D.name,instance:h})||u)}else u.reset=!1,E=-1}}},update:qie(function(){return new Promise(function(m){h.forceUpdate(),m(u)})}),destroy:function(){g(),f=!0}};if(!hF(a,l))return h;function g(){d.forEach(function(m){return m()}),d=[]}return h.setOptions(c).then(function(m){!f&&c.onFirstUpdate&&c.onFirstUpdate(m)}),h}}var Wg={passive:!0};const Zie={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function Xie(n){var t=n.state,e=n.instance,i=n.options,r=i.scroll,s=void 0===r||r,o=i.resize,a=void 0===o||o,l=Mi(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach(function(u){u.addEventListener("scroll",e.update,Wg)}),a&&l.addEventListener("resize",e.update,Wg),function(){s&&c.forEach(function(u){u.removeEventListener("scroll",e.update,Wg)}),a&&l.removeEventListener("resize",e.update,Wg)}},data:{}},ere={name:"popperOffsets",enabled:!0,phase:"read",fn:function Jie(n){var t=n.state;t.modifiersData[n.name]=lF({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};var tre={top:"auto",right:"auto",bottom:"auto",left:"auto"};function pF(n){var t,e=n.popper,i=n.popperRect,r=n.placement,s=n.variation,o=n.offsets,a=n.position,l=n.gpuAcceleration,c=n.adaptive,u=n.roundOffsets,d=n.isFixed,f=o.x,h=void 0===f?0:f,p=o.y,g=void 0===p?0:p,m="function"==typeof u?u({x:h,y:g}):{x:h,y:g};h=m.x,g=m.y;var y=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),b=Ri,E=xi,D=window;if(c){var w=Md(e),T="clientHeight",I="clientWidth";w===Mi(e)&&"static"!==Rs(w=fo(e)).position&&"absolute"===a&&(T="scrollHeight",I="scrollWidth"),(r===xi||(r===Ri||r===br)&&s===Ad)&&(E=vr,g-=(d&&w===D&&D.visualViewport?D.visualViewport.height:w[T])-i.height,g*=l?1:-1),r!==Ri&&(r!==xi&&r!==vr||s!==Ad)||(b=br,h-=(d&&w===D&&D.visualViewport?D.visualViewport.width:w[I])-i.width,h*=l?1:-1)}var Y,k=Object.assign({position:a},c&&tre),W=!0===u?function nre(n,t){var i=n.y,r=t.devicePixelRatio||1;return{x:rc(n.x*r)/r||0,y:rc(i*r)/r||0}}({x:h,y:g},Mi(e)):{x:h,y:g};return h=W.x,g=W.y,Object.assign({},k,l?((Y={})[E]=v?"0":"",Y[b]=y?"0":"",Y.transform=(D.devicePixelRatio||1)<=1?"translate("+h+"px, "+g+"px)":"translate3d("+h+"px, "+g+"px, 0)",Y):((t={})[E]=v?g+"px":"",t[b]=y?h+"px":"",t.transform="",t))}const rre={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function ire(n){var t=n.state,e=n.options,i=e.gpuAcceleration,r=void 0===i||i,s=e.adaptive,o=void 0===s||s,a=e.roundOffsets,l=void 0===a||a,c={placement:Qr(t.placement),variation:oc(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,pF(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,pF(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var are=[Zie,ere,rre,{name:"applyStyles",enabled:!0,phase:"write",fn:function sre(n){var t=n.state;Object.keys(t.elements).forEach(function(e){var i=t.styles[e]||{},r=t.attributes[e]||{},s=t.elements[e];!Xi(s)||!Xr(s)||(Object.assign(s.style,i),Object.keys(r).forEach(function(o){var a=r[o];!1===a?s.removeAttribute(o):s.setAttribute(o,!0===a?"":a)}))})},effect:function ore(n){var t=n.state,e={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,e.popper),t.styles=e,t.elements.arrow&&Object.assign(t.elements.arrow.style,e.arrow),function(){Object.keys(t.elements).forEach(function(i){var r=t.elements[i],s=t.attributes[i]||{},a=Object.keys(t.styles.hasOwnProperty(i)?t.styles[i]:e[i]).reduce(function(l,c){return l[c]="",l},{});!Xi(r)||!Xr(r)||(Object.assign(r.style,a),Object.keys(s).forEach(function(l){r.removeAttribute(l)}))})}},requires:["computeStyles"]}],lre=Qie({defaultModifiers:are});const dre={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function ure(n){var t=n.state,i=n.name,r=n.options.offset,s=void 0===r?[0,0]:r,o=nF.reduce(function(u,d){return u[d]=function cre(n,t,e){var i=Qr(n),r=[Ri,xi].indexOf(i)>=0?-1:1,s="function"==typeof e?e(Object.assign({},t,{placement:n})):e,o=s[0],a=s[1];return o=o||0,a=(a||0)*r,[Ri,br].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}(d,t.rects,s),u},{}),a=o[t.placement],c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=a.x,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=o}},gF=["*"],Hre=["dialog"],yF={animation:!0,transitionTimerDelayMs:5};let Kg=(()=>{class n{constructor(){this.animation=yF.animation}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function ac(n){return"string"==typeof n}function ga(n){return null!=n}function lc(n){return(n||document.body).getBoundingClientRect()}function bF(n=document){const t=n?.activeElement;return t?t.shadowRoot?bF(t.shadowRoot):t:null}const Pse=()=>{},{transitionTimerDelayMs:Fse}=yF,Od=new Map,Zi=(n,t,e,i)=>{let r=i.context||{};const s=Od.get(t);if(s)switch(i.runningTransition){case"continue":return oi;case"stop":n.run(()=>s.transition$.complete()),r=Object.assign(s.context,r),Od.delete(t)}const o=e(t,i.animation,r)||Pse;if(!i.animation||"none"===window.getComputedStyle(t).transitionProperty)return n.run(()=>o()),fe(void 0).pipe(function Lse(n){return t=>new Dt(e=>t.subscribe({next:o=>n.run(()=>e.next(o)),error:o=>n.run(()=>e.error(o)),complete:()=>n.run(()=>e.complete())}))}(n));const a=new Ke,l=new Ke,c=a.pipe(function nie(...n){return t=>Fu(t,fe(...n))}(!0));Od.set(t,{transition$:a,complete:()=>{l.next(),l.complete()},context:r});const u=function Nse(n){const{transitionDelay:t,transitionDuration:e}=window.getComputedStyle(n);return 1e3*(parseFloat(t)+parseFloat(e))}(t);return n.runOutsideAngular(()=>{const d=Nn(t,"transitionend").pipe(gn(c),pn(({target:h})=>h===t));XP(dD(u+Fse).pipe(gn(c)),d,l).pipe(gn(c)).subscribe(()=>{Od.delete(t),n.run(()=>{o(),a.next(),a.complete()})})}),a.asObservable()};let SF=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),CF=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),AF=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),xF=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})();const Zg=(n,t)=>!!t&&t.some(e=>e.contains(n)),kF=(n,t)=>!t||null!=function kse(n,t){return!t||typeof n.closest>"u"?null:n.closest(t)}(n,t),uoe=typeof navigator<"u"&&!!navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));function LF(n,t,e,i,r,s,o,a){e&&n.runOutsideAngular((n=>uoe?()=>setTimeout(()=>n(),100):n)(()=>{const c=Nn(t,"keydown").pipe(gn(r),pn(f=>"Escape"===f.key),qt(f=>f.preventDefault())),u=Nn(t,"mousedown").pipe(Ne(f=>{const h=f.target;return 2!==f.button&&!Zg(h,o)&&("inside"===e?Zg(h,s)&&kF(h,a):"outside"===e?!Zg(h,s):kF(h,a)||!Zg(h,s))}),gn(r)),d=Nn(t,"mouseup").pipe(hD(u),pn(([f,h])=>h),function sie(n,t=uD){const e=dD(n,t);return ZP(()=>e)}(0),gn(r));XP([c.pipe(Ne(f=>0)),d.pipe(Ne(f=>1))]).subscribe(f=>n.run(()=>i(f)))}))}const PF=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function FF(n){const t=Array.from(n.querySelectorAll(PF)).filter(e=>-1!==e.tabIndex);return[t[0],t[t.length-1]]}let foe=(()=>{class n{constructor(){this._element=S(Jt).documentElement}isRTL(){return"rtl"===(this._element.getAttribute("dir")||"").toLowerCase()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();const hoe=/\s+/,poe=/  +/gi,goe={top:["top"],bottom:["bottom"],start:["left","right"],left:["left"],end:["right","left"],right:["right"],"top-start":["top-start","top-end"],"top-left":["top-start"],"top-end":["top-end","top-start"],"top-right":["top-end"],"bottom-start":["bottom-start","bottom-end"],"bottom-left":["bottom-start"],"bottom-end":["bottom-end","bottom-start"],"bottom-right":["bottom-end"],"start-top":["left-start","right-start"],"left-top":["left-start"],"start-bottom":["left-end","right-end"],"left-bottom":["left-end"],"end-top":["right-start","left-start"],"right-top":["right-start"],"end-bottom":["right-end","left-end"],"right-bottom":["right-end"]},yoe=/^left/,_oe=/^right/,voe=/^start/,boe=/^end/;function UF({placement:n,baseClass:t},e){let i=Array.isArray(n)?n:n.split(hoe),s=i.findIndex(c=>"auto"===c);s>=0&&["top","bottom","start","end","top-start","top-end","bottom-start","bottom-end","start-top","start-bottom","end-top","end-bottom"].forEach(function(c){null==i.find(u=>-1!==u.search("^"+c))&&i.splice(s++,1,c)});const o=i.map(c=>function moe(n,t){const[e,i]=goe[n];return t&&i||e}(c,e.isRTL()));return{placement:o.shift(),modifiers:[{name:"bootstrapClasses",enabled:!!t,phase:"write",fn({state:c}){const u=new RegExp(t+"(-[a-z]+)*","gi"),d=c.elements.popper,f=c.placement;let h=d.className;h=h.replace(u,""),h+=` ${function Eoe(n,t){let[e,i]=t.split("-");const r=e.replace(yoe,"start").replace(_oe,"end");let s=[r];if(i){let o=i;("left"===e||"right"===e)&&(o=o.replace(voe,"top").replace(boe,"bottom")),s.push(`${r}-${o}`)}return n&&(s=s.map(o=>`${n}-${o}`)),s.join(" ")}(t,f)}`,h=h.trim().replace(poe," "),d.className=h}},Oie,Fie,Vie,{enabled:!0,name:"flip",options:{fallbackPlacements:o}}]}}function $F(n){return n}new Date(1882,10,12),new Date(2174,10,25);let JF=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),Foe=(()=>{class n{constructor(){this.autoClose=!0,this.placement=["bottom-start","bottom-end","top-start","top-end"],this.popperOptions=e=>e,this.container=null}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),nm=(()=>{class n{constructor(){this._disabled=!1,this.nativeElement=S(nt).nativeElement,this.tabindex=0}set disabled(e){this._disabled=""===e||!0===e}get disabled(){return this._disabled}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=X({type:n,selectors:[["","ngbDropdownItem",""]],hostAttrs:[1,"dropdown-item"],hostVars:3,hostBindings:function(i,r){2&i&&($i("tabIndex",r.disabled?-1:r.tabindex),Ge("disabled",r.disabled))},inputs:{tabindex:"tabindex",disabled:"disabled"}})}}return n})(),e2=(()=>{class n{constructor(){this.item=S(nm)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=X({type:n,selectors:[["button","ngbDropdownItem",""]],hostVars:1,hostBindings:function(i,r){2&i&&$i("disabled",r.item.disabled)}})}}return n})(),PD=(()=>{class n{constructor(){this.dropdown=S(rm),this.nativeElement=S(nt).nativeElement}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=X({type:n,selectors:[["","ngbDropdownMenu",""]],contentQueries:function(i,r,s){if(1&i&&fn(s,nm,4),2&i){let o;gt(o=mt())&&(r.menuItems=o)}},hostAttrs:[1,"dropdown-menu"],hostVars:2,hostBindings:function(i,r){1&i&&re("keydown.ArrowUp",function(o){return r.dropdown.onKeyDown(o)})("keydown.ArrowDown",function(o){return r.dropdown.onKeyDown(o)})("keydown.Home",function(o){return r.dropdown.onKeyDown(o)})("keydown.End",function(o){return r.dropdown.onKeyDown(o)})("keydown.Enter",function(o){return r.dropdown.onKeyDown(o)})("keydown.Space",function(o){return r.dropdown.onKeyDown(o)})("keydown.Tab",function(o){return r.dropdown.onKeyDown(o)})("keydown.Shift.Tab",function(o){return r.dropdown.onKeyDown(o)}),2&i&&Ge("show",r.dropdown.isOpen())}})}}return n})(),im=(()=>{class n{constructor(){this.dropdown=S(rm),this.nativeElement=S(nt).nativeElement}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=X({type:n,selectors:[["","ngbDropdownAnchor",""]],hostAttrs:[1,"dropdown-toggle"],hostVars:3,hostBindings:function(i,r){2&i&&(ht("aria-expanded",r.dropdown.isOpen()),Ge("show",r.dropdown.isOpen()))}})}}return n})(),t2=(()=>{class n extends im{static{this.\u0275fac=(()=>{let e;return function(r){return(e||(e=Tt(n)))(r||n)}})()}static{this.\u0275dir=X({type:n,selectors:[["","ngbDropdownToggle",""]],hostAttrs:[1,"dropdown-toggle"],hostVars:3,hostBindings:function(i,r){1&i&&re("click",function(){return r.dropdown.toggle()})("keydown.ArrowUp",function(o){return r.dropdown.onKeyDown(o)})("keydown.ArrowDown",function(o){return r.dropdown.onKeyDown(o)})("keydown.Home",function(o){return r.dropdown.onKeyDown(o)})("keydown.End",function(o){return r.dropdown.onKeyDown(o)})("keydown.Tab",function(o){return r.dropdown.onKeyDown(o)})("keydown.Shift.Tab",function(o){return r.dropdown.onKeyDown(o)}),2&i&&(ht("aria-expanded",r.dropdown.isOpen()),Ge("show",r.dropdown.isOpen()))},features:[yt([{provide:im,useExisting:Xe(()=>n)}]),qe]})}}return n})(),rm=(()=>{class n{constructor(){this._changeDetector=S(ji),this._config=S(Foe),this._document=S(Jt),this._injector=S(at),this._ngZone=S(ke),this._nativeElement=S(nt).nativeElement,this._destroyCloseHandlers$=new Ke,this._bodyContainer=null,this._positioning=function VF(){const n=S(foe);let t=null;return{createPopper(e){if(!t){let r=(e.updatePopperOptions||$F)(UF(e,n));t=lre(e.hostElement,e.targetElement,r)}},update(){t&&t.update()},setOptions(e){if(t){let r=(e.updatePopperOptions||$F)(UF(e,n));t.setOptions(r)}},destroy(){t&&(t.destroy(),t=null)}}}(),this.autoClose=this._config.autoClose,this._open=!1,this.placement=this._config.placement,this.popperOptions=this._config.popperOptions,this.container=this._config.container,this.openChange=new _e}ngOnInit(){this.display||(this.display=this._nativeElement.closest(".navbar")?"static":"dynamic")}ngAfterContentInit(){Fo({write:()=>{this._applyPlacementClasses(),this._open&&this._setCloseHandlers()}},{injector:this._injector})}ngOnChanges(e){if(e.container&&this._open&&this._applyContainer(this.container),e.placement&&!e.placement.firstChange&&(this._positioning.setOptions({hostElement:this._anchor.nativeElement,targetElement:this._bodyContainer||this._menu.nativeElement,placement:this.placement}),this._applyPlacementClasses()),e.dropdownClass){const{currentValue:i,previousValue:r}=e.dropdownClass;this._applyCustomDropdownClass(i,r)}e.autoClose&&this._open&&(this.autoClose=e.autoClose.currentValue,this._setCloseHandlers())}isOpen(){return this._open}open(){this._open||(this._open=!0,this._applyContainer(this.container),this.openChange.emit(!0),this._setCloseHandlers(),this._anchor&&(this._anchor.nativeElement.focus(),"dynamic"===this.display&&this._ngZone.runOutsideAngular(()=>{this._positioning.createPopper({hostElement:this._anchor.nativeElement,targetElement:this._bodyContainer||this._menu.nativeElement,placement:this.placement,updatePopperOptions:e=>this.popperOptions(function GF(n){return t=>(t.modifiers.push(dre,{name:"offset",options:{offset:()=>n}}),t)}([0,2])(e))}),this._applyPlacementClasses(),this._afterRenderRef=function Vf(n,t){!t?.injector&&wo();const e=t?.injector??S(at);return ti("NgAfterRender"),o1(n,e,t,!1)}({write:()=>{this._positionMenu()}},{injector:this._injector})})))}_setCloseHandlers(){this._destroyCloseHandlers$.next(),LF(this._ngZone,this._document,this.autoClose,e=>{this.close(),0===e&&this._anchor.nativeElement.focus()},this._destroyCloseHandlers$,this._menu?[this._menu.nativeElement]:[],this._anchor?[this._anchor.nativeElement]:[],".dropdown-item,.dropdown-divider")}close(){this._open&&(this._open=!1,this._resetContainer(),this._positioning.destroy(),this._afterRenderRef?.destroy(),this._destroyCloseHandlers$.next(),this.openChange.emit(!1),this._changeDetector.markForCheck())}toggle(){this.isOpen()?this.close():this.open()}ngOnDestroy(){this.close()}onKeyDown(e){const{key:i}=e,r=this._getMenuElements();let s=-1,o=null;const a=this._isEventFromToggle(e);if(!a&&r.length&&r.forEach((l,c)=>{l.contains(e.target)&&(o=l),l===bF(this._document)&&(s=c)})," "!==i&&"Enter"!==i){if("Tab"!==i){if(a||o){if(this.open(),r.length){switch(i){case"ArrowDown":s=Math.min(s+1,r.length-1);break;case"ArrowUp":if(this._isDropup()&&-1===s){s=r.length-1;break}s=Math.max(s-1,0);break;case"Home":s=0;break;case"End":s=r.length-1}r[s].focus()}e.preventDefault()}}else if(e.target&&this.isOpen()&&this.autoClose){if(this._anchor.nativeElement===e.target)return void("body"!==this.container||e.shiftKey?e.shiftKey&&this.close():(this._menu.nativeElement.setAttribute("tabindex","0"),this._menu.nativeElement.focus(),this._menu.nativeElement.removeAttribute("tabindex")));if("body"===this.container){const l=this._menu.nativeElement.querySelectorAll(PF);e.shiftKey&&e.target===l[0]?(this._anchor.nativeElement.focus(),e.preventDefault()):!e.shiftKey&&e.target===l[l.length-1]&&(this._anchor.nativeElement.focus(),this.close())}else Nn(e.target,"focusout").pipe(Ki(1)).subscribe(({relatedTarget:l})=>{this._nativeElement.contains(l)||this.close()})}}else o&&(!0===this.autoClose||"inside"===this.autoClose)&&Nn(o,"click").pipe(Ki(1)).subscribe(()=>this.close())}_isDropup(){return this._nativeElement.classList.contains("dropup")}_isEventFromToggle(e){return this._anchor.nativeElement.contains(e.target)}_getMenuElements(){return this._menu?this._menu.menuItems.filter(({disabled:e})=>!e).map(({nativeElement:e})=>e):[]}_positionMenu(){const e=this._menu;this.isOpen()&&e&&("dynamic"===this.display?(this._positioning.update(),this._applyPlacementClasses()):this._applyPlacementClasses(this._getFirstPlacement(this.placement)))}_getFirstPlacement(e){return Array.isArray(e)?e[0]:e.split(" ")[0]}_resetContainer(){this._menu&&this._nativeElement.appendChild(this._menu.nativeElement),this._bodyContainer&&(this._document.body.removeChild(this._bodyContainer),this._bodyContainer=null)}_applyContainer(e=null){if(this._resetContainer(),"body"===e){const i=this._menu.nativeElement,r=this._bodyContainer=this._bodyContainer||this._document.createElement("div");r.style.position="absolute",i.style.position="static",r.style.zIndex="1055",r.appendChild(i),this._document.body.appendChild(r)}this._applyCustomDropdownClass(this.dropdownClass)}_applyCustomDropdownClass(e,i){const r="body"===this.container?this._bodyContainer:this._nativeElement;r&&(i&&r.classList.remove(i),e&&r.classList.add(e))}_applyPlacementClasses(e){if(this._menu){e||(e=this._getFirstPlacement(this.placement)),this._nativeElement.classList.remove("dropup","dropdown"),"static"===this.display?this._menu.nativeElement.setAttribute("data-bs-popper","static"):this._menu.nativeElement.removeAttribute("data-bs-popper");const i=-1!==e.search("^top")?"dropup":"dropdown";this._nativeElement.classList.add(i),this._bodyContainer&&(this._bodyContainer.classList.remove("dropup","dropdown"),this._bodyContainer.classList.add(i))}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=X({type:n,selectors:[["","ngbDropdown",""]],contentQueries:function(i,r,s){if(1&i&&(fn(s,PD,5),fn(s,im,5)),2&i){let o;gt(o=mt())&&(r._menu=o.first),gt(o=mt())&&(r._anchor=o.first)}},hostVars:2,hostBindings:function(i,r){2&i&&Ge("show",r.isOpen())},inputs:{autoClose:"autoClose",dropdownClass:"dropdownClass",_open:[0,"open","_open"],placement:"placement",popperOptions:"popperOptions",container:"container",display:"display"},outputs:{openChange:"openChange"},exportAs:["ngbDropdown"],features:[Pn]})}}return n})(),n2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),Boe=(()=>{class n{constructor(){this._ngbConfig=S(Kg),this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0,this.role="dialog"}get animation(){return this._animation??this._ngbConfig.animation}set animation(e){this._animation=e}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();class ba{constructor(t,e,i){this.nodes=t,this.viewRef=e,this.componentRef=i}}let Uoe=(()=>{class n{constructor(){this._document=S(Jt)}hide(){const e=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),i=this._document.body,r=i.style,{overflow:s,paddingRight:o}=r;if(e>0){const a=parseFloat(window.getComputedStyle(i).paddingRight);r.paddingRight=`${a+e}px`}return r.overflow="hidden",()=>{e>0&&(r.paddingRight=o),r.overflow=s}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),$oe=(()=>{class n{constructor(){this._nativeElement=S(nt).nativeElement,this._zone=S(ke),this._injector=S(at)}ngOnInit(){Fo({mixedReadWrite:()=>Zi(this._zone,this._nativeElement,(e,i)=>{i&&lc(e),e.classList.add("show")},{animation:this.animation,runningTransition:"continue"})},{injector:this._injector})}hide(){return Zi(this._zone,this._nativeElement,({classList:e})=>e.remove("show"),{animation:this.animation,runningTransition:"stop"})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=un({type:n,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(i,r){2&i&&(mu("modal-backdrop"+(r.backdropClass?" "+r.backdropClass:"")),Ge("show",!r.animation)("fade",r.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},decls:0,vars:0,template:function(i,r){},encapsulation:2})}}return n})();class i2{update(t){}close(t){}dismiss(t){}}const Voe=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","role","scrollable","size","windowClass","modalDialogClass"],joe=["animation","backdropClass"];class Hoe{_applyWindowOptions(t,e){Voe.forEach(i=>{ga(e[i])&&(t[i]=e[i])})}_applyBackdropOptions(t,e){joe.forEach(i=>{ga(e[i])&&(t[i]=e[i])})}update(t){this._applyWindowOptions(this._windowCmptRef.instance,t),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,t)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(gn(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(gn(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(t,e,i,r){this._windowCmptRef=t,this._contentRef=e,this._backdropCmptRef=i,this._beforeDismiss=r,this._closed=new Ke,this._dismissed=new Ke,this._hidden=new Ke,t.instance.dismissEvent.subscribe(s=>{this.dismiss(s)}),this.result=new Promise((s,o)=>{this._resolve=s,this._reject=o}),this.result.then(null,()=>{})}close(t){this._windowCmptRef&&(this._closed.next(t),this._resolve(t),this._removeModalElements())}_dismiss(t){this._dismissed.next(t),this._reject(t),this._removeModalElements()}dismiss(t){if(this._windowCmptRef)if(this._beforeDismiss){const e=this._beforeDismiss();!function _F(n){return n&&n.then}(e)?!1!==e&&this._dismiss(t):e.then(i=>{!1!==i&&this._dismiss(t)},()=>{})}else this._dismiss(t)}_removeModalElements(){const t=this._windowCmptRef.instance.hide(),e=this._backdropCmptRef?this._backdropCmptRef.instance.hide():fe(void 0);t.subscribe(()=>{const{nativeElement:i}=this._windowCmptRef.location;i.parentNode.removeChild(i),this._windowCmptRef.destroy(),this._contentRef?.viewRef?.destroy(),this._windowCmptRef=null,this._contentRef=null}),e.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:i}=this._backdropCmptRef.location;i.parentNode.removeChild(i),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),fD(t,e).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var FD=function(n){return n[n.BACKDROP_CLICK=0]="BACKDROP_CLICK",n[n.ESC=1]="ESC",n}(FD||{});let Goe=(()=>{class n{constructor(){this._document=S(Jt),this._elRef=S(nt),this._zone=S(ke),this._injector=S(at),this._closed$=new Ke,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.role="dialog",this.dismissEvent=new _e,this.shown=new Ke,this.hidden=new Ke}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":ac(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(e){this.dismissEvent.emit(e)}ngOnInit(){this._elWithFocus=this._document.activeElement,Fo({mixedReadWrite:()=>this._show()},{injector:this._injector})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:e}=this._elRef,i={animation:this.animation,runningTransition:"stop"},o=fD(Zi(this._zone,e,()=>e.classList.remove("show"),i),Zi(this._zone,this._dialogEl.nativeElement,()=>{},i));return o.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),o}_show(){const e={animation:this.animation,runningTransition:"continue"};fD(Zi(this._zone,this._elRef.nativeElement,(s,o)=>{o&&lc(s),s.classList.add("show")},e),Zi(this._zone,this._dialogEl.nativeElement,()=>{},e)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:e}=this._elRef;this._zone.runOutsideAngular(()=>{Nn(e,"keydown").pipe(gn(this._closed$),pn(r=>"Escape"===r.key)).subscribe(r=>{this.keyboard?requestAnimationFrame(()=>{r.defaultPrevented||this._zone.run(()=>this.dismiss(FD.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let i=!1;Nn(this._dialogEl.nativeElement,"mousedown").pipe(gn(this._closed$),qt(()=>i=!1),Wi(()=>Nn(e,"mouseup").pipe(gn(this._closed$),Ki(1))),pn(({target:r})=>e===r)).subscribe(()=>{i=!0}),Nn(e,"click").pipe(gn(this._closed$)).subscribe(({target:r})=>{e===r&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!i&&this._zone.run(()=>this.dismiss(FD.BACKDROP_CLICK))),i=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:e}=this._elRef;if(!e.contains(document.activeElement)){const i=e.querySelector("[ngbAutofocus]"),r=FF(e)[0];(i||r||e).focus()}}_restoreFocus(){const e=this._document.body,i=this._elWithFocus;let r;r=i&&i.focus&&e.contains(i)?i:e,this._zone.runOutsideAngular(()=>{setTimeout(()=>r.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&Zi(this._zone,this._elRef.nativeElement,({classList:e})=>(e.add("modal-static"),()=>e.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=un({type:n,selectors:[["ngb-modal-window"]],viewQuery:function(i,r){if(1&i&&ms(Hre,7),2&i){let s;gt(s=mt())&&(r._dialogEl=s.first)}},hostAttrs:["tabindex","-1"],hostVars:8,hostBindings:function(i,r){2&i&&(ht("aria-modal",!0)("aria-labelledby",r.ariaLabelledBy)("aria-describedby",r.ariaDescribedBy)("role",r.role),mu("modal d-block"+(r.windowClass?" "+r.windowClass:"")),Ge("fade",r.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",role:"role",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},ngContentSelectors:gF,decls:4,vars:2,consts:[["dialog",""],["role","document"],[1,"modal-content"]],template:function(i,r){1&i&&(function K_(n){const t=O()[15][5];if(!t.projection){const i=t.projection=function cf(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){if(128!==s.type){const o=n?p5(s,n):0;null!==o&&(r[o]?r[o].projectionNext=s:i[o]=s,r[o]=s)}s=s.next}}}(),A(0,"div",1,0)(2,"div",2),function z_(n,t=0,e,i,r,s){const o=O(),a=ye(),l=i?n+1:null;null!==l&&du(o,a,l,i,r,s,null,e);const c=sl(a,26+n,16,null,e||null);null===c.projection&&(c.projection=t),oy();const d=!o[6]||Oo();null===o[15][5].projection[c.projection]&&null!==l?function g5(n,t,e){const i=26+e,r=t.data[i];rl(n[i],tl(n,r,void 0,{dehydratedView:null}),0,$o(r,null))}(o,a,l):d&&!Ws(c)&&function C3(n,t,e){SC(t[11],0,t,e,N0(n,e,t),vC(e.parent||t[5],e,t))}(a,o,c)}(3),x()()),2&i&&mu("modal-dialog"+(r.size?" modal-"+r.size:"")+(r.centered?" modal-dialog-centered":"")+r.fullscreenClass+(r.scrollable?" modal-dialog-scrollable":"")+(r.modalDialogClass?" "+r.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2})}}return n})(),Woe=(()=>{class n{constructor(){this._applicationRef=S(ri),this._injector=S(at),this._environmentInjector=S(An),this._document=S(Jt),this._scrollBar=S(Uoe),this._activeWindowCmptHasChanged=new Ke,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new _e;const e=S(ke);this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const i=this._windowCmpts[this._windowCmpts.length-1];((n,t,e,i=!1)=>{n.runOutsideAngular(()=>{const r=Nn(t,"focusin").pipe(gn(e),Ne(s=>s.target));Nn(t,"keydown").pipe(gn(e),pn(s=>"Tab"===s.key),hD(r)).subscribe(([s,o])=>{const[a,l]=FF(t);(o===a||o===t)&&s.shiftKey&&(l.focus(),s.preventDefault()),o===l&&!s.shiftKey&&(a.focus(),s.preventDefault())}),i&&Nn(t,"click").pipe(gn(e),hD(r),Ne(s=>s[1])).subscribe(s=>s.focus())})})(e,i.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(i.location.nativeElement)}})}_restoreScrollBar(){const e=this._scrollBarRestoreFn;e&&(this._scrollBarRestoreFn=null,e())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(e,i,r){const s=r.container instanceof HTMLElement?r.container:ga(r.container)?this._document.querySelector(r.container):this._document.body;if(!s)throw new Error(`The specified modal container "${r.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const o=new i2,a=(e=r.injector||e).get(An,null)||this._environmentInjector,l=this._getContentRef(e,a,i,o,r);let c=!1!==r.backdrop?this._attachBackdrop(s):void 0,u=this._attachWindowComponent(s,l.nodes),d=new Hoe(u,l,c,r.beforeDismiss);return this._registerModalRef(d),this._registerWindowCmpt(u),d.hidden.pipe(Ki(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(this._document.body.classList.remove("modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),o.close=f=>{d.close(f)},o.dismiss=f=>{d.dismiss(f)},o.update=f=>{d.update(f)},d.update(r),1===this._modalRefs.length&&this._document.body.classList.add("modal-open"),c&&c.instance&&c.changeDetectorRef.detectChanges(),u.changeDetectorRef.detectChanges(),d}get activeInstances(){return this._activeInstances}dismissAll(e){this._modalRefs.forEach(i=>i.dismiss(e))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(e){let i=gv($oe,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(i.hostView),e.appendChild(i.location.nativeElement),i}_attachWindowComponent(e,i){let r=gv(Goe,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:i});return this._applicationRef.attachView(r.hostView),e.appendChild(r.location.nativeElement),r}_getContentRef(e,i,r,s,o){return r?r instanceof Xt?this._createFromTemplateRef(r,s):ac(r)?this._createFromString(r):this._createFromComponent(e,i,r,s,o):new ba([])}_createFromTemplateRef(e,i){const s=e.createEmbeddedView({$implicit:i,close(o){i.close(o)},dismiss(o){i.dismiss(o)}});return this._applicationRef.attachView(s),new ba([s.rootNodes],s)}_createFromString(e){const i=this._document.createTextNode(`${e}`);return new ba([[i]])}_createFromComponent(e,i,r,s,o){const l=gv(r,{environmentInjector:i,elementInjector:at.create({providers:[{provide:i2,useValue:s}],parent:e})}),c=l.location.nativeElement;return o.scrollable&&c.classList.add("component-host-scrollable"),this._applicationRef.attachView(l.hostView),new ba([[c]],l.hostView,l)}_setAriaHidden(e){const i=e.parentElement;i&&e!==this._document.body&&(Array.from(i.children).forEach(r=>{r!==e&&"SCRIPT"!==r.nodeName&&(this._ariaHiddenValues.set(r,r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden","true"))}),this._setAriaHidden(i))}_revertAriaHidden(){this._ariaHiddenValues.forEach((e,i)=>{e?i.setAttribute("aria-hidden",e):i.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(e){const i=()=>{const r=this._modalRefs.indexOf(e);r>-1&&(this._modalRefs.splice(r,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(e),this._activeInstances.emit(this._modalRefs),e.result.then(i,i)}_registerWindowCmpt(e){this._windowCmpts.push(e),this._activeWindowCmptHasChanged.next(),e.onDestroy(()=>{const i=this._windowCmpts.indexOf(e);i>-1&&(this._windowCmpts.splice(i,1),this._activeWindowCmptHasChanged.next())})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Koe=(()=>{class n{constructor(){this._injector=S(at),this._modalStack=S(Woe),this._config=S(Boe)}open(e,i={}){const r={...this._config,animation:this._config.animation,...i};return this._modalStack.open(this._injector,e,r)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(e){this._modalStack.dismissAll(e)}hasOpenModals(){return this._modalStack.hasOpenModals()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),r2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({providers:[Koe]})}}return n})(),a2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),g2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),m2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),y2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),_2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),v2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),b2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),E2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),D2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})();new G("live announcer delay",{providedIn:"root",factory:()=>100});let T2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})(),S2=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({})}}return n})();const aae=[SF,CF,AF,xF,JF,n2,r2,a2,S2,g2,m2,y2,_2,v2,b2,E2,D2,T2];let lae=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n})}static{this.\u0275inj=st({imports:[aae,SF,CF,AF,xF,JF,n2,r2,a2,S2,g2,m2,y2,_2,v2,b2,E2,D2,T2]})}}return n})();const cae=["videoEl"];function uae(n,t){if(1&n){const e=pt();A(0,"button",14),re("click",function(){const r=Ae(e).$implicit;return xe(U().changeSource(r))}),B(1),x()}if(2&n){const e=t.$implicit;N(),Su("",e.ekydum_label,"",e.ekydum_isCurrent?"*":"","")}}function dae(n,t){if(1&n){const e=pt();A(0,"button",14),re("click",function(){const r=Ae(e).$implicit;return xe(U().changeLang(r))}),B(1),x()}if(2&n){const e=t.$implicit,i=U();N(),Su("",e,"",i.selectedLanguage===e?"*":"","")}}function fae(n,t){if(1&n){const e=pt();A(0,"button",14),re("click",function(){const r=Ae(e).$implicit;return xe(U(2).goToChapter(r))}),B(1),x()}if(2&n){const e=t.$implicit,i=t.index;N(),Su("",i+1,". ",e.title,"")}}function hae(n,t){if(1&n&&(A(0,"div",15)(1,"div",10)(2,"button",16),B(3,"Chapters"),x(),A(4,"div",17),de(5,fae,2,2,"button",8),x()()()),2&n){const e=U();N(5),j("ngForOf",e.video.chapters)}}let pae=(()=>{class n{get player(){return this.videoElementRef.nativeElement}constructor(e,i){this.auth=e,this.cdr=i,this.FALLBACK_CONTENT_LANG="en",this.PREF_AUTOPLAY=!0,this.PREF_DEFAULT_QUALITY="max",this.PREF_DEFAULT_CONTENT_LANG="en",this.CAP_HAS_NATIVE_HLS_SUPPORT=!1,this.CAP_HAS_HLS_PLAYER_SUPPORT=!1,this.posterUrl="",this.availableLanguages=[],this.selectedLanguage="en",this.combinedFormats=[],this.localizedFormats=[],this.selectedFormat=null,this.sourceManifestUrl="",this.isFirstLoad=!0,this.qssStrategyMax=!0,this.qssStrategyMin=!1,this.qssStrategyClosest=720,this.qssAvoidNonHls=!0,this.hlsPlayerOptions={debug:!1,enableWorker:!0},this.alive$=new Ke,this.render$=new Ke,this.SERVER_URL=this.auth.getServerUrl()||"http://localhost:3000"}ngAfterViewInit(){this.discoverRuntimeCapabilities(),this.setupRenderer(),this.preferences&&this.applyPreferences(),this.video&&(this.posterUrl=this.video?.thumbnail||"",this.parseFormats(),this.setSelectedSource(this.getDefaultSourceToPlay()),this.CAP_HAS_HLS_PLAYER_SUPPORT&&this.initHlsPlayer(),this.loadSelectedSource()),this.render$.next()}ngOnDestroy(){this.alive$.next(),this.alive$.complete(),this.hls&&this.hls.destroy()}play(){this.player.play().catch(e=>{console.error("Playback Error:",e)})}pause(){this.player.pause()}goToChapter(e){this.player.currentTime=e.start_time,this.render$.next()}changeSource(e){e&&(this.setSelectedSource(e),this.loadSelectedSource())}changeLang(e){this.selectedLanguage=e,this.localizedFormats=this.getLocalizedFormats(this.combinedFormats),this.changeSource(this.getDefaultSourceToPlay())}setSelectedSource(e){e&&(e.ekydum_isCurrent=!0,this.localizedFormats.forEach(i=>{e.format_id===i.format_id?i.ekydum_isCurrent||(i.ekydum_isCurrent=!0):i.ekydum_isCurrent&&(i.ekydum_isCurrent=!1)}),this.selectedFormat=e)}loadSelectedSource(){var e=this.selectedFormat;if(e){this.sourceManifestUrl=this.getProxiedManifestUrl(e.url);var i=this.capturePlayerState();this.hls?(this.hls.loadSource(this.sourceManifestUrl),this.hls.once(nc.Events.MANIFEST_PARSED,()=>{console.log("Manifest loaded"),i.restore()})):this.CAP_HAS_NATIVE_HLS_SUPPORT&&(this.player.src=this.sourceManifestUrl,i.restore()),e.language&&(!this.selectedLanguage||!e.language.startsWith(this.selectedLanguage))&&(this.selectedLanguage=e.language),this.render$.next()}}applyPreferences(){var e=this.preferences;if(Array.isArray(e)){var i=e.find(a=>"DEFAULT_QUALITY"===a.key);if(i)if(this.PREF_DEFAULT_QUALITY=i.value,"max"===this.PREF_DEFAULT_QUALITY)this.qssStrategyMax=!0,this.qssStrategyMin=!1;else if("min"===this.PREF_DEFAULT_QUALITY)this.qssStrategyMax=!1,this.qssStrategyMin=!0;else if(/^\d+p$/.test(this.PREF_DEFAULT_QUALITY+"")){var r=~~+this.PREF_DEFAULT_QUALITY.replace("p","");r>100&&r<1e5&&(this.qssStrategyMax=!1,this.qssStrategyMin=!1,this.qssStrategyClosest=r)}var s=e.find(a=>"LANG"===a.key);s&&(this.PREF_DEFAULT_CONTENT_LANG=(s.value+"").toLowerCase(),this.selectedLanguage=this.PREF_DEFAULT_CONTENT_LANG);var o=e.find(a=>"AUTO_PLAY"===a.key);o&&(this.PREF_AUTOPLAY=!!+o.value)}}initHlsPlayer(){this.hls=new nc(this.hlsPlayerOptions),this.hls.attachMedia(this.player),this.hls.on(nc.Events.ERROR,(e,i)=>this.handleHlsError(i))}parseFormats(){var e=this.video.formats;this.availableLanguages=this.extractAvailableLanguages(e),this.combinedFormats=this.sortFormatsByHeight(this.getCombinedFormats(e)),this.localizedFormats=this.getLocalizedFormats(this.combinedFormats)}getDefaultSourceToPlay(){var e=this.localizedFormats;return this.qssStrategyMax&&this.qssGetMaxQuality(e)||this.qssStrategyMin&&this.qssGetMinQuality(e)||this.qssStrategyClosest&&this.qssGetClosestQuality(e,this.qssStrategyClosest)||e[0]}extractAvailableLanguages(e){return Array.from(new Set(e.map(i=>i.language).filter(i=>!!i)))}getCombinedFormats(e){return e.filter(i=>i.vcodec&&"none"!==i.vcodec&&i.acodec&&"none"!==i.acodec).map(i=>{var r=(i?.protocol||"")+"",s=r.includes("m3u8"),o=i.height+"p"+(s?" HLS":" "+r.toUpperCase());return Object.assign({},i,{ekydum_sourceKind:KP.COMBINED,ekydum_isCurrent:!1,ekydum_isHls:s,ekydum_label:o})})}sortFormatsByHeight(e){return e.sort((i,r)=>(r.height||0)-(i.height||0))}getLocalizedFormats(e){var i=this.selectedLanguage,r=this.FALLBACK_CONTENT_LANG,s=e.filter(o=>o.language===i);return 0===s.length&&r!==i&&(s=e.filter(o=>o.language===r)),0===s.length&&(s=e),s}getProxiedManifestUrl(e){return`${this.SERVER_URL}/hls/m3u8?url=${encodeURIComponent(e)}&token=${this.auth.getAccountToken()}`}capturePlayerState(){var e=this.player;return{currentTime:e.currentTime,wasPlaying:!e.paused,self:this,restore(){e.currentTime=this.currentTime;var i=this.self;i.isFirstLoad?(i.isFirstLoad=!1,i.PREF_AUTOPLAY&&i.play()):this.wasPlaying&&i.play()}}}handleHlsError(e){if(e.fatal){var i=e.type;i===nc.ErrorTypes.NETWORK_ERROR?(console.log("Network error, trying to recover..."),this.hls.startLoad()):i===nc.ErrorTypes.MEDIA_ERROR?(console.log("Media error, trying to recover..."),this.hls.recoverMediaError()):(console.log("Fatal error, destroying player..."),this.hls.destroy()),this.render$.next()}}discoverRuntimeCapabilities(){this.CAP_HAS_NATIVE_HLS_SUPPORT=!!this.player.canPlayType("application/vnd.apple.mpegurl"),this.CAP_HAS_HLS_PLAYER_SUPPORT=nc.isSupported()}setupRenderer(){this.render$.pipe(gn(this.alive$),function Vne(n,t=uD,e){const i=dD(n,t);return function Une(n,t){return Wt((e,i)=>{const{leading:r=!0,trailing:s=!1}=t??{};let o=!1,a=null,l=null,c=!1;const u=()=>{l?.unsubscribe(),l=null,s&&(h(),c&&i.complete())},d=()=>{l=null,c&&i.complete()},f=p=>l=Tn(n(p)).subscribe(dt(i,u,d)),h=()=>{if(o){o=!1;const p=a;a=null,i.next(p),!c&&f(p)}};e.subscribe(dt(i,p=>{o=!0,a=p,(!l||l.closed)&&(r?h():f(p))},()=>{c=!0,(!(s&&o&&l)||l.closed)&&i.complete()}))})}(()=>i,e)}(100),qt(()=>this.cdr.detectChanges())).subscribe()}qssGetMaxQuality(e){var i=0,r=null,s=this.qssAvoidNonHls;return e.forEach(o=>{(!s||o.ekydum_isHls)&&o.height&&o.height>i&&(i=o.height,r=o)}),r}qssGetMinQuality(e){var i=Number.MAX_SAFE_INTEGER,r=null,s=this.qssAvoidNonHls;return e.forEach(o=>{(!s||o.ekydum_isHls)&&o.height&&o.height<i&&(i=o.height,r=o)}),r}qssGetClosestQuality(e,i){var r=Number.MAX_SAFE_INTEGER,s=null,o=this.qssAvoidNonHls;return e.forEach(a=>{if((!o||a.ekydum_isHls)&&a.height){var l=Math.abs(a.height-i);l<r&&(r=l,s=a)}}),s}static{this.\u0275fac=function(i){return new(i||n)(F(od),F(ji))}}static{this.\u0275cmp=un({type:n,selectors:[["app-ekydum-player"]],viewQuery:function(i,r){if(1&i&&ms(cae,5),2&i){let s;gt(s=mt())&&(r.videoElementRef=s.first)}},inputs:{video:"video",preferences:"preferences"},standalone:!1,decls:17,vars:6,consts:[["videoEl",""],["data-bs-theme","dark",1,"player-container"],["controls","",1,"video-element",3,"poster"],[1,"controls","d-flex"],[1,"control-item","quality-select"],["ngbDropdown","","placement","top-start",1,"d-inline-block"],["type","button","id","ctrlQuality","ngbDropdownToggle","",1,"btn","btn-sm","btn-outline-secondary"],["ngbDropdownMenu","","aria-labelledby","ctrlQuality",1,"multi-column-dropdown"],["ngbDropdownItem","",3,"click",4,"ngFor","ngForOf"],[1,"control-item","source-language-select"],["ngbDropdown","","display","dynamic","placement","top-start",1,"d-inline-block"],["type","button","id","ctrlLang","ngbDropdownToggle","",1,"btn","btn-sm","btn-outline-secondary"],["ngbDropdownMenu","","aria-labelledby","ctrlLang",1,"multi-column-dropdown"],["class","control-item chapters",4,"ngIf"],["ngbDropdownItem","",3,"click"],[1,"control-item","chapters"],["type","button","id","ctrlChapters","ngbDropdownToggle","",1,"btn","btn-sm","btn-outline-secondary"],["ngbDropdownMenu","","aria-labelledby","ctrlChapters",1,"multi-column-dropdown",2,"columns","2"]],template:function(i,r){1&i&&(A(0,"div",1),oe(1,"video",2,0),A(3,"div",3)(4,"div",4)(5,"div",5)(6,"button",6),B(7),x(),A(8,"div",7),de(9,uae,2,2,"button",8),x()()(),A(10,"div",9)(11,"div",10)(12,"button",11),B(13),x(),A(14,"div",12),de(15,dae,2,2,"button",8),x()()(),de(16,hae,6,1,"div",13),x()()),2&i&&(N(),j("poster",r.posterUrl,Jf),N(6),hn((null==r.selectedFormat?null:r.selectedFormat.ekydum_label)||"-"),N(2),j("ngForOf",r.localizedFormats),N(4),hn(r.selectedLanguage),N(2),j("ngForOf",r.availableLanguages),N(),j("ngIf",null==r.video||null==r.video.chapters?null:r.video.chapters.length))},dependencies:[xl,Xo,rm,t2,PD,nm,e2],styles:[".player-container[_ngcontent-%COMP%]{width:100%;background:#000}.player-container[_ngcontent-%COMP%]   .video-element[_ngcontent-%COMP%]{width:100%;aspect-ratio:16/9;background:#000}.player-container[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:.6rem 1rem 1rem}.player-container[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .multi-column-dropdown[_ngcontent-%COMP%]{columns:3;column-gap:1rem;max-height:600px;overflow-y:auto}.player-container[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]   .multi-column-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{break-inside:avoid;page-break-inside:avoid}"],changeDetection:0})}}return n})();const gae=n=>["/channel/",n];function mae(n,t){1&n&&(A(0,"div",3),oe(1,"div",4),x())}function yae(n,t){if(1&n&&(A(0,"span"),oe(1,"i",14),B(2),x()),2&n){const e=U(2);N(2),zt(" ",e.formatDate(e.video.upload_date)," ")}}function _ae(n,t){if(1&n&&(A(0,"span"),oe(1,"i",15),B(2),x()),2&n){const e=U(2);N(2),zt(" ",e.formatDuration(e.video.duration)," ")}}function vae(n,t){if(1&n&&(A(0,"span"),oe(1,"i",16),B(2),x()),2&n){const e=U(2);N(2),zt(" ",e.formatViews(e.video.view_count)," views ")}}function bae(n,t){if(1&n&&(A(0,"div",17)(1,"h6"),B(2,"Description"),x(),A(3,"p",18),B(4),x()()),2&n){const e=U(2);N(4),hn(e.video.description)}}function Eae(n,t){if(1&n){const e=pt();A(0,"div")(1,"button",5),re("click",function(){return Ae(e),xe(U().goBack())}),oe(2,"i",6),B(3," Back "),x(),A(4,"div",7),oe(5,"app-ekydum-player",8),x(),A(6,"div",9)(7,"h3"),B(8),x(),A(9,"div",10)(10,"span"),oe(11,"i",11),A(12,"a",12),B(13),x()(),de(14,yae,3,1,"span",2)(15,_ae,3,1,"span",2)(16,vae,3,1,"span",2),x(),de(17,bae,5,1,"div",13),x()()}if(2&n){const e=U();N(5),j("video",e.video)("preferences",e.preferences),N(3),hn(e.video.title),N(4),j("routerLink",function Sl(n,t,e,i){return ZA(O(),Vn(),n,t,e,i)}(9,gae,e.video.channel_id)),N(),hn(e.video.channel||e.video.uploader),N(),j("ngIf",e.video.upload_date),N(),j("ngIf",e.video.duration),N(),j("ngIf",e.video.view_count),N(),j("ngIf",e.video.description)}}let Dae=(()=>{class n{constructor(e,i,r){this.route=e,this.router=i,this.api=r,this.videoId="",this.video=null,this.loading=!1,this.alive$=new Ke}ngOnInit(){this.videoId=this.route.snapshot.paramMap.get("id")||"",this.videoId&&this.load()}ngOnDestroy(){this.alive$.next(),this.alive$.complete()}load(){this.loading=!0,QN([this.loadVideo(),this.loadPreferences()]).pipe(gn(this.alive$),qt(()=>{this.loading=!1}),It(e=>(this.loading=!1,console.error(e),fe(null)))).subscribe()}loadVideo(){return this.api.getVideo(this.videoId).pipe(qt(e=>{this.video=e}),It(e=>(console.error("cannot load video info",e),fe(null))))}loadPreferences(){return this.api.getSettings().pipe(qt(e=>{this.preferences=e.settings}),It(e=>(console.error("cannot load preferences",e),fe(null))))}formatDate(e){return e?`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`:""}formatDuration(e){var i=Math.floor(e/3600),r=Math.floor(e%3600/60),s=e%60;return i>0?`${i}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`}formatViews(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString()}goBack(){this.router.navigate(this.video?["/channel",this.video.channel_id]:["/subscriptions"])}static{this.\u0275fac=function(i){return new(i||n)(F(ia),F(gr),F(ad))}}static{this.\u0275cmp=un({type:n,selectors:[["app-watch"]],standalone:!1,decls:3,vars:2,consts:[[1,"container"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"btn","btn-outline-secondary","mb-3",2,"margin-left","48px",3,"click"],[1,"fas","fa-arrow-left","me-2"],[1,"player-container","mb-3"],[3,"video","preferences"],[1,"video-info"],[1,"d-flex","flex-wrap","gap-3","text-muted","mb-3"],[1,"fas","fa-tv","me-2"],[3,"routerLink"],["class","border rounded p-3 bg-light",4,"ngIf"],[1,"fas","fa-calendar","me-2"],[1,"fas","fa-clock","me-2"],[1,"fas","fa-eye","me-2"],[1,"border","rounded","p-3","bg-light"],[1,"mb-0",2,"white-space","pre-wrap"]],template:function(i,r){1&i&&(A(0,"div",0),de(1,mae,2,0,"div",1)(2,Eae,18,11,"div",2),x()),2&i&&(N(),j("ngIf",r.loading),N(),j("ngIf",!r.loading&&r.video))},dependencies:[Xo,Bl,pae],encapsulation:2})}}return n})();function Tae(n,t){if(1&n&&(A(0,"div",19),oe(1,"i",20),B(2," Connected as: "),A(3,"strong"),B(4),x()()),2&n){const e=U();N(4),hn(e.accountInfo.name)}}function Sae(n,t){1&n&&(A(0,"div",24),oe(1,"div",25),x())}function Cae(n,t){if(1&n){const e=pt();A(0,"div")(1,"div",7)(2,"label",8),B(3,"Default Quality"),x(),A(4,"select",26),Ei("ngModelChange",function(r){Ae(e);const s=U(2);return Vi(s.defaultQuality,r)||(s.defaultQuality=r),xe(r)}),re("change",function(){return Ae(e),xe(U(2).updateQuality())}),A(5,"option",27),B(6,"Minimum"),x(),A(7,"option",28),B(8,"360p"),x(),A(9,"option",29),B(10,"480p"),x(),A(11,"option",30),B(12,"720p (Recommended)"),x(),A(13,"option",31),B(14,"1080p"),x(),A(15,"option",32),B(16,"2K"),x(),A(17,"option",33),B(18,"4K"),x(),A(19,"option",34),B(20,"Maximum"),x()()(),A(21,"div",7)(22,"label",8),B(23,"Page Size"),x(),A(24,"select",26),Ei("ngModelChange",function(r){Ae(e);const s=U(2);return Vi(s.pageSize,r)||(s.pageSize=r),xe(r)}),re("change",function(){return Ae(e),xe(U(2).updatePageSize())}),A(25,"option",35),B(26,"10"),x(),A(27,"option",35),B(28,"20"),x(),A(29,"option",35),B(30,"30"),x(),A(31,"option",35),B(32,"50"),x(),A(33,"option",35),B(34,"100"),x(),A(35,"option",35),B(36,"200"),x(),A(37,"option",35),B(38,"300"),x(),A(39,"option",35),B(40,"500"),x()(),A(41,"small",10),B(42,"Number of videos per page"),x()(),A(43,"div",7)(44,"label",8),B(45,"Content Language"),x(),A(46,"input",36),Ei("ngModelChange",function(r){Ae(e);const s=U(2);return Vi(s.lang,r)||(s.lang=r),xe(r)}),re("change",function(){return Ae(e),xe(U(2).updateLang())}),x(),A(47,"small",10),B(48,'Language code, for eg. "en", "de"'),x()(),A(49,"div",7)(50,"label",8),B(51,"Play video automatically"),x(),A(52,"select",26),Ei("ngModelChange",function(r){Ae(e);const s=U(2);return Vi(s.autoPlay,r)||(s.autoPlay=r),xe(r)}),re("change",function(){return Ae(e),xe(U(2).updateAutoPlay())}),A(53,"option",35),B(54,"Yes"),x(),A(55,"option",35),B(56,"No"),x()()()()}if(2&n){const e=U(2);N(4),bi("ngModel",e.defaultQuality),N(20),bi("ngModel",e.pageSize),N(),j("value",10),N(2),j("value",20),N(2),j("value",30),N(2),j("value",50),N(2),j("value",100),N(2),j("value",200),N(2),j("value",300),N(2),j("value",500),N(7),bi("ngModel",e.lang),N(6),bi("ngModel",e.autoPlay),N(),j("value",1),N(2),j("value",0)}}function Iae(n,t){if(1&n&&(A(0,"div",21)(1,"div",4)(2,"h5",5),B(3,"User Preferences"),x()(),A(4,"div",6),de(5,Sae,2,0,"div",22)(6,Cae,57,14,"div",23),x()()),2&n){const e=U();N(5),j("ngIf",e.loadingSettings),N(),j("ngIf",!e.loadingSettings)}}let wae=(()=>{class n{constructor(e,i,r){this.api=e,this.auth=i,this.toast=r,this.serverUrl="http://localhost:3000",this.accountToken="",this.isConnected=!1,this.saving=!1,this.accountInfo=null,this.loadingSettings=!1,this.defaultQuality="720p",this.pageSize=40,this.lang="en",this.autoPlay=1}ngOnInit(){var e=this.auth.getServerUrl(),i=this.auth.getAccountToken();e&&(this.serverUrl=e),i&&(this.accountToken=i,this.isConnected=!0,this.loadAccountInfo(),this.loadSettings())}saveConnection(){this.serverUrl&&this.accountToken?(this.saving=!0,this.auth.setServerUrl(this.serverUrl),this.auth.setAccountToken(this.accountToken),this.api.getMe().subscribe({next:e=>{this.accountInfo=e,this.isConnected=!0,this.saving=!1,this.toast.success("Connected successfully"),this.loadSettings()},error:()=>{this.saving=!1,this.isConnected=!1}})):this.toast.error("Please fill in all fields")}disconnect(){this.auth.clearAccountToken(),this.accountToken="",this.isConnected=!1,this.accountInfo=null,this.toast.info("Disconnected")}loadAccountInfo(){this.api.getMe().subscribe({next:e=>{this.accountInfo=e}})}loadSettings(){this.loadingSettings=!0,this.api.getSettings().pipe(Ne(e=>e.settings)).subscribe({next:e=>{var i=e.find(a=>"DEFAULT_QUALITY"===a.key),r=e.find(a=>"PAGE_SIZE"===a.key),s=e.find(a=>"LANG"===a.key),o=e.find(a=>"AUTO_PLAY"===a.key);i&&(this.defaultQuality=i.value),r&&(this.pageSize=parseInt(r.value)),s&&(this.lang=s.value),o&&(this.autoPlay=+o.value||0),this.loadingSettings=!1},error:()=>{this.loadingSettings=!1}})}updateQuality(){this.api.updateSetting("DEFAULT_QUALITY",this.defaultQuality).subscribe({next:()=>{this.toast.success("Quality updated")}})}updatePageSize(){this.api.updateSetting("PAGE_SIZE",this.pageSize).subscribe({next:()=>{this.toast.success("Page size updated")}})}updateLang(){this.lang&&2===this.lang.length&&this.api.updateSetting("LANG",this.lang).subscribe({next:()=>{this.toast.success("Language updated")}})}updateAutoPlay(){this.api.updateSetting("AUTO_PLAY",this.autoPlay).subscribe({next:()=>{this.toast.success("Auto-play updated")}})}static{this.\u0275fac=function(i){return new(i||n)(F(ad),F(od),F(Lu))}}static{this.\u0275cmp=un({type:n,selectors:[["app-settings"]],standalone:!1,decls:30,vars:7,consts:[[1,"container"],[1,"mb-4",2,"margin-left","48px"],[1,"fas","fa-cog","me-2"],[1,"card","mb-4"],[1,"card-header"],[1,"mb-0"],[1,"card-body"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","http://localhost:3000",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-muted"],["type","password","placeholder","Enter your account token",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-save","me-2"],[1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-sign-out-alt","me-2"],["class","alert alert-success mt-3",4,"ngIf"],["class","card",4,"ngIf"],[1,"alert","alert-success","mt-3"],[1,"fas","fa-check-circle","me-2"],[1,"card"],["class","text-center py-3",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-3"],["role","status",1,"spinner-border","text-primary"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value","min"],["value","360p"],["value","480p"],["value","720p"],["value","1080p"],["value","2k"],["value","4k"],["value","max"],[3,"value"],["type","text","maxlength","2","minlength","2",1,"form-control",3,"ngModelChange","change","ngModel"]],template:function(i,r){1&i&&(A(0,"div",0)(1,"h2",1),oe(2,"i",2),B(3," Settings "),x(),A(4,"div",3)(5,"div",4)(6,"h5",5),B(7,"Server Configuration"),x()(),A(8,"div",6)(9,"div",7)(10,"label",8),B(11,"Server URL"),x(),A(12,"input",9),Ei("ngModelChange",function(o){return Vi(r.serverUrl,o)||(r.serverUrl=o),o}),x(),A(13,"small",10),B(14,"Ekydum server URL"),x()(),A(15,"div",7)(16,"label",8),B(17,"Account Token"),x(),A(18,"input",11),Ei("ngModelChange",function(o){return Vi(r.accountToken,o)||(r.accountToken=o),o}),x(),A(19,"small",10),B(20,"Token from server admin"),x()(),A(21,"div",12)(22,"button",13),re("click",function(){return r.saveConnection()}),oe(23,"i",14),B(24),x(),A(25,"button",15),re("click",function(){return r.disconnect()}),oe(26,"i",16),B(27," Disconnect "),x()(),de(28,Tae,5,1,"div",17),x()(),de(29,Iae,7,2,"div",18),x()),2&i&&(N(12),bi("ngModel",r.serverUrl),N(6),bi("ngModel",r.accountToken),N(4),j("disabled",r.saving),N(2),zt(" ",r.saving?"Saving...":"Save & Connect"," "),N(),j("disabled",!r.isConnected),N(3),j("ngIf",r.accountInfo),N(),j("ngIf",r.isConnected))},dependencies:[Xo,jO,GO,$l,ng,Vp,Yb,Qb,fd],encapsulation:2})}}return n})();function Aae(n,t){1&n&&(A(0,"div",19),oe(1,"i",20),B(2," Admin access granted "),x())}function xae(n,t){1&n&&(A(0,"div",34),oe(1,"div",35),x())}function Rae(n,t){1&n&&(A(0,"div",36),B(1," No accounts found "),x())}function Mae(n,t){if(1&n&&(A(0,"div"),B(1),x()),2&n){const e=U().$implicit;N(),zt(" ",e.name," ")}}function Nae(n,t){if(1&n){const e=pt();A(0,"input",45),Ei("ngModelChange",function(r){Ae(e);const s=U(4);return Vi(s.editingName,r)||(s.editingName=r),xe(r)}),re("keyup.enter",function(){Ae(e);const r=U().$implicit;return xe(U(3).saveEdit(r.id))}),x()}2&n&&bi("ngModel",U(4).editingName)}function Oae(n,t){if(1&n){const e=pt();A(0,"div",46)(1,"button",47),re("click",function(){Ae(e);const r=U().$implicit;return xe(U(3).startEdit(r))}),oe(2,"i",48),x(),A(3,"button",49),re("click",function(){Ae(e);const r=U().$implicit;return xe(U(3).deleteAccount(r.id))}),oe(4,"i",50),x()()}}function kae(n,t){if(1&n){const e=pt();A(0,"div",46)(1,"button",51),re("click",function(){Ae(e);const r=U().$implicit;return xe(U(3).saveEdit(r.id))}),oe(2,"i",52),x(),A(3,"button",53),re("click",function(){return Ae(e),xe(U(4).cancelEdit())}),oe(4,"i",54),x()()}}function Lae(n,t){if(1&n){const e=pt();A(0,"tr")(1,"td"),de(2,Mae,2,1,"div",18)(3,Nae,1,1,"input",40),x(),A(4,"td")(5,"code",41),B(6),x(),A(7,"button",42),re("click",function(){const r=Ae(e).$implicit;return xe(U(3).copyToken(r.token))}),oe(8,"i",43),x()(),A(9,"td")(10,"small"),B(11),Fh(12,"date"),x()(),A(13,"td"),de(14,Oae,5,0,"div",44)(15,kae,5,0,"div",44),x()()}if(2&n){const e=t.$implicit,i=U(3);N(2),j("ngIf",i.editingId!==e.id),N(),j("ngIf",i.editingId===e.id),N(3),zt("",e.token.substring(0,20),"..."),N(5),hn(ev(12,6,e.created_at,"short")),N(3),j("ngIf",i.editingId!==e.id),N(),j("ngIf",i.editingId===e.id)}}function Pae(n,t){if(1&n&&(A(0,"div",37)(1,"table",38)(2,"thead")(3,"tr")(4,"th"),B(5,"Name"),x(),A(6,"th"),B(7,"Token"),x(),A(8,"th"),B(9,"Created"),x(),A(10,"th"),B(11,"Actions"),x()()(),A(12,"tbody"),de(13,Lae,16,9,"tr",39),x()()()),2&n){const e=U(2);N(13),j("ngForOf",e.accounts)}}function Fae(n,t){if(1&n){const e=pt();A(0,"div")(1,"div",3)(2,"div",4)(3,"h5",5),B(4,"Create New Account"),x()(),A(5,"div",6)(6,"div",21)(7,"div",22)(8,"input",23),Ei("ngModelChange",function(r){Ae(e);const s=U();return Vi(s.newAccountName,r)||(s.newAccountName=r),xe(r)}),x()(),A(9,"div",24)(10,"button",25),re("click",function(){return Ae(e),xe(U().createAccount())}),oe(11,"i",26),B(12),x()()()()(),A(13,"div",27)(14,"div",28)(15,"h5",5),B(16,"Accounts"),x(),A(17,"button",29),re("click",function(){return Ae(e),xe(U().loadAccounts())}),oe(18,"i",30),B(19," Refresh "),x()(),A(20,"div",6),de(21,xae,2,0,"div",31)(22,Rae,2,0,"div",32)(23,Pae,14,1,"div",33),x()()()}if(2&n){const e=U();N(8),bi("ngModel",e.newAccountName),N(2),j("disabled",!e.newAccountName||e.creating),N(2),zt(" ",e.creating?"Creating...":"Create"," "),N(9),j("ngIf",e.loading),N(),j("ngIf",!e.loading&&0===e.accounts.length),N(),j("ngIf",!e.loading&&e.accounts.length>0)}}const Bae=[{path:"",redirectTo:"/subscriptions",pathMatch:"full"},{path:"subscriptions",component:EX},{path:"channel/:id",component:OX},{path:"watch/:id",component:Dae},{path:"settings",component:wae},{path:"manage",component:(()=>{class n{constructor(e,i,r){this.api=e,this.auth=i,this.toast=r,this.serverUrl="http://localhost:3000",this.adminToken="",this.isAdmin=!1,this.accounts=[],this.loading=!1,this.creating=!1,this.newAccountName="",this.editingId=null,this.editingName=""}ngOnInit(){var e=this.auth.getServerUrl();e&&(this.serverUrl=e);var i=this.auth.getAdminToken();i&&(this.adminToken=i,this.isAdmin=!0,this.loadAccounts())}saveAdminToken(){this.serverUrl?(this.auth.setServerUrl(this.serverUrl),this.adminToken?(this.auth.setAdminToken(this.adminToken),this.api.getAccounts().subscribe({next:()=>{this.isAdmin=!0,this.toast.success("Admin access granted"),this.loadAccounts()},error:()=>{this.auth.clearAdminToken(),this.isAdmin=!1,this.adminToken=""}})):this.toast.error("Please enter admin token")):this.toast.error("Please enter server URL")}adminLogout(){this.auth.clearAdminToken(),this.adminToken="",this.isAdmin=!1,this.accounts=[],this.toast.info("Admin logged out")}loadAccounts(){this.loading=!0,this.api.getAccounts().subscribe({next:e=>{this.accounts=e?.accounts||[],this.loading=!1},error:()=>{this.loading=!1}})}createAccount(){this.newAccountName?(this.creating=!0,this.api.createAccount(this.newAccountName).subscribe({next:e=>{this.toast.success("Account created successfully"),this.newAccountName="",this.creating=!1,this.loadAccounts(),this.toast.info("Token: "+e.token)},error:()=>{this.creating=!1}})):this.toast.error("Please enter account name")}startEdit(e){this.editingId=e.id,this.editingName=e.name}saveEdit(e){this.editingName?this.api.updateAccount(e,this.editingName).subscribe({next:()=>{this.toast.success("Account updated"),this.editingId=null,this.editingName="",this.loadAccounts()}}):this.toast.error("Name cannot be empty")}cancelEdit(){this.editingId=null,this.editingName=""}deleteAccount(e){confirm("Are you sure you want to delete this account?")&&this.api.deleteAccount(e).subscribe({next:()=>{this.toast.success("Account deleted"),this.loadAccounts()}})}copyToken(e){navigator.clipboard.writeText(e).then(()=>{this.toast.success("Token copied to clipboard")}).catch(()=>{this.toast.error("Failed to copy token")})}static{this.\u0275fac=function(i){return new(i||n)(F(ad),F(od),F(Lu))}}static{this.\u0275cmp=un({type:n,selectors:[["app-manage"]],standalone:!1,decls:28,vars:7,consts:[[1,"container"],[1,"mb-4",2,"margin-left","48px"],[1,"fas","fa-users-cog","me-2"],[1,"card","mb-4"],[1,"card-header"],[1,"mb-0"],[1,"card-body"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","http://localhost:3000",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-muted"],["type","password","placeholder","Enter admin token",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"d-flex","gap-2"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-save","me-2"],[1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-sign-out-alt","me-2"],["class","alert alert-success mt-3",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-success","mt-3"],[1,"fas","fa-check-circle","me-2"],[1,"row","g-2"],[1,"col"],["type","text","placeholder","Account name",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-auto"],[1,"btn","btn-success",3,"click","disabled"],[1,"fas","fa-plus","me-2"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"fas","fa-sync","me-1"],["class","text-center py-3",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-center","py-3"],["role","status",1,"spinner-border","text-primary"],[1,"alert","alert-info"],[1,"table-responsive"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],["type","text","class","form-control form-control-sm",3,"ngModel","ngModelChange","keyup.enter",4,"ngIf"],[1,"small"],[1,"btn","btn-sm","btn-link","p-0","ms-2",3,"click"],[1,"fas","fa-copy"],["class","btn-group btn-group-sm",4,"ngIf"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],[1,"btn","btn-success",3,"click"],[1,"fas","fa-check"],[1,"btn","btn-secondary",3,"click"],[1,"fas","fa-times"]],template:function(i,r){1&i&&(A(0,"div",0)(1,"h2",1),oe(2,"i",2),B(3," Manage Accounts "),x(),A(4,"div",3)(5,"div",4)(6,"h5",5),B(7,"Admin Authentication"),x()(),A(8,"div",6)(9,"div",7)(10,"label",8),B(11,"Server URL"),x(),A(12,"input",9),Ei("ngModelChange",function(o){return Vi(r.serverUrl,o)||(r.serverUrl=o),o}),x(),A(13,"small",10),B(14,"Ekydum server URL"),x()(),A(15,"div",7)(16,"label",8),B(17,"Admin Token"),x(),A(18,"input",11),Ei("ngModelChange",function(o){return Vi(r.adminToken,o)||(r.adminToken=o),o}),x()(),A(19,"div",12)(20,"button",13),re("click",function(){return r.saveAdminToken()}),oe(21,"i",14),B(22," Save & Login "),x(),A(23,"button",15),re("click",function(){return r.adminLogout()}),oe(24,"i",16),B(25," Admin Logout "),x()(),de(26,Aae,3,0,"div",17),x()(),de(27,Fae,24,6,"div",18),x()),2&i&&(N(12),bi("ngModel",r.serverUrl),N(6),bi("ngModel",r.adminToken),j("disabled",r.isAdmin),N(2),j("disabled",r.isAdmin||!r.adminToken),N(3),j("disabled",!r.isAdmin),N(3),j("ngIf",r.isAdmin),N(),j("ngIf",r.isAdmin))},dependencies:[xl,Xo,$l,Vp,fd,Rv],encapsulation:2})}}return n})()}];let Uae=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ft({type:n,bootstrap:[L7]})}static{this.\u0275inj=st({providers:[cQ()],imports:[RR,A7.forRoot(Bae),kz,uX,lae]})}}return n})();Oz().bootstrapModule(Uae).catch(n=>console.error(n))}},Ns=>{var fi=Nt=>Ns(Ns.s=Nt);fi(532),fi(571)}]);